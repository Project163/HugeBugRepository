diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/AbstractLayeredFileProvider.java b/core/src/main/java/org/apache/commons/vfs2/provider/AbstractLayeredFileProvider.java
index 13579836..5d7a46cb 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/AbstractLayeredFileProvider.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/AbstractLayeredFileProvider.java
@@ -80,7 +80,7 @@ public abstract class AbstractLayeredFileProvider
     {
         // Check if cached
         final FileName rootName = file.getName();
-        FileSystem fs = findFileSystem(rootName, null);
+        FileSystem fs = findFileSystem(rootName, fileSystemOptions); // TODO
         if (fs == null)
         {
             // Create the file system
diff --git a/core/src/test/java/org/apache/commons/vfs2/provider/tar/test/NestedTarTestCase.java b/core/src/test/java/org/apache/commons/vfs2/provider/tar/test/NestedTarTestCase.java
index eb7df8db..cc181794 100644
--- a/core/src/test/java/org/apache/commons/vfs2/provider/tar/test/NestedTarTestCase.java
+++ b/core/src/test/java/org/apache/commons/vfs2/provider/tar/test/NestedTarTestCase.java
@@ -20,7 +20,11 @@ import junit.framework.Test;
 
 import org.apache.commons.AbstractVfsTestCase;
 import org.apache.commons.vfs2.FileObject;
+import org.apache.commons.vfs2.FileSystemConfigBuilder;
 import org.apache.commons.vfs2.FileSystemManager;
+import org.apache.commons.vfs2.FileSystemOptions;
+import org.apache.commons.vfs2.auth.StaticUserAuthenticator;
+import org.apache.commons.vfs2.impl.DefaultFileSystemConfigBuilder;
 import org.apache.commons.vfs2.impl.DefaultFileSystemManager;
 import org.apache.commons.vfs2.provider.tar.TarFileProvider;
 import org.apache.commons.vfs2.test.AbstractProviderTestConfig;
@@ -60,12 +64,16 @@ public class NestedTarTestCase
     @Override
     public FileObject getBaseTestFolder(final FileSystemManager manager) throws Exception
     {
+        // We test with non-empty FS options to make sure they are propagated
+        final FileSystemOptions opts = new FileSystemOptions();
+        DefaultFileSystemConfigBuilder.getInstance().setUserAuthenticator(opts, new StaticUserAuthenticator("domain",  null,  null));
+
         // Locate the base Tar file
         final String tarFilePath = AbstractVfsTestCase.getTestResource("nested.tar").getAbsolutePath();
-        final String uri = "tar:file:" + tarFilePath + "!/test.tar";
-        final FileObject tarFile = manager.resolveFile(uri);
 
         // Now build the nested file system
+        final String uri = "tar:file:" + tarFilePath + "!/test.tar";
+        final FileObject tarFile = manager.resolveFile(uri, opts);
         final FileObject nestedFS = manager.createFileSystem(tarFile);
         return nestedFS.resolveFile("/");
     }
diff --git a/core/src/test/java/org/apache/commons/vfs2/test/UrlTests.java b/core/src/test/java/org/apache/commons/vfs2/test/UrlTests.java
index 85175b16..ec269f1b 100644
--- a/core/src/test/java/org/apache/commons/vfs2/test/UrlTests.java
+++ b/core/src/test/java/org/apache/commons/vfs2/test/UrlTests.java
@@ -23,6 +23,7 @@ import java.net.URLConnection;
 
 import org.apache.commons.vfs2.Capability;
 import org.apache.commons.vfs2.FileObject;
+import org.apache.commons.vfs2.FileSystemOptions;
 
 /**
  * URL test cases for providers.
@@ -87,6 +88,25 @@ public class UrlTests
         assertSameURLContent("", urlCon);
     }
 
+    /**
+     * Tests content.
+     */
+    public void testURLContentProvider() throws Exception
+    {
+        // Test non-empty file
+        FileObject file = getReadFolder().resolveFile("file1.txt");
+        assertTrue(file.exists());
+
+        String uri = file.getURL().toExternalForm();
+        FileSystemOptions options = getReadFolder().getFileSystem().getFileSystemOptions();
+
+        FileObject f1 = getManager().resolveFile(uri, options);
+        FileObject f2 = getManager().resolveFile(uri, options);
+
+        assertEquals("Two files resolved by URI must be equals on " + uri,  f1, f2);
+        assertSame("Resolving two times should not produce new filesystem on " + uri, f1.getFileSystem(), f2.getFileSystem());
+    }
+
     /**
      * Tests that unknown files have no content.
      */
