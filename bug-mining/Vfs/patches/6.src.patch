diff --git a/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java b/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java
index 5f094829..a00d31ec 100644
--- a/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java
+++ b/src/java/org/apache/commons/vfs/provider/AbstractFileObject.java
@@ -745,7 +745,7 @@ public abstract class AbstractFileObject implements FileObject
         final int count = files.size();
         for (int i = 0; i < count; i++)
         {
-            final AbstractFileObject file = (AbstractFileObject) files.get(i);
+            final AbstractFileObject file = FileObjectUtils.getAbstractFileObject((FileObject) files.get(i));
             // file.attach();
 
             // If the file is a folder, make sure all its children have been deleted
@@ -936,7 +936,7 @@ public abstract class AbstractFileObject implements FileObject
                 attach();
                 doRename(destFile);
 
-                ((AbstractFileObject) destFile).handleCreate(getType());
+                (FileObjectUtils.getAbstractFileObject(destFile)).handleCreate(getType());
 
                 destFile.close(); // now the destFile is no longer imaginary. force reattach.
 
diff --git a/src/java/org/apache/commons/vfs/provider/local/LocalFile.java b/src/java/org/apache/commons/vfs/provider/local/LocalFile.java
index ebb8e67f..2a3ecb3e 100644
--- a/src/java/org/apache/commons/vfs/provider/local/LocalFile.java
+++ b/src/java/org/apache/commons/vfs/provider/local/LocalFile.java
@@ -133,9 +133,11 @@ public class LocalFile
     /**
      * rename this file
      */
-    protected void doRename(FileObject newfile) throws Exception
+    protected void doRename(final FileObject newfile) throws Exception
     {
-        if (!file.renameTo(((LocalFile) newfile).getLocalFile()))
+        LocalFile newLocalFile = (LocalFile) FileObjectUtils.getAbstractFileObject(newfile);
+
+        if (!file.renameTo(newLocalFile.getLocalFile()))
         {
             throw new FileSystemException("vfs.provider.local/rename-file.error",
                 new String[]{file.toString(), newfile.toString()});
