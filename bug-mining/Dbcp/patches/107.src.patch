diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index f74871bc..bcc48787 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -136,6 +136,10 @@ The <action> type attribute can be add,update,fix,remove.
         DelegatingDatabaseMetaData.isWrapperFor() and
         DelegatingResultSet.isWrapperFor() that had the same problem.
       </action>
+      <action dev="markt" issue="DBCP-341" type="fix" due-to="Ioannis Canellos">
+        LocalXAConnectionFactory does not properly check if Xid is equal to
+        currentXid when resuming which may result in an XAException.
+      </action>
     </release>
     <release version="1.4.1" date="TBD" description="TBD">
       <action dev="psteitz" issue="DBCP-334" type="update" due-to="Alberto Mozzone">
diff --git a/src/main/java/org/apache/commons/dbcp2/managed/LocalXAConnectionFactory.java b/src/main/java/org/apache/commons/dbcp2/managed/LocalXAConnectionFactory.java
index bfbad784..01aff3d7 100644
--- a/src/main/java/org/apache/commons/dbcp2/managed/LocalXAConnectionFactory.java
+++ b/src/main/java/org/apache/commons/dbcp2/managed/LocalXAConnectionFactory.java
@@ -139,7 +139,7 @@ public class LocalXAConnectionFactory implements XAConnectionFactory {
 
                 this.currentXid = xid;
             } else if (flag == XAResource.TMRESUME) {
-                if (xid != this.currentXid) {
+                if (!xid.equals(this.currentXid)) {
                     throw new XAException("Attempting to resume in different transaction: expected " + this.currentXid + ", but was " + xid);
                 }
             } else {
