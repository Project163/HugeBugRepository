diff --git a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java
index 0fc8ce934..2af7e043d 100644
--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java
+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java
@@ -1030,7 +1030,9 @@ public class TikaCLI {
             if (name == null) {
                 name = "file" + count++;
             }
-
+            if (! inputStream.markSupported()) {
+                inputStream = TikaInputStream.get(inputStream);
+            }
             MediaType contentType = detector.detect(inputStream, metadata);
 
             if (name.indexOf('.')==-1 && contentType!=null) {
diff --git a/tika-app/src/test/java/org/apache/tika/cli/TikaCLITest.java b/tika-app/src/test/java/org/apache/tika/cli/TikaCLITest.java
index 5c6d35914..5d102dcb7 100644
--- a/tika-app/src/test/java/org/apache/tika/cli/TikaCLITest.java
+++ b/tika-app/src/test/java/org/apache/tika/cli/TikaCLITest.java
@@ -282,6 +282,34 @@ public class TikaCLITest {
             FileUtils.deleteDirectory(tempFile);
         }
     }
+
+    @Test
+    public void testExtractTgz() throws Exception {
+        //TIKA-2564
+        File tempFile = File.createTempFile("tika-test-", "");
+        tempFile.delete();
+        tempFile.mkdir();
+
+        try {
+            String[] params = {"--extract-dir="+tempFile.getAbsolutePath(),"-z", resourcePrefix + "/test-documents.tgz"};
+
+            TikaCLI.main(params);
+
+            StringBuffer allFiles = new StringBuffer();
+            for (String f : tempFile.list()) {
+                if (allFiles.length() > 0) allFiles.append(" : ");
+                allFiles.append(f);
+            }
+
+            File expectedTAR = new File(tempFile, "test-documents.tar");
+
+            assertExtracted(expectedTAR, allFiles.toString());
+        } finally {
+            FileUtils.deleteDirectory(tempFile);
+        }
+    }
+
+
     protected static void assertExtracted(File f, String allFiles) {
 
         assertTrue(
diff --git a/tika-app/src/test/resources/test-data/test-documents.tgz b/tika-app/src/test/resources/test-data/test-documents.tgz
new file mode 100644
index 000000000..baca6bb34
Binary files /dev/null and b/tika-app/src/test/resources/test-data/test-documents.tgz differ
