diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileObject.java b/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileObject.java
index 8632c739..576a74d7 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileObject.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/AbstractFileObject.java
@@ -896,14 +896,17 @@ public abstract class AbstractFileObject<AFS extends AbstractFileSystem> impleme
             {
                 // Create file objects for the children
                 // children = new FileObject[files.length];
-                children = new FileName[files.length];
+                final FileName[] cache = new FileName[files.length];
                 for (int i = 0; i < files.length; i++)
                 {
                     final String file = files[i];
                     // children[i] = fs.resolveFile(name.resolveName(file, NameScope.CHILD));
                     // children[i] = name.resolveName(file, NameScope.CHILD);
-                    children[i] = fs.getFileSystemManager().resolveName(name, file, NameScope.CHILD);
+                    cache[i] = fs.getFileSystemManager().resolveName(name, file, NameScope.CHILD);
                 }
+                // VFS-285: only assign the children filenames after all of them have been
+                // resolved successfully to prevent an inconsistent internal state
+                children = cache;
             }
 
             return resolveFiles(children);
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 03da785f..29d2f04a 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -26,6 +26,10 @@
 <!--       <action issue="VFS-443" dev="ggregory" type="update" due-to="nickallen"> -->
 <!--     	[Local] Need an easy way to convert from a FileObject to a File. -->
 <!--       </action> -->
+      <action issue="VFS-285" dev="tn" type="fix" due-to="Kirill Safonov">
+        AbstractFileObject.getChildren() may corrupt its internal state if a filename
+        can not be resolved.
+      </action>
       <action issue="VFS-451" dev="ggregory" type="fix" due-to="ilmarcoronchi">
         Authentication fails using private key.
       </action>
