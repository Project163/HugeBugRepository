<!--
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Thu Oct 23 09:40:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<!-- If you wish to do custom client-side styling of RSS, uncomment this:
<?xml-stylesheet href="https://issues.apache.org/jira/styles/jiraxml2html.xsl" type="text/xsl"?>
-->
<rss version="0.92">
    <channel>
        <title>ASF JIRA</title>
        <link>https://issues.apache.org/jira/issues/?jql=project+%3D+%22DBCP%22+AND+issuetype+%3D+Bug+ORDER+BY+key+DESC</link>
        <description>An XML representation of a search request</description>
                <language>en-uk</language>
                        <issue start="0" end="200" total="400"/>
                <build-info>
            <version>8.20.10</version>
            <build-number>820010</build-number>
            <build-date>22-06-2022</build-date>
        </build-info>

<item>
            <title>[DBCP-599] destroyObject method behaves incorrectly on ABANDONED connection, issue with unhandled AbstractMethodError</title>
                <link>https://issues.apache.org/jira/browse/DBCP-599</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Short description of the problem:&lt;br/&gt;
The PoolableConnectionFactory.destroyObject method is called for a connection in ABANDONED status, which results in an AbstractMethodError on a real connection due to not calling DelegatingConnection#abort, which takes into account throwing such an error due to Jdbc41Bridge#abort.&lt;/p&gt;

&lt;p&gt;Details:&lt;br/&gt;
It all started when we determined from the application logs in tomcat 9.0.82 that stacktraces were being dumped for allegedly not being able to get a new connection from the connect pool.&lt;br/&gt;
At the same time, I know and I am sure that we are configured to handle Abandoned connections and remove them from the pool.&lt;br/&gt;
However, on that day we received an application that after some time started to &#8220;complain&#8221; that it can&apos;t give new connections and that the pool doesn&apos;t give these new connections for 20 seconds.&lt;br/&gt;
Stacktrace-dump and heapdump were obtained, and after restarting the application &#8220;everything was normalized&#8221;.&lt;br/&gt;
After parsing the contents of the heapdump I found out that with maxTotal equal to 20 connections we had 18 connections in ABANDONED state, and only 2 in IDLE state, which on that day continued to hold all the load that fell only on them, and, apparently, &#8220;when the application needed 3 connections at once in a row&#8221; - we had problems with getting them from the pool, why we saw a lot of stacktraces about the impossibility to get these connections from the pool.&lt;br/&gt;
On that day, apparently, a stored procedure was changed, the call of which under certain conditions caused the connection to &#8220;freeze&#8221;, waiting for a response from the database, and of course it was killed by the pool and transferred to the ABANDONED status.&lt;br/&gt;
We counted 18 such connections in the heapdump, but the most interesting thing is that the configuration for the Abandoned mechanism is set up in such a way that we assumed that such connections would be thrown out of the connection pool and their place would be taken by &#8220;fresh&#8221; ones, but it was obviously not so.&lt;br/&gt;
As a result, what was the situation: when calling BasicDataSource.getConnection on stacktrace, our application reached the method PoolableConnectionFactory.destroyObject, which resulted in AbstractMethodError, which, due to the fact that it is Error, was not captured by catch-blocks, and knocked out the connection obtaining from the pool, because of which we had a few 500 errors at times when more than 2 connections were required at the same time (this is my assumption at the moment).&lt;br/&gt;
I &#8220;looked through&#8221; the sources of Tomcat 9.0.82 in terms of working with dbcp2, stacktrace frames, and in many of the errors we received at that time, associated with getting a connection from the pool involved method org.apache.commons.dbcp2.PoolableConnectionFactory#destroyObject(org.apache.commons.pool2.PooledObject&amp;lt;org.apache.commons.dbcp2.PoolableConnection&amp;gt;, org.apache.commons.pool2.DestroyMode), designated by Gary Gregory as &apos;@since 2.9.0&apos;.&lt;br/&gt;
This method itself is recorded in the history of git as having appeared in such a commit:&lt;br/&gt;
cbf77a08b7c64c1df3e2b2d2ee5e1415c9a885a1 &#160; &#160;Mon Dec 28 18:17:43 CET 2020 &#160; &#160;Phil Steitz* &#160; &#160;Use abort rather than close to destroy abandoned connections. Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-567&quot; title=&quot;Use abort rather than close to clean up abandoned connections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-567&quot;&gt;&lt;del&gt;DBCP-567&lt;/del&gt;&lt;/a&gt;. (#68)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/projects/DBCP/issues/DBCP-567&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/DBCP/issues/DBCP-567&lt;/a&gt;&lt;br/&gt;
Its current implementation results in the line org/apache/commons/dbcp2/PoolableConnectionFactory.java:152 where we have p.getObject().getInnermostDelegate().abort(Runnable::run), but getInnermostDelegate does retrieve the &#8220;last&#8221; connection, which is at the end of the nesting chain, rather than PoolableConnection, which inherits from the DelegatingConnection class and implements the method org.apache.commons.dbcp2.DelegatingConnection#abort , which takes into account that a database driver may be used that supports the JDBC 4.0 specification, and there is no abort method implementation there. The org.apache.commons.dbcp2.Jdbc41Bridge#abort method provides &quot;workaround&quot; in this case, ensuring that close is called instead of abort when the JVM throws an AbstractMethodError.&lt;br/&gt;
In fact, we have in our application with a tomcat that supports the JDBC 4.2 specification, a driver that is implemented according to the JDBC 4.0 specification, and it is this nuance that made DBCP2 unable to cope with pool cleanup when the removeAbandonedOnBorrow=&quot;true&quot; parameter is specified in the pool settings. The only thing I don&apos;t understand yet is why the pool didn&apos;t perform OnMaintenance cleanup with the specified parameters removeAbandonedTimeout=&quot;600&quot; removeAbandonedOnMaintenance=&quot;true&quot; logAbandoned=&quot;true&quot; minEvictableIdleTimeMillis=&quot;30000&quot;. Is this a settings for some internal sheduler?&lt;/p&gt;

&lt;p&gt;To reinforce all of the above, I attach the files:&lt;br/&gt;
testcase_PoolableConnectionFactory_1.patch - a testcase for PoolableConnectionFactory.destroyObject, which enlightens the problem.&lt;br/&gt;
TestPoolableConnectionFactory.java - the same file, but in form of the java source file.&lt;br/&gt;
part_of_stacktrace_1.txt - the most important file of all, it contains the part of the stacktrace that is repeated in all connection acquisition errors.&lt;br/&gt;
abandoned_traces_1.txt - all (anonymized) stacktraces from catalina.out, which are related to connection rejection in the database when the response time is exceeded, and transfer to ABANDONED status.&lt;br/&gt;
errors_getting_connection_traces_2_filtered_1.txt - All (anonymized) errors that include Caused by: java.lang.AbstractMethodError: Method com/sybase/jdbc4/jdbc/SybConnection.abort(Ljava/util/concurrent/Executor;)V is abstract.&lt;br/&gt;
errors_getting_connection_traces_1_filtered_1.txt - All (anonymized) errors where we tried to get a new connection from the pool and didn&apos;t wait the item.&lt;br/&gt;
part_of_server_xml.txt - (Anonymized) Resources from the conf/server.xml file.&lt;br/&gt;
abandoned_objects_1.txt - List of 18 DefaultPooledObject that appeared in the pool in ABANDONED status in heapdump, and &#8220;did not want to be destroyed&#8221;.&lt;br/&gt;
abandoned_objects_other_1.txt - Several other connections, from other pools, and 2 connections from the same pool that were involved in the &#8220;problem&#8221;, in IDLE status, which seem to be holding the load.&lt;br/&gt;
abandoned_objects_query_1.txt - queries for VisualVM , OQL Console tab, which retrieved the previous 2 files.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, Tomcat 9.0.82, openjdk 17, jconn4.jar (Sybase JDBC 4.0 spec DB driver) in tomcat&apos;s lib dir&lt;/p&gt;</environment>
        <key id="13597481">DBCP-599</key>
            <summary>destroyObject method behaves incorrectly on ABANDONED connection, issue with unhandled AbstractMethodError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="denixx">denixx baykin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Nov 2024 19:40:30 +0000</created>
                <updated>Sat, 23 Nov 2024 21:11:13 +0000</updated>
                            <resolved>Sat, 23 Nov 2024 21:11:13 +0000</resolved>
                                    <version>2.12.0</version>
                                    <fixVersion>2.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17894907" author="denixx" created="Fri, 1 Nov 2024 19:53:02 +0000"  >&lt;p&gt;To add a bit to the above, this bug looks like in the method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.commons.dbcp2.PoolableConnectionFactory#destroyObject(org.apache.commons.pool2.PooledObject&amp;lt;org.apache.commons.dbcp2.PoolableConnection&amp;gt;, org.apache.commons.pool2.DestroyMode)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;as a result of the line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
p.getObject().getInnermostDelegate().abort(&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;::run)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, the author assumed that&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getInnermostDelegate()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;would return &quot;hindmost DelegatingConnection&quot; rather than &quot;hindmost connection = real connection&quot;.&lt;/p&gt;</comment>
                            <comment id="17895145" author="psteitz" created="Sun, 3 Nov 2024 18:50:07 +0000"  >&lt;p&gt;I may be missing something, but I think the code is working as intended, but the driver is not at the required level.&#160; Versions 2.5+ of DBCP require JDBC 4.2+&#160; Drivers at this level have the method that is missing from your driver.&#160; The JDBC4 bridge thing should actually probably be removed at this point.&#160; &#160;As a workaround, you could revert to DBCP 2.8.0 but it would be better to upgrade to a compliant driver.&lt;/p&gt;

&lt;p&gt;To &quot;fix&quot; this in DBCP, we could catch the AbstractMethodError and fall back to close, but I am thinking it might actually be better to just do what we say we have been doing for 4+ years now, which is to require 4.2+ and drop the bridge.&lt;/p&gt;</comment>
                            <comment id="17895148" author="garydgregory" created="Sun, 3 Nov 2024 19:28:17 +0000"  >&lt;p&gt;WRT dropping Jdbc41Bridge, we could deprecate it for 2.x and remove it in 3.0 but... it should only be used internally really, so deprecation would only ugly up IDEs and builds with compiler warnings (if you have those turned on).&lt;/p&gt;

&lt;p&gt;We could make it write a message to stdout that an old JDBC driver is in use but it&apos;s likely that users would be able to do anything about it. If a dev or user decides it&apos;s OK to ship or use an old driver, we can&apos;t do much about it. &lt;/p&gt;

&lt;p&gt;&amp;gt; To &quot;fix&quot; this in DBCP, we could catch the AbstractMethodError and fall back to close&lt;/p&gt;

&lt;p&gt;That&apos;s what the bridge has been doing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void abort(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Connection connection, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Executor executor) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            connection.abort(executor);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AbstractMethodError e) {
            connection.close();
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the fix might just be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/src/main/java/org/apache/commons/dbcp2/PoolableConnectionFactory.java b/src/main/java/org/apache/commons/dbcp2/PoolableConnectionFactory.java
index c182d17..3a4f65c 100644
--- a/src/main/java/org/apache/commons/dbcp2/PoolableConnectionFactory.java
+++ b/src/main/java/org/apache/commons/dbcp2/PoolableConnectionFactory.java
@@ -149,7 +149,7 @@
     @Override
     public void destroyObject(final PooledObject&amp;lt;PoolableConnection&amp;gt; p, final DestroyMode mode) throws SQLException {
         if (mode == DestroyMode.ABANDONED) {
-            p.getObject().getInnermostDelegate().abort(Runnable::run);
+            Jdbc41Bridge.abort(p.getObject().getInnermostDelegate(), Runnable::run);
         } else {
             p.getObject().reallyClose();
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please try git master or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17895330" author="denixx" created="Mon, 4 Nov 2024 15:26:15 +0000"  >&lt;p&gt;Phil, Thank you. I appreciate you are spending your time on this for us!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Gary, I was thinking of this as one of the possible fixes.&lt;/p&gt;

&lt;p&gt;I focused a little on the PoolableConnectionFactory class, and I could see the Jdbc41Bridge.setSchema is already used here, so I don&apos;t think one more bridge execution will break things.&lt;/p&gt;

&lt;p&gt;I changed the org/apache/tomcat/dbcp/dbcp2/PoolableConnectionFactory.java in apache-tomcat-9.0.82-src and will replace the existing tomcat-dbcp.jar with the fixed one:&lt;/p&gt;

&lt;p&gt;I will try the proposed variant in a production since tomorrow.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * @since 2.9.0
 */
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void destroyObject(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PooledObject&amp;lt;PoolableConnection&amp;gt; p, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DestroyMode mode) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mode == DestroyMode.ABANDONED) {
        Jdbc41Bridge.abort(p.getObject().getInnermostDelegate(), &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;::run);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        p.getObject().reallyClose();
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I understand I could upgrade to jconn42.jar from Sybase jConnect, but this is not an easy problem for other developers, so I chose the path to fix it this way.&lt;/p&gt;

&lt;p&gt;Gary, how do you feel, maybe &lt;ins&gt;markt&lt;/ins&gt; and &lt;ins&gt;remm&lt;/ins&gt; should be noticed about this issue?&lt;/p&gt;</comment>
                            <comment id="17895388" author="garydgregory" created="Mon, 4 Nov 2024 18:32:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=denixx&quot; class=&quot;user-hover&quot; rel=&quot;denixx&quot;&gt;denixx&lt;/a&gt; &lt;br/&gt;
You can use the &quot;@&quot; sign to tag users in Jira, send an email to the Tomcat mailing list, or create a Tomcat Jira issue linked to this one.&lt;/p&gt;</comment>
                            <comment id="17895413" author="denixx" created="Mon, 4 Nov 2024 19:54:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; Thank you! Let&apos;s give the fixed code time to execute at least once, and I will do this as soon as we have some results.&lt;/p&gt;</comment>
                            <comment id="17896616" author="denixx" created="Fri, 8 Nov 2024 09:31:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; I have added a new file, successfully_killed_1_filtered_1.txt.&lt;/p&gt;

&lt;p&gt;The line &quot;Successfully closed connection using Jdbc41Bridge.abort.&quot; at the end comes from a modified part of destroyObject:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void destroyObject(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PooledObject&amp;lt;PoolableConnection&amp;gt; p, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DestroyMode mode) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mode == DestroyMode.ABANDONED) {
&#160; &#160; &#160; &#160; &#160; &#160; Jdbc41Bridge.abort(p.getObject().getInnermostDelegate(), &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;::run);
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Successfully closed connection using Jdbc41Bridge.abort.&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; p.getObject().reallyClose();
&#160; &#160; &#160; &#160; }
&#160; &#160; }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So, I could say we fixed the initial problem.&lt;br/&gt;
As it may take more time to understand if this fixes the degradation problem, I can say now it is fixed in the sense of &quot;normally processing the abandoned connection.&quot;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=remm&quot; class=&quot;user-hover&quot; rel=&quot;remm&quot;&gt;remm&lt;/a&gt; Please take a look at this, as I think Tomcat 9 has an issue with closing the abandoned connections (if configured) since Tomcat 9.0.42:&lt;br/&gt;
&quot;Update the internal fork of Apache Commons DBCP to 2.9.0 (2021-08-03). Improvements, code clean-up and refactoring. (markt)&quot;&lt;/p&gt;</comment>
                            <comment id="17900128" author="denixx" created="Thu, 21 Nov 2024 17:08:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; Hello Gary! OK, here is a thread with Remy and Mark, they just say &quot;We will be glad to have the fix as it will be released in DBCP&quot;.&lt;br/&gt;
&lt;a href=&quot;https://www.mail-archive.com/dev@tomcat.apache.org/msg179955.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/dev@tomcat.apache.org/msg179955.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What are my actions to make this fix available? I may prepare a merge request if I need to.&lt;/p&gt;</comment>
                            <comment id="17900151" author="garydgregory" created="Thu, 21 Nov 2024 18:44:48 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=denixx&quot; class=&quot;user-hover&quot; rel=&quot;denixx&quot;&gt;denixx&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for reaching out.&lt;/p&gt;

&lt;p&gt;What would you like to merge?&lt;/p&gt;

&lt;p&gt;Doesn&apos;t the state of git master and the snapshot build in &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt; meet your needs?&lt;/p&gt;

&lt;p&gt;Let me know, that&apos;s what will be in the next release.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17900605" author="denixx" created="Sat, 23 Nov 2024 17:23:50 +0000"  >&lt;p&gt;Hello, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;!&lt;br/&gt;
I missed the&lt;br/&gt;
&quot;04933534 PoolableConnectionFactory.destroyObject() method behaves incorrectly on ABANDONED connection, issue with unhandled AbstractMethodError Gary Gregory 03.11.2024 20:31&quot;&lt;br/&gt;
commit.&lt;/p&gt;

&lt;p&gt;As I needed to verify this change, so I made a similar change in the code of Tomcat&apos;s dbcp2 version we use, and I know it fixes the behavior, so this is done well.&lt;/p&gt;

&lt;p&gt;A state of git master meets my needs.&lt;/p&gt;</comment>
                            <comment id="17900648" author="garydgregory" created="Sat, 23 Nov 2024 21:00:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=denixx&quot; class=&quot;user-hover&quot; rel=&quot;denixx&quot;&gt;denixx&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for checking. I&apos;ll create a release candidate later today.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13072557" name="TestPoolableConnectionFactory.java" size="3574" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072566" name="abandoned_objects_1.txt" size="5838" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072565" name="abandoned_objects_other_1.txt" size="1295" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072564" name="abandoned_objects_query_1.txt" size="413" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072563" name="abandoned_traces_1.txt" size="94501" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072562" name="errors_getting_connection_traces_1_filtered_1.txt" size="126423" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072561" name="errors_getting_connection_traces_2_filtered_1.txt" size="112332" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072560" name="part_of_server_xml.txt" size="2852" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072559" name="part_of_stacktrace_1.txt" size="1186" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                            <attachment id="13072698" name="successfully_killed_1_filtered_1.txt" size="5267" author="denixx" created="Fri, 8 Nov 2024 09:06:14 +0000"/>
                            <attachment id="13072558" name="testcase_PoolableConnectionFactory_1.patch" size="4530" author="denixx" created="Fri, 1 Nov 2024 19:37:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            47 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1sc60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-597]  Validation query not timing out on connections managed by SharedPoolDataSource</title>
                <link>https://issues.apache.org/jira/browse/DBCP-597</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We are running a Java application that uses &lt;b&gt;org.apache.commons.dbcp2.datasources.SharedPoolDataSource&lt;/b&gt;&#160;to maintain a JDBC connection pool.&lt;/p&gt;

&lt;p&gt;In a recent database failover event, we noticed database validation queries were not timing out as expected, resulting in the application hanging and waiting indefinitely for a response from the database.&lt;/p&gt;

&lt;p&gt;The validation query and timeout were both explicitly set on the SharedPoolDataSource instance.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;ds = new SharedPoolDataSource();&lt;/p&gt;

&lt;p&gt;ds.setValidationQuery(&quot;SELECT 1&quot;)&lt;/p&gt;

&lt;p&gt;ds.setValidationQueryTimeout(5).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Upon diving a bit into the source code, we suspect the issue was caused by this code:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-dbcp/blob/master/src/main/java/org/apache/commons/dbcp2/datasources/CPDSConnectionFactory.java#L465&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/blob/master/src/main/java/org/apache/commons/dbcp2/datasources/CPDSConnectionFactory.java#L465&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; conn = pconn.getConnection();&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; stmt = conn.createStatement();&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; rset = stmt.executeQuery(validationQuery);&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; valid = rset.next();&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We noticed the &lt;em&gt;stmt&lt;/em&gt; statement object does not call setQueryTimeout() and the validation query seems to be executed with no timeout at all.&#160;&lt;/p&gt;

&lt;p&gt;Could you confirm that this is indeed a bug, not us missing some fundamental details? We would greatly appreciate a prompt resolution to this issue, thanks!&lt;/p&gt;</description>
                <environment></environment>
        <key id="13570610">DBCP-597</key>
            <summary> Validation query not timing out on connections managed by SharedPoolDataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="xiaotianbai">Xiaotian Bai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Mar 2024 03:05:17 +0000</created>
                <updated>Sun, 15 Dec 2024 23:02:16 +0000</updated>
                            <resolved>Sun, 15 Dec 2024 14:46:25 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.13.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17823024" author="garydgregory" created="Mon, 4 Mar 2024 03:14:26 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaotianbai&quot; class=&quot;user-hover&quot; rel=&quot;xiaotianbai&quot;&gt;xiaotianbai&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for reaching out.&lt;/p&gt;

&lt;p&gt;Would you please provide a failing unit test in order for us to reproduce this issue?&lt;/p&gt;

&lt;p&gt;This would be best as a PR on GitHub.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17823032" author="JIRAUSER304480" created="Mon, 4 Mar 2024 05:07:41 +0000"  >&lt;p&gt;A quick simple test would be&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SharedPoolDataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SharedPoolDataSource();
ds.setValidationQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT PG_SLEEP(10)&quot;&lt;/span&gt;);
ds.setValidationQueryTimeout(1);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (Connection conn = ds.getConnection()){
    fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Expected a timeout exception &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the database connection.&quot;&lt;/span&gt;); 
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
  &#160;&lt;span class=&quot;code-comment&quot;&gt;// expected, &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; nothing 
&lt;/span&gt;}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I also tested this locally, the connection can be borrowed from the pool without an exception.&lt;/p&gt;</comment>
                            <comment id="17905808" author="JIRAUSER308107" created="Sun, 15 Dec 2024 14:16:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; I have created a failing test based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaotianbai&quot; class=&quot;user-hover&quot; rel=&quot;xiaotianbai&quot;&gt;xiaotianbai&lt;/a&gt; comments at &lt;a href=&quot;https://github.com/apache/commons-dbcp/pull/464.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/pull/464.&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please take a review and let me know if this is indeed a bug. I would like to take on this work but would like confirmation that it is a go-ahead. Thanks!&lt;/p&gt;</comment>
                            <comment id="17905812" author="garydgregory" created="Sun, 15 Dec 2024 14:46:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaotianbai&quot; class=&quot;user-hover&quot; rel=&quot;xiaotianbai&quot;&gt;xiaotianbai&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajugupta&quot; class=&quot;user-hover&quot; rel=&quot;rajugupta&quot;&gt;rajugupta&lt;/a&gt;&lt;br/&gt;
This is fixed in git master for 2.13.1-SNAPSHOT, please verify.&lt;br/&gt;
This fix is also available in snapshot builds here: &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="17905813" author="JIRAUSER308107" created="Sun, 15 Dec 2024 14:53:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; &#160; I think I am using the 2.13.1-SNAPSHOT version. At least that&apos;s what the pom.xml file tells me&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13073478/13073478_image-2024-12-15-14-51-46-184.png&quot; height=&quot;104&quot; width=&quot;217&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I ran the test in this version and the tests have failed. Could you link the PR that fixes this behaviour ? Also, maybe you can run the CI pipelines to test the fix ? Thanks!&lt;/p&gt;</comment>
                            <comment id="17905814" author="JIRAUSER308107" created="Sun, 15 Dec 2024 14:59:03 +0000"  >&lt;p&gt;Got it. The issue has been fixed. Thanks a ton. &lt;a href=&quot;https://github.com/rajucomp/commons-dbcp/commit/7659d9e55f77a0633972f268a62f68dabb8ff5c5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rajucomp/commons-dbcp/commit/7659d9e55f77a0633972f268a62f68dabb8ff5c5&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17905846" author="garydgregory" created="Sun, 15 Dec 2024 23:02:16 +0000"  >&lt;p&gt;Note that &lt;font color=&quot;#de350b&quot;&gt;&lt;b&gt;&lt;tt&gt;PerUserPoolDataSource&lt;/tt&gt;&lt;/b&gt;&lt;/font&gt; suffered from the same issue.&lt;/p&gt;

&lt;p&gt;This is also now fixed in git master and snapshot builds here: &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13073478" name="image-2024-12-15-14-51-46-184.png" size="79539" author="rajugupta" created="Sun, 15 Dec 2024 14:51:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            44 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1nr20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-596] PoolingConnection.toString() causes StackOverflowError</title>
                <link>https://issues.apache.org/jira/browse/DBCP-596</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;&lt;tt&gt;PoolingConnection&lt;/tt&gt;, as it is constructed by &lt;tt&gt;PoolableConnectionFactory.makeObject()&lt;/tt&gt; method, causes StackOverflowError in its &lt;tt&gt;toString()&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;PoolingConnection&lt;/tt&gt; acts as the object factory for the statement pool, while &lt;tt&gt;GenericKeyedObjectPool&lt;/tt&gt; implements the statement pool. &lt;tt&gt;PoolingConnection.toString()&lt;/tt&gt; calls the pool&apos;s &lt;tt&gt;toString()&lt;/tt&gt; method, while &lt;tt&gt;GenericKeyedObjectPool.toStringAppendFields()&lt;/tt&gt; calls the factory&apos;s &lt;tt&gt;toString()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Here is small test application that causes StackOverflowError:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.DelegatingPreparedStatement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.PoolingConnection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool2.impl.GenericKeyedObjectPool;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool2.impl.GenericKeyedObjectPoolConfig;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; conn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingConnection(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericKeyedObjectPoolConfig&amp;lt;DelegatingPreparedStatement&amp;gt;();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; stmtPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericKeyedObjectPool&amp;lt;&amp;gt;(conn, config);
        conn.setStatementPool(stmtPool);

        conn.toString();
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In normal use cases this doesn&apos;t cause a problem, but we&apos;ve encountered this bug in some situations with network connectivity problems.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13568301">DBCP-596</key>
            <summary>PoolingConnection.toString() causes StackOverflowError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="aapo.haapanen">Aapo Haapanen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Feb 2024 13:17:32 +0000</created>
                <updated>Tue, 13 Feb 2024 20:41:40 +0000</updated>
                            <resolved>Tue, 13 Feb 2024 14:02:03 +0000</resolved>
                                    <version>2.11.0</version>
                                    <fixVersion>2.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17817012" author="garydgregory" created="Tue, 13 Feb 2024 14:02:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aapo.haapanen&quot; class=&quot;user-hover&quot; rel=&quot;aapo.haapanen&quot;&gt;aapo.haapanen&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;A fix is in git master and 2.11.1-SNAPSHOT builds in &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-dbcp2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-dbcp2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please report if you encounter SO&apos;s in other classes with this build.&lt;/p&gt;

&lt;p&gt;I&apos;d like to cut a release candidate to push this out if I hear all is well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ndao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-595] Connection pool can be exhausted when connections are killed on the DB side</title>
                <link>https://issues.apache.org/jira/browse/DBCP-595</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Apache Oozie 5.2.1 uses OpenJPA 2.4.2 and commons-dbcp 1.4 and commons-pool 1.5.4. These are ancient versions, I know.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h1&gt;

&lt;p&gt;The issue is that when due to some network issues or &quot;maintenance work&quot; on the DB side (especially PostgreSQL) which causes the DB connection to be closed, it results exhausted Pool on the client side. Many threads are waiting at this point:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;pool-2-thread-4&quot; #20 prio=5 os_prio=31 tid=0x00007faf7903b800 nid=0x8603 waiting on condition [0x000000030f3e7000]
   java.lang.Thread.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  &amp;lt;0x000000066aca8e70&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
	at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:1324) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;According to my observation this is because the JDBC driver does not get closed on the client side, nor the abstract DBCP connection &lt;em&gt;org.apache.commons.dbcp2.PoolableConnection&lt;/em&gt; .&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Repro&quot;&gt;&lt;/a&gt;Repro&lt;/h1&gt;

&lt;p&gt;(Un)Fortunately I can reproduce the issue using the latest and greatest commons-dbcp 2.11.0 and commons-pool 2.12.0 along with OpenJPA 3.2.2.&lt;/p&gt;

&lt;p&gt;I&apos;ve just created a Java application to reproduce the issue: &lt;a href=&quot;https://github.com/dionusos/pool_exhausted_repro&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dionusos/pool_exhausted_repro&lt;/a&gt; . See README.md for detailed repro steps.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Kindofsolution%3F&quot;&gt;&lt;/a&gt;Kind of solution?&lt;/h1&gt;

&lt;p&gt;To be honest I am not really familiar with DBCP but with this change I managed to make my application more robust:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/src/main/java/org/apache/commons/dbcp2/PoolableConnection.java b/src/main/java/org/apache/commons/dbcp2/PoolableConnection.java
index 440cb756..678550bf 100644
--- a/src/main/java/org/apache/commons/dbcp2/PoolableConnection.java
+++ b/src/main/java/org/apache/commons/dbcp2/PoolableConnection.java
@@ -214,6 +214,10 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PoolableConnection &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DelegatingConnection&amp;lt;Connection&amp;gt; impleme
&#160; &#160; &#160;@Override
&#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleException(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SQLException e) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
&#160; &#160; &#160; &#160; &#160;fatalSqlExceptionThrown |= isFatalException(e);
+ &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fatalSqlExceptionThrown &amp;amp;&amp;amp; getDelegate() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+ &#160; &#160; &#160; &#160; &#160; &#160;getDelegate().close();
+ &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.close();
+ &#160; &#160; &#160; &#160;}
&#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.handleException(e);
&#160; &#160; &#160;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What do you think about this approach?&lt;/p&gt;

&lt;p&gt;Is it a completely dead-end or we can start working on it in this direction?&lt;/p&gt;

&lt;p&gt;Do you agree that the reported and reproduced issue is a real one and nut just some kind of misconfiguration?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am lost at this point and I need to move forward so I am asking for guidance here.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13567898">DBCP-595</key>
            <summary>Connection pool can be exhausted when connections are killed on the DB side</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dionusos">D&#233;nes Bod&#243;</reporter>
                        <labels>
                            <label>deadlock</label>
                            <label>robustness</label>
                    </labels>
                <created>Thu, 8 Feb 2024 13:26:27 +0000</created>
                <updated>Thu, 29 Feb 2024 18:53:35 +0000</updated>
                            <resolved>Tue, 20 Feb 2024 21:58:00 +0000</resolved>
                                    <version>2.11.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17815776" author="garydgregory" created="Thu, 8 Feb 2024 18:11:02 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dionusos&quot; class=&quot;user-hover&quot; rel=&quot;dionusos&quot;&gt;dionusos&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;To get an idea of the impact of your change, you could create a PR on github against the master branch. This will cause builds to run on Java LTS platforms. That&apos;s a first step. It&apos;s possible that we do not have sufficient code coverage in tests to detect problems in this area though. IOW, the builds could be green and still cause issues for existing apps. This will need careful review.&lt;/p&gt;</comment>
                            <comment id="17816463" author="psteitz" created="Sun, 11 Feb 2024 23:35:00 +0000"  >&lt;p&gt;I am still working through the repro code, but the symptoms don&apos;t make sense to me yet.&#160; The stack trace is indicating pool exhaustion, which would mean clients are holding or abandoning connections.&#160; If connections go bad, since all validation is turned off in the repro code, clients will keep getting bad connections and their operations will fail; but that does not explain the pool exhaustion, unless clients are not returning (closing) connections when they hit the exceptions.&#160; &#160;Have you tried turning on say testOnReturn?&#160; &#160;That will cause bad connections to be closed when they are returned to the pool.&lt;/p&gt;</comment>
                            <comment id="17816520" author="dionusos" created="Mon, 12 Feb 2024 08:01:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=psteitz&quot; class=&quot;user-hover&quot; rel=&quot;psteitz&quot;&gt;psteitz&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;In the &quot;Oozie-like repro steps&quot; the following is configured:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &#160; connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestOnBorrow=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestOnReturn=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestWhileIdle=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This means the program will stuck and threads will wait infinitely&#160;at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:1324). The only difference between connection validation and no connection validation is that how much time do we have to wait until the program sticks is.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;My observation is that there is some kind of timing issue in the background as we experience exhausted pool no matter what and connection validation only delays the issue and not solves it.&lt;/p&gt;</comment>
                            <comment id="17816685" author="psteitz" created="Mon, 12 Feb 2024 17:47:39 +0000"  >&lt;p&gt;Thanks for the info on validation.&#160; That info and the partial thread dump above (can you maybe include a fuller trace?)&#160; makes it look likely to me that the problem is that that the application is not closing connections on some exception paths.&#160; &#160;Can you check to make sure that even on exception paths, the code is calling close on the connection handles returned by DBCP?&#160; &#160;The fact that forcing close on fatal exceptions improves things supports the hypothesis that what is going on is the client code is not closing connections on some exception paths.&#160;&lt;/p&gt;

&lt;p&gt;Also, can you confirm that when the starvation happens, the pool is reporting numActive == maxActive?&lt;/p&gt;

&lt;p&gt;With validation turned on, DBCP will reliably close connections when validation fails.&#160; If any kind of exception occurs during the close, DBCP will destroy the connection handle and reduce its active count.&#160; You can see that in the validateObject method of PoolableConnectionFactory.&#160; If you set fastFailValidation to true, DBCP will fail validation without attempting a validation query after a fatal exception occurs, again destroying the handle and adjusting counters.&lt;/p&gt;</comment>
                            <comment id="17816813" author="psteitz" created="Mon, 12 Feb 2024 23:08:51 +0000"  >&lt;p&gt;I just realized there is another scenario that can lead to this, which is due to a limitation in Commons Pool.&#160; If you look at the currently disabled test case, testLivenessOnTransientFactoryFailure in TestGenericObjectPool, it illustrates the following scenario:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Threads enter borrow object when there is capacity to create, but due to transient factory outage, creates fail.&lt;/li&gt;
	&lt;li&gt;The factory starts working again, but threads remain blocked waiting on the pool&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If minIdle &amp;gt; 0 and pool maintenance is enabled (minTimeBetweenEvictionRuns &amp;gt;0), the pool will create instances when the evictor runs to serve the blocked threads.&lt;/p&gt;

&lt;p&gt;This is being tracked as [&lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-407&quot; title=&quot;Threads get stuck when idleObjects list is empty.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-407&quot;&gt;POOL-407&lt;/a&gt;|&lt;/p&gt;</comment>
                            <comment id="17817059" author="dionusos" created="Tue, 13 Feb 2024 16:19:29 +0000"  >&lt;p&gt;Thank you Phil for your inputs.&lt;/p&gt;

&lt;p&gt;I&apos;ll go back testing your suggestions and will provide answers for your questions in one-two days.&lt;/p&gt;</comment>
                            <comment id="17818815" author="dionusos" created="Tue, 20 Feb 2024 13:43:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=psteitz&quot; class=&quot;user-hover&quot; rel=&quot;psteitz&quot;&gt;psteitz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I executed the ReproOneThread class with these settings:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;MaxActive=&quot;&lt;/span&gt;).append(1).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;MaxTotal=&quot;&lt;/span&gt;).append(2).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;//connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;MaxIdle=&quot;&lt;/span&gt;).append(2).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
&lt;/span&gt;        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;fastFailValidation=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestOnBorrow=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestOnReturn=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestWhileIdle=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;//connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;ValidationQuery=&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 1&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
&lt;/span&gt;        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;timeBetweenEvictionRunsMillis=&quot;&lt;/span&gt;).append(10_000).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
        connectionProperties.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;numTestsPerEvictionRun=&quot;&lt;/span&gt;).append(10).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The program got stuck when the org.apache.commons.pool2.impl.GenericObjectPool#create failed to create a new connection because newCreateCount &amp;gt; localMaxTotal was true. See this screen shot:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13066901/13066901_ReproOneThread-screenshot_when_create-newCreateCount_gt_localMaxTotal.png&quot; height=&quot;386&quot; width=&quot;576&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
I created jstack at the time when I created the screen shot and a jstack after I let the debugger continue running but the program really stuck:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13066902/13066902_ReproOneThread-jstack_when_create.txt&quot; title=&quot;ReproOneThread-jstack_when_create.txt attached to DBCP-595&quot;&gt;ReproOneThread-jstack_when_create.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; and &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13066903/13066903_ReproOneThread-jstack_when_stuck.txt&quot; title=&quot;ReproOneThread-jstack_when_stuck.txt attached to DBCP-595&quot;&gt;ReproOneThread-jstack_when_stuck.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;Setting fastFailValidation to true had no effect, the program successfully stuck.&lt;/p&gt;

&lt;p&gt;When I set MinIdle to 1 there was a thread running after the program stuck and it tried to create new connections but the variables shoed the same as the above screen shot: . &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13066906/13066906_ReproOneThread-jstack-minIdle.txt&quot; title=&quot;ReproOneThread-jstack-minIdle.txt attached to DBCP-595&quot;&gt;ReproOneThread-jstack-minIdle.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Based on this I confirm the program got stuck when numActive == maxActive.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Regarding validation and connection closure in case of exception:&lt;br/&gt;
I played around with my repro code (ReproDBCP):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Closed the connection got from DataSource::getConnection() when it was not null
	&lt;ul&gt;
		&lt;li&gt;when exception occurred&lt;/li&gt;
		&lt;li&gt;in a finally block&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;maxActive=1, maxTotal=2, validation turned off completely&lt;/li&gt;
	&lt;li&gt;4 threads&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There was no sign of any deadlock during testing.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This confirms your theory that when the issue is happening in Oozie the &quot;client&quot; does not close the connection after it notices the exception about connection closure.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;My questions:&lt;/p&gt;

&lt;p&gt;1. As OpenJPA is the client in Oozie&apos;s perspective does it mean that I have to check OpenJPA code if it closes/releases the connection when catches an exception from &lt;em&gt;org.apache.commons.dbcp2.PoolableConnection#handleException&lt;/em&gt; ?&lt;br/&gt;
Is it the right approach to drop/close the connection by the client? Shouldn&apos;t the client get notified about &lt;b&gt;fatalSqlExceptionThrown&lt;/b&gt; instead of a simple SQLException?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleException(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SQLException e) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
    fatalSqlExceptionThrown |= isFatalException(e);
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.handleException(e);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;2. If DBCP is aware that this is a fatalSqlException, shouldn&apos;t it handle the situation by closing the connection automatically? - I know, this is what I suggested in my patch. Just curious.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="17819000" author="psteitz" created="Tue, 20 Feb 2024 21:58:00 +0000"  >&lt;p&gt;Don&apos;t mean to be blunt / dismissive with the close here.&#160; But this does not look like a DBCP bug and it would be better to discuss on the mailing list any changes to behavior.&#160; See &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; &apos;s nice summary there on why we do not force close connections on fatal SQL exceptions - basically drivers don&apos;t consistently return codes that a generic library can count on.&lt;/p&gt;

&lt;p&gt;I would definitely recommend reporting or trying to find and patch the code that checks out connections from the pool and does not close them on fatal exception paths.&#160; That would impact a lot of other users.&#160; One way to find this is to turn abandoned connection logging.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13173190">DBCP-513</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13568377">OOZIE-3722</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13569467">OPENJPA-2919</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13066906" name="ReproOneThread-jstack-minIdle.txt" size="5707" author="dionusos" created="Tue, 20 Feb 2024 13:33:57 +0000"/>
                            <attachment id="13066902" name="ReproOneThread-jstack_when_create.txt" size="5086" author="dionusos" created="Tue, 20 Feb 2024 13:14:52 +0000"/>
                            <attachment id="13066903" name="ReproOneThread-jstack_when_stuck.txt" size="5285" author="dionusos" created="Tue, 20 Feb 2024 13:14:52 +0000"/>
                            <attachment id="13066901" name="ReproOneThread-screenshot_when_create-newCreateCount_gt_localMaxTotal.png" size="738222" author="dionusos" created="Tue, 20 Feb 2024 13:14:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1nat4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-594] DBCP Does not check the validity of DB connection at the time creating preparedStatement</title>
                <link>https://issues.apache.org/jira/browse/DBCP-594</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Recently we observed an issue of &quot;This connection has been closed.&quot; while borrowing prepared statement from the pool.&#160;&lt;/p&gt;

&lt;p&gt;It was trying to create a new PreparedStatement using the pooled connection object. And the Pooled connection object was already closed due to some reason.&lt;/p&gt;

&lt;p&gt;There are two configurations testOnCreate and testOnBorrow ensures that the connection is validated after create and before borrow. In case of connection is not valid, DBCP discards such connection from the pool and will not be used in future. However, in the current scenario, if there is some connection in the pool which is in closed state, it will throw above error every time when it will try to create prepareStatement with it. As the actual PgConnection object is wrapped with the DBCP object the application cannot close the actual DB connection. So, the DBCP should take care of this error and discard such connection from the pool in case of this error and should not propagate the error to the application.&#160;&lt;/p&gt;

&lt;p&gt;Attached is the exception stack trace for this issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS: CentOS&lt;/p&gt;

&lt;p&gt;DB: PostgreSQL&lt;/p&gt;

&lt;p&gt;Java: openjdk 17.0.8.1 2023-08-24&lt;/p&gt;</environment>
        <key id="13562918">DBCP-594</key>
            <summary>DBCP Does not check the validity of DB connection at the time creating preparedStatement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sjhala">Shaktisinh Jhala</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Dec 2023 10:03:43 +0000</created>
                <updated>Mon, 8 Jan 2024 16:49:15 +0000</updated>
                            <resolved>Mon, 8 Jan 2024 13:56:11 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17800505" author="garydgregory" created="Tue, 26 Dec 2023 15:00:10 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;br/&gt;
Thank you for your report.&lt;br/&gt;
Would you please test with 2.11.0? If any change is made it would be for 2.11.1.&lt;br/&gt;
TY!&lt;/p&gt;</comment>
                            <comment id="17800690" author="sjhala" created="Wed, 27 Dec 2023 04:45:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; i checked the defects fixed in the 2.10 and 2.11 and found no fix made in this area. The issue mentioned is observed only for production setup where there is huge traffic. And we cannot use latest version it in the production envt.&#160;&lt;/p&gt;</comment>
                            <comment id="17800762" author="garydgregory" created="Wed, 27 Dec 2023 12:58:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;br/&gt;
Thank you for your update.&lt;br/&gt;
Feel free to provide a PR on GitHub with a least a failing test if not a fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17800784" author="sjhala" created="Wed, 27 Dec 2023 14:22:41 +0000"  >&lt;p&gt;I doubt I fully understood your last comment &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;If the ask is to provide the failing use case if this issue is not fixed, there here it is:&lt;/p&gt;

&lt;p&gt;In the case when the the actual DB connection is closed (in this case the PgConnection.queryExecutor.closed = true) then every time such connection is used to prepare the statement it will give the error and it will not be discarded from the pool.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17800792" author="garydgregory" created="Wed, 27 Dec 2023 14:43:25 +0000"  >&lt;p&gt;Hello&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What I mean is this: Can you provide a failing unit test?&lt;/p&gt;</comment>
                            <comment id="17800822" author="sjhala" created="Wed, 27 Dec 2023 16:25:47 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160; for clarifying. Appreciate your support.&lt;/p&gt;

&lt;p&gt;The failing use case i mentioned in my earlier comment and in the defect description. Let me know if any specifics are required.&lt;/p&gt;</comment>
                            <comment id="17800825" author="garydgregory" created="Wed, 27 Dec 2023 16:39:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let me be ever clearer: A unit test is a JUnit method or class, in other words, &lt;em&gt;code&lt;/em&gt;, not &lt;em&gt;a description of a behavior in plain text&lt;/em&gt;. You can provide this as a PR preferably, or as a patch attached here (which is less preferable). This allows someone here is simply duplicate the issue you want addressed.&lt;/p&gt;</comment>
                            <comment id="17804290" author="sjhala" created="Mon, 8 Jan 2024 13:53:08 +0000"  >&lt;p&gt;Executed the use case&#160; by manually closing connection using reflection and found it working as expected with latest version of DBCP.&lt;/p&gt;</comment>
                            <comment id="17804295" author="garydgregory" created="Mon, 8 Jan 2024 13:55:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ll mark this issue as resolved in 2.11.0 then. Please confirm that&apos;s the version you tested.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17804371" author="sjhala" created="Mon, 8 Jan 2024 16:49:15 +0000"  >&lt;p&gt;yes, it was 2.11.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13065605" name="ExceptionStackTrace.txt" size="2838" author="sjhala" created="Tue, 26 Dec 2023 10:03:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mg34:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-593] On Connection interaction failure, InvocationTargetException hides SQLException</title>
                <link>https://issues.apache.org/jira/browse/DBCP-593</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;For example, interacting with a closed Postgres Connection leads to this kind of stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.reflect.InvocationTargetException
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:118)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.commons.pool2.proxy.BaseProxyHandler.doInvoke(BaseProxyHandler.java:79)
	at org.apache.commons.pool2.proxy.JdkProxyHandler.invoke(JdkProxyHandler.java:50)
	... 100 more
Caused by: org.postgresql.util.PSQLException: This connection has been closed.
	at org.postgresql.jdbc.PgConnection.checkClosed(PgConnection.java:907)
	at org.postgresql.jdbc.PgConnection.rollback(PgConnection.java:914)
	at org.apache.commons.dbcp2.DelegatingConnection.rollback(DelegatingConnection.java:781)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	... 103 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ORMs like Hibernate expect &lt;tt&gt;SQLException&lt;/tt&gt; but find themselves interacting with an &lt;tt&gt;InvocationTargetException&lt;/tt&gt; .&lt;/p&gt;</description>
                <environment></environment>
        <key id="13560794">DBCP-593</key>
            <summary>On Connection interaction failure, InvocationTargetException hides SQLException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ralaoui">R&#233;da Housni Alaoui</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Dec 2023 11:02:03 +0000</created>
                <updated>Wed, 6 Dec 2023 13:08:23 +0000</updated>
                            <resolved>Wed, 6 Dec 2023 13:08:23 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17793641" author="garydgregory" created="Wed, 6 Dec 2023 11:08:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralaoui&quot; class=&quot;user-hover&quot; rel=&quot;ralaoui&quot;&gt;ralaoui&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;What is the actual issue? You write about Hibernate but it is not in the stack trace.&lt;/p&gt;

&lt;p&gt;Would you provide a failing test as a PR on GitHub so we can concretely see what you are reporting?&lt;/p&gt;</comment>
                            <comment id="17793656" author="ralaoui" created="Wed, 6 Dec 2023 11:31:18 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The actual issue is that I should directly get an &lt;tt&gt;SQLException&lt;/tt&gt;, not an &lt;tt&gt;InvocationTargetException&lt;/tt&gt; caused by an &lt;tt&gt;SQLException&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Would you provide a failing test as a PR on GitHub so we can concretely see what you are reporting?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, already working on that. But frankly, I don&apos;t know if the issue is in commons-dbcp2 or commons-pool.&lt;/p&gt;</comment>
                            <comment id="17793701" author="ralaoui" created="Wed, 6 Dec 2023 13:08:23 +0000"  >&lt;p&gt;This is caused by the workaround described at &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-590?focusedCommentId=17676588&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17676588&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-590?focusedCommentId=17676588&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17676588&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1m2zk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-590] BasicDataSource#setAbandonedUsageTracking has no effect</title>
                <link>https://issues.apache.org/jira/browse/DBCP-590</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Passing &lt;tt&gt;true&lt;/tt&gt; to &lt;tt&gt;BasicDataSource#setAbandonedUsageTracking(boolean usageTracking)&lt;/tt&gt; has no effect because &lt;tt&gt;UsageTracking#use&lt;/tt&gt; is never called.&lt;/p&gt;

&lt;p&gt;From what I found, &lt;tt&gt;usageTracking&lt;/tt&gt; can only work if the object pool is of type &lt;tt&gt;ProxiedObjectPool&lt;/tt&gt; . Alas, BasicDataSource enforces &lt;tt&gt;GenericObjectPool&lt;/tt&gt; concrete type preventing us from overriding &lt;tt&gt;BasicDataSource#createObjectPool&lt;/tt&gt; to return a &lt;tt&gt;ProxiedObjectPool&lt;/tt&gt; .&lt;/p&gt;

&lt;p&gt;Is there something I missed or a workaround?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13518311">DBCP-590</key>
            <summary>BasicDataSource#setAbandonedUsageTracking has no effect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ralaoui">R&#233;da Housni Alaoui</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jan 2023 10:31:42 +0000</created>
                <updated>Thu, 15 Feb 2024 23:15:50 +0000</updated>
                            <resolved>Thu, 15 Feb 2024 23:15:50 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.12.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17676588" author="ralaoui" created="Fri, 13 Jan 2023 11:14:27 +0000"  >&lt;p&gt;Here is my workaround for now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Connection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.SQLException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.sql.DataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.BasicDataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.PoolableConnection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.PoolingDataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool2.impl.GenericObjectPool;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool2.proxy.JdkProxySource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool2.proxy.ProxiedObjectPool;

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ExtendedBasicDataSource &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; BasicDataSource {

  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; DataSource createDataSourceInstance() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!getAbandonedUsageTracking()) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.createDataSourceInstance();
    }

    &lt;span class=&quot;code-comment&quot;&gt;// Workaround &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; https://issues.apache.org/jira/browse/DBCP-590
&lt;/span&gt;    GenericObjectPool&amp;lt;PoolableConnection&amp;gt; connectionPool = getConnectionPool();

    JdkProxySource&amp;lt;PoolableConnection&amp;gt; jdkProxySource =
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JdkProxySource&amp;lt;&amp;gt;(getClass().getClassLoader(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;[] {Connection.class});

    ProxiedObjectPool&amp;lt;PoolableConnection&amp;gt; proxiedConnectionPool =
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProxiedObjectPool&amp;lt;&amp;gt;(connectionPool, jdkProxySource);

    PoolingDataSource&amp;lt;PoolableConnection&amp;gt; poolingDataSource =
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource&amp;lt;&amp;gt;(proxiedConnectionPool);
    poolingDataSource.setAccessToUnderlyingConnectionAllowed(
        isAccessToUnderlyingConnectionAllowed());
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; poolingDataSource;
  }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17679153" author="garydgregory" created="Fri, 20 Jan 2023 13:54:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=psteitz&quot; class=&quot;user-hover&quot; rel=&quot;psteitz&quot;&gt;psteitz&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Would reimplementing the BasicDataSource method as below make sense (all tests pass), or, is there an implementation that would be cleaner that you can think of?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; DataSource createDataSourceInstance() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!getAbandonedUsageTracking()) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PoolingDataSource&amp;lt;PoolableConnection&amp;gt; pds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource&amp;lt;&amp;gt;(connectionPool);
            pds.setAccessToUnderlyingConnectionAllowed(isAccessToUnderlyingConnectionAllowed());
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pds;
        }
        &lt;span class=&quot;code-comment&quot;&gt;// Workaround &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; https://issues.apache.org/jira/browse/DBCP-590
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; GenericObjectPool&amp;lt;PoolableConnection&amp;gt; connectionPool = getConnectionPool();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JdkProxySource&amp;lt;PoolableConnection&amp;gt; jdkProxySource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JdkProxySource&amp;lt;&amp;gt;(getClass().getClassLoader(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;[] { Connection.class });
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ProxiedObjectPool&amp;lt;PoolableConnection&amp;gt; proxiedConnectionPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProxiedObjectPool&amp;lt;&amp;gt;(connectionPool, jdkProxySource);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PoolingDataSource&amp;lt;PoolableConnection&amp;gt; poolingDataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource&amp;lt;&amp;gt;(proxiedConnectionPool);
        poolingDataSource.setAccessToUnderlyingConnectionAllowed(isAccessToUnderlyingConnectionAllowed());
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; poolingDataSource;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17681805" author="psteitz" created="Sun, 29 Jan 2023 21:27:09 +0000"  >&lt;p&gt;I will look more at this when I have a little more time.&#160; IIRC, this functionality used to work.&#160; I would not recommend changing the datasource creation until we understand what is causing the problem.&#160; Could be I am wrong and it did not work before.&#160; I will do some testing and analysis some time this week.&lt;/p&gt;</comment>
                            <comment id="17793767" author="ralaoui" created="Wed, 6 Dec 2023 15:02:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;I will do some testing and analysis some time this week.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=psteitz&quot; class=&quot;user-hover&quot; rel=&quot;psteitz&quot;&gt;psteitz&lt;/a&gt;, could you take a look at this issue? FYI, my workaround caused &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-593&quot; title=&quot;On Connection interaction failure, InvocationTargetException hides SQLException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-593&quot;&gt;&lt;del&gt;DBCP-593&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17817807" author="psteitz" created="Thu, 15 Feb 2024 23:15:50 +0000"  >&lt;p&gt;I am really sorry it took me so long to figure this out.&#160; It looks like indeed this has been broken since 2.0 and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralaoui&quot; class=&quot;user-hover&quot; rel=&quot;ralaoui&quot;&gt;ralaoui&lt;/a&gt; is right that the root cause was BDS not calling use() on the PoolableConnections.&#160; I added a test to confirm that it is working now (as of 4dd9df42ffe0905c6fd74515017a22505ae863cf).&#160;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1eua8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-587] DBCP and Transparent Application Continuity</title>
                <link>https://issues.apache.org/jira/browse/DBCP-587</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Oracle databases have a high-availability setup that uses an item called Transparent Application Continuity.&#160; It requires using the following driver class name for &quot;oracle.jdbc.replay.OracleDataSourceImpl&quot;&#160; When I attempt to use this driver I get the following error message.&#160;&#160;&lt;/p&gt;

&lt;p&gt;SQLException occurred : Cannot create JDBC driver of class &apos;oracle.jdbc.replay.OracleDataSourceImpl&apos;&#160;&lt;/p&gt;

&lt;p&gt;Having this as a way to create connection pools would greatly enhance your product.&#160;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13485976">DBCP-587</key>
            <summary>DBCP and Transparent Application Continuity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10004">Not A Bug</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cptkirkh">Kirk Hill</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Oct 2022 21:41:20 +0000</created>
                <updated>Sun, 23 Oct 2022 17:25:00 +0000</updated>
                            <resolved>Fri, 21 Oct 2022 13:59:59 +0000</resolved>
                                    <version>2.9.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17616703" author="JIRAUSER296857" created="Wed, 12 Oct 2022 21:55:56 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.BasicDataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.PrintStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Connection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.PreparedStatement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.ResultSet;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.SQLException;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BasicDB{
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BasicDataSource dataSource;&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BasicDataSource getDataSource() {&#160; &#160; &#160; &#160; {&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataSource == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&#160; &#160; &#160; &#160; &#160; &#160; {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; BasicDataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicDataSource();
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setUrl(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:oracle:thin:@pdb_tac&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setUsername(&lt;span class=&quot;code-quote&quot;&gt;&quot;hr&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;my_password&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;//ds.setDriverClassName(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.driver.OracleDriver&quot;&lt;/span&gt;);
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setDriverClassName(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.replay.OracleDataSourceImpl&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;//ds.setDriverClass(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.replay.OracleDataSourceImpl&quot;&lt;/span&gt;);
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setDefaultAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setInitialSize(5);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setMinIdle(5);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setMaxIdle(10);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setMaxOpenPreparedStatements(100);&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; dataSource = ds;
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dataSource;
&#160; &#160; &#160; &#160; }&#160; &#160; }&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ORACLE_WALLET= &lt;span class=&quot;code-quote&quot;&gt;&quot;c:/my_wallet&quot;&lt;/span&gt;;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void pressAnyKeyToContinue()
&#160; &#160; {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(&lt;span class=&quot;code-quote&quot;&gt;&quot;Press any key to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;...&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.in.read(); }
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception e) { e.printStackTrace(); }
&#160; &#160; }
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getInstanceName(Connection conn) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
&#160; &#160; &#160; &#160; PreparedStatement pstmt = conn.prepareStatement(&lt;span class=&quot;code-quote&quot;&gt;&quot;select instance_name from v$instance&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; r = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;();&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(ResultSet result = pstmt.executeQuery(); result.next(); r = result.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;instance_name&quot;&lt;/span&gt;)) {
&#160; &#160; &#160; &#160; }&#160; &#160; &#160; &#160; pstmt.close();
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; r;
&#160; &#160; }&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getStatValue(Connection conn, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; statName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; q = &lt;span class=&quot;code-quote&quot;&gt;&quot;select value from v$statname sn, v$sesstat ss where sn.statistic#=ss.statistic# and sn.name=? and ss.sid=SYS_CONTEXT(&lt;span class=&quot;code-quote&quot;&gt;&apos;USERENV&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;SID&apos;&lt;/span&gt;)&quot;&lt;/span&gt;;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; r = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&#160; &#160; &#160; &#160; PreparedStatement pstmt = conn.prepareStatement(q);
&#160; &#160; &#160; &#160; pstmt.setString(1, statName);&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(ResultSet rs = pstmt.executeQuery(); rs.next(); r = rs.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;)) {
&#160; &#160; &#160; &#160; }&#160; &#160; &#160; &#160; pstmt.close();
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; r;
&#160; &#160; }&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void doTx(Connection c, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numValue) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; updsql = &lt;span class=&quot;code-quote&quot;&gt;&quot;UPDATE test SET v=UPPER(v) WHERE id=?&quot;&lt;/span&gt;;
&#160; &#160; &#160; &#160; PreparedStatement pstmt = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&#160; &#160; &#160; &#160; pstmt = c.prepareStatement(updsql);
&#160; &#160; &#160; &#160; c.setAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; numValue; ++i) {
&#160; &#160; &#160; &#160; &#160; &#160; pstmt.setInt(1, i);
&#160; &#160; &#160; &#160; &#160; &#160; pstmt.executeUpdate();
&#160; &#160; &#160; &#160; }&#160; &#160; &#160; &#160; c.commit();
&#160; &#160; &#160; &#160; pstmt.close();
&#160; &#160; }
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;//Connection conn = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/span&gt;&#160; &#160; &#160; &#160; BasicDB self = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicDB();
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numValue = 5000;&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; statname = &lt;span class=&quot;code-quote&quot;&gt;&quot;CPU used by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; session&quot;&lt;/span&gt;;&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.net.tns_admin&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;C:/oracle/product/19.0.0/client_1/network/admin&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.net.wallet_location&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;(SOURCE=(METHOD=FILE)(METHOD_DATA=(DIRECTORY=${ORACLE_WALLET})))&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160;BasicDataSource dataSource = BasicDB.getDataSource();
&#160; &#160; &#160; &#160; &#160; &#160;Connection conn = dataSource.getConnection();
&#160; &#160; &#160; &#160; &#160; &#160; PrintStream var10000 = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out;
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; var10001 = self.getInstanceName(conn);
&#160; &#160; &#160; &#160; &#160; &#160; var10000.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Instance Name = &quot;&lt;/span&gt; + var10001);&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Performing transactions&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; self.pressAnyKeyToContinue();
&#160; &#160; &#160; &#160; &#160; &#160; self.doTx(conn, numValue);&#160; &#160; &#160; &#160; &#160; &#160; var10001 = self.getInstanceName(conn);
&#160; &#160; &#160; &#160; &#160; &#160; var10000.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Instance Name = &quot;&lt;/span&gt; + var10001);&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;BasicDB - &quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;SQLException occurred : &quot;&lt;/span&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; + e.getMessage());
&#160; &#160; &#160; &#160; }&#160; &#160; }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above is a copy of my testing code.&#160; If I use the driver oracle.jdbc.driver.OracleDriver I can connect but the minute I test the Transparent Application Continuity on a two node Oracle RAC with the app connected to the SCAN listener I should be able to shutdown the node that the app is connected to and my Oracle SCAN listener should simply switch the app over to the other node.&#160; This doesn&apos;t work using DBCP to create the connection pools.&#160; If we could use the oracle.jdbc.replay.OracleDataSourceImpl driver then it would allow this to function properly.&#160;&lt;/p&gt;</comment>
                            <comment id="17616735" author="garydgregory" created="Thu, 13 Oct 2022 00:43:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cptkirkh&quot; class=&quot;user-hover&quot; rel=&quot;cptkirkh&quot;&gt;cptkirkh&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;What is the full stack trace?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17617012" author="JIRAUSER296857" created="Thu, 13 Oct 2022 12:27:22 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;C:\Program Files\Java\jdk-14.0.1\bin\java.exe&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.3.1\lib\idea_rt.jar=53726:C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.3.1\bin&quot;&lt;/span&gt; -Dfile.encoding=UTF-8 -classpath C:\Users\ksh\Documents\mywork\java\test_tac\out\production\test_tac;C:\Users\ksh\Documents\mywork\java\test_tac\ucp.jar;C:\Users\ksh\Documents\mywork\java\test_tac\ojdbc8.jar;C:\oracle\product\19.0.0\client_1\jlib\oraclepki.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-dbcp2-2.9.0.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-pool2-2.11.1.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-logging-1.2.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-collections4-4.4.jar;C:\Users\ksh\Documents\mywork\java\test_tac\simplefan.jar;C:\Users\ksh\Documents\mywork\java\test_tac\ons.jar BasicDB
&lt;/span&gt;BasicDB - SQLException occurred : Cannot create JDBC driver of class &lt;span class=&quot;code-quote&quot;&gt;&apos;oracle.jdbc.replay.OracleDataSourceImpl&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; connect URL &lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc:oracle:thin:@pdb_tac&apos;&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; finished with exit code 0
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17617038" author="garydgregory" created="Thu, 13 Oct 2022 13:06:51 +0000"  >&lt;p&gt;That&apos;s not a stack trace.&lt;/p&gt;

&lt;p&gt;I&apos;m guessing you might have a version of the JDBC driver that does not contain this class or maybe the class depends on code that is not on your classpath. The stack trace and any chain of &quot;Cause by&quot; exceptions might show you the actual cause of the reported issue. It&apos;s also possible you are using a JDBC connection string that this driver class does not support.&lt;/p&gt;</comment>
                            <comment id="17617055" author="JIRAUSER296857" created="Thu, 13 Oct 2022 13:28:37 +0000"  >&lt;p&gt;Sorry, I am the Oracle DBA.&#160; Here is the stack trace.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&quot;C:\Program Files\Java\jdk1.8.0_333\bin\java.exe&quot; &quot;-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.3.1\lib\idea_rt.jar=64979:C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.3.1\bin&quot; -Dfile.encoding=UTF-8 -classpath &quot;C:\Program Files\Java\jdk1.8.0_333\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\rt.jar;C:\Users\ksh\Documents\mywork\java\test_tac\out\production\test_tac;C:\Users\ksh\Documents\mywork\java\test_tac\ucp.jar;C:\Users\ksh\Documents\mywork\java\test_tac\ojdbc8.jar;C:\oracle\product\19.0.0\client_1\jlib\oraclepki.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-dbcp2-2.9.0.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-pool2-2.11.1.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-logging-1.2.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-collections4-4.4.jar;C:\Users\ksh\Documents\mywork\java\test_tac\simplefan.jar;C:\Users\ksh\Documents\mywork\java\test_tac\ons.jar&quot; BasicDB&lt;br/&gt;
java.sql.SQLException: Cannot create JDBC driver of class &apos;oracle.jdbc.replay.OracleDataSourceImpl&apos; for connect URL &apos;jdbc:oracle:thin:@pdb_tac&apos;&lt;br/&gt;
&#160; &#160; at org.apache.commons.dbcp2.DriverFactory.createDriver(DriverFactory.java:75)&lt;br/&gt;
&#160; &#160; at org.apache.commons.dbcp2.BasicDataSource.createConnectionFactory(BasicDataSource.java:459)&lt;br/&gt;
&#160; &#160; at org.apache.commons.dbcp2.BasicDataSource.createDataSource(BasicDataSource.java:525)&lt;br/&gt;
&#160; &#160; at org.apache.commons.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:731)&lt;br/&gt;
&#160; &#160; at BasicDB.main(BasicDB.java:110)&lt;br/&gt;
Caused by: java.lang.ClassCastException: oracle.jdbc.replay.OracleDataSourceImpl cannot be cast to java.sql.Driver&lt;br/&gt;
&#160; &#160; at org.apache.commons.dbcp2.DriverFactory.createDriver(DriverFactory.java:66)&lt;br/&gt;
&#160; &#160; ... 4 more&lt;/p&gt;

&lt;p&gt;Process finished with exit code 0&lt;/p&gt;</comment>
                            <comment id="17617090" author="markt" created="Thu, 13 Oct 2022 14:22:48 +0000"  >&lt;p&gt;`Oracle.jdbc.replay.OracleDataSourceImpl` is a `DataSource` not a `Driver`. You can&apos;t use it with `BasicDataSource`. I don&apos;t have an Oracle database to hand to test with but I&apos;m fairly sure you need to configure a `PoolingDataSource` to use `Oracle.jdbc.replay.OracleDataSourceImpl`. That will require code changes.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17617924" author="JIRAUSER296857" created="Fri, 14 Oct 2022 19:13:27 +0000"  >&lt;p&gt;Mark,&#160; Thanks for the input.&#160; So now I go an create a PoolingDataSource but nowhere can see how to set the FactoryClassName.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here is the setup of my DataSource.&#160; Then again maybe I need to read more on pooling since when I run this I only get 1 connection as opposed to when I run BasicDataSource I see 5 in my DB.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; PoolingDataSource setupDataSource() {
&lt;/span&gt;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connectURI = &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:oracle:thin:hr/my_password@pdb_tac&quot;&lt;/span&gt;;
    ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DriverManagerConnectionFactory(connectURI, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);

    PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(connectionFactory, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);


    GenericObjectPoolConfig poolConfig = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPoolConfig();

    poolConfig.setMaxTotal(5);
    poolConfig.setMinIdle(3);
    ObjectPool objectPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool(poolableConnectionFactory,poolConfig);

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Max connections total at setup: &quot;&lt;/span&gt;
            + poolConfig.getMaxTotal());



    poolableConnectionFactory.setPool(objectPool);

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource(objectPool);



}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17617943" author="b.eckenfels" created="Fri, 14 Oct 2022 19:59:30 +0000"  >&lt;p&gt;You need to use &lt;a href=&quot;https://commons.apache.org/proper/commons-dbcp/apidocs/org/apache/commons/dbcp2/DataSourceConnectionFactory.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://commons.apache.org/proper/commons-dbcp/apidocs/org/apache/commons/dbcp2/DataSourceConnectionFactory.html&lt;/a&gt; instead of DriverManagerConnectionFactory to specify an instantiated DataSource subclass.&lt;/p&gt;</comment>
                            <comment id="17618168" author="michael-o" created="Sat, 15 Oct 2022 20:45:14 +0000"  >&lt;p&gt;I don&apos;t see a bug here. This is better suited for StackOverflow or the users mailing list.&lt;/p&gt;</comment>
                            <comment id="17618933" author="JIRAUSER296857" created="Mon, 17 Oct 2022 14:23:53 +0000"  >&lt;p&gt;You are correct this isn&apos;t a bug.&#160; The hints above are helping me understand and I have posted my questions in the user&apos;s mailing list.&lt;/p&gt;</comment>
                            <comment id="17619078" author="JIRAUSER296857" created="Mon, 17 Oct 2022 20:09:09 +0000"  >&lt;p&gt;Ok,&#160; So not sure if this is considered a bug so I apologize if is not.&#160; I have changed the code to work now using Datasource and here is my current code.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DbPoolTest {&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; GenericObjectPool&amp;lt;PoolableConnection&amp;gt; connectionPool = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BasicDataSource dataSource;&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BasicDataSource getDataSource() {&#160; &#160; &#160; &#160; {&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataSource == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&#160; &#160; &#160; &#160; &#160; &#160; {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; BasicDataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicDataSource();
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setUrl(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:oracle:thin:@pdb_tac&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setUsername(&lt;span class=&quot;code-quote&quot;&gt;&quot;hr&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;my_password&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setDriverClassName(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.driver.OracleDriver&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setDefaultAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setConnectionFactoryClassName(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.replay.OracleDataSourceImpl&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;DBCP classname: &quot;&lt;/span&gt; + ds.getConnectionFactoryClassName());&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setInitialSize(5);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setMinIdle(5);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setMaxIdle(10);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ds.setMaxOpenPreparedStatements(100);&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; dataSource = ds;
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dataSource;
&#160; &#160; &#160; &#160; }&#160; &#160; }&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; PoolingDataSource setupDataSource(BasicDataSource ds ) {
&#160; &#160; &#160; &#160; ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataSourceConnectionFactory(ds);&#160; &#160; &#160; &#160; PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(connectionFactory, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&#160; &#160; &#160; &#160; GenericObjectPoolConfig poolConfig = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPoolConfig();&#160; &#160; &#160; &#160; poolConfig.setMaxTotal(4);
&#160; &#160; &#160; &#160; poolConfig.setMinIdle(3);&#160; &#160; &#160; &#160; ObjectPool objectPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool(poolableConnectionFactory,poolConfig);&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Max connections total at setup: &quot;&lt;/span&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; + poolConfig.getMaxTotal());&#160; &#160; &#160; &#160; poolableConnectionFactory.setPool(objectPool);&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource(objectPool);&#160; &#160; }&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; GenericObjectPool&amp;lt;PoolableConnection&amp;gt; getConnectionPool() {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; connectionPool;
&#160; &#160; }
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
&#160; &#160; &#160; &#160; DbPoolTest demo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DbPoolTest();
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numValue = 5000;
&#160; &#160; &#160; &#160; Connection conn = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&#160; &#160; &#160; &#160; BasicDataSource dataSource = DbPoolTest.getDataSource();
&#160; &#160; &#160; &#160; PoolingDataSource pds = setupDataSource(dataSource);&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160;
&#160; &#160; &#160; &#160; &#160; &#160; conn = pds.getConnection();
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; var10001 = demo.getInstanceName(conn);
&#160; &#160; &#160; &#160; &#160; &#160; var10000.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Instance Name = &quot;&lt;/span&gt; + var10001);
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Performing transactions&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
&#160; &#160; &#160; &#160; &#160; &#160; e.printStackTrace(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out);
&#160; &#160; &#160; &#160; }
&#160; &#160; }}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now returns this for an error.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\Program Files\Java\jdk1.8.0_333\bin\java.exe&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.3.1\lib\idea_rt.jar=63926:C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.3.1\bin&quot;&lt;/span&gt; -Dfile.encoding=UTF-8 -classpath &lt;span class=&quot;code-quote&quot;&gt;&quot;C:\Program Files\Java\jdk1.8.0_333\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_333\jre\lib\rt.jar;C:\Users\ksh\Documents\mywork\java\test_tac\out\production\test_tac;C:\Users\ksh\Documents\mywork\java\test_tac\ucp.jar;C:\Users\ksh\Documents\mywork\java\test_tac\ojdbc8.jar;C:\oracle\product\19.0.0\client_1\jlib\oraclepki.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-dbcp2-2.9.0.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-pool2-2.11.1.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-logging-1.2.jar;C:\Users\ksh\Documents\mywork\java\test_tac\commons-collections4-4.4.jar;C:\Users\ksh\Documents\mywork\java\test_tac\simplefan.jar;C:\Users\ksh\Documents\mywork\java\test_tac\ons.jar&quot;&lt;/span&gt; DbPoolTest
DBCP classname: oracle.jdbc.replay.OracleDataSourceImpl
Max connections total at setup: 4
java.sql.SQLException: Cannot load ConnectionFactory implementation &lt;span class=&quot;code-quote&quot;&gt;&apos;oracle.jdbc.replay.OracleDataSourceImpl&apos;&lt;/span&gt;
&#160; &#160; at org.apache.commons.dbcp2.ConnectionFactoryFactory.createConnectionFactory(ConnectionFactoryFactory.java:70)
&#160; &#160; at org.apache.commons.dbcp2.BasicDataSource.createConnectionFactory(BasicDataSource.java:459)
&#160; &#160; at org.apache.commons.dbcp2.BasicDataSource.createDataSource(BasicDataSource.java:525)
&#160; &#160; at org.apache.commons.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:731)
&#160; &#160; at org.apache.commons.dbcp2.DataSourceConnectionFactory.createConnection(DataSourceConnectionFactory.java:83)
&#160; &#160; at org.apache.commons.dbcp2.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:374)
&#160; &#160; at org.apache.commons.pool2.impl.GenericObjectPool.create(GenericObjectPool.java:571)
&#160; &#160; at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:298)
&#160; &#160; at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:223)
&#160; &#160; at org.apache.commons.dbcp2.PoolingDataSource.getConnection(PoolingDataSource.java:141)
&#160; &#160; at DbPoolTest.main(DbPoolTest.java:142)
Caused by: java.lang.NoSuchMethodException: oracle.jdbc.replay.OracleDataSourceImpl.&amp;lt;init&amp;gt;(java.sql.Driver, java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, java.util.Properties)
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:3082)
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:1825)
&#160; &#160; at org.apache.commons.dbcp2.ConnectionFactoryFactory.createConnectionFactory(ConnectionFactoryFactory.java:64)
&#160; &#160; ... 10 more
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With this being the culprit.&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.NoSuchMethodException: oracle.jdbc.replay.OracleDataSourceImpl.&amp;lt;init&amp;gt;(java.sql.Driver, java.lang.String, java.util.Properties)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17619105" author="b.eckenfels" created="Mon, 17 Oct 2022 21:25:36 +0000"  >&lt;p&gt;I don&#8217;t think you need the basic datasource at all:&#228;&lt;/p&gt;

&lt;p&gt;    OracleDataSourceImpl ds = new oracle.jdbc.replay.OracleDataSourceImpl();&lt;br/&gt;
    ds.setUrl(&quot;jdbc:oracle:thin:@pdb_tac&quot;);&lt;br/&gt;
    ds.setUsername(&quot;hr&quot;);&lt;br/&gt;
    ds.setPassword(&quot;my_password&quot;);&lt;br/&gt;
    ConnectionFactory connectionFactory = new DataSourceConnectionFactory(ds);&lt;br/&gt;
    PoolableConnectionFactory poolableConnectionFactory = new PoolableConnectionFactory(connectionFactory, null);&lt;/p&gt;

</comment>
                            <comment id="17619738" author="JIRAUSER296857" created="Tue, 18 Oct 2022 18:47:15 +0000"  >&lt;p&gt;Bernd,&#160; thanks for the help.&#160; One more question.&#160; When I run this code&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;OracleDataSourceImpl ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; oracle.jdbc.replay.OracleDataSourceImpl(); OracleDataSourceImpl ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; oracle.jdbc.replay.OracleDataSourceImpl();
ds.setURL(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:oracle:thin:@pdb_tac&quot;&lt;/span&gt;);
ds.setUsername(&lt;span class=&quot;code-quote&quot;&gt;&quot;hr&quot;&lt;/span&gt;);
ds.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;my_password&quot;&lt;/span&gt;);
ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataSourceConnectionFactory(ds);
PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(connectionFactory,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);GenericObjectPoolConfig poolConfig = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPoolConfig();
poolConfig.setMaxTotal(5);
poolConfig.setMinIdle(4);ObjectPool objectPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool(poolableConnectionFactory, poolConfig);
poolableConnectionFactory.setPool(objectPool);
PoolingDataSource dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource(objectPool);conn = dataSource.getConnection();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I want 5 pool connections so set it this way. &#160;poolConfig.setMaxTotal(5);&#160; When I go to check my connections in my DB I only see one.&#160; When I use the BasicDataSource I can set it this way ds.setInitialSize(5) and&#160; see the 5 connections.&#160; Do I not understand this properly?&#160; Thanks.&#160;&lt;/p&gt;</comment>
                            <comment id="17619934" author="psteitz" created="Wed, 19 Oct 2022 02:05:42 +0000"  >&lt;p&gt;GenericObjectPool has no initialSize parameter.&#160; You need to do what BasicDataSource does to pre-load the pool, which is to call objectPool.addObject initialSize times to get the initial instances created.&#160; Alternatively, since you have set minIdle, you can call GOP&apos;s preparePool method which will create 4 instances.&lt;/p&gt;

&lt;p&gt;It would be great to either summarize the discussion here or post a link back to your question on commons-user.&lt;/p&gt;</comment>
                            <comment id="17622297" author="JIRAUSER296857" created="Fri, 21 Oct 2022 13:59:20 +0000"  >&lt;p&gt;I can close the issue.&#160; Thank you for helping me with this.&#160; I will post a link back to this under the commons-user&lt;/p&gt;</comment>
                            <comment id="17622298" author="JIRAUSER296857" created="Fri, 21 Oct 2022 13:59:59 +0000"  >&lt;p&gt;Issue was resolved and will post a link back to this in the commons-user group.&lt;/p&gt;</comment>
                            <comment id="17622847" author="psteitz" created="Sun, 23 Oct 2022 17:25:00 +0000"  >&lt;p&gt;Thanks.  It was a good question.&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z19bag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-585] Connection level JMX queries result in concurrent access to connection objects, causing errors</title>
                <link>https://issues.apache.org/jira/browse/DBCP-585</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;As we expose Connection objects over JMX, they may be accessed by multiple threads concurrently; &lt;br/&gt;
a) an application thread that borrows the Connection and uses it business as usual,&lt;br/&gt;
b) another thread simultaneously performing a JMX query, which in turn calls getters on the same connection object via the MBean interface.&lt;/p&gt;

&lt;p&gt;Also, calls to Connection object getters are mostly delegated to the underlying vendor-specific connection provided by the JDBC driver. For example, when we make the JMX query to get the &quot;schema&quot; attribute of the JMX connection object, this is translated into a &quot;java.sql.Connection.getSchema()&quot;, and passed to the vendor-specific Connection object by DBCP. In the case of Postgres, for example, this is further translated to a query &quot;select current_schema()&quot; and sent to the server.&lt;/p&gt;

&lt;p&gt;Hence, querying connections over JMX result in concurrent access by multiple threads to the underlying Connection provided by the vendors, to the point that these two threads may be running queries simultaneously on the same connection. &lt;/p&gt;

&lt;p&gt;However, this is not supported by any of the major database vendors. Vendor links on Connection objects not being threadsafe:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://jdbc.postgresql.org/documentation/head/thread.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Postgres&lt;/a&gt;
&lt;blockquote&gt;&lt;p&gt;The PostgreSQL&#8482; JDBC driver is not thread safe. The PostgreSQL server is not threaded. Each connection creates a new process on the server; as such any concurrent requests to the process would have to be serialized. The driver makes no guarantees that methods on connections are synchronized. It will be up to the caller to synchronize calls to the driver.&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://docs.oracle.com/en/database/oracle/oracle-database/19/jjdbc/JDBC-coding-tips.html#GUID-EE479007-D105-4F82-8D51-000CBBD4BC77&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Oracle&lt;/a&gt;&#160;
&lt;blockquote&gt;&lt;p&gt;Oracle strongly discourages sharing a database connection among multiple threads. Avoid allowing multiple threads to access a connection simultaneously.&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.javadoc.io/doc/com.microsoft.sqlserver/mssql-jdbc/latest/com.microsoft.sqlserver.jdbc/com/microsoft/sqlserver/jdbc/SQLServerConnection.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Microsoft SQL Server&lt;/a&gt;
&lt;blockquote&gt;&lt;p&gt;SQLServerConnection is not thread safe, however multiple statements created from a single connection can be processing simultaneously in concurrent threads.&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Another interesting point to note, also to do justice to previous committers who have put this feature in place, is that this was not always the case. In the following links, you may see the same links to the older versions of the same pages. In the past, all vendors indicated that Connection is fully thread-safe; &lt;a href=&quot;https://www.postgresql.org/docs/7.1/jdbc-thread.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Postgres&lt;/a&gt;, &lt;a href=&quot;https://docs.oracle.com/cd/A97335_02/apps.102/a83724/tips1.htm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Oracle&lt;/a&gt;, &lt;a href=&quot;https://www.javadoc.io/doc/com.microsoft.sqlserver/mssql-jdbc/6.1.0.jre7/com/microsoft/sqlserver/jdbc/SQLServerConnection.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MSSQL Server&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Hence, it was once safe to expose Connection objects via JMX given the thread-safety guarantees for the underlying vendor connection were in place. But as Vendors dropped the thread-safety guarantee one by one, it is not safe anymore, and may actually cause convoluted errors that pop up intermittently due to thread races in the JDBC driver code (see an example in the comments section below). Accordingly, exposing Connections via JMX shall be retired along with dropped support from most vendors. &lt;/p&gt;

&lt;p&gt;Note: the Datasource MBeans, which provide a vital set of metrics have no such problems as they don&apos;t depend on the underlying JDBC provider.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13437293">DBCP-585</key>
            <summary>Connection level JMX queries result in concurrent access to connection objects, causing errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Kurtcebe Eroglu">Kurtcebe Eroglu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Apr 2022 16:45:18 +0000</created>
                <updated>Mon, 2 May 2022 22:48:50 +0000</updated>
                            <resolved>Mon, 2 May 2022 22:48:23 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17516009" author="kurtcebe eroglu" created="Fri, 1 Apr 2022 16:45:47 +0000"  >&lt;p&gt;It&apos;s hard to consistently repro race conditions with test classes, but just to provide a sample of cases where concurrent access can actually break things, we may use the class below. We seem to be able to generate such an error almost 50% of the time with the example below.&lt;/p&gt;

&lt;p&gt;The class depends on commons-dbcp2 2.9.0 and Postgres JDBC driver 42.2.23. We simulate external JMX queries using &lt;a href=&quot;https://github.com/prometheus/jmx_exporter&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Prometheus JMX Exporter&lt;/a&gt; 0.16.1.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;download the dependencies and the javaagent&lt;/li&gt;
	&lt;li&gt;create a new file called &apos;jmx-exporter-config.yml&apos; in the same directory, with the following contents. This config will query and report all MBeans.
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;---
startDelaySeconds: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;compile class with dependencies and run like below. Notice that we expose port 9099 for JMX queries over HTTP. Replace the JDBC connection string parameter as per your DB instance details.&lt;/li&gt;
	&lt;li&gt;after starting a program use a browser or Curl to send a get request to the port exposed by the agent using the address &quot;http://localhost:9099&quot;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java -cp postgresql-42.2.23.jar:commons-dbcp2-2.9.0.jar:commons-pool2-2.10.0.jar:commons-logging/1.2/commons-logging-1.2.jar:. -javaagent:jmx_prometheus_javaagent-0.16.1.jar=9099:jmx-exporter-config.yml TestBasicDataSource &quot;jdbc:postgresql://localhost:5432/testdb?user=testuser&amp;amp;password=testpass&amp;amp;ssl=false&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;~50% of the time, as soon as we browse &quot;http://localhost:9099&quot;, we can notice the following errors in the logs. If the error does not happen, stop and restart the test and try again.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Setting up data source.
Creating threads to use the datasource
waiting for error messages during JMX access...
org.postgresql.util.PSQLException: Cannot change transaction isolation level in the middle of a transaction.
	at org.postgresql.jdbc.PgConnection.setTransactionIsolation(PgConnection.java:940)
	at org.apache.commons.dbcp2.DelegatingConnection.setTransactionIsolation(DelegatingConnection.java:958)
	at org.apache.commons.dbcp2.DelegatingConnection.setTransactionIsolation(DelegatingConnection.java:958)
	at TestBasicDataSource$QueryTask.runOnce(TestBasicDataSource.java:54)
	at TestBasicDataSource$QueryTask.run(TestBasicDataSource.java:35)
	at java.lang.Thread.run(Thread.java:748)
Thread terminated on error
org.postgresql.util.PSQLException: Cannot change transaction isolation level in the middle of a transaction.
	at org.postgresql.jdbc.PgConnection.setTransactionIsolation(PgConnection.java:940)
	at org.apache.commons.dbcp2.DelegatingConnection.setTransactionIsolation(DelegatingConnection.java:958)
	at org.apache.commons.dbcp2.DelegatingConnection.setTransactionIsolation(DelegatingConnection.java:958)
	at TestBasicDataSource$QueryTask.runOnce(TestBasicDataSource.java:54)
	at TestBasicDataSource$QueryTask.run(TestBasicDataSource.java:35)
	at java.lang.Thread.run(Thread.java:748)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Test class&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Connection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.ResultSet;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.SQLException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Statement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.sql.DataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.BasicDataSource;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestBasicDataSource {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DataSource dataSource;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Setting up data source.&quot;&lt;/span&gt;);
        dataSource = setupDataSource(args[0]);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Creating threads to use the datasource&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 20; i ++){
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryTask()).start();
        }
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; error messages during JMX access...&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DataSource setupDataSource(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connectURI) {
        BasicDataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicDataSource();
        ds.setJmxName(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.example:name=BasicDataSource1&quot;&lt;/span&gt;);
        ds.setDriverClassName(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.postgresql.Driver&quot;&lt;/span&gt;);
        ds.setUrl(connectURI);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ds;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;QueryTask &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; runFlag = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (runFlag) {
                runOnce();
            }
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; terminated on error&quot;&lt;/span&gt;);
        }

        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void runOnce() {
            Connection conn = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            Statement stmt = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            ResultSet rset = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                conn = dataSource.getConnection();

                &lt;span class=&quot;code-comment&quot;&gt;// Following setTransactionIsolation call will fail &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we&apos;re already in an active transaction.
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// This happens intermittently, because the JMX thread sometimes read the stale value of &lt;span class=&quot;code-quote&quot;&gt;&quot;autoCommit&quot;&lt;/span&gt;
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// flag on the Postgres connection object, and send the &lt;span class=&quot;code-quote&quot;&gt;&quot;select current_schema()&quot;&lt;/span&gt; query with a preceding
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;begin&quot;&lt;/span&gt; statement, starting a transaction, which the connection pool and JDBC driver are not aware of
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// This never fails &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we don&apos;t perform any JMX access
&lt;/span&gt;                conn.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED);
                conn.setAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

                stmt = conn.createStatement();
                rset = stmt.executeQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT CURRENT_TIME(3) ;&quot;&lt;/span&gt;);
                rset.next();
                rset.getString(1);

                conn.commit();
                conn.setAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(SQLException e) {
                e.printStackTrace();
                runFlag = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rset != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) rset.close(); } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception e) { }
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stmt != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) stmt.close(); } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception e) { }
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conn != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) conn.close(); } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception e) { }
            }
        }
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My testing environment details:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;- Mac 2,6 GHz 6-Core Intel Core i7
- Darwin C02DG16JMD6V 19.6.0 Darwin Kernel Version 19.6.0: Tue Feb 15 21:39:11 PST 2022; root:xnu-6153.141.59~1/RELEASE_X86_64 x86_64
- OpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_292-b10)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17516283" author="garydgregory" created="Sat, 2 Apr 2022 12:28:30 +0000"  >&lt;p&gt;So this is fully dependent on the feature of a specific version of a specific JDBC Driver...&lt;/p&gt;

&lt;p&gt;&quot;Accordingly, exposing Connections via JMX shall be retired along with dropped support from most vendors.&quot;&lt;/p&gt;

&lt;p&gt;Well, no, that would break users for whom this actually works today. I suppose we could consider this if we break compatibility in this area for a possible 3.0 major release, whenever that would be, but not in the 2.x line.&lt;/p&gt;</comment>
                            <comment id="17516403" author="kurtcebe eroglu" created="Sat, 2 Apr 2022 22:19:11 +0000"  >&lt;p&gt;Thanks for your comment &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;It makes perfect sense to handle this with as little disruption as possible to existing users, and dropping an existing feature may indeed be a no go for a minor version.&lt;/p&gt;

&lt;p&gt;Would you agree that even if we don&apos;t have multiple examples (from different vendors and versions) at the moment, the existence of clear guidance from multiple major DB/ JDBC driver vendors, telling that their Connection objects are not thread-safe and shall not be accessed as such, may justify an optional config param for 2.x line? JMX instrumentation is already optional via &quot;jmxName&quot; parameter, but we&apos;d love to hang on to the DataSource MBeans, which are providing immense value on monitoring. For example, an additional config option &quot;registerConnectionMBean&quot;, &quot;true&quot; by default, hence completely transparent to existing users, may give users who have problems, or want to follow the guidance from their DB vendors a way to opt-out from Connection monitoring, only when this parameter is explicitly set to &quot;false&quot;?&#160;&lt;/p&gt;</comment>
                            <comment id="17516506" author="garydgregory" created="Sun, 3 Apr 2022 14:08:29 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Kurtcebe+Eroglu&quot; class=&quot;user-hover&quot; rel=&quot;Kurtcebe Eroglu&quot;&gt;Kurtcebe Eroglu&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;How would &quot;registerConnectionMBean&quot; be different from &lt;tt&gt;org.apache.commons.pool2.impl.BaseObjectPoolConfig.setJmxEnabled(boolean)&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17516574" author="garydgregory" created="Sun, 3 Apr 2022 18:49:15 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Kurtcebe+Eroglu&quot; class=&quot;user-hover&quot; rel=&quot;Kurtcebe Eroglu&quot;&gt;Kurtcebe Eroglu&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Any patch should be submitted as a PR on GitHub, which will let GitHub automatically run builds and do all of the checks of the Maven default goal.&lt;/p&gt;</comment>
                            <comment id="17516575" author="kurtcebe eroglu" created="Sun, 3 Apr 2022 18:55:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;We register two different sets of information to JMX. Below are screenshots from JavaMissionControl for quick visualization.&lt;br/&gt;
When we configure the data source as&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        BasicDataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicDataSource();
        ds.setJmxName(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.example:name=BasicDataSource1&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
	&lt;li&gt;The selected object in the screenshot is &quot;&lt;tt&gt;com.example:name=BasicDataSource1&lt;/tt&gt;&quot;.&lt;br/&gt;
It gives the datasource config and runtime metrics as can be seen above.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13041964/13041964_ds_attrs.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
We also register a subset of this data at &quot;&lt;tt&gt;com.example:connectionpool=connections,name=BasicDataSource1&lt;/tt&gt;&quot;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13041965/13041965_connections_attrs.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;And we have the MBeans pointing to the connection object instances. These are registered at &lt;tt&gt;org.apache.commons.dbcp2.PoolableConnection&lt;/tt&gt;, as a part of the connection lifecycle. This is the problematic one as values are fetched from underlying vendor-specific connection objects (we extend &lt;tt&gt;DelegatingConnection&lt;/tt&gt;).&lt;br/&gt;
These are registered with the name &quot;&lt;tt&gt;com.example:connectionpool=connections,connection=X,name=BasicDataSource1&lt;/tt&gt;&quot;, where &quot;X&quot; changes with each new connection creation.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13041966/13041966_conn_instance_attrs.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The first two sets of data are essential for monitoring, as it gives us both DataSource runtime config options, and metrics like connection pool size, idle and active connections etc. Setting &lt;tt&gt;setJmxEnabled(false)&lt;/tt&gt; would disable everything. However, we can hold on to the essential metrics and just drop out the connection instance metrics (to be honest, in my personal opinion, these are not adding too much value to monitoring anyways).&lt;/p&gt;

&lt;p&gt;Nothing changes with default settings, but if we set up the pool specifying the new flag like below, we end up disabling only the problematic part, and can still reach all the essential monitoring information (notice the connections disappear);&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        BasicDataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicDataSource();
        ds.setJmxName(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.example:name=BasicDataSource1&quot;&lt;/span&gt;);
        ds.setRegisterConnectionMBean(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13041967/13041967_final.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
Below is the patch file (a quick one), for testing the above parameter.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;^0001-DBCP-585-idea-clarification.patch&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17516580" author="kurtcebe eroglu" created="Sun, 3 Apr 2022 19:43:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; I noticed your last comment after I&apos;ve posted. I&apos;ve submitted a PR for your review.&lt;/p&gt;</comment>
                            <comment id="17516589" author="garydgregory" created="Sun, 3 Apr 2022 20:40:14 +0000"  >&lt;p&gt;Thank you the the patch!&lt;/p&gt;</comment>
                            <comment id="17516590" author="garydgregory" created="Sun, 3 Apr 2022 20:41:06 +0000"  >&lt;p&gt; &lt;a href=&quot;https://github.com/apache/commons-dbcp/pull/179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/pull/179&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17520227" author="psteitz" created="Sun, 10 Apr 2022 22:04:28 +0000"  >&lt;p&gt;Nice analysis.&#160; The patch looks reasonable as a way to turn off the direct connection access.&#160; Trying to allow this safely is an interesting problem.&#160; The only ways that I can come up with risk performance impacts due to adding sync.&#160; The simplest way to do it would be to force clients to obtain a lock in DelegatingConnection.checkOpen (called by everything that actually uses a connection).&#160; The lock would not be contended much, but it would cost something.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17522336" author="garydgregory" created="Thu, 14 Apr 2022 14:17:39 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=psteitz&quot; class=&quot;user-hover&quot; rel=&quot;psteitz&quot;&gt;psteitz&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Are you ok with merging this PR as it stands? Or are you saying that more work is needed?&lt;/p&gt;</comment>
                            <comment id="17526928" author="psteitz" created="Sat, 23 Apr 2022 21:08:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; sorry I missed this.&#160; There is a small javadoc error in the patch (says &quot;sets t.&quot; when it means something else).&#160; There should also be some tests added to verify it is working as designed.&#160; But in general, yes, I am +1 on this.&lt;/p&gt;</comment>
                            <comment id="17526929" author="garydgregory" created="Sat, 23 Apr 2022 21:13:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Kurtcebe+Eroglu&quot; class=&quot;user-hover&quot; rel=&quot;Kurtcebe Eroglu&quot;&gt;Kurtcebe Eroglu&lt;/a&gt;&lt;br/&gt;
Please see Phil&apos;s previous comment, basically looks good but we need tests added to the PR.&lt;br/&gt;
TY!&lt;/p&gt;</comment>
                            <comment id="17530521" author="garydgregory" created="Sun, 1 May 2022 14:59:04 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=psteitz&quot; class=&quot;user-hover&quot; rel=&quot;psteitz&quot;&gt;psteitz&lt;/a&gt;&lt;br/&gt;
Do you think the PR&apos;s test is enough to validate the changes?&lt;/p&gt;</comment>
                            <comment id="17530947" author="psteitz" created="Mon, 2 May 2022 21:17:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160; yes this looks good&lt;/p&gt;</comment>
                            <comment id="17530964" author="garydgregory" created="Mon, 2 May 2022 22:48:50 +0000"  >&lt;p&gt;PR merged to git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13041968" name="0001-DBCP-585-idea-clarification-1.patch" size="5375" author="Kurtcebe Eroglu" created="Sun, 3 Apr 2022 22:57:47 +0000"/>
                            <attachment id="13041966" name="conn_instance_attrs.png" size="91856" author="Kurtcebe Eroglu" created="Sun, 3 Apr 2022 18:47:35 +0000"/>
                            <attachment id="13041965" name="connections_attrs.png" size="224747" author="Kurtcebe Eroglu" created="Sun, 3 Apr 2022 18:46:41 +0000"/>
                            <attachment id="13041964" name="ds_attrs.png" size="246584" author="Kurtcebe Eroglu" created="Sun, 3 Apr 2022 18:46:26 +0000"/>
                            <attachment id="13041967" name="final.png" size="216301" author="Kurtcebe Eroglu" created="Sun, 3 Apr 2022 18:53:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z112i8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-584] DBCP minIdle is invalid</title>
                <link>https://issues.apache.org/jira/browse/DBCP-584</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I use dbcp2 to connect oracle 19c&#160; , but minIdle is invalid,&#160;&lt;/p&gt;

&lt;p&gt;List my dataSource as below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp2.BasicDataSource&quot;&lt;/span&gt; init-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;createDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.OracleDriver&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160; &#160;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt;&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;value&amp;gt;jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=xxx.xxx.xxx.xxx)(PORT=1521)))(CONNECT_DATA=(SERVICE_NAME=orcl)))&amp;lt;/value&amp;gt;
&#160; &#160;&amp;lt;/property&amp;gt;&#160;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;xxxxxx&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;yyyyyyy&quot;&lt;/span&gt; /&amp;gt;&#160;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;connectionProperties&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;v$session.program=LvTest&quot;&lt;/span&gt; /&amp;gt;&#160;  &#160; &#160; &#160;   &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxTotal&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;-1&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxWaitMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;5000&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;20&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;validationQuery&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;select 1 from dual&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;validationQueryTimeout&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;30&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testOnBorrow&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testWhileIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minEvictableIdleTimeMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;180000&quot;&lt;/span&gt;/&amp;gt;
&#160; &#160;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;timeBetweenEvictionRunsMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;60000&quot;&lt;/span&gt;/&amp;gt;&#160;&#160;
&amp;lt;/bean&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when I start up program , execute SQL &quot;select * from v$session where program =&apos;LvTest&apos; &quot;&#160;&lt;/p&gt;

&lt;p&gt;repeatedly , the queryresult is abnormal&lt;/p&gt;

&lt;p&gt;the count of queryresult&#160; increase to 20 rapidly at the begining of the test , After 60 seconds count will change to&#160; 0 Suddenly&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 10 ,&#160; Eclipse EE(2021-6),&#160; Java8, Spring Framework 5.2&lt;/p&gt;</environment>
        <key id="13429609">DBCP-584</key>
            <summary>DBCP minIdle is invalid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lvmingtao">&#21525;&#26126;&#28059;</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Feb 2022 03:03:25 +0000</created>
                <updated>Sun, 6 Mar 2022 20:06:51 +0000</updated>
                                            <version>2.8.0</version>
                    <version>2.9.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17502007" author="garydgregory" created="Sun, 6 Mar 2022 20:06:51 +0000"  >&lt;p&gt;I not sure how to help here unless you can provide a reproducer, which would be best done as a failing test in a GitHub PR. Our build uses the H2 database so anyone can run a build without dependencies on an RDMBS like Oracle. You could also provide a standalone Maven project in a zip file attached here. The PR route would be best.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 33 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zrpk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-583] The &quot;DelegatingConnection.getCatalog&quot; method can return incorrect cached values</title>
                <link>https://issues.apache.org/jira/browse/DBCP-583</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Commons DBCP started caching the catalog name returned by &lt;tt&gt;getCatalog&lt;/tt&gt; (&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-dbcp/blob/922eb2685ff64bdb27607ceecbe333330e5be4c0/src/main/java/org/apache/commons/dbcp2/DelegatingConnection.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/blob/922eb2685ff64bdb27607ceecbe333330e5be4c0/src/main/java/org/apache/commons/dbcp2/DelegatingConnection.java&lt;/a&gt;). This can cause the method to return incorrect values after using a pooled connection to execute a SQL command that effectively changes the catalog of the connection.&lt;/p&gt;

&lt;p&gt;The motivation for executing a SQL command that changes the catalog of a connection instead of calling &lt;tt&gt;setCatalog&lt;/tt&gt; is that some vendors provide commands that allow for &quot;new connections&quot; to happen on an already established connection (i.e. commands that allow connecting to a different catalog, with a different user). Commons DBCP doesn&apos;t offer a way to clear the cache of a connection when something like this happens, which can lead to incorrect results.&lt;/p&gt;

&lt;p&gt;We also think that calling the &lt;tt&gt;close&lt;/tt&gt; method on the connection should invoke the &lt;tt&gt;clearCachedState&lt;/tt&gt; method (as it is called when a transaction ends: &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-dbcp/blob/922eb2685ff64bdb27607ceecbe333330e5be4c0/src/main/java/org/apache/commons/dbcp2/managed/ManagedConnection.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/blob/922eb2685ff64bdb27607ceecbe333330e5be4c0/src/main/java/org/apache/commons/dbcp2/managed/ManagedConnection.java&lt;/a&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13424741">DBCP-583</key>
            <summary>The &quot;DelegatingConnection.getCatalog&quot; method can return incorrect cached values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="iteijeiro">Ismael Teijeiro Fl&#243;rez</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jan 2022 17:02:38 +0000</created>
                <updated>Thu, 29 Feb 2024 19:17:49 +0000</updated>
                            <resolved>Thu, 29 Feb 2024 19:17:49 +0000</resolved>
                                    <version>2.9.0</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17481982" author="garydgregory" created="Tue, 25 Jan 2022 17:20:24 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iteijeiro&quot; class=&quot;user-hover&quot; rel=&quot;iteijeiro&quot;&gt;iteijeiro&lt;/a&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Commons DBCP doesn&apos;t offer a way to clear the cache of a connection when something like this happens, which can lead to incorrect results.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But it does:&lt;/p&gt;

&lt;p&gt;See &lt;tt&gt;org.apache.commons.dbcp2.DelegatingConnection.clearCachedState()&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Feel free to provide a PR on GitHub (with a test), otherwise if you have a different solution.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://bz.apache.org/bugzilla/show_bug.cgi?id=65845]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yxv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-581] BigDecimal precision lossing when reusing prepared statement for INSERT / UPDATE queries in DB2</title>
                <link>https://issues.apache.org/jira/browse/DBCP-581</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We&#160;use DBCP1.4 (with &lt;b&gt;poolPreparedStatements enabled&lt;/b&gt;) to insert records that contains&#160;&lt;tt&gt;&lt;b&gt;BigDecimal&lt;/b&gt; and it will store into a &lt;b&gt;Decimal(11, 2)&lt;/b&gt;&lt;/tt&gt;&#160;column.&lt;br/&gt;
 Although BigDecimal in the first insertion can be rounded up propertly, the remains&#160;&lt;font color=&quot;#ff0000&quot;&gt;&lt;em&gt;fails&lt;/em&gt;&lt;/font&gt;: (see the bottom output)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-09-07 10:22:13:186 INFO JdbcDbcpTest:81 - JDK version 1.8.0_181
2021-09-07 10:22:13:190 INFO JdbcDbcpTest:83 - [Connection class: org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper] connected to jdbc:db2:&lt;span class=&quot;code-comment&quot;&gt;//localhost:50000/mydb
&lt;/span&gt;2021-09-07 10:22:13:232 DEBUG JdbcDbcpTest:103 - [Perform 1 insert] 1 record inserted (value = 0.10999999940395355224609375)
2021-09-07 10:22:13:235 DEBUG JdbcDbcpTest:103 - [Perform 2 insert] 1 record inserted (value = 100.10999999940395355224609375)
2021-09-07 10:22:13:241 INFO JdbcDbcpTest:113 - Execute query SELECT DECTEST FROM TBL_DECTEST
2021-09-07 10:22:13:262 INFO CompareUtils:27 - *******************************
2021-09-07 10:22:13:263 INFO CompareUtils:28 - * Value set: [0.11, 100.10]
2021-09-07 10:22:13:263 INFO CompareUtils:29 - *******************************&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then we upgraded the DBCP from 1.4 to 2.9.0 but the problem &lt;font color=&quot;#ff0000&quot;&gt;still exists&lt;/font&gt;: (see the connection class in line 2)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-09-07 10:22:13:533  INFO JdbcDbcpTest:81 - JDK version 1.8.0_181
2021-09-07 10:22:13:534  INFO JdbcDbcpTest:83 - [Connection class: org.apache.commons.dbcp2.PoolingDataSource$PoolGuardConnectionWrapper] connected to jdbc:db2:&lt;span class=&quot;code-comment&quot;&gt;//localhost:50000/mydb
&lt;/span&gt;2021-09-07 10:22:13:562 DEBUG JdbcDbcpTest:103 - [Perform 1 insert] 1 record inserted (value = 0.10999999940395355224609375)
2021-09-07 10:22:13:564 DEBUG JdbcDbcpTest:103 - [Perform 2 insert] 1 record inserted (value = 100.10999999940395355224609375)
2021-09-07 10:22:13:571  INFO JdbcDbcpTest:113 - Execute query SELECT DECTEST FROM TBL_DECTEST
2021-09-07 10:22:13:574  INFO CompareUtils:27 - *******************************
2021-09-07 10:22:13:574  INFO CompareUtils:28 - * Value set: [0.11, 100.10]
2021-09-07 10:22:13:574  INFO CompareUtils:29 - ******************************* &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We found all BigDecimal can rounded up properly if we&#160;&lt;b&gt;disable poolPreparedStatements&lt;/b&gt;.&#160; However this is not an option due to performance condition.&lt;/p&gt;

&lt;p&gt;Also we tried to insert BigDecimal with only JDBC and all BigDecimal rounded up properly as well:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-09-07 10:22:13:345  INFO JdbcDbcpTest:81 - JDK version 1.8.0_181
2021-09-07 10:22:13:345  INFO JdbcDbcpTest:83 - [Connection class: com.ibm.db2.jcc.t4.b] connected to jdbc:db2:&lt;span class=&quot;code-comment&quot;&gt;//localhost:50000/mydb
&lt;/span&gt;2021-09-07 10:22:13:364 DEBUG JdbcDbcpTest:103 - [Perform 1 insert] 1 record inserted (value = 0.10999999940395355224609375)
2021-09-07 10:22:13:371 DEBUG JdbcDbcpTest:103 - [Perform 2 insert] 1 record inserted (value = 100.10999999940395355224609375)
2021-09-07 10:22:13:372  INFO JdbcDbcpTest:113 - Execute query SELECT DECTEST FROM TBL_DECTEST
2021-09-07 10:22:13:374  INFO CompareUtils:27 - *******************************
2021-09-07 10:22:13:374  INFO CompareUtils:28 - * Value set: [100.11, 0.11]
2021-09-07 10:22:13:374  INFO CompareUtils:29 - *******************************&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;Sample Project:&#160;&lt;a href=&quot;https://github.com/maplecfiv/dbcp-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;maplecfiv/dbcp-test (github.com)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;&lt;b&gt;Java Version&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;DBCP 1.4&lt;/ins&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IBM 64-bit SDK for Windows AMD64/EM64T architecture, Java Technology Edition, Version 7 Release 1&lt;/li&gt;
	&lt;li&gt;Open JDK Zulu 8.31.0.1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;ins&gt;DBCP 2.9.0&lt;/ins&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Open JDK Zulu 8.31.0.1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Database&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;IBM DB2 10.5&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;IBM DB2 11.5&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;We are using IBM DB2 driver&#160;4.25.13, but the problem exists in other versions as well (see below)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;3.69.76&lt;/li&gt;
	&lt;li&gt;4.19.77&lt;/li&gt;
	&lt;li&gt;4.25.13&lt;/li&gt;
	&lt;li&gt;4.26.14&lt;/li&gt;
	&lt;li&gt;4.27.25&lt;/li&gt;
	&lt;li&gt;4.28.11&lt;/li&gt;
	&lt;li&gt;4.29.24&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;MySql Ver 8.0.17 for Linux on x86_64 (MySQL Community Server - GPL)&lt;/ins&gt;&lt;/p&gt;</environment>
        <key id="13399648">DBCP-581</key>
            <summary>BigDecimal precision lossing when reusing prepared statement for INSERT / UPDATE queries in DB2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bcfsham">Barry Sham</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Sep 2021 02:36:35 +0000</created>
                <updated>Tue, 26 Oct 2021 20:53:24 +0000</updated>
                                            <version>1.4</version>
                    <version>2.9.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17412029" author="garydgregory" created="Wed, 8 Sep 2021 15:53:04 +0000"  >&lt;p&gt;It would be most helpful if you could provide a failing test case on GitHub, where you can likely clone of one the existing tests. This should also reveal if this is an issue in DBCP in general or is specific to one driver.&lt;/p&gt;</comment>
                            <comment id="17413039" author="bcfsham" created="Fri, 10 Sep 2021 08:00:25 +0000"  >&lt;p&gt;Thank you for your comment!&lt;/p&gt;

&lt;p&gt;The failing test case can be found on Github:&#160;&lt;a href=&quot;https://github.com/maplecfiv/dbcp-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;maplecfiv/dbcp-test (github.com)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We are using IBM DB2 driver&#160;4.25.13, but the problem exists in other versions as well (see below)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;3.69.76&lt;/li&gt;
	&lt;li&gt;4.19.77&lt;/li&gt;
	&lt;li&gt;4.25.13&lt;/li&gt;
	&lt;li&gt;4.26.14&lt;/li&gt;
	&lt;li&gt;4.27.25&lt;/li&gt;
	&lt;li&gt;4.28.11&lt;/li&gt;
	&lt;li&gt;4.29.24&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also there is no problem when using JDBC (the classic DriverManager.getConnection()) but failed when using&#160;org.apache.commons.dbcp.BasicDataSource /&#160;org.apache.commons.dbcp2.BasicDataSource.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17413276" author="garydgregory" created="Fri, 10 Sep 2021 16:29:28 +0000"  >&lt;p&gt;I&apos;m not sure I can do anything with the repo you provided. It depends on DB2 instead of the database the DBCP tests uses: H2. If the problem is in DBCP, you should be able to reproduce it with H2. Providing your tests as a PR to our repository is the best path to getting your issue resolved because it simplifies our workflow, especially getting your new tests in our code base.&lt;/p&gt;</comment>
                            <comment id="17417882" author="bcfsham" created="Tue, 21 Sep 2021 01:19:16 +0000"  >&lt;p&gt;Thanks for your suggestion.&#160; We will look into H2 and see if we can reproduce our test case on H2 as well.&#160;&lt;/p&gt;

&lt;p&gt;Besides, our teammate found flag&#160;&lt;b&gt;poolPreparedStatements&lt;/b&gt;&#160;seems trigger the behavor like&#160;&lt;b&gt;maxStatements&lt;/b&gt; which provided by DB2 driver for statement pooling purpose.&#160;&lt;/p&gt;

&lt;p&gt;We enabled trace log and found that the DBCP library calles &lt;b&gt;PreparedStatement.clearParameters()&lt;/b&gt;&#160;after the update query executed.&lt;/p&gt;

&lt;p&gt;Is there have any reference material for the &lt;ins&gt;implemenation of statement pooling in DBCP&lt;/ins&gt;?&lt;/p&gt;

&lt;p&gt;Many thanks.&lt;/p&gt;</comment>
                            <comment id="17420114" author="garydgregory" created="Sat, 25 Sep 2021 14:44:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bcfsham&quot; class=&quot;user-hover&quot; rel=&quot;bcfsham&quot;&gt;bcfsham&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What we have is on on &lt;a href=&quot;https://commons.apache.org/proper/commons-dbcp/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://commons.apache.org/proper/commons-dbcp/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do you have H2 tests to reproduce this issue? Or HSQLDB? Or anything we can run?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="17434561" author="garydgregory" created="Tue, 26 Oct 2021 20:53:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bcfsham&quot; class=&quot;user-hover&quot; rel=&quot;bcfsham&quot;&gt;bcfsham&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do you have a status update for us?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13033136" name="DBCPTest.zip" size="6278" author="bcfsham" created="Tue, 7 Sep 2021 06:03:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0untk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-580] Not compatible with org.dbunit.IDatabaseTester </title>
                <link>https://issues.apache.org/jira/browse/DBCP-580</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We tried to upgrade to the latest version from 1.4 but it seems to be causing an issue with our db unit test.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We get the following printed over and over again when the&#160;onSetup() method is invoked&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
at java.lang.StringBuilder.append(StringBuilder.java:131)at java.lang.StringBuilder.append(StringBuilder.java:131) at org.apache.commons.pool2.impl.GenericKeyedObjectPool.toStringAppendFields(GenericKeyedObjectPool.java:1593) at org.apache.commons.pool2.BaseObject.toString(BaseObject.java:31) at org.apache.commons.dbcp2.PoolingConnection.toString(PoolingConnection.java:584) at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2994) at java.lang.StringBuilder.append(StringBuilder.java:131) at org.apache.commons.pool2.impl.GenericKeyedObjectPool.toStringAppendFields(GenericKeyedObjectPool.java:1593) at org.apache.commons.pool2.BaseObject.toString(BaseObject.java:31) at org.apache.commons.dbcp2.PoolingConnection.toString(PoolingConnection.java:584) at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2994) at java.lang.StringBuilder.append(StringBuilder.java:131) at org.apache.commons.pool2.impl.GenericKeyedObjectPool.toStringAppendFields(GenericKeyedObjectPool.java:1593) at org.apache.commons.pool2.BaseObject.toString(BaseObject.java:31) at org.apache.commons.dbcp2.PoolingConnection.toString(PoolingConnection.java:584) at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2994) at java.lang.StringBuilder.append(StringBuilder.java:131) at org.apache.commons.pool2.impl.GenericKeyedObjectPool.toStringAppendFields(GenericKeyedObjectPool.java:1593) at org.apache.commons.pool2.BaseObject.toString(BaseObject.java:31) at org.apache.commons.dbcp2.PoolingConnection.toString(PoolingConnection.java:584) at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2994) at java.lang.StringBuilder.append(StringBuilder.java:131) at org.apache.commons.pool2.impl.GenericKeyedObjectPool.toStringAppendFields(GenericKeyedObjectPool.java:1593) at org.apache.commons.pool2.BaseObject.toString(BaseObject.java:31) at org.apache.commons.dbcp2.PoolingConnection.toString(PoolingConnection.java:584)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We tested different versions and it seems&#160;2.1.1 does not have this bug.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;&amp;lt;dependency&amp;gt;&lt;br/&gt;
            &amp;lt;groupId&amp;gt;com.github.springtestdbunit&amp;lt;/groupId&amp;gt;&lt;br/&gt;
            &amp;lt;artifactId&amp;gt;spring-test-dbunit&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
            &amp;lt;version&amp;gt;1.3.0&amp;lt;/version&amp;gt;&lt;br/&gt;
            &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
        &amp;lt;/dependency&amp;gt;&lt;br/&gt;
		&amp;lt;dependency&amp;gt;&lt;br/&gt;
            &amp;lt;groupId&amp;gt;org.dbunit&amp;lt;/groupId&amp;gt;&lt;br/&gt;
            &amp;lt;artifactId&amp;gt;dbunit&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
            &amp;lt;version&amp;gt;2.7.2&amp;lt;/version&amp;gt;&lt;br/&gt;
            &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
        &amp;lt;/dependency&amp;gt;&lt;/p&gt;</environment>
        <key id="13398520">DBCP-580</key>
            <summary>Not compatible with org.dbunit.IDatabaseTester </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Arelowo">Arelowo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Aug 2021 17:41:22 +0000</created>
                <updated>Mon, 30 Jan 2023 23:41:12 +0000</updated>
                            <resolved>Mon, 30 Jan 2023 23:41:12 +0000</resolved>
                                    <version>2.7.0</version>
                    <version>2.9.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17409480" author="garydgregory" created="Fri, 3 Sep 2021 12:36:23 +0000"  >&lt;p&gt;This looks like the middle of a stack trace. May you please post or attach a complete one?&lt;/p&gt;</comment>
                            <comment id="17409481" author="garydgregory" created="Fri, 3 Sep 2021 12:37:25 +0000"  >&lt;p&gt;Note that the package name has changed between version 1 and 2 so a drop in replacement will not work.&lt;/p&gt;</comment>
                            <comment id="17434563" author="garydgregory" created="Tue, 26 Oct 2021 20:57:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Arelowo&quot; class=&quot;user-hover&quot; rel=&quot;Arelowo&quot;&gt;Arelowo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do you have a status update for us?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ugv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-579] Performance of DelegatingConnection.prepareStatement(String) regressed enormously in 2.8.0 compared to 1.4</title>
                <link>https://issues.apache.org/jira/browse/DBCP-579</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We recently upgraded the commons DBCP from version 1.4 to latest version 2.8.0. After the upgrade, we observed significant degradation in our use case. After the analysis it was found that the performance of&#160;DelegatingConnection.prepareStatement(String) is regressed in version 2.8.0&#160;enormously compared to 1.4 where the approx time taken in 2.8.0 is 7400 seconds compared to approx 183 sec in 1.4.&lt;/p&gt;

&lt;p&gt;Looking at the Yourkit snapshot, it is observed that the newly added call PoolingConnection.createKey(String) in the method PoolingConnection.prepareStatement(String) is the major contributor for this regression.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We took multiple snapshot and in all these snapshot we observed the regression. So it was not intermittent. Also, we observed this with both the our DBs (MS SQL server and PostgreSQL)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please find attached the screenshot of YourKit Snapshot showing the Merged Callees of DelegatingConnection.prepareStatement(String) taken for MS SQL server with commons DBCP version 1.4 and version 2.8 for further details.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS: Windows Server 2008 R2 Enterprise&#160;&lt;/p&gt;

&lt;p&gt;Java: Open JDK 12.0.1&lt;/p&gt;

&lt;p&gt;DB:&#160;Microsoft SQL Server 2012 - 11.0.5058.0 (X64)&lt;/p&gt;</environment>
        <key id="13386495">DBCP-579</key>
            <summary>Performance of DelegatingConnection.prepareStatement(String) regressed enormously in 2.8.0 compared to 1.4</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sjhala">Shaktisinh Jhala</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jun 2021 10:27:17 +0000</created>
                <updated>Wed, 27 Oct 2021 06:53:13 +0000</updated>
                            <resolved>Wed, 27 Oct 2021 06:53:13 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.9.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17375915" author="garydgregory" created="Tue, 6 Jul 2021 18:03:52 +0000"  >&lt;p&gt;Thank you for you report.&lt;/p&gt;

&lt;p&gt;It seems we can cache data like the catalog and schema like we do the auto-commit value. I will look tonight after work.&lt;/p&gt;</comment>
                            <comment id="17376609" author="garydgregory" created="Wed, 7 Jul 2021 14:39:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;br/&gt;
 May you please try git master or a SNAPSHOT build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-dbcp2/2.9.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-dbcp2/2.9.0-SNAPSHOT/&lt;/a&gt; and report back the difference you see in your use case as the schema name and catalog name is now cached. See changes.xml for details.&lt;/p&gt;</comment>
                            <comment id="17377205" author="sjhala" created="Thu, 8 Jul 2021 08:31:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;thanks for quick turn around.&lt;/p&gt;

&lt;p&gt;I checked with the guy who manages our performance setups where we had executed runs earlier. Currently some runs are going on on that setup the setup would be free in a day or two. Will revert back to you early next week if not over the weekend.&lt;/p&gt;</comment>
                            <comment id="17378013" author="sjhala" created="Fri, 9 Jul 2021 11:25:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;took the&#160;&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-dbcp2/2.9.0-SNAPSHOT/commons-dbcp2-2.9.0-20210707.143825-1.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commons-dbcp2-2.9.0-20210707.143825-1.jar&lt;/a&gt;&#160;from the link you provided above and run the tests. However, we did not observed any improvement. When opened the jar file, i noticed that all classes were having the time stamp of 22-Jan-2020. I was expecting it to be of Jul 2021. I double check that i downloaded the jar of correct version and it was 2.9.0 which is correct.&lt;/p&gt;

&lt;p&gt;I executed one more run with profiling enabled. I can still see that&#160;PoolingConnection.createKey(String) is still the culprit. Please find the screen shot of yourkit snapshot attached here with name WithPrivateJarFrom2.9.0.jpg.&lt;/p&gt;</comment>
                            <comment id="17378031" author="garydgregory" created="Fri, 9 Jul 2021 12:10:54 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for your update.&lt;/p&gt;

&lt;p&gt;I can&apos;t explain the class file timestamps oddity within the jar. I just built and deployed another SNAPSHOT jar to the snapshot repository and that jar&apos;s class files also have the odd timestamps.&lt;/p&gt;

&lt;p&gt;The next step is to debug your application from connection pool creation and make sure caching gets propagated all the way down to the &lt;tt&gt;org.apache.commons.dbcp2.DelegatingConnection.cacheState&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;With caching enabled, which it should be by default in &lt;tt&gt;org.apache.commons.dbcp2.BasicDataSource.cacheState&lt;/tt&gt;, I would expect &lt;tt&gt;org.apache.commons.dbcp2.DelegatingConnection.getSchema()&lt;/tt&gt; to call &lt;tt&gt;org.apache.commons.dbcp2.Jdbc41Bridge.getSchema(Connection)&lt;/tt&gt; only once for a given &lt;tt&gt;DelegatingConnection&lt;/tt&gt; instance. That one call could take a while and still show up in your measurements but it should only happen once per instance.&lt;/p&gt;

&lt;p&gt;It is possible that your specific configuration does not use caching at the level of&#160;&lt;tt&gt;DelegatingConnection&lt;/tt&gt; somehow. That, or, caching is enabled but still shows up in the measurements because of the way the application makes use of pools.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17378236" author="sjhala" created="Fri, 9 Jul 2021 18:33:12 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;. Thanks for the details.&lt;/p&gt;

&lt;p&gt;Yes, I can see that while creating the PoolableConnectionFactory in BasicDataSource.createPoolableConnectionFactory, it sets the cacheState to the newly created instance of&#160;PoolableConnectionFactory with its own instance member&#160;cacheState which is initialized with value true so it is expected to cache by default.&#160;&lt;/p&gt;

&lt;p&gt;I can see you have added&#160;cachedSchema member variable in DelegatingConnection class and it is being set in getSchema as well setSchema. So next time when getSchema is called on same instance of DelegatingConnection, it will return back the cachedSchema.&lt;/p&gt;

&lt;p&gt;I will run the test with CPU profiling enabled with callCounting to see how many times the actual implementation&#160;Jdbc41Bridge.getSchema is being called.&lt;/p&gt;

&lt;p&gt;BTW, i could not understand your point &quot;That, or, caching is enabled but still shows up in the measurements because of the way the application makes use of pools.&quot; We have simply configured BasicDatasource in our spring context xml file. Can you pl elaborate on this please.&lt;/p&gt;</comment>
                            <comment id="17379869" author="sjhala" created="Tue, 13 Jul 2021 12:55:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;as discussed above, i executed our tests and captured the your kit snapshot with call counting enabled and i noticed that it was indeed calling&#160;Jdbc41Bridge.getSchema which it should not. Then i captured the heapdump to see what value is set for&#160;cachedSchema&#160; and&#160;cacheState. And i noticed that the&#160;cacheState&#160; was set to true as expected however, i could not find the variable cachedSchema defined at all. Which was bit weird. After some further analysis i understood that the jar file i replaced is not being picked up at run time. So after make necessary change, i got the performance number which we had with DBCP version 1.4&lt;/p&gt;

&lt;p&gt;So we are good to close this issue with the code change you made in shared private jar file.&lt;/p&gt;

&lt;p&gt;Thanks for your quick turn around.&lt;/p&gt;</comment>
                            <comment id="17379872" author="sjhala" created="Tue, 13 Jul 2021 12:56:30 +0000"  >&lt;p&gt;Can you share tentative release date of DBCP 2.9.0? so that we can consume 2.9.0 along with your code change?&lt;/p&gt;</comment>
                            <comment id="17380043" author="garydgregory" created="Tue, 13 Jul 2021 16:57:31 +0000"  >&lt;p&gt;There is no fixed released date set yet, we are all volunteers here. My guess is within a month as I want to release a couple of other components before this one.&lt;/p&gt;</comment>
                            <comment id="17380052" author="sjhala" created="Tue, 13 Jul 2021 17:13:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;,&#160;I absolutely agree that you all are volunteers and we are really thankful for your contributions. My intention for asking the tentative release date was not to push for it but knowing it can help us to plan related things accordingly. Thank you!!&lt;/p&gt;</comment>
                            <comment id="17391062" author="garydgregory" created="Sat, 31 Jul 2021 21:57:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;FYI, a release candidate for 2.9.0 is up for review, please see the developer mailing list for details.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17391122" author="sjhala" created="Sun, 1 Aug 2021 09:36:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;Thanks for the info.&lt;/p&gt;</comment>
                            <comment id="17434564" author="garydgregory" created="Tue, 26 Oct 2021 20:57:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjhala&quot; class=&quot;user-hover&quot; rel=&quot;sjhala&quot;&gt;sjhala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We released 2.9.0 a while back. Do you have an update for us?&lt;/p&gt;</comment>
                            <comment id="17434665" author="sjhala" created="Wed, 27 Oct 2021 05:16:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;We consumed the latest release 2.9.0 and we observed the issue is resolved. Good to close the Jira. Thanks for the support!!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13027392" name="DBCP_v1.4.jpg" size="633217" author="sjhala" created="Tue, 29 Jun 2021 10:35:35 +0000"/>
                            <attachment id="13027393" name="DBCP_v2.8.0.jpg" size="662764" author="sjhala" created="Tue, 29 Jun 2021 10:37:06 +0000"/>
                            <attachment id="13030346" name="WithPrivateJarFrom2.9.0.jpg" size="375896" author="sjhala" created="Fri, 9 Jul 2021 11:20:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0seqw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-573] DataSource implementations do not implement Wrapper interface correctly</title>
                <link>https://issues.apache.org/jira/browse/DBCP-573</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Let&apos;s take &lt;tt&gt;BasicDataSource&lt;/tt&gt;&#160;as an example. Its code is currently:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isWrapperFor(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}

@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; T unwrap(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;T&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLException(&lt;span class=&quot;code-quote&quot;&gt;&quot;BasicDataSource is not a wrapper.&quot;&lt;/span&gt;);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This breaks consumers relying on Wrapper being correctly implemented.&lt;/p&gt;

&lt;p&gt;The DataSource should at least check if &lt;b&gt;this&lt;/b&gt; is an instance of iface and return it from &lt;tt&gt;unwrap&lt;/tt&gt;&#160;if it is.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13369032">DBCP-573</key>
            <summary>DataSource implementations do not implement Wrapper interface correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ralaoui">R&#233;da Housni Alaoui</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Apr 2021 07:00:07 +0000</created>
                <updated>Tue, 1 Jun 2021 09:22:24 +0000</updated>
                            <resolved>Mon, 31 May 2021 15:11:55 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.9.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17354505" author="garydgregory" created="Mon, 31 May 2021 15:11:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralaoui&quot; class=&quot;user-hover&quot; rel=&quot;ralaoui&quot;&gt;ralaoui&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please see git master and close if your use cases are covered.&lt;/p&gt;

&lt;p&gt;Merci!&lt;/p&gt;</comment>
                            <comment id="17354962" author="ralaoui" created="Tue, 1 Jun 2021 09:22:21 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;

&lt;p&gt;Thank you !&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pft4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-572] timed out connections remain active in the pool</title>
                <link>https://issues.apache.org/jira/browse/DBCP-572</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;when the database does not respond within a time-out period, the connection pool seems to still keep the connection in its pool and consider it active. These active connections are never closed and seems to be kept in the pool forever.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;create a BasicDataSource&lt;/li&gt;
	&lt;li&gt;suspend the database process using &lt;tt&gt;kill -STOP&lt;/tt&gt; signal&lt;/li&gt;
	&lt;li&gt;get a connection from multiple threads simultaneously which will timeout&lt;/li&gt;
	&lt;li&gt;inspect org.apache.commons.pool2.impl.GenericObjectPool.getNumActive()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The active count is equivalent to the number of timed out connections.&lt;/p&gt;

&lt;p&gt;The active count never goes down.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13361011">DBCP-572</key>
            <summary>timed out connections remain active in the pool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="erol.guven">Erol Guven</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Feb 2021 17:38:56 +0000</created>
                <updated>Fri, 20 Jan 2023 13:52:34 +0000</updated>
                            <resolved>Fri, 20 Jan 2023 13:52:34 +0000</resolved>
                                    <version>2.8.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17291653" author="garydgregory" created="Fri, 26 Feb 2021 13:46:45 +0000"  >&lt;p&gt;May you provide a unit test PR on GitHub on top of git master? Y&lt;/p&gt;

&lt;p&gt;You can look at the existing tests for inspiration.&lt;/p&gt;</comment>
                            <comment id="17291763" author="psteitz" created="Fri, 26 Feb 2021 16:55:44 +0000"  >&lt;p&gt;This is not a bug.&#160; By default, the pool does not try to keep connections alive while they are idle.&#160; If you want to do that, configure one or both of connection validation or testWhileIdle.&#160; This is really a question for the user list.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0o2hs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-571] Back to OSGi import of `javax.transaction.xa` package</title>
                <link>https://issues.apache.org/jira/browse/DBCP-571</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I&apos;d like to refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-445&quot; title=&quot;java.lang.NoClassDefFoundError: javax/transaction/SystemException after update&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-445&quot;&gt;&lt;del&gt;DBCP-445&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-454&quot; title=&quot;OSGi declarations contain multiple import headers for javax.transaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-454&quot;&gt;DBCP-454&lt;/a&gt; issues, which left commons-dbcp2 OSGi bundle with these headers:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Import-Package = 
...
	javax.transaction;version=1.1.0,
	javax.transaction.xa;mandatory:=partial;partial=true;version=1.1.0,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve described some findings in &lt;a href=&quot;https://github.com/ops4j/org.ops4j.pax.transx/issues/33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ops4j/org.ops4j.pax.transx/issues/33&lt;/a&gt; and I&apos;d like to know what&apos;s the rationale behind this &quot;partial&quot; attribute?&lt;/p&gt;

&lt;p&gt;First, &lt;tt&gt;javax.transaction.xa&lt;/tt&gt; package is &lt;em&gt;complete&lt;/em&gt; in both JDK 8 and 9+ (&lt;a href=&quot;https://openjdk.java.net/projects/jigsaw/spec/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JPMS&lt;/a&gt;) and it&apos;s not missing any class in JDK itself.&lt;br/&gt;
&lt;tt&gt;javax.transaction&lt;/tt&gt; on the other hand do miss important classes and if anything, this package should be &lt;em&gt;special&lt;/em&gt;, not &lt;tt&gt;javax.transaction.xa&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ll do some resolution test with Karaf and will add more comments later. But if you (DBCP2 devs) know more about the mentioned issues, I&apos;d be happy to learn more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13355994">DBCP-571</key>
            <summary>Back to OSGi import of `javax.transaction.xa` package</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ggrzybek">Grzegorz Grzybek</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Feb 2021 16:44:37 +0000</created>
                <updated>Mon, 3 Feb 2025 13:15:23 +0000</updated>
                                                                                <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17276917" author="gzres" created="Tue, 2 Feb 2021 07:56:40 +0000"  >&lt;p&gt;I&apos;ve reviewed the comments under &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-445&quot; title=&quot;java.lang.NoClassDefFoundError: javax/transaction/SystemException after update&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-445&quot;&gt;&lt;del&gt;DBCP-445&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-454&quot; title=&quot;OSGi declarations contain multiple import headers for javax.transaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-454&quot;&gt;DBCP-454&lt;/a&gt;, for example &lt;a href=&quot;http://apache-geronimo.328035.n3.nabble.com/Understanding-the-quot-partial-true-mandatory-partial-quot-trick-td396729.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this reference to Geronimo mailing list&lt;/a&gt;. There&apos;s a quote from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gawor%40mcs.anl.gov&quot; class=&quot;user-hover&quot; rel=&quot;gawor@mcs.anl.gov&quot;&gt;gawor@mcs.anl.gov&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In Geronimo we marked the javax.transaction.xa package with that&lt;br/&gt;
partial attribute because the JVM only provides a subset of the&lt;br/&gt;
classes in that package.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure which Geronimo version it is being referred to. 2.x is not an OSGi server and 3.0 is based on Karaf and uses &lt;tt&gt;geronimo-jta_1.1_spec-1.1.1.jar&lt;/tt&gt; and simply has:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Export-Package: javax.transaction.xa;version=&quot;1.1&quot;,\
  javax.transaction;uses:=&quot;javax.transaction.xa&quot;;version=&quot;1.1&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m afraid the &lt;tt&gt;mandatory:=partial;partial=true&lt;/tt&gt; used by DBCP2 is some legacy trick which no one remembers what it was used for. Same for Karaf exporting &lt;b&gt;both&lt;/b&gt; &lt;tt&gt;javax.transaction&lt;/tt&gt; and &lt;tt&gt;javax.transaction.xa&lt;/tt&gt; packages with this attribute.&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17571277" author="JIRAUSER290401" created="Tue, 26 Jul 2022 08:11:55 +0000"  >&lt;p&gt;It&apos;s now a year, that I tried to migrate from DBCP to DBCP2 in an osgi environment (Equinox). I started to rework this, and added dbcp2 2.9.0 and now again, my research brought me here. So it seems, that this problem is still not tackled. I&apos;m using Java 17 now, and can&apos;t find a way to get this running. So it seems that I again have to revert back to DBCP 1.4!&lt;/p&gt;

&lt;p&gt;I tried the geronimo package, and others, and can&apos;t get to fix this. Does anybody know if there is another way of fixing this for my setup?&lt;/p&gt;</comment>
                            <comment id="17571357" author="gzres" created="Tue, 26 Jul 2022 11:23:33 +0000"  >&lt;p&gt;Here are my findings and solutions we use in custom Karaf distribution. First, some facts:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;javax.transaction&lt;/tt&gt; package is not provided at all in JDK9+ because of the removal of CORBA&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;javax.transaction&lt;/tt&gt; package in JDK8 and earlier contains only 3 exception classes required to translate 3 Corba/OMG exception: org.omg.CORBA.TRANSACTION_REQUIRED, org.omg.CORBA.TRANSACTION_ROLLEDBACK, org.omg.CORBA.INVALID_TRANSACTION&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;javax.transaction.xa&lt;/tt&gt; package should always be provided by JDK itself (thus exported from system bundle and bootdelegated) because of &lt;tt&gt;javax.sql.XAConnection&lt;/tt&gt; interface relying on &lt;tt&gt;javax.transaction.xa.XAResource&lt;/tt&gt; interface&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Now an explanation of the &lt;tt&gt;partial&lt;/tt&gt; attribute. &lt;a href=&quot;https://docs.osgi.org/specification/osgi.core/7.0.0/framework.module.html#framework.module.requirebundle&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Chapter 3.13.1 of OSGi Core R7 specification&lt;/a&gt; mentions this &lt;em&gt;trick&lt;/em&gt; - bundles that export given package, but not all the classes &lt;b&gt;should&lt;/b&gt; export such &lt;em&gt;partial&lt;/em&gt; package with:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;some attribute (like &lt;tt&gt;partial=true&lt;/tt&gt;) - &lt;tt&gt;partial&lt;/tt&gt; is only a name and can be anything&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;mandatory&lt;/tt&gt; directive specifying the above attribute (like &lt;tt&gt;mandatory:=partial&lt;/tt&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is part of the solution. Full working system should contain another bundle that exports the same package, but with the remaining classes and &lt;b&gt;what&apos;s most important&lt;/b&gt; it should contain this header:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Require-Bundle: symbolic-name-of-bundle-with-partial-export
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This sounds easier when looking from importer perspective - a bundle importing, say, &lt;tt&gt;javax.transaction&lt;/tt&gt; package should NOT be wired to a bundle exporting this package with &lt;tt&gt;partial=true;mandatory:=partial&lt;/tt&gt; when using only &lt;tt&gt;Import-Package: javax.transaction&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;DBCP2 with &lt;tt&gt;Import-Package: javax.transaction.xa;partial=true;mandatory:=partial&lt;/tt&gt; has two errors in this import header:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;it explicitly states that it wants to be wired to a bundle exporting the package partially&lt;/li&gt;
	&lt;li&gt;it assumes that the partiality is about &lt;tt&gt;javax.transaction.xa&lt;/tt&gt; but it (if at all) should be related to &lt;tt&gt;javax.transaction&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://github.com/eclipse-ee4j/jta-api/issues/186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse-ee4j/jta-api/issues/186&lt;/a&gt; is an issue where I explain the same from the perspective of JTA API jar/bundle. This GH issue refers to ancient (2013) commit where &lt;tt&gt;Require-Bundle: system.bundle&lt;/tt&gt; was added on commit with &lt;tt&gt;fixes to manifest for osgi bundle&lt;/tt&gt; message - it doesn&apos;t explain the reasons and doesn&apos;t refer to any Jira/Bugzilla.&lt;/p&gt;

&lt;p&gt;In my custom Karaf distro, I&apos;ve changed &lt;tt&gt;org.osgi.framework.system.packages&lt;/tt&gt; property (in etc/jre.properties} to contain this on JD8:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; javax.transaction;partial=true;mandatory:=partial, \
 javax.transaction.xa;version=&quot;1.1&quot;;partial=true;mandatory:=partial, \
 javax.transaction.xa;version=&quot;1.1&quot;, \
 javax.transaction.xa;version=&quot;1.2&quot;, \
 javax.transaction.xa;version=&quot;1.3&quot;, \
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and this on JDK9+:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; javax.transaction.xa;version=&quot;1.1&quot;;partial=true;mandatory:=partial, \
 javax.transaction.xa;version=&quot;1.1&quot;, \
 javax.transaction.xa;version=&quot;1.2&quot;, \
 javax.transaction.xa;version=&quot;1.3&quot;, \
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;tricky, eh?&lt;/p&gt;

&lt;p&gt;The reasons are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;on JDK8, I&apos;ve use the 3.13.1 trick myself for &lt;tt&gt;javax.transaction&lt;/tt&gt; package to indicate that JDK itself doesn&apos;t export full package - effectively blocking it and forcing to install real JTA API bundle.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;javax.transaction.xa;version=&quot;1.1&quot;;partial=true;mandatory:=partial&lt;/tt&gt; is special export just for DBCP2 to work (and it works)&lt;/li&gt;
	&lt;li&gt;remaining 3 exports with 3 versions are indications that JDK itself exports full &lt;tt&gt;javax.transaction.xa&lt;/tt&gt; package in 3 version - in case someone builds a project using maven-bundle-plugin/bnd with 1.1, 1.2 or 1.3 versions of JTA API bundles - this package wasn&apos;t ever changed (from OSGi point of view) - versions 1.1, 1.2 and 1.3 are JavaEE versions, not OSGi versions, but they still sneak into the exports of JTA API bundles.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I hope my comment clears more confusion than it adds &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="17571360" author="JIRAUSER290401" created="Tue, 26 Jul 2022 11:31:29 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggrzybek&quot; class=&quot;user-hover&quot; rel=&quot;ggrzybek&quot;&gt;ggrzybek&lt;/a&gt; - it will take me some time to work through that.&lt;/p&gt;

&lt;p&gt;Currently I was thinking about simply copying the source project of dbcp2 and modifying the Import-Package as required. Maybe this approach would be easier, although I don&apos;t understand (until I worked through your comments) on wether this approach will be working out or not!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17571808" author="JIRAUSER290401" created="Wed, 27 Jul 2022 08:48:25 +0000"  >&lt;p&gt;My approach seemed to have worked out - at the moment all tests pass.&lt;/p&gt;

&lt;p&gt;Please see &lt;a href=&quot;https://github.com/elexis/elexis-target/tree/2022-06-java17/bundles/org.apache.commons.commons-dbcp2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/elexis/elexis-target/tree/2022-06-java17/bundles/org.apache.commons.commons-dbcp2&lt;/a&gt; and &lt;a href=&quot;https://github.com/elexis/elexis-target/tree/2022-06-java17/bundles/org.apache.geronimo.specs.geronimo-jta_1.1_spec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/elexis/elexis-target/tree/2022-06-java17/bundles/org.apache.geronimo.specs.geronimo-jta_1.1_spec&lt;/a&gt; for information on my &lt;em&gt;forks&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;I removed all traces of javax.transaction.xa now leaving this entirely up to the JRE to provide.&lt;/p&gt;</comment>
                            <comment id="17571810" author="gzres" created="Wed, 27 Jul 2022 08:50:29 +0000"  >&lt;p&gt;I&apos;m glad it worked &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17923203" author="JIRAUSER290401" created="Mon, 3 Feb 2025 07:56:13 +0000"  >&lt;p&gt;I&apos;m working with my modified copy of this for quite a while now, and yet this issue has not been integrated?!&lt;br/&gt;
If there are no plans on including this, I think it should be clearly spoken out, and the issue closed.&lt;/p&gt;

&lt;p&gt;I will update to 2.13 and add my manual patches again, but It would be great not to have to keep a modified copy of this!&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="17923285" author="garydgregory" created="Mon, 3 Feb 2025 13:15:23 +0000"  >&lt;p&gt;I&apos;d be happy to help integrate changes the community has validated... but:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Keep in mind that ideally, we&apos;d like not to have a custom configuration in each Commons component, and instead use commons-parent:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-parent/blob/e5f0953b2ddde530f1e763949c4d6b7778f05d2d/pom.xml#L959-L980&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-parent/blob/e5f0953b2ddde530f1e763949c4d6b7778f05d2d/pom.xml#L959-L980&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;This goal might not be possible for each component&lt;/li&gt;
	&lt;li&gt;Many components seem to override commons-parent to add version metadata to imports. Should all components specify versions in imports and if so, can commons-parent be made to do this?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Feel free to provide changes in PRs on GitHub:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/commons-parent/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-parent/&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/commons-dbcp/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/&lt;/a&gt;&lt;br/&gt;
&#160;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13358109">KARAF-7032</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13304047">KARAF-6715</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            37 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n874:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-570] Oracle transaction issue</title>
                <link>https://issues.apache.org/jira/browse/DBCP-570</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;A failure can be seen when using two connections from different DBCP pools to access Oracle in a single transaction. The pools must access the same database server/SID but the users must be different. In such cases, Oracle has issues that result in a failure at the point of connection enlistment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 ... WARN [main] sun.reflect.NativeMethodAccessorImpl.invoke0 ARJUNA016089: TransactionImple.enlistResource - xa_start - caught: XAException.XAER_RMERR &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &amp;lt; formatId=131077, gtrid_length=29, bqual_length=36, tx_uid=0:ffff0a000264:a0d3:5fdbca1d:a, node_name=1, branch_uid=0:ffff0a000264:a0d3:5fdbca1d:c, subordinatenodename=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, eis_name=0 &amp;gt;
 oracle.jdbc.xa.OracleXAException: XAErr (-3): A resource manager error has occured in the transaction branch. ORA-24774 SQLErr (0)
 at oracle.jdbc.xa.OracleXAResource.checkError(OracleXAResource.java:1092)
 at oracle.jdbc.xa.client.OracleXAResource.start(OracleXAResource.java:272)
 at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.enlistResource(TransactionImple.java:741)
 at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.enlistResource(TransactionImple.java:423)
 at org.apache.tomcat.dbcp.dbcp2.managed.TransactionContext.setSharedConnection(TransactionContext.java:109)
 at org.apache.tomcat.dbcp.dbcp2.managed.ManagedConnection.updateTransactionStatus(ManagedConnection.java:157)
 at org.apache.tomcat.dbcp.dbcp2.managed.ManagedConnection.&amp;lt;init&amp;gt;(ManagedConnection.java:75)
 at org.apache.tomcat.dbcp.dbcp2.managed.ManagedDataSource.getConnection(ManagedDataSource.java:80)
 at org.apache.tomcat.dbcp.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:1563)
 at support.jboss.web.TransactionTest.executeSQL(TransactionTest.java:84)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;We also verified that the explanation/presumed cause is correct by using a Byteman based workaround (which is probably &lt;b&gt;too&lt;/b&gt; aggressive for some cases but does work around the problem scenario) that simulates what is done by IronJacamar and what is suggested/discussed in &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - i.e. force the OracleXAResource &quot;true&quot; return for isSameRM to be &quot;false&quot; (instead) via a proxy for the OracleXAResource implementation.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RULE oracle.jdbc.xa.OracleXAResource.isSameRM.FALSE
CLASS oracle.jdbc.xa.OracleXAResource
METHOD isSameRM
AT ENTRY
IF &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
DO &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;[BMAN] Overriding Oracle isSameRM ...&quot;&lt;/span&gt;);
 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
ENDRULE&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is it possible for DBCP to better handle this Oracle specific scenario?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.tomee-openejb.979440.n4.nabble.com/Oracle-XA-with-different-credentials-fails-td4680456.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.tomee-openejb.979440.n4.nabble.com/Oracle-XA-with-different-credentials-fails-td4680456.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://community.oracle.com/tech/developers/discussion/1058320/ora-24774-why-does-xa-start-fails-for-2-txn-branches-on-same-instance&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://community.oracle.com/tech/developers/discussion/1058320/ora-24774-why-does-xa-start-fails-for-2-txn-branches-on-same-instance&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13354721">DBCP-570</key>
            <summary>Oracle transaction issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aogburn">Aaron Ogburn</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jan 2021 17:08:58 +0000</created>
                <updated>Fri, 20 Jan 2023 13:56:12 +0000</updated>
                            <resolved>Fri, 20 Jan 2023 13:56:12 +0000</resolved>
                                    <version>2.8.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17272944" author="garydgregory" created="Wed, 27 Jan 2021 15:43:30 +0000"  >&lt;p&gt;So, a 10 year old bug in the Oracle driver? Yikes. What version of the driver are you using? Which Maven coordinates? Can I assume you tried the latest driver?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If the latest driver still has the bug, then you are looking for a workaround in DBCP, right? At which point I think this will take time to figure out unless you can hasten things by providing a PR on GitHub with at least a way to reproduce the bug from scratch. I can access some Oracle server but I&apos;d need a test I can configure with a connection string that can set itself up.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;</comment>
                            <comment id="17279215" author="satche" created="Thu, 4 Feb 2021 22:42:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;, Sorry for the delay. I&apos;ve attached a maven-based test (using the latest available Oracle driver published to Maven) that demonstrates what we&apos;ve encountered. There&apos;s a &lt;tt&gt;README.md&lt;/tt&gt; but running the test should be as simple as supplying an Oracle URL and two user/password pairs in the &lt;tt&gt;pom.xml&lt;/tt&gt; and &lt;tt&gt;mvn clean test&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17300285" author="gzres" created="Fri, 12 Mar 2021 12:40:20 +0000"  >&lt;p&gt;I&apos;ve just reproduced the problem with podman-based Oracle DB and driver from &lt;a href=&quot;https://repo1.maven.org/maven2/com/oracle/database/jdbc/ojdbc8/21.1.0.0/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repo1.maven.org/maven2/com/oracle/database/jdbc/ojdbc8/21.1.0.0/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13:37:21 WARN [arjunacore.TransactionImple] (TransactionImple.java:766) : ARJUNA016138: Failed to enlist XA resource oracle.jdbc.driver.T4CXAResource@dbd8e44
oracle.jdbc.xa.OracleXAException: XAErr (-3): A resource manager error has occured in the transaction branch. ORA-24774 SQLErr (0)
	at oracle.jdbc.xa.OracleXAResource.convertError(OracleXAResource.java:1142) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.xa.client.OracleXAResource.start(OracleXAResource.java:253) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.enlistResource(TransactionImple.java:740) [jta-5.10.6.Final.jar:5.10.6.Final]
	at com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionImple.enlistResource(TransactionImple.java:422) [jta-5.10.6.Final.jar:5.10.6.Final]
	at org.ops4j.pax.jdbc.pool.dbcp2.impl.PooledDataSourceXATest.jtaTest(PooledDataSourceXATest.java:187) [test-classes/:?]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_281]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_281]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_281]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_281]
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59) [junit-4.13.1.jar:4.13.1]
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56) [junit-4.13.1.jar:4.13.1]
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) [junit-4.13.1.jar:4.13.1]
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) [junit-4.13.1.jar:4.13.1]
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:54) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306) [junit-4.13.1.jar:4.13.1]
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413) [junit-4.13.1.jar:4.13.1]
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137) [junit-4.13.1.jar:4.13.1]
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69) [junit-rt.jar:?]
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33) [junit-rt.jar:?]
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:221) [junit-rt.jar:?]
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54) [junit-rt.jar:?]
Caused by: java.sql.SQLException: ORA-24774: cannot switch to specified transaction

	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:628) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:557) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.driver.T4CTTIoer11.processError(T4CTTIoer11.java:552) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.driver.T4CTTIfun.processError(T4CTTIfun.java:1312) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:726) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:291) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.driver.T4CTTIOtxse.doOTXSE(T4CTTIOtxse.java:175) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.driver.T4CXAResource.doStart(T4CXAResource.java:217) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	at oracle.jdbc.xa.client.OracleXAResource.start(OracleXAResource.java:248) ~[ojdbc8-21.1.0.0.jar:21.1.0.0.0]
	... 30 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17300303" author="gzres" created="Fri, 12 Mar 2021 13:13:41 +0000"  >&lt;p&gt;I&apos;ve pushed a test that reproduced the problem and provides a silly fix to this problem. See &lt;a href=&quot;https://github.com/ops4j/org.ops4j.pax.jdbc/commit/26a3e1f9ad515ab3383bf665c831161425be55a6#diff-0f93b59dd6a5b34adcf0f068afb75d5b24fb2277e8b3b354b64080ebd9e80674R174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the unit test for podman-based Oracle database here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When using:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;jdbc:oracle:thin:@localhost:1521:xe + user1/password1&lt;/li&gt;
	&lt;li&gt;jdbc:oracle:thin:@localhost:1521:xe + user2/password2&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I had the &lt;tt&gt;ORA-24774: cannot switch to specified transaction&lt;/tt&gt; problem, but changing the URIs to (note that URI doesn&apos;t contain the password, it is provided as before):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;jdbc:oracle:thin:user1/@localhost:1521:xe&lt;/li&gt;
	&lt;li&gt;jdbc:oracle:thin:user2/@localhost:1521:xe&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;the test passes and:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
assertFalse(xaResource1.isSameRM(xaResource2));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;doesn&apos;t fail.&lt;/p&gt;</comment>
                            <comment id="17434566" author="garydgregory" created="Tue, 26 Oct 2021 21:01:42 +0000"  >&lt;p&gt;Can we close this ticket or is there a PR being considered? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aogburn&quot; class=&quot;user-hover&quot; rel=&quot;aogburn&quot;&gt;aogburn&lt;/a&gt;? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=satche&quot; class=&quot;user-hover&quot; rel=&quot;satche&quot;&gt;satche&lt;/a&gt;? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggrzybek&quot; class=&quot;user-hover&quot; rel=&quot;ggrzybek&quot;&gt;ggrzybek&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17434658" author="gzres" created="Wed, 27 Oct 2021 04:43:24 +0000"  >&lt;p&gt;From my point of view, it&apos;s a &lt;em&gt;won&apos;t fix&lt;/em&gt; issue, as there&apos;s a workaround. And there&apos;s nothing actually that can be done on DBCP side.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13020044" name="test.zip" size="5543" author="satche" created="Thu, 4 Feb 2021 22:38:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n0cw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-569] Fix test random failure on TestSynchronizationOrder.testInterposedSynchronization</title>
                <link>https://issues.apache.org/jira/browse/DBCP-569</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;&lt;tt&gt;TestSynchronizationOrder.testInterposedSynchronization&lt;/tt&gt; may fail randomly depending on GC behavior, because the test involves a &lt;tt&gt;Transaction&lt;/tt&gt; object held only be weak references, which may be cleared earlier that the test expects:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.sql.SQLException: Unable to enlist connection because the transaction has been garbage collected
	at org.apache.commons.dbcp2.managed.TransactionContext.getTransaction(TransactionContext.java:186)
	at org.apache.commons.dbcp2.managed.TransactionContext.setSharedConnection(TransactionContext.java:105)
	at org.apache.commons.dbcp2.managed.ManagedConnection.updateTransactionStatus(ManagedConnection.java:310)
	at org.apache.commons.dbcp2.managed.ManagedConnection.&amp;lt;init&amp;gt;(ManagedConnection.java:89)
	at org.apache.commons.dbcp2.managed.ManagedDataSource.getConnection(ManagedDataSource.java:64)
	at org.apache.commons.dbcp2.managed.TestSynchronizationOrder.testInterposedSynchronization(TestSynchronizationOrder.java:118)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The &lt;tt&gt;TransactionContext.transactionRef&lt;/tt&gt; and the &lt;tt&gt;TransactionRegistry.caches&lt;/tt&gt; are holding onto the &lt;tt&gt;Transaction&lt;/tt&gt; (acquired in &lt;tt&gt;TransactionRegistry.getActiveTransactionContext()&lt;/tt&gt;) only using weak refs.&lt;/p&gt;

&lt;p&gt;However in &lt;tt&gt;TestSynchronizationOrder&lt;/tt&gt; the fake &lt;tt&gt;TransactionManager&lt;/tt&gt; returns a &lt;tt&gt;Transaction&lt;/tt&gt; (that&apos;s an instance of an anonymous class) but nobody holds a strong reference to that. The fake &lt;tt&gt;TransactionManager&lt;/tt&gt; should create the fake &lt;tt&gt;Transaction&lt;/tt&gt; at &lt;tt&gt;begin()&lt;/tt&gt; time, and hold onto it using a strong reference until &lt;tt&gt;commit()&lt;/tt&gt; time.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13348842">DBCP-569</key>
            <summary>Fix test random failure on TestSynchronizationOrder.testInterposedSynchronization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fguillaume">Florent Guillaume</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jan 2021 00:44:29 +0000</created>
                <updated>Wed, 13 Jan 2021 17:45:31 +0000</updated>
                            <resolved>Wed, 13 Jan 2021 17:29:19 +0000</resolved>
                                                    <fixVersion>2.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17264293" author="garydgregory" created="Wed, 13 Jan 2021 17:29:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fguillaume&quot; class=&quot;user-hover&quot; rel=&quot;fguillaume&quot;&gt;fguillaume&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In git master, please verify and close this ticket.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0lzww:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-568] ManagedConnection must clear its cached state after transaction completes</title>
                <link>https://issues.apache.org/jira/browse/DBCP-568</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;There&apos;s a spurious log (see log in comment) about failure to rollback a connection in the following context:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;use of a managed connection&lt;/li&gt;
	&lt;li&gt;cacheState=true (the default)&lt;/li&gt;
	&lt;li&gt;rollback initiated by the transaction manager&lt;/li&gt;
	&lt;li&gt;rollbackOnReturn=true (the default)&lt;/li&gt;
	&lt;li&gt;JDBC driver that refuses to rollback when autoCommit=true (like the PostgreSQL driver)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The sequence of events leading to the error is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;transaction started&lt;/li&gt;
	&lt;li&gt;application acquires managed connection from pool (wrapping the low-level PgConnection)
	&lt;ul&gt;
		&lt;li&gt;connection enlisted in transaction&lt;/li&gt;
		&lt;li&gt;LocalXAConnectionFactory.LocalXAResource.start sets low-level connection autoCommit=false&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;application does some work&lt;/li&gt;
	&lt;li&gt;application check connection&apos;s autoCommit state for various reasons
	&lt;ul&gt;
		&lt;li&gt;calls DelegatingConnection.getAutoCommit which caches the state (false)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;application does more work and signals the transaction manager to rollback&lt;/li&gt;
	&lt;li&gt;transaction manager rolls back
	&lt;ul&gt;
		&lt;li&gt;all enlisted resources roll back
		&lt;ul&gt;
			&lt;li&gt;LocalXAConnectionFactory.LocalXAResource.rollback rolls back and sets low-level autoCommit=true&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;managed connection is closed
	&lt;ul&gt;
		&lt;li&gt;PoolableConnection.close calls PoolableConnectionFactory.passivateObject&lt;/li&gt;
		&lt;li&gt;passivation does rollback-on-return which checks for connection autoCommit before doing rollback
		&lt;ul&gt;
			&lt;li&gt;the autoCommit status returned is the one cached in DelegatingConnection so still false&lt;/li&gt;
			&lt;li&gt;rollback is called on low-level connection, which throws because it&apos;s still in state autoCommit=true&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There are several workarounds:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;use cacheState=false in the datasource config&lt;/li&gt;
	&lt;li&gt;use rollbackOnReturn=false in the datasource config&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But the correct fix is to make the DelegatingConnection aware that during rollback something was changed at low-level and its cache is invalid. This can be done by making ManagedConnection.transactionComplete (which is called in afterCompletion) clear the cached state.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13340718">DBCP-568</key>
            <summary>ManagedConnection must clear its cached state after transaction completes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fguillaume">Florent Guillaume</reporter>
                        <labels>
                    </labels>
                <created>Sun, 15 Nov 2020 18:38:06 +0000</created>
                <updated>Wed, 13 Jan 2021 19:50:12 +0000</updated>
                            <resolved>Wed, 13 Jan 2021 19:37:38 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17232375" author="fguillaume" created="Sun, 15 Nov 2020 18:45:05 +0000"  >
&lt;p&gt;Example stacktrace logged&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-11-15 16:16:10,455 [mythread] WARN  [SwallowedExceptionLogger] An internal object pool swallowed an Exception.
org.postgresql.util.PSQLException: Cannot rollback when autoCommit is enabled.
	at org.postgresql.jdbc.PgConnection.rollback(PgConnection.java:895) ~[postgresql-42.2.18.jar:42.2.18]
	at org.apache.commons.dbcp2.DelegatingConnection.rollback(DelegatingConnection.java:482) ~[commons-dbcp2-2.8.0.jar:2.8.0]
	at org.apache.commons.dbcp2.PoolableConnectionFactory.passivateObject(PoolableConnectionFactory.java:427) ~[commons-dbcp2-2.8.0.jar:2.8.0]
	at org.apache.commons.pool2.impl.GenericObjectPool.returnObject(GenericObjectPool.java:557) ~[commons-pool2-2.9.0.jar:2.9.0]
	at org.apache.commons.dbcp2.PoolableConnection.close(PoolableConnection.java:203) ~[commons-dbcp2-2.8.0.jar:2.8.0]
	at org.apache.commons.dbcp2.DelegatingConnection.closeInternal(DelegatingConnection.java:236) ~[commons-dbcp2-2.8.0.jar:2.8.0]
	at org.apache.commons.dbcp2.DelegatingConnection.close(DelegatingConnection.java:207) ~[commons-dbcp2-2.8.0.jar:2.8.0]
	at org.apache.commons.dbcp2.managed.ManagedConnection.close(ManagedConnection.java:111) ~[commons-dbcp2-2.8.0.jar:2.8.0]
	at com.example.MyApp.closeConnection(MyApp.java:42)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17264381" author="garydgregory" created="Wed, 13 Jan 2021 19:33:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fguillaume&quot; class=&quot;user-hover&quot; rel=&quot;fguillaume&quot;&gt;fguillaume&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for the detailed write up. Your explanation makes the PR much easier to understand.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17264382" author="garydgregory" created="Wed, 13 Jan 2021 19:37:38 +0000"  >&lt;p&gt;In git master. Please verify and close this ticket.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0klug:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-565] application stuck with normal load</title>
                <link>https://issues.apache.org/jira/browse/DBCP-565</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;one application in cluster(8) stuck&#160;&lt;/p&gt;

&lt;p&gt;commons-dbcp 1.4&#160; &#160;commons-pool 1.5.4&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;the connection to mysql-server&#160; slow continuous grows &#65292;about 30 minutes later&#65292;the application stuck &#12290;&lt;/p&gt;

&lt;p&gt;I check the&#160; mysql-server log&#65292;find&#160; &#160;some transaction not commit&#12290;the execution log like this&#65306;&lt;/p&gt;

&lt;p&gt;set autocommit = 0 ;&lt;/p&gt;

&lt;p&gt;update xxxxx;&lt;/p&gt;

&lt;p&gt;logout&#160; ( FAIL ) for 30 minutes&#160; (finally restart the application)&#12290;&lt;/p&gt;

&lt;p&gt;Emegencying to handle the&#160; production&#160; fault&#65292;no stacktrace keeps&#12290;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13307760">DBCP-565</key>
            <summary>application stuck with normal load</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hzq">zhiqian huang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 May 2020 14:29:28 +0000</created>
                <updated>Thu, 28 May 2020 01:52:54 +0000</updated>
                            <resolved>Thu, 28 May 2020 01:52:54 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17117814" author="garydgregory" created="Wed, 27 May 2020 14:31:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hzq&quot; class=&quot;user-hover&quot; rel=&quot;hzq&quot;&gt;hzq&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unless you can provide a reproducible test case, then this kind of ticket without even a description is useless and will be deleted.&lt;/p&gt;

&lt;p&gt;Tests as patches on GitHub are best, using a local database like H2 is best as well.&lt;/p&gt;</comment>
                            <comment id="17117858" author="garydgregory" created="Wed, 27 May 2020 15:38:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hzq&quot; class=&quot;user-hover&quot; rel=&quot;hzq&quot;&gt;hzq&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for adding a description to this ticket. Version 1.x is no longer maintained (at least not by me), please update to 2.x and let us know if this still happens.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f80g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-564] BasicManagedDataSource leaks connections opened after transaction is rollback-only</title>
                <link>https://issues.apache.org/jira/browse/DBCP-564</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In the following situation a connection will be leaked and never returned to the pool:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;a &lt;tt&gt;BasicManagedDataSource&lt;/tt&gt;&#160;is instantiated for a non-XA driver class name (but with a&#160;TransactionManager and a&#160;TransactionSynchronizationRegistry),&lt;/li&gt;
	&lt;li&gt;a transaction is started then switched to rollback-only,&lt;/li&gt;
	&lt;li&gt;a connection is acquired from the datasource,&lt;/li&gt;
	&lt;li&gt;the connection is closed,&lt;/li&gt;
	&lt;li&gt;the transaction is rolled back.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The leak happens because, even though there is code in &lt;tt&gt;TransactionContext.addTransactionContextListener&lt;/tt&gt; to properly use the &lt;tt&gt;transactionSynchronizationRegistry&lt;/tt&gt; to register the suitable &lt;tt&gt;Synchronization&lt;/tt&gt; to do cleanup in &lt;tt&gt;afterCompletion&lt;/tt&gt;, the &lt;tt&gt;transactionSynchronizationRegistry&lt;/tt&gt; is actually &lt;tt&gt;null&lt;/tt&gt; because of the way the &lt;tt&gt;LocalXAConnectionFactory&lt;/tt&gt; was created in &lt;tt&gt;BasicManagedDataSource.createConnectionFactory&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;PR:&#160;&lt;a href=&quot;https://github.com/apache/commons-dbcp/pull/39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/pull/39&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13304739">DBCP-564</key>
            <summary>BasicManagedDataSource leaks connections opened after transaction is rollback-only</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fguillaume">Florent Guillaume</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 May 2020 17:59:27 +0000</created>
                <updated>Thu, 14 May 2020 16:27:47 +0000</updated>
                            <resolved>Thu, 14 May 2020 14:29:03 +0000</resolved>
                                    <version>2.7.0</version>
                                    <fixVersion>2.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="17107357" author="garydgregory" created="Thu, 14 May 2020 14:29:03 +0000"  >&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0epdc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-563] query return previous result when previous request cause MySQLTimeoutException by one connection</title>
                <link>https://issues.apache.org/jira/browse/DBCP-563</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;when run JdbcLocalDemo, you can get wrong result&#12290;query a record&#65292;then return b record&#12290;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.BasicDataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.BasicDataSourceFactory;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Connection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.PreparedStatement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.ResultSet;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.SQLException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.ExecutorService;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.Executors;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.ThreadLocalRandom;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.TimeUnit;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.atomic.AtomicInteger;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.sql.ResultSet.CLOSE_CURSORS_AT_COMMIT;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.sql.ResultSet.CONCUR_READ_ONLY;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.sql.ResultSet.TYPE_FORWARD_ONLY;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JdbcLocalDemo {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AtomicInteger count = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger(0);

    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BasicDataSource basicDataSource = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            basicDataSource = BasicDataSourceFactory.createDataSource(PropertiesUtils.loadFromClassPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;application-local.properties&quot;&lt;/span&gt;));
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            e.printStackTrace();
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        SqlRunnable r1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SqlRunnable(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;);
        SqlRunnable r2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SqlRunnable(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;);

        ExecutorService executorService = Executors.newFixedThreadPool(5);

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 1; i &amp;lt;= 2000; ++i) {
            executorService.submit(r1);
            executorService.submit(r2);
        }

        executorService.shutdown();

        executorService.awaitTermination(1, TimeUnit.MINUTES);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SqlRunnable &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value;

        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; SqlRunnable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.value = value;
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
            PreparedStatement preparedStatement = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            ResultSet resultSet = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            Connection connection = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(count.incrementAndGet());
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                connection = basicDataSource.getConnection();
                preparedStatement = connection.prepareStatement(&lt;span class=&quot;code-quote&quot;&gt;&quot;select \&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot; + value + &quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot; as v, sleep(?);&quot;&lt;/span&gt;, TYPE_FORWARD_ONLY, CONCUR_READ_ONLY, CLOSE_CURSORS_AT_COMMIT);
                preparedStatement.setQueryTimeout(1);
                preparedStatement.setFetchSize(0);
                preparedStatement.setMaxRows(0);
&lt;span class=&quot;code-comment&quot;&gt;//                preparedStatement.setString(1, value);
&lt;/span&gt;                preparedStatement.setDouble(1,ThreadLocalRandom.current().nextInt(2000) / 1000.0);
                resultSet = preparedStatement.executeQuery();

                &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (resultSet.next()) {
                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; v = resultSet.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;v&quot;&lt;/span&gt;);

                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!value.equals(v)) {
                        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;wrong result !=!=!=!=!=!=!=!=!=!=!=!=!=!=!=!=!=!=!=!=!=: &quot;&lt;/span&gt; + value);
                        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(-1);
                    }
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
                e.printStackTrace();
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (resultSet != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                        resultSet.close();
                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
                        e.printStackTrace();
                    }
                }
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (preparedStatement != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                        preparedStatement.close();
                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
                        e.printStackTrace();
                    }
                }
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connection != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                        connection.close();
                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
                        e.printStackTrace();
                    }
                }
            }
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// application-local.properties
&lt;/span&gt;defaultQueryTimeout=1000
driverClassName=com.mysql.jdbc.Driver
maxTotal=10
maxIdle=10
minIdle=5
initialSize=5
testOnBorrow=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
username=root
password=12345678
url=jdbc:mysql:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:3306/db_paymra_router?characterEncoding=UTF8&amp;amp;socketTimeout=1005&amp;amp;allowMulti&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13303539">DBCP-563</key>
            <summary>query return previous result when previous request cause MySQLTimeoutException by one connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jodechenwen">jode</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 May 2020 04:35:21 +0000</created>
                <updated>Thu, 30 Jul 2020 00:12:27 +0000</updated>
                            <resolved>Thu, 30 Jul 2020 00:12:27 +0000</resolved>
                                    <version>2.1.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17167569" author="psteitz" created="Thu, 30 Jul 2020 00:12:27 +0000"  >&lt;p&gt;This is a driver bug.&#160; I can reproduce using&#160;mysql-connector-java-5.x but not with&#160;mysql-connector-java-8.&#160; DBCP can&apos;t change connections under the handles held by clients and even that would not explain the result.&#160; See&#160;&lt;a href=&quot;https://bugs.mysql.com/bug.php?id=99495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.mysql.com/bug.php?id=99495&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 13 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ehzc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-562] Password should not be exposed via JMXBean</title>
                <link>https://issues.apache.org/jira/browse/DBCP-562</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;if a BasicDataSource is created with jmxName set, password property is exposed/exported via jmx and is visible for everybody who is connected to jmx port.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Expectation : Do not export it via&#160;BasicDataSourceMXBean Interface&lt;/p&gt;</description>
                <environment></environment>
        <key id="13289638">DBCP-562</key>
            <summary>Password should not be exposed via JMXBean</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="fgdrf">Frank Gasdorf</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Wed, 4 Mar 2020 21:18:29 +0000</created>
                <updated>Tue, 1 Jun 2021 08:20:00 +0000</updated>
                            <resolved>Mon, 31 May 2021 14:41:33 +0000</resolved>
                                    <version>2.5.0</version>
                    <version>2.7.0</version>
                                    <fixVersion>2.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7200">2h</timespent>
                                <comments>
                            <comment id="17051656" author="garydgregory" created="Wed, 4 Mar 2020 22:02:28 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fgdrf&quot; class=&quot;user-hover&quot; rel=&quot;fgdrf&quot;&gt;fgdrf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Feel-free to provide a patch on GitHub (which does not break binary compatibility.)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17051906" author="markt" created="Thu, 5 Mar 2020 08:47:17 +0000"  >&lt;p&gt;See prior discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-448&quot; title=&quot;Disable password exposure via JMX.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-448&quot;&gt;&lt;del&gt;DBCP-448&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17052020" author="fgdrf" created="Thu, 5 Mar 2020 11:08:58 +0000"  >&lt;p&gt;Read this discussion and I guess the Wrapper-Approach for JMX Beans might also work. Since (as stated in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-448&quot; title=&quot;Disable password exposure via JMX.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-448&quot;&gt;&lt;del&gt;DBCP-448&lt;/del&gt;&lt;/a&gt;) its a read-only interface the Wrapper might delegate everything except password.&#160;&lt;tt&gt;getPassword()&lt;/tt&gt; could be overwritten and return always &quot;****&quot; in this case (only for registered MBean)&lt;/p&gt;

&lt;p&gt;I&apos;ll try this and refactor the pull request&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17354486" author="garydgregory" created="Mon, 31 May 2021 14:41:33 +0000"  >&lt;p&gt;Please see git git master and close this PR if all is well for your use case.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17354928" author="fgdrf" created="Tue, 1 Jun 2021 08:20:00 +0000"  >&lt;p&gt;For documentation: To export JMX bean the code has been refactored, it uses&#160;StandardMBean and a different Interface that has no getter for password.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12896224">DBCP-448</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0c6ao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-561] NullPointerException occurs</title>
                <link>https://issues.apache.org/jira/browse/DBCP-561</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The following error sometimes occurs with the attached program.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;java.lang.NullPointerExceptionjava.lang.NullPointerException&lt;br/&gt;
at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.prepareStatement(PooledConnectionImpl.java:243)&lt;br/&gt;
at org.apache.commons.dbcp.cpdsadapter.ConnectionImpl.prepareStatement(ConnectionImpl.java:95) at PoolingThread2.selectSysdate(PoolingTest2.java:173)&lt;br/&gt;
at PoolingThread2.run(PoolingTest2.java:147)&lt;/li&gt;
	&lt;li&gt;java.sql.SQLRecoverableException: &#12463;&#12525;&#12540;&#12474;&#12373;&#12428;&#12383;&#25509;&#32154;&#12391;&#12377;&#12290;&lt;br/&gt;
at oracle.jdbc.driver.PhysicalConnection.prepareStatementInternal(PhysicalConnection.java:1994)&lt;br/&gt;
at oracle.jdbc.driver.PhysicalConnection.prepareStatement(PhysicalConnection.java:1960)&lt;br/&gt;
 at oracle.jdbc.driver.PhysicalConnection.prepareStatement(PhysicalConnection.java:1866)&lt;br/&gt;
 at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.prepareStatement(PooledConnectionImpl.java:243) &lt;br/&gt;
at org.apache.commons.dbcp.cpdsadapter.ConnectionImpl.prepareStatement(ConnectionImpl.java:95) &lt;br/&gt;
at PoolingThread2.selectSysdate(PoolingTest2.java:173) &lt;br/&gt;
at PoolingThread2.run(PoolingTest2.java:147)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Does not occur with dbcp 1.2.2, but occurs with dbcp 1.4.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13284188">DBCP-561</key>
            <summary>NullPointerException occurs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hayashiy">Yasufumi Hayashi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Feb 2020 04:10:05 +0000</created>
                <updated>Mon, 30 Jan 2023 23:41:34 +0000</updated>
                            <resolved>Mon, 30 Jan 2023 23:41:34 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17035862" author="garydgregory" created="Thu, 13 Feb 2020 02:34:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hayashiy&quot; class=&quot;user-hover&quot; rel=&quot;hayashiy&quot;&gt;hayashiy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please update to the current version 2.7.0; 1.x line is very old and quite unlikely to have a new release.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17434567" author="garydgregory" created="Tue, 26 Oct 2021 21:02:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hayashiy&quot; class=&quot;user-hover&quot; rel=&quot;hayashiy&quot;&gt;hayashiy&lt;/a&gt;&#160;Ping, we released 2.9.0 a while back.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12992999" name="PoolingTest2.java" size="4625" author="hayashiy" created="Mon, 10 Feb 2020 04:09:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bazk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-558] DelegatingConnection setReadOnly and setAutoCommit sometimes caches the wrong value</title>
                <link>https://issues.apache.org/jira/browse/DBCP-558</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;DelegatingConnection caches the input of setReadOnly and setAutoCommit directly without checking if the underlying connection succeeded in setting the configuration parameter. This results in wrong return value from isReadOnly and getAutoCommit if the underlying connection doesn&apos;t support read-only/non-read-only or auto-commit/non-auto-commit connections, as with SqlServerConnection.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;To reproduce the issue:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a DelegatingConnection with an underlying SqlServerConnection&lt;/li&gt;
	&lt;li&gt;Set the connection read-only `con.setReadOnly(true)`&lt;/li&gt;
	&lt;li&gt;Query the read-only state on the DelegatingConnection, you will get true&lt;/li&gt;
	&lt;li&gt;Query the read-only state of the underlying SqlServerConnection, you will get false (SqlServer JDBC driver doesn&apos;t support read-only connections)&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13268088">DBCP-558</key>
            <summary>DelegatingConnection setReadOnly and setAutoCommit sometimes caches the wrong value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="louislatreille">Louis Latreille</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Nov 2019 17:02:21 +0000</created>
                <updated>Wed, 7 Jul 2021 15:00:38 +0000</updated>
                            <resolved>Wed, 7 Jul 2021 15:00:38 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17376622" author="garydgregory" created="Wed, 7 Jul 2021 15:00:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/garydgregory&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;garydgregory&lt;/a&gt;&#160;merged commit&#160;&lt;a href=&quot;https://github.com/apache/commons-dbcp/commit/79422dc193221b745617984d30c321436c2a849c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;79422dc&lt;/tt&gt;&lt;/a&gt;&#160;into&#160;apache:master&#160;&lt;a href=&quot;https://github.com/apache/commons-dbcp/pull/35#event-3640210267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on Aug 10, 2020&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08ko0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-555] NPE when creating a SQLExceptionList with a null list.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-555</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;NPE when creating a SQLExceptionList with a null list.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13249567">DBCP-555</key>
            <summary>NPE when creating a SQLExceptionList with a null list.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Aug 2019 04:41:10 +0000</created>
                <updated>Thu, 8 Aug 2019 04:47:43 +0000</updated>
                            <resolved>Thu, 8 Aug 2019 04:47:43 +0000</resolved>
                                    <version>2.7.0</version>
                                    <fixVersion>2.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16902676" author="garydgregory" created="Thu, 8 Aug 2019 04:47:43 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05g9k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-554] org.apache.commons.dbcp2.PoolableCallableStatement.passivate() should close ALL of its resources even when an exception occurs.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-554</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;org.apache.commons.dbcp2.PoolableCallableStatement.passivate() should close ALL of its resources even when an exception occurs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13247970">DBCP-554</key>
            <summary>org.apache.commons.dbcp2.PoolableCallableStatement.passivate() should close ALL of its resources even when an exception occurs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jul 2019 23:29:48 +0000</created>
                <updated>Thu, 1 Aug 2019 21:56:33 +0000</updated>
                            <resolved>Thu, 1 Aug 2019 21:56:33 +0000</resolved>
                                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16898390" author="garydgregory" created="Thu, 1 Aug 2019 21:56:33 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z056f4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-553] org.apache.commons.dbcp2.PoolablePreparedStatement.passivate() should close ALL of its resources even when an exception occurs</title>
                <link>https://issues.apache.org/jira/browse/DBCP-553</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;org.apache.commons.dbcp2.PoolablePreparedStatement.passivate() should close ALL of its resources even when an exception occurs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13247957">DBCP-553</key>
            <summary>org.apache.commons.dbcp2.PoolablePreparedStatement.passivate() should close ALL of its resources even when an exception occurs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jul 2019 22:26:53 +0000</created>
                <updated>Tue, 30 Jul 2019 23:28:35 +0000</updated>
                            <resolved>Tue, 30 Jul 2019 23:28:35 +0000</resolved>
                                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16896616" author="garydgregory" created="Tue, 30 Jul 2019 23:28:35 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z056c8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-552] org.apache.commons.dbcp2.DelegatingConnection.passivate() should close ALL of its resources even when an exception occurs</title>
                <link>https://issues.apache.org/jira/browse/DBCP-552</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The method&#160;&lt;tt&gt;org.apache.commons.dbcp2.DelegatingConnection.passivate()&lt;/tt&gt; should close ALL of its resources even when an exception occurs. This is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-551&quot; title=&quot;org.apache.commons.dbcp2.DelegatingStatement.close() should try to close ALL of its result sets even when an exception occurs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-551&quot;&gt;&lt;del&gt;DBCP-551&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13247943">DBCP-552</key>
            <summary>org.apache.commons.dbcp2.DelegatingConnection.passivate() should close ALL of its resources even when an exception occurs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jul 2019 21:17:12 +0000</created>
                <updated>Tue, 30 Jul 2019 22:24:34 +0000</updated>
                            <resolved>Tue, 30 Jul 2019 22:24:34 +0000</resolved>
                                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16896545" author="garydgregory" created="Tue, 30 Jul 2019 21:42:50 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                            <comment id="16896581" author="garydgregory" created="Tue, 30 Jul 2019 22:24:34 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13247937">DBCP-551</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0569c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-551] org.apache.commons.dbcp2.DelegatingStatement.close() should try to close ALL of its result sets even when an exception occurs</title>
                <link>https://issues.apache.org/jira/browse/DBCP-551</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The method&#160;&lt;tt&gt;org.apache.commons.dbcp2.DelegatingStatement#close()&lt;/tt&gt; should try to close ALL of its result sets even when an exception occurs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13247937">DBCP-551</key>
            <summary>org.apache.commons.dbcp2.DelegatingStatement.close() should try to close ALL of its result sets even when an exception occurs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jul 2019 20:33:56 +0000</created>
                <updated>Tue, 30 Jul 2019 21:44:15 +0000</updated>
                            <resolved>Tue, 30 Jul 2019 21:44:15 +0000</resolved>
                                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16896547" author="garydgregory" created="Tue, 30 Jul 2019 21:43:38 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13247943">DBCP-552</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05680:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-550] java.util.IllegalFormatException while building a message for a SQLFeatureNotSupportedException in Jdbc41Bridge.getObject(ResultSet,String,Class)</title>
                <link>https://issues.apache.org/jira/browse/DBCP-550</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;&lt;tt&gt;java.util.IllegalFormatException&lt;/tt&gt; while building a message for a &lt;tt&gt;SQLFeatureNotSupportedException&lt;/tt&gt; in &lt;tt&gt;org.apache.commons.dbcp2.Jdbc41Bridge.getObject(ResultSet,String,Class)&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13247923">DBCP-550</key>
            <summary>java.util.IllegalFormatException while building a message for a SQLFeatureNotSupportedException in Jdbc41Bridge.getObject(ResultSet,String,Class)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jul 2019 19:13:50 +0000</created>
                <updated>Tue, 30 Jul 2019 19:14:34 +0000</updated>
                            <resolved>Tue, 30 Jul 2019 19:14:34 +0000</resolved>
                                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16896424" author="garydgregory" created="Tue, 30 Jul 2019 19:14:34 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0564w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-544] Custom Shared ClassLoader not working after migrated from Tomcat 7 to Tomcat 9.0.17</title>
                <link>https://issues.apache.org/jira/browse/DBCP-544</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;&#160;&lt;br/&gt;
 Hi,&lt;br/&gt;
I have Custom SharedClassLoader in Tomcat 7 to load shared library jars,&lt;br/&gt;
 which is used by different applications in that tomcat. We migrated to&lt;br/&gt;
 Tomcat 9, now it is not working. How to achieve the same functionality in&lt;br/&gt;
 tomcat 9.&lt;/p&gt;

&lt;p&gt;In Tomcat 9 it expects resources to be passed. I don&apos;t find any sample Code&lt;br/&gt;
 on how to populate resources.&lt;/p&gt;

&lt;p&gt;I tried like below&lt;/p&gt;

&lt;p&gt;public CustomSharedClassLoader(ClassLoader parent) throws Exception {&lt;br/&gt;
 &#160; &#160; &#160; &#160; super(parent);&lt;br/&gt;
 //The below three lines are added by me to work for Tomcat 9.&lt;br/&gt;
 &#160; &#160; &#160; &#160; StandardRoot standardRoot = new StandardRoot();&lt;br/&gt;
 &#160; &#160; &#160; &#160; standardRoot.addPreResources(new DirResourceSet());&lt;br/&gt;
 &#160; &#160; &#160; &#160; setResources(standardRoot);// End for tomcat 9 changes.&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; for (URL urlForJars : getClassPath(SHARED_LIB))&lt;/p&gt;

{ &#160; &#160; &#160; &#160; &#160; &#160; addURL(urlForJars); &#160; &#160; &#160; &#160; }

&lt;p&gt;&#160; &#160; &#160; &#160; start();&lt;br/&gt;
 &#160; &#160; }&lt;/p&gt;

&lt;p&gt;It didn&apos;t work.&lt;/p&gt;

&lt;p&gt;public class CustomSharedClassLoader extends WebappClassLoader&lt;/p&gt;

{//Which takes shared folder libarary, it returns those classes.}</description>
                <environment></environment>
        <key id="13228359">DBCP-544</key>
            <summary>Custom Shared ClassLoader not working after migrated from Tomcat 7 to Tomcat 9.0.17</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="AH">Akram</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Apr 2019 14:46:29 +0000</created>
                <updated>Fri, 19 Apr 2019 07:17:18 +0000</updated>
                            <resolved>Fri, 19 Apr 2019 07:17:18 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16819300" author="garydgregory" created="Tue, 16 Apr 2019 17:23:07 +0000"  >&lt;p&gt;Why is this a DBCP issue?&lt;/p&gt;</comment>
                            <comment id="16819339" author="ah" created="Tue, 16 Apr 2019 17:50:26 +0000"  >&lt;p&gt;Sorry for creating in wrong project/module, could you please guide me to which project this issue belongs.&lt;/p&gt;
</comment>
                            <comment id="16820031" author="garydgregory" created="Wed, 17 Apr 2019 12:27:19 +0000"  >&lt;p&gt;Well, you mention Tomcat...&lt;/p&gt;</comment>
                            <comment id="16821741" author="markt" created="Fri, 19 Apr 2019 07:17:18 +0000"  >&lt;p&gt;This is a question for the Tomcat users mailing list:&lt;br/&gt;
&lt;a href=&quot;http://tomcat.apache.org/lists.html#tomcat-users&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tomcat.apache.org/lists.html#tomcat-users&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01u8w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-542] Fix tests on Java 11</title>
                <link>https://issues.apache.org/jira/browse/DBCP-542</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Fix tests on Java 11.&lt;/p&gt;

&lt;p&gt;Both tests in org.apache.commons.dbcp2.managed.TestSynchronizationOrder fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13225310">DBCP-542</key>
            <summary>Fix tests on Java 11</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Apr 2019 15:42:54 +0000</created>
                <updated>Mon, 1 Apr 2019 15:48:19 +0000</updated>
                            <resolved>Mon, 1 Apr 2019 15:48:19 +0000</resolved>
                                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16806925" author="garydgregory" created="Mon, 1 Apr 2019 15:48:19 +0000"  >&lt;p&gt;Fixed in git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01btk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-539] ManagedDataSource::close should declare used exceptions to allow the compiler to check that no InterruptedException are thrown.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-539</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In OFBiz we implemented &lt;a href=&quot;http://svn.apache.org/viewvc/ofbiz/ofbiz-framework/trunk/framework/entity/src/main/java/org/apache/ofbiz/entity/connection/DebugManagedDataSource.java?view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DebugManagedDataSource&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We had to write DebugManagedDataSource::close in order to avoid throwing an InterruptedException&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://github.com/apache/commons-dbcp/pull/30/commits&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/pull/30/commits&lt;/a&gt; for the fix&lt;/p&gt;</description>
                <environment></environment>
        <key id="13218605">DBCP-539</key>
            <summary>ManagedDataSource::close should declare used exceptions to allow the compiler to check that no InterruptedException are thrown.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jleroux">Jacques Le Roux</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Feb 2019 11:01:53 +0000</created>
                <updated>Thu, 28 Feb 2019 14:17:41 +0000</updated>
                            <resolved>Thu, 28 Feb 2019 13:56:42 +0000</resolved>
                                    <version>2.6.0</version>
                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16780386" author="jacques.le.roux" created="Thu, 28 Feb 2019 11:10:06 +0000"  >&lt;p&gt;I have updated changes.xml for this fix&lt;/p&gt;</comment>
                            <comment id="16780542" author="garydgregory" created="Thu, 28 Feb 2019 13:56:42 +0000"  >&lt;p&gt;In git master now. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="16780556" author="jacques.le.roux" created="Thu, 28 Feb 2019 14:17:41 +0000"  >&lt;p&gt;It&apos;s OK with me, thanks Gary&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/apache/commons-dbcp/pull/30]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z006m0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-538] Wrong JMX base name derived in BasicDataSource#updateJmxName</title>
                <link>https://issues.apache.org/jira/browse/DBCP-538</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Prior to version 2.3, the registeredJmxName class member was of type ObjectName, which has its own toString implementation. From version 2.3 the registeredJmxName is of type ObjectNameWrapper which does not implement toString, causing the JMX base name derived in the updateJmxName method to be on the form&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.commons.dbcp2.ObjectNameWrapper@&amp;lt;hash_code&amp;gt;,connectionpool=&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13216978">DBCP-538</key>
            <summary>Wrong JMX base name derived in BasicDataSource#updateJmxName</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ragnaroh">Ragnar Haugan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Feb 2019 16:50:51 +0000</created>
                <updated>Thu, 28 Feb 2019 14:12:55 +0000</updated>
                            <resolved>Thu, 28 Feb 2019 14:12:55 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.4.0</version>
                    <version>2.5.0</version>
                    <version>2.6.0</version>
                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16780551" author="garydgregory" created="Thu, 28 Feb 2019 14:12:55 +0000"  >&lt;p&gt;In git master now. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi16yo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-536] More than 5k+ instances of PgConnection created</title>
                <link>https://issues.apache.org/jira/browse/DBCP-536</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We are facing memory issues with DBCP2 in production. We are using the 2.0.1 version of dbcp2. By analyzing heap dump we noticed that 5k+ instances of PgConnection were created. I have attached the screenshot of the same.&lt;/p&gt;

&lt;p&gt;We have set&#160;setMaxTotal(pool size) to 40 and initializing two BasicDatasource Objects for two different data source.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Rahil&lt;/p&gt;</description>
                <environment></environment>
        <key id="13214782">DBCP-536</key>
            <summary>More than 5k+ instances of PgConnection created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rahil">Rahil S</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Feb 2019 10:17:33 +0000</created>
                <updated>Mon, 8 Jul 2019 21:39:51 +0000</updated>
                            <resolved>Mon, 8 Jul 2019 21:39:50 +0000</resolved>
                                    <version>2.0.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16764210" author="garydgregory" created="Sat, 9 Feb 2019 19:34:09 +0000"  >&lt;p&gt;Do you close all pool objects?&lt;/p&gt;

&lt;p&gt;What happens when you test with version 2.5.0?&lt;/p&gt;</comment>
                            <comment id="16764372" author="rahil" created="Sun, 10 Feb 2019 10:06:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks&#160;for the quick response. I don&apos;t think we close BasicDataSource as we need it from the start of the app until the app is killed/restarted. We initialize it only twice. Sadly, we were not able to reproduce it in a test environment. In production, we have not yet tried upgrading the version of dbcp2. Let me know if you need any more information.&lt;/p&gt;</comment>
                            <comment id="16764387" author="garydgregory" created="Sun, 10 Feb 2019 11:53:07 +0000"  >&lt;p&gt;Do you close JDBC resources like connections, statements, and result sets?&lt;/p&gt;</comment>
                            <comment id="16764388" author="rahil" created="Sun, 10 Feb 2019 12:01:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt; Nope, we don&apos;t close JDBC resources. Another thing I forgot to mention is that we use&#160;spring-jdbc(4.1.4.RELEASE) and creating a JdbcTemplate instance using the BasicDataSource of dbcp2.&lt;/p&gt;</comment>
                            <comment id="16764395" author="garydgregory" created="Sun, 10 Feb 2019 12:48:18 +0000"  >&lt;p&gt;If you create a JDBC Connection and never close it...&lt;/p&gt;</comment>
                            <comment id="16764400" author="rahil" created="Sun, 10 Feb 2019 13:00:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Sorry, let me put it in a better way. We don&apos;t interact directly with the connection so we do not close it. Spring-JDBC does it for us. Here is the line of spring-jdbc&#160;where the connection is released back to the pool -&#160;&lt;a href=&quot;https://github.com/spring-projects/spring-framework/blob/f7e53a071b8613ce9312d282770b29211da219b7/spring-jdbc/src/main/java/org/springframework/jdbc/core/JdbcTemplate.java#L339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/spring-projects/spring-framework/blob/f7e53a071b8613ce9312d282770b29211da219b7/spring-jdbc/src/main/java/org/springframework/jdbc/core/JdbcTemplate.java#L339&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16764406" author="garydgregory" created="Sun, 10 Feb 2019 13:10:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rahil&quot; class=&quot;user-hover&quot; rel=&quot;rahil&quot;&gt;rahil&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I would&#160;start with updating Commons Pool and Commons DBCP to their current versions. You could also update Spring instead first. Either way, you&apos;ll need to experiment with some changes.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16764518" author="rahil" created="Sun, 10 Feb 2019 19:08:32 +0000"  >&lt;p&gt;Sure, I will try that. Thanks&lt;/p&gt;</comment>
                            <comment id="16880471" author="garydgregory" created="Mon, 8 Jul 2019 15:29:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rahil&quot; class=&quot;user-hover&quot; rel=&quot;rahil&quot;&gt;rahil&lt;/a&gt; Can we close this ticket?&lt;/p&gt;</comment>
                            <comment id="16880709" author="rahil" created="Mon, 8 Jul 2019 21:13:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;Tried various things but it did not help, for now we can close it. Thank you&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12958128" name="Screenshot 2019-02-09 at 3.39.35 PM.jpg" size="307741" author="rahil" created="Sat, 9 Feb 2019 10:10:11 +0000"/>
                            <attachment id="12958127" name="Screenshot 2019-02-09 at 3.41.20 PM.jpg" size="374588" author="rahil" created="Sat, 9 Feb 2019 10:11:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0thk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-535] SharedPoolDataSource does not sent connectionProperties to the JDBC driver</title>
                <link>https://issues.apache.org/jira/browse/DBCP-535</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We are using&#160;org.apache.commons.dbcp2.datasources.SharedPoolDataSource via JNDI and&#160;need to send special &lt;b&gt;connectionProperties&lt;/b&gt; to our &lt;b&gt;Oracle JDBC Driver&lt;/b&gt;. Unfortunaly that does not work.&#160;&lt;/p&gt;

&lt;p&gt;Here is an example based on your &lt;a href=&quot;https://commons.apache.org/proper/commons-dbcp/guide/jndi-howto.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JNDI Howto&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;InitialContext ic = new InitialContext();&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;// Construct DriverAdapterCPDS reference&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Reference cpdsRef = new Reference(&quot;org.apache.commons.dbcp2.cpdsadapter.DriverAdapterCPDS&quot;,&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&quot;org.apache.commons.dbcp2.cpdsadapter.DriverAdapterCPDS&quot;, null);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cpdsRef.add(new StringRefAddr(&quot;driver&quot;, &quot;oracle.jdbc.OracleDriver&quot;));&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cpdsRef.add(new StringRefAddr(&quot;url&quot;, &quot;jdbc:oracle:thin:@server:port:sid&quot;));&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cpdsRef.add(new StringRefAddr(&quot;user&quot;, &quot;foo&quot;));&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cpdsRef.add(new StringRefAddr(&quot;password&quot;, &quot;bar&quot;));&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;ic.rebind(&quot;jdbc/cpds&quot;, cpdsRef);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;// Construct SharedPoolDataSource reference&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Reference ref = new Reference(&quot;org.apache.commons.dbcp2.datasources.SharedPoolDataSource&quot;,&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&quot;org.apache.commons.dbcp2.datasources.SharedPoolDataSourceFactory&quot;, null);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;ref.add(new StringRefAddr(&quot;dataSourceName&quot;, &quot;jdbc/cpds&quot;));&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;ref.add(new StringRefAddr(&quot;defaultMaxTotal&quot;, &quot;100&quot;));&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;ref.add(new StringRefAddr(&quot;defaultMaxIdle&quot;, &quot;30&quot;));&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;ref.add(new StringRefAddr(&quot;defaultMaxWaitMillis&quot;, &quot;10000&quot;));&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;tt&gt;// the connection properties we need to set&lt;/tt&gt;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;tt&gt;ref.add(new StringRefAddr(&quot;connectionProperties&quot;, &quot;defaultRowPrefetch=100&quot;));&lt;/tt&gt;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ic.rebind(&quot;jdbc/shared&quot;, ref);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;// Use&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;InitialContext ic2 = new InitialContext();&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;DataSource ds = (DataSource) ic2.lookup(&quot;jdbc/shared&quot;);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;assertNotNull(ds);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Connection conn = ds.getConnection(&quot;foo&quot;,&quot;bar&quot;);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;assertNotNull(conn);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;conn.close();&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Normally&#160;the&#160;defaultRowPrefetch in the oracle driver should be 100 but it&apos;s still the default value (10).&lt;/p&gt;

&lt;p&gt;The same happens when we use&#160;&lt;b&gt;PerUserPoolDataSource&lt;/b&gt; instead of &lt;b&gt;SharedPoolDataSource&lt;/b&gt;.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 10 /&#160;Java 11&lt;/p&gt;</environment>
        <key id="13209425">DBCP-535</key>
            <summary>SharedPoolDataSource does not sent connectionProperties to the JDBC driver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mseele">Michael Seele</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jan 2019 14:13:23 +0000</created>
                <updated>Sun, 23 Apr 2023 19:41:15 +0000</updated>
                                            <version>2.5.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16742879" author="garydgregory" created="Tue, 15 Jan 2019 08:52:08 +0000"  >&lt;p&gt;Feel free to provide a patch on GitHub with a unit test p &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17711928" author="douglasawh" created="Thu, 13 Apr 2023 14:46:12 +0000"  >&lt;p&gt;anybody seen this in versions before 2.5?&lt;/p&gt;</comment>
                            <comment id="17715510" author="garydgregory" created="Sun, 23 Apr 2023 19:41:15 +0000"  >&lt;p&gt;Your example shows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ref.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringRefAddr(&lt;span class=&quot;code-quote&quot;&gt;&quot;connectionProperties&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;defaultRowPrefetch=100&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is NOT in the how-to guide. How would that ever work? SharedPoolDataSource or its hierarchy does NOT define a &lt;tt&gt;connectionProperties&lt;/tt&gt; field. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00tfs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-533] tomcat register MBean of BasicDataSource with jmxName , appear InstanceAlreadyExistsException</title>
                <link>https://issues.apache.org/jira/browse/DBCP-533</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We use DBCP2 as&#160;GlobalNamingResources in tomcat and I need monitoring&#160; connection of DBCP2 ,but does not find how to use JMX in&#160; &lt;a href=&quot;http://commons.apache.org/proper/commons-dbcp/configuration.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-dbcp/configuration.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;through reading the source code ,i find jmxName&#160;properties in&#160;&lt;/p&gt;

&lt;p&gt;BasicDataSourceFactory ,when I add the setting like&#160;&lt;/p&gt;

&lt;p&gt;jmxName=&quot;org.apache.dbcp:DataSource=mydb&quot; in server.xml , there is&#160;javax.management.InstanceAlreadyExistsException: org.apache.dbcp:DataSource=mysqldb when I start up tomcat.&lt;/p&gt;

&lt;p&gt;after I debug the code , i find that DBCP have registered the Mbean in&#160;BasicDataSource with jmxName (BasicDataSource line 2390).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void jmxRegister() {
    &lt;span class=&quot;code-comment&quot;&gt;// Return immediately &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no JMX name has been specified
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; requestedName = getJmxName();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (requestedName == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        ObjectNameWrapper.wrap(requestedName).registerMBean(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MalformedObjectNameException e) {
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;The requested JMX name [&quot;&lt;/span&gt; + requestedName + &lt;span class=&quot;code-quote&quot;&gt;&quot;] was not valid and will be ignored.&quot;&lt;/span&gt;);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;but tomcat will&#160;&#160;register the&#160;Component in the startup lifecycle , tomcat will use the&#160;BasicDataSource&apos;s preRegister method to get the same Mbean name, because BasicDataSource&#160; implements MBeanRegistration.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((&lt;span class=&quot;code-quote&quot;&gt;&quot;javax.sql.DataSource&quot;&lt;/span&gt;.equals(ref.getClassName())  ||
    &lt;span class=&quot;code-quote&quot;&gt;&quot;javax.sql.XADataSource&quot;&lt;/span&gt;.equals(ref.getClassName())) &amp;amp;&amp;amp;
        resource.getSingleton()) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        ObjectName on = createObjectName(resource);
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; actualResource = envCtx.lookup(resource.getName());
        Registry.getRegistry(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).registerComponent(actualResource, on, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        objectNames.put(resource.getName(), on);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
        log.warn(sm.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;naming.jmxRegistrationFailed&quot;&lt;/span&gt;, e));
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;DBCP will register the MBean first ,but when tomcat register it will throw the&#160;InstanceAlreadyExistsException&lt;/p&gt;

&lt;p&gt;BUT i&apos;m not&#160;certain that it&apos;s a bug or I use it wrong&lt;/p&gt;</description>
                <environment>&lt;p&gt;tomcat 8.5.32&#160;&lt;/p&gt;</environment>
        <key id="13205862">DBCP-533</key>
            <summary>tomcat register MBean of BasicDataSource with jmxName , appear InstanceAlreadyExistsException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ck0528">Chengkun Li</reporter>
                        <labels>
                            <label>InstanceAlreadyExistsException</label>
                            <label>jmxName</label>
                    </labels>
                <created>Fri, 21 Dec 2018 02:16:35 +0000</created>
                <updated>Fri, 21 Dec 2018 05:56:25 +0000</updated>
                                            <version>2.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u007qo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-530] Can Not Collect Database Connection Pooling metrics In JMX</title>
                <link>https://issues.apache.org/jira/browse/DBCP-530</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;&lt;b&gt;Background:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Our project used&#160;org.apache.commons::commons-dbcp2:2.1.1 for collecting&#160;Database Connection Pooling metrics, and publish metrics from JMX to StatsD server&lt;/p&gt;

&lt;p&gt;&#160;After we changed version from&#160;2.1.1 to 2.4.0, we&#160;can see Database Connection pool metrics are in JMX MBeans list, but all of Database Connection pool metrics are &lt;b&gt;NULL&lt;/b&gt; value.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Impact:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;It will caused we can not collect metrics from Database Connection Pooling.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;May I get helps&#160;to investigate this problem?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Any suggestion/question please feel free to let me know.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Haven&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13199164">DBCP-530</key>
            <summary>Can Not Collect Database Connection Pooling metrics In JMX</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="halin">Haven Lin</reporter>
                        <labels>
                            <label>usability</label>
                    </labels>
                <created>Sun, 18 Nov 2018 11:36:14 +0000</created>
                <updated>Sun, 18 Nov 2018 12:09:25 +0000</updated>
                            <resolved>Sun, 18 Nov 2018 12:09:25 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.4.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 49 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00mi0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-525] license problem with latest Apache commons-dbcp</title>
                <link>https://issues.apache.org/jira/browse/DBCP-525</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;our pom includes various JBoss artifacts.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;jboss-parent license &apos;Public Domain&apos; without any further clarification. Would need a clarification imo.&lt;/li&gt;
	&lt;li&gt;org.jboss.narayana.jta:narayana-jta LGPL&lt;/li&gt;
	&lt;li&gt;org.jboss.spec.javax.transaction:jboss-transaction-api_1.2_spec LGPL&lt;/li&gt;
	&lt;li&gt;org.jboss:jboss-transaction-spi LGPL&lt;/li&gt;
	&lt;li&gt;org.jboss.logging:jboss-logging LGPL&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;According to the following LEGAL ticket those dependencies should imo not be there as they are required in the build:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LEGAL-207&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LEGAL-207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My interpretation is that having LGPL dependencies are oki-ish as long as they are purely optional. E.g. if they are only in an optional profile in the build and implement some public api.&lt;/p&gt;

&lt;p&gt;Those deps only got added recently. The commit message is not really clear what it is about. &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-dbcp/commit/5660855731502d00319f54cd584c95afa487a854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/commit/5660855731502d00319f54cd584c95afa487a854&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13193591">DBCP-525</key>
            <summary>license problem with latest Apache commons-dbcp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="struberg">Mark Struberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Oct 2018 14:46:30 +0000</created>
                <updated>Fri, 2 Nov 2018 15:56:53 +0000</updated>
                                            <version>2.5.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16660763" author="mbenson" created="Tue, 23 Oct 2018 14:48:42 +0000"  >&lt;p&gt;It looks like the original addition happened with &lt;a href=&quot;https://github.com/apache/commons-dbcp/commit/377dd0a46189c53b9af1f89c7e4e9e1bc7698646&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/commit/377dd0a46189c53b9af1f89c7e4e9e1bc7698646&lt;/a&gt;&#160;. It would seem that fully hiding the test and dependencies in the associated Maven profile would insulate downstream users from any surprises when building the code.&lt;/p&gt;</comment>
                            <comment id="16660792" author="struberg" created="Tue, 23 Oct 2018 15:03:53 +0000"  >&lt;p&gt;Gary, I assigned it to you. You applied the patch and probably have more background info about what to do.&lt;br/&gt;
Afaict we have 2 options&lt;br/&gt;
a.) make those classes optional and move the deps to a profile&lt;br/&gt;
b.) switch to Apache geronimo-transaction TxMgr.&lt;/p&gt;</comment>
                            <comment id="16660819" author="struberg" created="Tue, 23 Oct 2018 15:21:09 +0000"  >&lt;p&gt;whoops wrongly created this in POOL, but it&apos;s actually a DBCP issue. Gonna move it&lt;/p&gt;</comment>
                            <comment id="16673316" author="garydgregory" created="Fri, 2 Nov 2018 15:56:53 +0000"  >&lt;p&gt;I do not really want to change the tests since this is a fix for a real life scenario.&lt;/p&gt;

&lt;p&gt;It would be nice to have &lt;em&gt;additional&lt;/em&gt; tests that use Apache Geronimo.&lt;/p&gt;

&lt;p&gt;So you would only run the tests that depend on &quot;com.arjuna&quot; when a Maven profile is active?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zjgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-524] Thread is blocked when i using dbcp 1.0 to connect mysql</title>
                <link>https://issues.apache.org/jira/browse/DBCP-524</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;when I use dbcp 1.0 to connect to mysql, one thread is always blocked by other thread.&lt;/p&gt;

&lt;p&gt;The log is blow:&lt;/p&gt;

&lt;p&gt;&quot;schedulerFactoryBean_Worker-8&quot; J9VMThread:0x0000000004047300, j9thread_t:0x00007F66B7232200, java/lang/Thread:0x00000007E90CBA48, state:R, prio=5&lt;br/&gt;
3XMJAVALTHREAD (java/lang/Thread getId:0x8A, isDaemon:false)&lt;br/&gt;
3XMTHREADINFO1 (native thread ID:0x2452, native priority:0x5, native policy:UNKNOWN)&lt;br/&gt;
3XMTHREADINFO2 (native stack address range from:0x00007F66B6FE9000, to:0x00007F66B702A000, size:0x41000)&lt;br/&gt;
3XMHEAPALLOC Heap bytes allocated since last GC cycle=0 (0x0)&lt;br/&gt;
3XMTHREADINFO3 Java callstack:&lt;br/&gt;
4XESTACKTRACE at java/net/SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
4XESTACKTRACE at java/net/SocketInputStream.read(SocketInputStream.java:140(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.readFully(MysqlIO.java:1391(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.reuseAndReadPacket(MysqlIO.java:1538(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.checkErrorPacket(MysqlIO.java:1929(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.sendCommand(MysqlIO.java:1167(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.sqlQueryDirect(MysqlIO.java:1278(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.sqlQuery(MysqlIO.java:1224(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/Connection.execSQL(Connection.java:2248(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: java/lang/Object@0x00000007EB01D990, entry count: 2)&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/Connection.execSQL(Connection.java:2196(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/Statement.executeQuery(Statement.java:1163(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: java/lang/Object@0x00000007EB01D990, entry count: 1)&lt;br/&gt;
5XESTACKTRACE (entered lock: com/mysql/jdbc/Statement@0x00000007EA1168C0, entry count: 1)&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/DelegatingStatement.executeQuery(DelegatingStatement.java:162(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/PoolableConnectionFactory.validateObject(PoolableConnectionFactory.java:221(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: org/apache/commons/dbcp/PoolableConnectionFactory@0x00000007EB01D3F8, entry count: 1)&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/pool/impl/GenericObjectPool.addObjectToPool(GenericObjectPool.java:1415(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/pool/impl/GenericObjectPool.returnObject(GenericObjectPool.java:1381(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/AbandonedObjectPool.returnObject(AbandonedObjectPool.java:140(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: org/apache/commons/dbcp/AbandonedObjectPool@0x00000007EB01D368, entry count: 1)&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/PoolableConnection.close(PoolableConnection.java:110(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/baseclasses/BaseJdbcDAO.query(BaseJdbcDAO.java:49(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/GatewayJdbcService.QueryBySqlEx(GatewayJdbcService.java:124(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/gateway/SmsChanneMASlImpl.receiveRPTs(SmsChanneMASlImpl.java:114(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/SmsReceiveSentReportService.receiveReports(SmsReceiveSentReportService.java:54(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/SmsReceiveSentReportService$$FastClassByCGLIB$$5201ea4.invoke(&amp;lt;generated&amp;gt;(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at net/sf/cglib/proxy/MethodProxy.invoke(MethodProxy.java:149(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/Cglib2AopProxy$CglibMethodInvocation.invokeJoinpoint(Cglib2AopProxy.java:700(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/transaction/interceptor/TransactionInterceptor.invoke(TransactionInterceptor.java:106(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:635(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/SmsReceiveSentReportService$$EnhancerByCGLIB$$c660d003.receiveReports(&amp;lt;generated&amp;gt;)&lt;br/&gt;
4XESTACKTRACE at com/sms/job/SmsReceiveSentReportJob.execute(SmsReceiveSentReportJob.java:70(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at sun/reflect/GeneratedMethodAccessor258.invoke(Bytecode PC:36(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at sun/reflect/DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at java/lang/reflect/Method.invoke(Method.java:611(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/util/MethodInvoker.invoke(MethodInvoker.java:276(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/scheduling/quartz/MethodInvokingJobDetailFactoryBean$MethodInvokingJob.executeInternal(MethodInvokingJobDetailFactoryBean.java:260(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/scheduling/quartz/QuartzJobBean.execute(QuartzJobBean.java:86(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/quartz/core/JobRunShell.run(JobRunShell.java:202(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/quartz/simpl/SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:529(Compiled Code))&lt;/p&gt;</description>
                <environment></environment>
        <key id="13186211">DBCP-524</key>
            <summary>Thread is blocked when i using dbcp 1.0 to connect mysql</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="guominzhi">guominzhi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Sep 2018 01:17:42 +0000</created>
                <updated>Mon, 30 Jan 2023 21:26:50 +0000</updated>
                            <resolved>Mon, 30 Jan 2023 21:26:50 +0000</resolved>
                                    <version>1.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16621418" author="garydgregory" created="Thu, 20 Sep 2018 02:20:44 +0000"  >&lt;p&gt;Please try version&#160;2.9.0. You&apos;ll have to update package imports and possibly some source if you are still on 1.x.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ya5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-523] dbcp1.0&#29256;&#26412;&#36830;&#25509;mysql&#25968;&#25454;&#24211;&#26102;&#65292;&#32463;&#24120;&#20986;&#29616;&#32447;&#31243;&#38459;&#22622;&#30340;&#38382;&#39064;</title>
                <link>https://issues.apache.org/jira/browse/DBCP-523</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;dbcp1.0&#29256;&#26412;&#36830;&#25509;mysql&#25968;&#25454;&#24211;&#26102;&#65292;&#32463;&#24120;&#20986;&#29616;&#32447;&#31243;&#38459;&#22622;&#30340;&#38382;&#39064;&#65292;&#26085;&#24535;&#20449;&#24687;&#22914;&#19979;&#65306;&lt;/p&gt;

&lt;p&gt;&quot;schedulerFactoryBean_Worker-8&quot; J9VMThread:0x0000000004047300, j9thread_t:0x00007F66B7232200, java/lang/Thread:0x00000007E90CBA48, state:R, prio=5&lt;br/&gt;
3XMJAVALTHREAD (java/lang/Thread getId:0x8A, isDaemon:false)&lt;br/&gt;
3XMTHREADINFO1 (native thread ID:0x2452, native priority:0x5, native policy:UNKNOWN)&lt;br/&gt;
3XMTHREADINFO2 (native stack address range from:0x00007F66B6FE9000, to:0x00007F66B702A000, size:0x41000)&lt;br/&gt;
3XMHEAPALLOC Heap bytes allocated since last GC cycle=0 (0x0)&lt;br/&gt;
3XMTHREADINFO3 Java callstack:&lt;br/&gt;
4XESTACKTRACE at java/net/SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
4XESTACKTRACE at java/net/SocketInputStream.read(SocketInputStream.java:140(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.readFully(MysqlIO.java:1391(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.reuseAndReadPacket(MysqlIO.java:1538(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.checkErrorPacket(MysqlIO.java:1929(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.sendCommand(MysqlIO.java:1167(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.sqlQueryDirect(MysqlIO.java:1278(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/MysqlIO.sqlQuery(MysqlIO.java:1224(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/Connection.execSQL(Connection.java:2248(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: java/lang/Object@0x00000007EB01D990, entry count: 2)&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/Connection.execSQL(Connection.java:2196(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/mysql/jdbc/Statement.executeQuery(Statement.java:1163(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: java/lang/Object@0x00000007EB01D990, entry count: 1)&lt;br/&gt;
5XESTACKTRACE (entered lock: com/mysql/jdbc/Statement@0x00000007EA1168C0, entry count: 1)&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/DelegatingStatement.executeQuery(DelegatingStatement.java:162(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/PoolableConnectionFactory.validateObject(PoolableConnectionFactory.java:221(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: org/apache/commons/dbcp/PoolableConnectionFactory@0x00000007EB01D3F8, entry count: 1)&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/pool/impl/GenericObjectPool.addObjectToPool(GenericObjectPool.java:1415(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/pool/impl/GenericObjectPool.returnObject(GenericObjectPool.java:1381(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/AbandonedObjectPool.returnObject(AbandonedObjectPool.java:140(Compiled Code))&lt;br/&gt;
5XESTACKTRACE (entered lock: org/apache/commons/dbcp/AbandonedObjectPool@0x00000007EB01D368, entry count: 1)&lt;br/&gt;
4XESTACKTRACE at org/apache/commons/dbcp/PoolableConnection.close(PoolableConnection.java:110(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/baseclasses/BaseJdbcDAO.query(BaseJdbcDAO.java:49(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/GatewayJdbcService.QueryBySqlEx(GatewayJdbcService.java:124(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/gateway/SmsChanneMASlImpl.receiveRPTs(SmsChanneMASlImpl.java:114(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/SmsReceiveSentReportService.receiveReports(SmsReceiveSentReportService.java:54(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/SmsReceiveSentReportService$$FastClassByCGLIB$$5201ea4.invoke(&amp;lt;generated&amp;gt;(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at net/sf/cglib/proxy/MethodProxy.invoke(MethodProxy.java:149(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/Cglib2AopProxy$CglibMethodInvocation.invokeJoinpoint(Cglib2AopProxy.java:700(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/transaction/interceptor/TransactionInterceptor.invoke(TransactionInterceptor.java:106(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/aop/framework/Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:635(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at com/sms/service/SmsReceiveSentReportService$$EnhancerByCGLIB$$c660d003.receiveReports(&amp;lt;generated&amp;gt;)&lt;br/&gt;
4XESTACKTRACE at com/sms/job/SmsReceiveSentReportJob.execute(SmsReceiveSentReportJob.java:70(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at sun/reflect/GeneratedMethodAccessor258.invoke(Bytecode PC:36(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at sun/reflect/DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at java/lang/reflect/Method.invoke(Method.java:611(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/util/MethodInvoker.invoke(MethodInvoker.java:276(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/scheduling/quartz/MethodInvokingJobDetailFactoryBean$MethodInvokingJob.executeInternal(MethodInvokingJobDetailFactoryBean.java:260(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/springframework/scheduling/quartz/QuartzJobBean.execute(QuartzJobBean.java:86(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/quartz/core/JobRunShell.run(JobRunShell.java:202(Compiled Code))&lt;br/&gt;
4XESTACKTRACE at org/quartz/simpl/SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:529(Compiled Code))&lt;/p&gt;</description>
                <environment></environment>
        <key id="13186055">DBCP-523</key>
            <summary>dbcp1.0&#29256;&#26412;&#36830;&#25509;mysql&#25968;&#25454;&#24211;&#26102;&#65292;&#32463;&#24120;&#20986;&#29616;&#32447;&#31243;&#38459;&#22622;&#30340;&#38382;&#39064;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="guominzhi">guominzhi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Sep 2018 13:13:35 +0000</created>
                <updated>Wed, 19 Sep 2018 19:02:19 +0000</updated>
                            <resolved>Wed, 19 Sep 2018 19:02:19 +0000</resolved>
                                    <version>1.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16621053" author="michael-o" created="Wed, 19 Sep 2018 19:02:19 +0000"  >&lt;p&gt;No English, no support.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y973:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-522] Cached autocommit state can get out of sync with the database if Error is thrown</title>
                <link>https://issues.apache.org/jira/browse/DBCP-522</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;DelegatingConnection.setAutoCommit() resets autoCommitCached to null to indicate if a SQLException is caught.&#160; This suffices in most cases, but if a Java Error is thrown, e.g., OutOfMemoryError, the autoCommitCached state retains its original value, even though the database might have received and honored the change (the OutOfMemoryError might have happened when the JDBC driver processed the response).&#160;&#160;&lt;/p&gt;

&lt;p&gt;The impact of this on an app that tries to manage and continue after the Error is rather severe, as the incorrect cached auto commit value means that the rollbackOnReturn and enableAutoCommitOnReturn options do not cause the connection to be restored to a predictable state, as the Java side believes the connection is not in a transaction, even though the database server side believes it is.&#160;&#160;&lt;/p&gt;

&lt;p&gt;At least three fixes possible.&#160; One could set autoCommitCached to null before issuing the request, and then give it a value only if the the database request succeeded.&#160; One could catch all Throwables, not just SQLException.&#160; One could maintain the new state in a local initialized to null, and then store its value in a finally block, which would avoid actually catching and rethrowing a Throwable.&#160;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13182168">DBCP-522</key>
            <summary>Cached autocommit state can get out of sync with the database if Error is thrown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wtmitchell3">Bill Mitchell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Aug 2018 16:02:54 +0000</created>
                <updated>Tue, 26 Oct 2021 21:07:42 +0000</updated>
                                            <version>2.1.1</version>
                    <version>2.2.0</version>
                    <version>2.3.0</version>
                    <version>2.4.0</version>
                    <version>2.5.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16673333" author="garydgregory" created="Fri, 2 Nov 2018 16:04:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wtmitchell3&quot; class=&quot;user-hover&quot; rel=&quot;wtmitchell3&quot;&gt;wtmitchell3&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;Please feel free to propose a PR on GitHub: &lt;a href=&quot;https://github.com/apache/commons-dbcp&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="17434573" author="garydgregory" created="Tue, 26 Oct 2021 21:07:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wtmitchell3&quot; class=&quot;user-hover&quot; rel=&quot;wtmitchell3&quot;&gt;wtmitchell3&lt;/a&gt;&#160;ping.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xli7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-521] dbcp 2.5.0 doesn&apos;t work with JDBC 3.0 drivers, e.g., jtds</title>
                <link>https://issues.apache.org/jira/browse/DBCP-521</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-508&quot; title=&quot;Prepared statement keys should take a Connection&amp;#39;s schema into account&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-508&quot;&gt;&lt;del&gt;DBCP-508&lt;/del&gt;&lt;/a&gt;, to add the schema to the keys for the prepared statement cache, the Connection.getSchema() method is called.&#160; On the dbcp side, this call is issued in a try-catch block that ignores a returned SQLException.&#160; Unfortunately, at least one JDBC 3.0 driver, jdts 1.3.1, throws an AbstractMethodError in its getSchema method, as it doesn&apos;t support this.&#160; (The 2.4.0 version of dbcp works fine with jtds.)&lt;/p&gt;

&lt;p&gt;At least two fixes are possible.&#160; One could ignore any Throwable from getSchema call.&#160; Or one could determine the major/minor JDBC version for the connection and issue the method call only on drivers that claim support for 4.1.&#160;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13182164">DBCP-521</key>
            <summary>dbcp 2.5.0 doesn&apos;t work with JDBC 3.0 drivers, e.g., jtds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wtmitchell3">Bill Mitchell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Aug 2018 15:51:55 +0000</created>
                <updated>Sun, 2 Sep 2018 01:18:48 +0000</updated>
                            <resolved>Sun, 2 Sep 2018 01:18:48 +0000</resolved>
                                    <version>2.5.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16597922" author="garydgregory" created="Thu, 30 Aug 2018 21:02:08 +0000"  >&lt;p&gt;Please try the current snapshot version.&lt;/p&gt;</comment>
                            <comment id="16597932" author="garydgregory" created="Thu, 30 Aug 2018 21:12:30 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-518&quot; title=&quot;Allow DBCP to work with old Java 6/JDBC drivers without throwing AbstractMethodError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-518&quot;&gt;&lt;del&gt;DBCP-518&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16599852" author="wtmitchell3" created="Sat, 1 Sep 2018 23:56:53 +0000"  >&lt;p&gt;Thanks for the suggestion to check the snapshot version.&#160; You&apos;re right, I should have checked to see if the issue was already open, but I probably would not have thought to look for a snapshot.&#160; The problem I was seeing with jtds is resolved in the snapshot version.&#160;&#160;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xlhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-518] Allow DBCP to work with old Java 6/JDBC drivers without throwing AbstractMethodError</title>
                <link>https://issues.apache.org/jira/browse/DBCP-518</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Allow DBCP to work with old Java 6/JDBC 4.0 drivers without throwing &lt;tt&gt;AbstractMethodError&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;As of version 2.5.0, DBCP uses methods from Java 7/JDBC 4.1 like &lt;tt&gt;Connection#getSchema()&lt;/tt&gt;. When DBCP tries to call this method, the JVM throws a &lt;tt&gt;AbstractMethodError&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;DBCP will detect this condition and use &lt;tt&gt;null&lt;/tt&gt; for such schema values.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13179211">DBCP-518</key>
            <summary>Allow DBCP to work with old Java 6/JDBC drivers without throwing AbstractMethodError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Aug 2018 00:12:54 +0000</created>
                <updated>Thu, 16 Aug 2018 03:52:24 +0000</updated>
                            <resolved>Thu, 16 Aug 2018 03:52:24 +0000</resolved>
                                    <version>2.5.0</version>
                                    <fixVersion>2.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16581916" author="garydgregory" created="Thu, 16 Aug 2018 03:52:24 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x3br:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-517] Make defensive copies of char[] passwords.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-517</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Make defensive copies of char[] passwords.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13174224">DBCP-517</key>
            <summary>Make defensive copies of char[] passwords.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jul 2018 22:18:43 +0000</created>
                <updated>Tue, 24 Jul 2018 22:35:00 +0000</updated>
                            <resolved>Tue, 24 Jul 2018 22:35:00 +0000</resolved>
                                                    <fixVersion>2.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16554868" author="garydgregory" created="Tue, 24 Jul 2018 22:35:00 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w8uv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-516] Do not double returnObject back to the pool if there is a transaction context with a shared connection</title>
                <link>https://issues.apache.org/jira/browse/DBCP-516</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;It is possible for the same thread to return a connection to the pool twice:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// in TX
&lt;/span&gt;c = getConnection()
&lt;span class=&quot;code-comment&quot;&gt;// in aftercompletion
&lt;/span&gt;c.getWarnings()
c.getWarnings()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This issue was uncovered after resolving &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-515&quot; title=&quot;Do not try to register synchronization when the transaction is no longer active&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-515&quot;&gt;&lt;del&gt;DBCP-515&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13174066">DBCP-516</key>
            <summary>Do not double returnObject back to the pool if there is a transaction context with a shared connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tomjenkinson">Tom Jenkinson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jul 2018 10:52:38 +0000</created>
                <updated>Thu, 26 Jul 2018 07:44:15 +0000</updated>
                            <resolved>Wed, 25 Jul 2018 23:28:59 +0000</resolved>
                                                    <fixVersion>2.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16556407" author="garydgregory" created="Wed, 25 Jul 2018 23:28:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomjenkinson&quot; class=&quot;user-hover&quot; rel=&quot;tomjenkinson&quot;&gt;tomjenkinson&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank you for your patch!&lt;/p&gt;

&lt;p&gt;I applied a revised version of the patch.&lt;/p&gt;

&lt;p&gt;Please verify and close this ticket.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16558020" author="tomjenkinson" created="Thu, 26 Jul 2018 07:44:08 +0000"  >&lt;p&gt;Thanks, the changes look good to me!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/apache/commons-dbcp/pull/17]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w7vj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-515] Do not try to register synchronization when the transaction is no longer active</title>
                <link>https://issues.apache.org/jira/browse/DBCP-515</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The current code can try to register a synchronization with the transaction manager when the only transaction on the thread is already committed (e.g. if someone tries to call getConnection in aftercompletion. We should not try to register at that point as it is invalid.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13173415">DBCP-515</key>
            <summary>Do not try to register synchronization when the transaction is no longer active</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tomjenkinson">Tom Jenkinson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jul 2018 10:08:59 +0000</created>
                <updated>Thu, 26 Jul 2018 07:44:28 +0000</updated>
                            <resolved>Wed, 25 Jul 2018 23:12:47 +0000</resolved>
                                                    <fixVersion>2.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16550617" author="tomjenkinson" created="Fri, 20 Jul 2018 10:21:03 +0000"  >&lt;p&gt;PR over here: &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-515&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-515&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16556384" author="garydgregory" created="Wed, 25 Jul 2018 23:12:47 +0000"  >&lt;p&gt;Applied a different, more compact, version of the patch. The test is the same though. Closes #16.&lt;/p&gt;

&lt;p&gt;Please verify and close this ticket.&lt;/p&gt;</comment>
                            <comment id="16558021" author="tomjenkinson" created="Thu, 26 Jul 2018 07:44:23 +0000"  >&lt;p&gt;Thanks, the changes look good to me!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/apache/commons-dbcp/pull/16]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w3v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-513] Hundreads of threads in Wait state with below stack trace</title>
                <link>https://issues.apache.org/jira/browse/DBCP-513</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hello Team,&lt;/p&gt;

&lt;p&gt;Our application suddenly stops responding, when we checked thread dump, most of the threads are in wait state with below stack trace, we had to restart server to make it active, can you pelase provide your inputs on the root cause &amp;amp; resolution?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&quot;JSockConn Thread #4532&quot; #40906 prio=5 os_prio=0 tid=0x00007f84382ce800 nid=0xc692 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f83d38f8000&amp;#93;&lt;/span&gt;&lt;br/&gt;
 java.lang.Thread.State: WAITING (parking)&lt;br/&gt;
 at sun.misc.Unsafe.park(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;parking to wait for &amp;lt;0x00000005c30a11b8&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)&lt;br/&gt;
 at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)&lt;br/&gt;
 at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)&lt;br/&gt;
 at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:583)&lt;br/&gt;
 at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:442)&lt;br/&gt;
 at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:363)&lt;br/&gt;
 at org.apache.commons.dbcp2.PoolingDataSource.getConnection(PoolingDataSource.java:134)&lt;br/&gt;
 at org.apache.commons.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:1533)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Java Version:&#160;&lt;/p&gt;

&lt;p&gt;1.8.0_121&lt;/p&gt;

&lt;p&gt;&#160;OS Complete Version:&#160;&lt;/p&gt;

&lt;p&gt;Linux sdpvvrwm556 3.10.0-693.11.6.el7.x86_64 #1 SMP Thu Dec 28 14:23:39 EST 2017 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;DBCP Jar:&lt;/p&gt;

&lt;p&gt;commons-dbcp2-2.1.1.jar&lt;/p&gt;</environment>
        <key id="13173190">DBCP-513</key>
            <summary>Hundreads of threads in Wait state with below stack trace</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="mahesh537">Mahesh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Jul 2018 13:35:56 +0000</created>
                <updated>Thu, 8 Feb 2024 13:26:58 +0000</updated>
                            <resolved>Thu, 25 Oct 2018 12:54:26 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.6.0</version>
                                    <fixVersion>2.6.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16549294" author="garydgregory" created="Thu, 19 Jul 2018 13:52:06 +0000"  >&lt;p&gt;Version 2.1.1 is antique, can you try the version we just released: 2.5.0?&lt;/p&gt;

&lt;p&gt;Please provide your environment in that field.&lt;/p&gt;</comment>
                            <comment id="16549350" author="mahesh537" created="Thu, 19 Jul 2018 14:34:41 +0000"  >&lt;p&gt;Thanks Gary.&lt;/p&gt;

&lt;p&gt;Java - 1.8.0_121&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Linux sdpvvrwm556 3.10.0-693.11.6.el7.x86_64 #1 SMP Thu Dec 28 14:23:39 EST 2017 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;commons-dbcp2-2.1.1.jar&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Let me know if any other details required to analyze further. Since this is in Production, we may not be able to apply 2.5 jars directly.&lt;/p&gt;</comment>
                            <comment id="16549380" author="garydgregory" created="Thu, 19 Jul 2018 14:54:44 +0000"  >&lt;p&gt;How about:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create a unit test anyone can run to reproduce, then we can try different versions.
	&lt;ul&gt;
		&lt;li&gt;You version 2.1.1&lt;/li&gt;
		&lt;li&gt;Use 2.5.0 version.&lt;/li&gt;
		&lt;li&gt;Use the 2.5.1-SNAPSHOT version.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;There have been bugs fixed in the underlying Commons Pool component, maybe&#160;there is a fix for you there. You should scan the release notes for Commons Pool &lt;a href=&quot;https://commons.apache.org/proper/commons-pool/changes-report.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://commons.apache.org/proper/commons-pool/changes-report.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Note that newer DBCP versions pick up newer Commons Pool versions.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Basically, they ke is to get something we can reproduce.&lt;/p&gt;</comment>
                            <comment id="16549405" author="mahesh537" created="Thu, 19 Jul 2018 15:11:36 +0000"  >&lt;p&gt;Thanks Gary. Will try to reproduce this issue with Standalone code and share the results.&lt;/p&gt;</comment>
                            <comment id="16569260" author="agrrwal" created="Sat, 4 Aug 2018 18:28:51 +0000"  >&lt;p&gt;+1&#160;&lt;/p&gt;

&lt;p&gt;Threads are going in wait state while fetching/get connection from pool, tried with 2.5.0 version as well.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thread dump:&lt;/p&gt;

&lt;p&gt;&quot;qtp1150284200-22&quot; #22 prio=5 os_prio=31 tid=0x00007fc1e0a77800 nid=0x5f03 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007000051a2000&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160; java.lang.Thread.State: WAITING (parking)&lt;/p&gt;

&lt;p&gt; at sun.misc.Unsafe.park(Native Method)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;parking to wait for&#160; &amp;lt;0x00000006d7102ec0&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)&lt;/p&gt;

&lt;p&gt; at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)&lt;/p&gt;

&lt;p&gt; at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:590)&lt;/p&gt;

&lt;p&gt; at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:441)&lt;/p&gt;

&lt;p&gt; at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:362)&lt;/p&gt;

&lt;p&gt; at org.apache.commons.dbcp2.PoolingDataSource.getConnection(PoolingDataSource.java:134)&lt;/p&gt;

&lt;p&gt; at org.apache.commons.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:1525)&lt;/p&gt;</comment>
                            <comment id="16569270" author="garydgregory" created="Sat, 4 Aug 2018 19:24:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=agrrwal&quot; class=&quot;user-hover&quot; rel=&quot;agrrwal&quot;&gt;agrrwal&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Can you provide a patch that reproduces the problem as a unit test? For a database, you should try to use an local database like H2 (&lt;a href=&quot;http://www.h2database.com/html/main.html)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.h2database.com/html/main.html)&lt;/a&gt;&#160;or HSQLDB (&lt;a href=&quot;http://hsqldb.org/).&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hsqldb.org/).&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Otherwise, I do not see how I can help you in a timely manner.&#160;&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16569370" author="agrrwal" created="Sun, 5 Aug 2018 05:08:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Pleas find attached patch to reproduce the issue. I have used Postgress SQL as I am using the same in production.&#160;Please let me know if any other information is required. Thanks&lt;/p&gt;

&lt;p&gt;This is the screen shot of the problem, app got hanged after 8th query. &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12934397/12934397_Screen+Shot+2018-08-05+at+10.29.52+AM.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12934396/12934396_dbcpthread.zip&quot; title=&quot;dbcpthread.zip attached to DBCP-513&quot;&gt;dbcpthread.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16575443" author="mahesh537" created="Thu, 9 Aug 2018 21:50:54 +0000"  >&lt;p&gt;Hello&#160;Gary/Harshit,&lt;/p&gt;

&lt;p&gt;Default Max Connection Pool Size&#160;is set to 8 in Apache Connection Pool (BasicDataSource), we need to overwrite this with respect to our need, else we may see similar behavior when&#160;&#160;connections are exhausted.&#160;&lt;/p&gt;

&lt;p&gt;basicDataSource.setMaxTotal(20);&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Mahesh&lt;/p&gt;</comment>
                            <comment id="16575491" author="psteitz" created="Thu, 9 Aug 2018 22:25:24 +0000"  >&lt;p&gt;It&apos;s hard to tell from the code above, but the most likely scenario is that you are failing to close the connections and the pool is simply exhausted.  Threads will pile up waiting if there are no connections left in the pool.  You need to make sure that your code is closing connections on all execution paths.&lt;/p&gt;</comment>
                            <comment id="16660478" author="struberg" created="Tue, 23 Oct 2018 11:45:37 +0000"  >&lt;p&gt;We face the same issue in Apache OpenJPA when testing against a real MySQL DB.&lt;br/&gt;
We spin up 80 threads which do an EntityManager query and an em.close() after that (should free the connection);&lt;/p&gt;

&lt;p&gt;It seems that there are race conditions which do lead to the notEmpty Condition doesn&apos;t get fired.&lt;/p&gt;

&lt;p&gt;I&apos;ll attach 2 test runs. One which has only 1 tread which keeps hanging (dbcp_lock_1.txt), the other with 7 threads still open (dbcp_lock_7.txt. &lt;/p&gt;

&lt;p&gt;Here is my environment:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Apache Maven 3.5.0 (ff8f5e7444045639af65f6095c62210b5713f426; 2017-04-03T21:39:06+02:00)
Maven home: /opt/apache/maven
Java version: 1.8.0_181, vendor: Oracle Corporation
Java home: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.181.b15-6.fc28.x86_64/jre
Default locale: de_AT, platform encoding: UTF-8
OS name: &quot;linux&quot;, version: &quot;4.18.14-200.fc28.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the unit test in question:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/openjpa/blob/master/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jdbc/sqlcache/TestMultithreadedReparameterization.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/openjpa/blob/master/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jdbc/sqlcache/TestMultithreadedReparameterization.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can run it via starting up the MySQL docker in /openjpa with the following commands&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# building the last snapshot
$&amp;gt; mvn clean install -DskipTests

# start mysql docker
$&amp;gt; mvn -N -Ptest-mysql-docker docker:start

# run the test
$&amp;gt; cd openjpa-persistence-jdbc
$&amp;gt; mvn test -Dtest=TestMultithreadedReparameterization -Ptest-mysql-docker
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16660545" author="struberg" created="Tue, 23 Oct 2018 12:17:18 +0000"  >&lt;p&gt;What appears to me as a &lt;em&gt;potential&lt;/em&gt; issue is that if the idletime is rather short we might end up with a glitch due to the following code:&lt;/p&gt;

&lt;p&gt;Imagine that our 80 threads all try to borrow a Connection but we have a maxActive of say 10. So 70 are waiting. &lt;br/&gt;
They are basically locked in exactly the place above. They are waiting for someone to return a Connection (or any other kind of pooled object for that matter) into the LikedDequeue.&lt;/p&gt;

&lt;p&gt;But here is a funny code which destroys a Connection &lt;em&gt;without&lt;/em&gt; returning them to the DeQueue if the idle time is exceeded!&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-pool/blob/commons-pool-2.6.0/src/main/java/org/apache/commons/pool2/impl/GenericObjectPool.java#L582&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-pool/blob/commons-pool-2.6.0/src/main/java/org/apache/commons/pool2/impl/GenericObjectPool.java#L582&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        if (isClosed() || maxIdleSave &amp;gt; -1 &amp;amp;&amp;amp; maxIdleSave &amp;lt;= idleObjects.size()) {
            try {
                destroy(p);
...
        } else {
            if (getLifo()) {
                idleObjects.addFirst(p);
            } else {
                idleObjects.addLast(p);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So in this case nobody is returning something to the DeQueue and thus those connections are probably waiting forever &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;A possible solution would (probably?) be to remove the else and execute it always. And have the destroy(p); immediately calla p = create(); ?&lt;br/&gt;
How does that sound?&lt;/p&gt;</comment>
                            <comment id="16660555" author="struberg" created="Tue, 23 Oct 2018 12:20:48 +0000"  >&lt;p&gt;PS: in our case the maxIdleSave is 0. So unluckily not -1 and thus not hitting the condition to skip that part. &lt;br/&gt;
And gosh, it&apos;s even worse. This is not a time but the number of connections. So if you happen to create that stuff quickly enough then you will guaranteed be getting into this situation if I&apos;m not completely wrong &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="16660626" author="struberg" created="Tue, 23 Oct 2018 13:08:25 +0000"  >&lt;p&gt;Another idea: what about enhancing the blockWhenExhausted logic with an AtomicInteger waitingToGetServed?&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
waitingToGetServed.incrementAndGet();
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (borrowMaxWaitMillis &amp;lt; 0) {
                        p = idleObjects.takeFirst();
                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                        p = idleObjects.pollFirst(borrowMaxWaitMillis,
                                TimeUnit.MILLISECONDS);
                    }
waitingToGetServed.decrementAndGet();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then do not destroy the Connection when returned and someone still is waitingToGetServed (via the LinkedBlockingDeque notEmpty.await(); )&lt;/p&gt;</comment>
                            <comment id="16662741" author="struberg" created="Wed, 24 Oct 2018 19:39:05 +0000"  >&lt;p&gt;Works fine with my fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-356&quot; title=&quot;deadlock if borrowObject gets called to fast and maxIdle is 0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-356&quot;&gt;&lt;del&gt;POOL-356&lt;/del&gt;&lt;/a&gt; and updating to commons-pool-1.6.1-SNAPSHOT&lt;/p&gt;</comment>
                            <comment id="16728116" author="raoabhishek" created="Mon, 24 Dec 2018 03:25:49 +0000"  >&lt;p&gt;We&apos;re facing a similar problem with SharedPoolDataSource. At one point a lot of BLOCKED threads are seen because the pool exhausts due to a sudden surge in connection requests. Following this there&apos;s a pattern repeating itself and response times go haywire in our application. The surge / exhaustion is not backed up by a slow database or anything like that, and we have done a whole lot of analysis on our databases (Oracle RAC) and found that service times are around 2-4ms max! I&apos;ve upgraded DBCP to the latest master and commons pool 2.6.1 and still seeing this issue.&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12952966/12952966_image-2018-12-24-08-54-06-625.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13193829">POOL-356</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13567898">DBCP-595</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12934397" name="Screen Shot 2018-08-05 at 10.29.52 AM.png" size="137342" author="agrrwal" created="Sun, 5 Aug 2018 05:06:50 +0000"/>
                            <attachment id="12945208" name="dbcp_lock_1.txt" size="12069" author="struberg" created="Tue, 23 Oct 2018 11:46:13 +0000"/>
                            <attachment id="12945209" name="dbcp_lock_7.txt" size="28072" author="struberg" created="Tue, 23 Oct 2018 11:46:13 +0000"/>
                            <attachment id="12934396" name="dbcpthread.zip" size="25046" author="agrrwal" created="Sun, 5 Aug 2018 05:05:58 +0000"/>
                            <attachment id="12952964" name="image-2018-12-24-08-42-34-611.png" size="86749" author="raoabhishek" created="Mon, 24 Dec 2018 03:12:37 +0000"/>
                            <attachment id="12952965" name="image-2018-12-24-08-45-09-224.png" size="85499" author="raoabhishek" created="Mon, 24 Dec 2018 03:15:11 +0000"/>
                            <attachment id="12952966" name="image-2018-12-24-08-54-06-625.png" size="136022" author="raoabhishek" created="Mon, 24 Dec 2018 03:24:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w2hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-503] org.apache.commons.dbcp2.datasources.InstanceKeyDataSourceFactory.closeAll() does not close all</title>
                <link>https://issues.apache.org/jira/browse/DBCP-503</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;&lt;tt&gt;org.apache.commons.dbcp2.datasources.InstanceKeyDataSourceFactory.closeAll()&lt;/tt&gt; does not close all if an exception is thrown while closing one of the resources.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Closes all pools associated with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; class.
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
     *             a {@link ListException} containing all exceptions thrown by {@link InstanceKeyDataSource#close()}
     * @see InstanceKeyDataSource#close()
     * @see ListException
     * @since 2.4.0 &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; a {@link ListException} instead of, in 2.3.0 and before, the first exception thrown by
     *        {@link InstanceKeyDataSource#close()}.
     */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13165336">DBCP-503</key>
            <summary>org.apache.commons.dbcp2.datasources.InstanceKeyDataSourceFactory.closeAll() does not close all</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jun 2018 14:10:35 +0000</created>
                <updated>Mon, 11 Jun 2018 20:35:53 +0000</updated>
                            <resolved>Mon, 11 Jun 2018 15:06:00 +0000</resolved>
                                                    <fixVersion>2.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16508188" author="garydgregory" created="Mon, 11 Jun 2018 15:06:00 +0000"  >&lt;p&gt;In git master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 20 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3uqbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-493] Upgrade Apache Commons Pool to the version 2.5.1</title>
                <link>https://issues.apache.org/jira/browse/DBCP-493</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;A memory leak was fixed in Apache Commons Pool 2.5.1 (see &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-337&quot; title=&quot;EvictionTimer does not remove cancelled tasks from the executor, leading to an IllegalStateException when the evictor attempts to evict&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-337&quot;&gt;&lt;del&gt;POOL-337&lt;/del&gt;&lt;/a&gt;). This memory leak occurs in Apache Commons DBCP and could be fixed upgrading the version of Apache Commons Pool to v2.5.1&lt;/p&gt;</description>
                <environment></environment>
        <key id="13161322">DBCP-493</key>
            <summary>Upgrade Apache Commons Pool to the version 2.5.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cdeneux">Christophe DENEUX</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 May 2018 07:37:14 +0000</created>
                <updated>Sun, 8 Jul 2018 20:11:42 +0000</updated>
                            <resolved>Sun, 8 Jul 2018 20:11:41 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16486858" author="cdeneux" created="Wed, 23 May 2018 07:39:22 +0000"  >&lt;p&gt;I&apos;ll provide a PR when Apache Commons Pool 2.5.1 will be released.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13134729">POOL-337</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13170649">DBCP-510</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3u1lj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-491] Ensure DBCP ConnectionListener can deal with transaction managers which invoke rollback in a separate thread</title>
                <link>https://issues.apache.org/jira/browse/DBCP-491</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;By using the ManagedDataSource with the &lt;a href=&quot;http://narayana.io&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Narayana&lt;/a&gt;,  the CompletionListener in DBCP is resetting too much of the state of the connection in afterCompletion when it should be waiting until the connection is also closed by the user.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13159930">DBCP-491</key>
            <summary>Ensure DBCP ConnectionListener can deal with transaction managers which invoke rollback in a separate thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zhfeng">Zheng Feng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 May 2018 05:24:29 +0000</created>
                <updated>Sun, 3 Jun 2018 15:52:59 +0000</updated>
                            <resolved>Tue, 29 May 2018 21:06:04 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16482670" author="garydgregory" created="Mon, 21 May 2018 16:14:55 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhfeng&quot; class=&quot;user-hover&quot; rel=&quot;zhfeng&quot;&gt;zhfeng&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Do you plan on providing a PR?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16483635" author="zhfeng" created="Tue, 22 May 2018 08:23:38 +0000"  >&lt;p&gt;yeah, we will raise the PR after releasing the Narayana 5.8.2.Final&lt;/p&gt;</comment>
                            <comment id="16494168" author="garydgregory" created="Tue, 29 May 2018 20:02:33 +0000"  >&lt;p&gt;If I run the unit test &lt;tt&gt;testConnectionInTimeout&lt;/tt&gt; without the main code changes, it passes. Should it not fail? The other tests fail, which I expected (without the main code change.)&lt;/p&gt;</comment>
                            <comment id="16494272" author="garydgregory" created="Tue, 29 May 2018 21:06:04 +0000"  >&lt;p&gt;I applied a modified version of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhfeng&quot; class=&quot;user-hover&quot; rel=&quot;zhfeng&quot;&gt;zhfeng&lt;/a&gt;&apos;s patch. Please verify and close this ticket and associated PR if it works for you. More unit tests would also be welcome to any area.&lt;/p&gt;</comment>
                            <comment id="16499459" author="zhfeng" created="Sun, 3 Jun 2018 15:52:59 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;, it works for me.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13133723">DBCP-484</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/apache/commons-dbcp/pull/12]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ttev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-484] Connection leak during XATransaction in high load</title>
                <link>https://issues.apache.org/jira/browse/DBCP-484</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We&apos;re experiencing a connection leak in a distributed transaction when the system is under heavy load. We&apos;re using commons-dbcp (latest version) + eclipselink and narayana to perform transaction coordination.&lt;/p&gt;

&lt;p&gt;From time to time we can see a stacktrace reporting an abandoned connection. We are trying to figure out what&apos;s the root cause and we think that might be some issue in the commons dbcp (not sure) . More specifically, this parte of the code:&lt;/p&gt;

&lt;p&gt;ManagedConnection#updateTransactionStatus&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionContext != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionContext.isActive()) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionContext != transactionRegistry.getActiveTransactionContext()) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Connection can not be used &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; enlisted in another transaction&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-comment&quot;&gt;// transaction should have been cleared up by TransactionContextListener, but in
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// rare cases another lister could have registered which uses the connection before
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// our listener is called.  In that rare &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, trigger the transaction complete call now
&lt;/span&gt;    transactionComplete();    
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If the&#160;transactionContext is different than null but the state is not &quot;active&quot; (ex:&#160;STATUS_ROLLEDBACK, STATUS_ROLLING_BACK, etc) it executes the&#160;transactionComplete mothod that clears the reference to a shared connection and after that the connection is never closed (returned to the pool).&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If we move the transactionComplete(); to an else,(see below), the connection leak does not happen.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionContext != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionContext.isActive()) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionContext != transactionRegistry.getActiveTransactionContext()) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Connection can not be used &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; enlisted in another transaction&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    transactionComplete();
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After this the&#160;dbcp unit tests still pass but I&apos;m not sure about this changes. Can you please check?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13133723">DBCP-484</key>
            <summary>Connection leak during XATransaction in high load</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ejsfreitas">Emanuel Freitas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Jan 2018 15:48:48 +0000</created>
                <updated>Tue, 8 Jan 2019 20:49:05 +0000</updated>
                            <resolved>Mon, 21 May 2018 14:44:39 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16339444" author="garydgregory" created="Thu, 25 Jan 2018 16:18:11 +0000"  >&lt;p&gt;Hello and thank you for your report.&lt;/p&gt;

&lt;p&gt;Can you make sure you are also bringing in Apache Commons 2.5.0?&lt;/p&gt;

&lt;p&gt;Can you provide a small test case program that reproduces the problem? Preferably in the for a JUnit test case?&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16343701" author="ejsfreitas" created="Mon, 29 Jan 2018 17:50:07 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;, thanks for your fast answer.&lt;/p&gt;

&lt;p&gt;As you asked I&apos;m working on a small test case but without any success yet.&#160;&lt;/p&gt;

&lt;p&gt;Yes, I&apos;m also using Apache Commons 2.5.0&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Emanuel&lt;/p&gt;</comment>
                            <comment id="16343981" author="garydgregory" created="Mon, 29 Jan 2018 20:40:09 +0000"  >&lt;p&gt;OK, let us know when you get that unit test working/failing. Above, I meant Apache Commons POOL 2.5.0 coupled with Apache Commons DBCP 2.2.0.&lt;/p&gt;</comment>
                            <comment id="16346724" author="ejsfreitas" created="Wed, 31 Jan 2018 12:20:18 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;For some reason (JIRA could not attach the file as there was a missing token. Please try attaching the file again.) i&apos;m not able to atach the files.&#160;&lt;/p&gt;

&lt;p&gt;Where is a link to dropbox:&#160;&lt;a href=&quot;https://www.dropbox.com/s/g0oiz2wizmedeqs/dbcp-test.zip?dl=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.dropbox.com/s/g0oiz2wizmedeqs/dbcp-test.zip?dl=0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you run the TeskLeak you can see that if you increase the number of threads (nthreads) you start getting some leaks. On our project I was able to fix the issue with the code that I posted above, but for this test the problem is something else.&#160;&lt;/p&gt;

&lt;p&gt;For this tests I was using a PostgreSQL database.&lt;/p&gt;

&lt;p&gt;Thanks for your help.&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Emanuel&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16369153" author="ejsfreitas" created="Mon, 19 Feb 2018 14:16:07 +0000"  >&lt;p&gt;Hello&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;, did you had the chance to see the test?&#160;&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Emanuel&lt;/p&gt;</comment>
                            <comment id="16390640" author="zhfeng" created="Thu, 8 Mar 2018 02:53:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ejsfreitas&quot; class=&quot;user-hover&quot; rel=&quot;ejsfreitas&quot;&gt;ejsfreitas&lt;/a&gt;, I&apos;m from the narayana team and I&apos;m looking into this test. can you provide the command to run the TestLeak ?&lt;/p&gt;

&lt;p&gt;I just use &quot;mvn clean test&quot; but it looks like can not run the test.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Amos&lt;/p&gt;</comment>
                            <comment id="16410711" author="zhfeng" created="Fri, 23 Mar 2018 02:20:02 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I think there might be a race condition when closing the ManagedConnection&lt;/p&gt;

&lt;p&gt;There are two methods which could call connection.close() and the one is in &lt;a href=&quot;https://github.com/apache/commons-dbcp/blob/master/src/main/java/org/apache/commons/dbcp2/managed/ManagedConnection.java#L160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ManagedConnection.close()&lt;/a&gt; and the other is &lt;a href=&quot;https://github.com/apache/commons-dbcp/blob/master/src/main/java/org/apache/commons/dbcp2/managed/ManagedConnection.java#L188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ManagedConncetion.transactionComplete()&lt;/a&gt; which is used in calling back when the transaction is completed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isClosedInternal()) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// Don&apos;t actually close the connection &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; in a transaction. The
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// connection will be closed by the transactionComplete method.
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionContext == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.close();
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                setClosedInternal(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The thread of close() could be switched after check (transactionContext == null) and before the setCloseInternal(true). So it thinks it is still in a transaction but dose not set the _closed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void transactionComplete() {
        transactionContext = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

        &lt;span class=&quot;code-comment&quot;&gt;// If we were using a shared connection, clear the reference now that
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// the transaction has completed
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isSharedConnection) {
            setDelegate(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
            isSharedConnection = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }

        &lt;span class=&quot;code-comment&quot;&gt;// If &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; connection was closed during the transaction and there is
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// still a delegate present close it
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Connection delegate = getDelegateInternal();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isClosedInternal() &amp;amp;&amp;amp; delegate != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                setDelegate(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!delegate.isClosed()) {
                    delegate.close();
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SQLException ignored) {
                &lt;span class=&quot;code-comment&quot;&gt;// Not a whole lot we can &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; here as connection is closed
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// and &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a transaction callback so there is no
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// way to report the error.
&lt;/span&gt;            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The thread of transationComplete() should check isClosedInternal() which is still false. So it will not close the connection. And the connection.close() is missed both in close() and transactionComplete(). I think it could be one cause of the connection leaking.&lt;/p&gt;</comment>
                            <comment id="16416323" author="garydgregory" created="Tue, 27 Mar 2018 22:11:19 +0000"  >&lt;p&gt;I attached the zip file from &lt;a href=&quot;https://www.dropbox.com/s/g0oiz2wizmedeqs/dbcp-test.zip?dl=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.dropbox.com/s/g0oiz2wizmedeqs/dbcp-test.zip?dl=0&lt;/a&gt; to this ticket.&lt;/p&gt;</comment>
                            <comment id="16416993" author="zhfeng" created="Wed, 28 Mar 2018 07:49:44 +0000"  >&lt;p&gt;I just opened &lt;a href=&quot;https://github.com/apache/commons-dbcp/pull/10&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/pull/10&lt;/a&gt; for fixing this issue.&lt;/p&gt;</comment>
                            <comment id="16419046" author="garydgregory" created="Thu, 29 Mar 2018 14:04:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhfeng&quot; class=&quot;user-hover&quot; rel=&quot;zhfeng&quot;&gt;zhfeng&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Thank you for your PR!&#160;&lt;/p&gt;

&lt;p&gt;Do you think you could augment your PR with a unit test that fails unless the &lt;tt&gt;main&lt;/tt&gt; portion of the patch is applied?&lt;/p&gt;

&lt;p&gt;Thank you,&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16420264" author="zhfeng" created="Fri, 30 Mar 2018 07:56:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;, I think we can add a test to simulate the race condition with the &lt;a href=&quot;https://byteman.jboss.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Byteman&lt;/a&gt; tool which is licensed by the LGPL.&lt;br/&gt;
I&apos;m not sure this could be used in the apache project ?&lt;/p&gt;</comment>
                            <comment id="16421043" author="garydgregory" created="Fri, 30 Mar 2018 22:58:52 +0000"  >&lt;p&gt;Good question.&#160;IANAL, but it looks like a no: &lt;a href=&quot;https://www.apache.org/legal/resolved.html:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/legal/resolved.html:&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;GNU LGPLThe LGPL is ineligible primarily due to the restrictions it places on larger works, violating the third license criterion.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;More:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.apache.org/licenses/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/&lt;/a&gt;&lt;br/&gt;
-&#160;&lt;a href=&quot;https://www.apache.org/foundation/license-faq.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/foundation/license-faq.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16431873" author="zhfeng" created="Tue, 10 Apr 2018 07:47:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;, it looks like that the ActiveMQ already uses the byteman in their tests&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. So I think it could be OK to just include the byteman as the testsing purpose.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/activemq-artemis/blob/master/tests/extra-tests/pom.xml#L46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq-artemis/blob/master/tests/extra-tests/pom.xml#L46&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16434549" author="garydgregory" created="Wed, 11 Apr 2018 20:41:16 +0000"  >&lt;p&gt;Nice find in Apache MQ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhfeng&quot; class=&quot;user-hover&quot; rel=&quot;zhfeng&quot;&gt;zhfeng&lt;/a&gt;!&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m curious if anyone in our community has any thoughts here? Because Apache MQ uses it in their tests does not make it right, but I would hope that they&apos;ve validated this dependency...&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16435211" author="martyntaylor" created="Thu, 12 Apr 2018 09:06:50 +0000"  >&lt;p&gt;It&apos;s a question of whether or not the LGPL licensed dependency is distributed as part of the Apache project.&#160; Build time dependencies are OK&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&#160; The licensing documentation is not explicit about test dependencies.&#160; In ActiveMQ Artemis we don&apos;t distribute tests and don&apos;t redistribute Byteman.&#160; As a precautionary measure, we&#160;disable by default tests that pull down libraries with prohibited licenses.&#160; TBH I don&apos;t believe this is necessary.&#160; If you&apos;re still unsure I would fire an email off to Apache security to verify.&lt;/p&gt;

&lt;p&gt;1.&#160;&lt;a href=&quot;https://www.apache.org/legal/resolved.html#prohibited&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/legal/resolved.html#prohibited&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16476664" author="zhfeng" created="Wed, 16 May 2018 00:47:03 +0000"  >&lt;p&gt;There could be an issue with the Narayana related to the afterCompletion and I think we have fixed in &lt;a href=&quot;https://issues.jboss.org/browse/JBTM-3021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JBTM-3021&lt;/a&gt; which should be include in the Narayan 5.8.2.Final&lt;/p&gt;</comment>
                            <comment id="16481976" author="garydgregory" created="Sun, 20 May 2018 15:08:45 +0000"  >&lt;p&gt;Hm... where are we on this?&lt;/p&gt;</comment>
                            <comment id="16482218" author="zhfeng" created="Mon, 21 May 2018 06:06:20 +0000"  >&lt;p&gt;The Narayana dependency is in the dbcp-test. I have verified the TestLeak.java works fine with the fix of JBTM-3021. And we will release the Narayana 5.8.2.Final soon I hope in this week. So I would suggest to close this issue as &quot;Migrated to other ITS&quot; and mark with JBTM-3021&lt;/p&gt;</comment>
                            <comment id="16482220" author="zhfeng" created="Mon, 21 May 2018 06:08:51 +0000"  >&lt;p&gt;Also we have worked with more tests by using the Narayana and the DBCP2 and will raise the PR for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-491&quot; title=&quot;Ensure DBCP ConnectionListener can deal with transaction managers which invoke rollback in a separate thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-491&quot;&gt;&lt;del&gt;DBCP-491&lt;/del&gt;&lt;/a&gt; after we release 5.8.2.Final of Narayana&lt;/p&gt;</comment>
                            <comment id="16482296" author="markt" created="Mon, 21 May 2018 08:32:19 +0000"  >&lt;p&gt;A reliable unit test for a race condition is always going to be tricky. The patch looks good to me. I&apos;ve commented on the PR.&lt;/p&gt;</comment>
                            <comment id="16482570" author="garydgregory" created="Mon, 21 May 2018 14:44:39 +0000"  >&lt;p&gt;PR applied. Please verify and close this ticket and associated PR.&lt;/p&gt;</comment>
                            <comment id="16737421" author="ddillard" created="Tue, 8 Jan 2019 18:58:52 +0000"  >&lt;p&gt;I know this fix has been out a while, but any chance of getting a CVE for this?&lt;/p&gt;</comment>
                            <comment id="16737468" author="garydgregory" created="Tue, 8 Jan 2019 20:03:53 +0000"  >&lt;p&gt;I would not think this requires a CVE. What do others think?&lt;/p&gt;</comment>
                            <comment id="16737480" author="ddillard" created="Tue, 8 Jan 2019 20:13:06 +0000"  >&lt;p&gt;To be clear, the reason I asked about a CVE is that a resource leak can lead to a denial of service.&lt;/p&gt;</comment>
                            <comment id="16737505" author="garydgregory" created="Tue, 8 Jan 2019 20:43:08 +0000"  >&lt;p&gt;Hm...  OK. Let&apos;s see if we get a volunteer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16737508" author="markt" created="Tue, 8 Jan 2019 20:49:05 +0000"  >&lt;p&gt;I don&apos;t think this meets the bar for a CVE.&lt;/p&gt;

&lt;p&gt;It can&apos;t be reliably triggered by a remote user. The bug appears to be rare enough that a malicious user isn&apos;t going to be able to exhaust server resources with this. Also, the abandoned connection clean-up releases the leaked resource.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13159930">DBCP-491</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12916479" name="dbcp-test.zip" size="12852" author="ggregory" created="Tue, 27 Mar 2018 22:10:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/apache/commons-dbcp/pull/10]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pd33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-477] Documentation out of date and confusing</title>
                <link>https://issues.apache.org/jira/browse/DBCP-477</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The DBCP package description page (&lt;a href=&quot;https://commons.apache.org/proper/commons-dbcp/apidocs/org/apache/commons/dbcp2/package-summary.html#package_description&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://commons.apache.org/proper/commons-dbcp/apidocs/org/apache/commons/dbcp2/package-summary.html#package_description&lt;/a&gt;) is referred to from the Overview page&lt;br/&gt;
as containing important information on usage of the package.&lt;/p&gt;

&lt;p&gt;The following sample code is provided there:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;GenericObjectPool connectionPool = new GenericObjectPool(null);
ConnectionFactory connectionFactory = new DriverManagerConnectionFactory(&quot;jdbc:some:connect:string&quot;, &quot;username&quot;, &quot;password&quot;);
PoolableConnectionFactory poolableConnectionFactory = new PoolableConnectionFactory(connectionFactory,connectionPool,null,null,false,true);
PoolingDataSource dataSource = new PoolingDataSource(connectionPool);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is out of date:  the six argument constructor for PoolableConnectionFactory has been removed.  Additionally, even if the correct constructor is used, nothing connects the PortableConnectionFactory created on the third line with the pool.&lt;/p&gt;

&lt;p&gt;There is a much better sample at &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=commons-dbcp.git;a=blob;f=doc/PoolingDataSourceExample.java;h=2a12c74898930b9623223db1597b8a8052a6f1df;hb=56deeaf5ccbbee5081dbcce374685f4399d71bd5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=commons-dbcp.git;a=blob;f=doc/PoolingDataSourceExample.java;h=2a12c74898930b9623223db1597b8a8052a6f1df;hb=56deeaf5ccbbee5081dbcce374685f4399d71bd5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However this should be accessible from any of several &quot;examples&quot; links on the site, all of which are broken.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13091402">DBCP-477</key>
            <summary>Documentation out of date and confusing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="scohen@apache.org">Steve Cohen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Jul 2017 23:27:19 +0000</created>
                <updated>Thu, 29 Feb 2024 19:39:51 +0000</updated>
                            <resolved>Thu, 29 Feb 2024 19:39:51 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16108227" author="garydgregory" created="Tue, 1 Aug 2017 00:57:33 +0000"  >&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;Would you mind providing a PR (&lt;a href=&quot;https://github.com/apache/commons-dbcp&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp&lt;/a&gt;) or patch to fix this?&lt;/p&gt;

&lt;p&gt;Thank you!&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i8of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-476] AbandonedTrace.getTrace() contains race condition</title>
                <link>https://issues.apache.org/jira/browse/DBCP-476</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The clean up code in AbandonedTrace is subject to the reference being cleared in between the condition being checked and the referent being added to the result.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (iter.hasNext()) {
                WeakReference&amp;lt;AbandonedTrace&amp;gt; ref = iter.next();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ref.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-comment&quot;&gt;// Clean-up since we are here anyway
&lt;/span&gt;                    iter.remove();
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    result.add(ref.get());
                }
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This can surface as a NullPointerException, e.g.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.NullPointerException
	at org.apache.tomcat.dbcp.dbcp2.DelegatingStatement.close(DelegatingStatement.java:149)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13066942">DBCP-476</key>
            <summary>AbandonedTrace.getTrace() contains race condition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pascalschumacher">Pascal Schumacher</assignee>
                                    <reporter username="rcordova">Richard Cordova</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Apr 2017 05:51:47 +0000</created>
                <updated>Mon, 7 May 2018 18:46:21 +0000</updated>
                            <resolved>Mon, 7 May 2018 18:46:21 +0000</resolved>
                                                    <fixVersion>2.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15984216" author="rcordova" created="Wed, 26 Apr 2017 05:53:20 +0000"  >&lt;p&gt;Suggested (untested) fix:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (iter.hasNext()) {
                AbandonedTrace trace = iter.next().get();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (trace == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-comment&quot;&gt;// Clean-up since we are here anyway
&lt;/span&gt;                    iter.remove();
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    result.add(trace);
                }
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15990513" author="gevesson" created="Sun, 30 Apr 2017 23:52:57 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/commons-dbcp/pull/7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/pull/7&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3e41j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-475] Undefined MBean attribute of BasicDataSourceMXBean</title>
                <link>https://issues.apache.org/jira/browse/DBCP-475</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;BasicDataSourceMXBean does not define methods for the following attributes.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testOnReturn&lt;/li&gt;
	&lt;li&gt;evictionPolicyClassName&lt;/li&gt;
	&lt;li&gt;rollbackOnReturn&lt;/li&gt;
	&lt;li&gt;enableAutoCommitOnReturn&lt;/li&gt;
	&lt;li&gt;defaultQueryTimeout&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve implemented the get method of these attributes in BasicDataSourceMXBean.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13022071">DBCP-475</key>
            <summary>Undefined MBean attribute of BasicDataSourceMXBean</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="KeiichiFujino">KeiichiFujino</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Nov 2016 02:36:40 +0000</created>
                <updated>Mon, 31 May 2021 14:57:54 +0000</updated>
                                            <version>2.1.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16556798" author="garydgregory" created="Thu, 26 Jul 2018 02:26:58 +0000"  >&lt;p&gt;Thank you for your patches. Would you please mind providing these again on top of our current git master, preferably as a PR and with unit tests?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12839742" name="BasicDataSource.patch" size="1490" author="KeiichiFujino" created="Mon, 21 Nov 2016 02:37:08 +0000"/>
                            <attachment id="12839743" name="BasicDataSourceMXBean.patch" size="1973" author="KeiichiFujino" created="Mon, 21 Nov 2016 02:37:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36k53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-474] Prepared or Callable Statement are not cached in PoolingConnection.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-474</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In PoolingConnection, the following methods are not defined.&lt;br/&gt;
-prepareStatement(String sql, int[] columnIndexes) &lt;br/&gt;
-prepareStatement(String sql, int resultSetType, int resultSetConcurrency, int resultSetHoldability) &lt;br/&gt;
-prepareStatement(String sql, String[] columnNames) &lt;br/&gt;
-prepareCall(String sql, int resultSetType, int resultSetConcurrency, int resultSetHoldability) &lt;br/&gt;
Therefore, when calling these methods, we can not cache statements.&lt;/p&gt;

&lt;p&gt;I fixed PoolingConnection and PStmtKey in order to cache all of Prepared and Callable Statement.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13018783">DBCP-474</key>
            <summary>Prepared or Callable Statement are not cached in PoolingConnection.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="KeiichiFujino">KeiichiFujino</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Nov 2016 09:16:17 +0000</created>
                <updated>Tue, 8 Nov 2016 15:14:54 +0000</updated>
                            <resolved>Tue, 8 Nov 2016 15:14:53 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15647809" author="markt" created="Tue, 8 Nov 2016 15:14:53 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12837719" name="Fixed-PoolingConnection-and-PStmtKey.patch" size="29095" author="KeiichiFujino" created="Mon, 7 Nov 2016 09:17:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35zuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-472] infinite loop in PoolableConnection.isDisconnectionSqlException</title>
                <link>https://issues.apache.org/jira/browse/DBCP-472</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;There is an infinite loop in PoolableConnection.isDisconnectionSqlException.  If e.getNextException() == e, which happens to be the case for me (I&apos;m mybatis).  I think there should be a check around line 329 to see if e == e.getNextException() and if so, stop recursing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13017232">DBCP-472</key>
            <summary>infinite loop in PoolableConnection.isDisconnectionSqlException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tonyschwartz">Tony Schwartz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Nov 2016 13:33:24 +0000</created>
                <updated>Wed, 2 Nov 2016 23:19:42 +0000</updated>
                            <resolved>Wed, 2 Nov 2016 21:37:52 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15630536" author="markt" created="Wed, 2 Nov 2016 21:10:43 +0000"  >&lt;p&gt;If e.getNextException() == e is true then I&apos;d argue that the bug is in whatever code generated that Exception. That said, it would be sensible to protect DBCP against it.&lt;/p&gt;</comment>
                            <comment id="15630573" author="tonyschwartz" created="Wed, 2 Nov 2016 21:20:41 +0000"  >&lt;p&gt;agreed, &#160;but in addition to that check, &#160;i generally add logic to limit the recursive calls. &#160; there could be a circle for example. &#160; maybe a loop counter (or recursion counter) and stop at a thousand would do the trick.&lt;/p&gt;


&lt;p&gt;Sent from my Verizon, Samsung Galaxy smartphone&lt;br/&gt;
-------- Original message --------From: &quot;Mark Thomas (JIRA)&quot; &amp;lt;jira@apache.org&amp;gt; Date: 11/2/16  17:10  (GMT-05:00) To: tony@xfire.io Subject: &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Commented&amp;#93;&lt;/span&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-472&quot; title=&quot;infinite loop in PoolableConnection.isDisconnectionSqlException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-472&quot;&gt;&lt;del&gt;DBCP-472&lt;/del&gt;&lt;/a&gt;) infinite loop in&lt;br/&gt;
&#160; PoolableConnection.isDisconnectionSqlException &lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160; [ &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-472?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=15630536#comment-15630536&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-472?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=15630536#comment-15630536&lt;/a&gt; ] &lt;/p&gt;

&lt;p&gt;Mark Thomas commented on &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-472&quot; title=&quot;infinite loop in PoolableConnection.isDisconnectionSqlException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-472&quot;&gt;&lt;del&gt;DBCP-472&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
----------------------------------&lt;/p&gt;

&lt;p&gt;If e.getNextException() == e is true then I&apos;d argue that the bug is in whatever code generated that Exception. That said, it would be sensible to protect DBCP against it.&lt;/p&gt;




&lt;p&gt;&amp;#8211;&lt;br/&gt;
This message was sent by Atlassian JIRA&lt;br/&gt;
(v6.3.4#6332)&lt;/p&gt;</comment>
                            <comment id="15630615" author="markt" created="Wed, 2 Nov 2016 21:37:54 +0000"  >&lt;p&gt;I&apos;ve added the basic check. We can expand it if necessary but my preference is for keeping the code as simple.&lt;/p&gt;</comment>
                            <comment id="15630866" author="garydgregory" created="Wed, 2 Nov 2016 23:19:42 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35q9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-471] Cannot use connectionInitSqls property in BasicDataSource</title>
                <link>https://issues.apache.org/jira/browse/DBCP-471</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Error : &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: org.springframework.beans.NotWritablePropertyException: Invalid property &lt;span class=&quot;code-quote&quot;&gt;&apos;connectionInitSqls&apos;&lt;/span&gt; of bean class [org.apache.commons.dbcp2.BasicDataSource]: Bean property &lt;span class=&quot;code-quote&quot;&gt;&apos;connectionInitSqls&apos;&lt;/span&gt; is not writable or has an invalid setter method. Does the parameter type of the setter match the &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type of the getter?
	at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:1042)
	at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:902)
	at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:75)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Configuration : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp2.BasicDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${database.driverClassName}&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${database.url}&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${database.username}&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${database.password}&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;connectionInitSqls&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;list&amp;gt;
    	&amp;lt;value&amp;gt;Select 1 from dual;&amp;lt;/value&amp;gt;
    &amp;lt;/list&amp;gt;
    &amp;lt;/property&amp;gt;
  &amp;lt;/bean&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similar issue for another bean : &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-469&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-469&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The property is listed as a List&amp;lt;String&amp;gt;, has a getter which returns a List&amp;lt;String&amp;gt; but has a setter which takes a Collection&amp;lt;String&amp;gt; &lt;br/&gt;
This is also not in line with what was in versions before 2 (dbcp.BasicDataSource)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13014624">DBCP-471</key>
            <summary>Cannot use connectionInitSqls property in BasicDataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="happybuddha">happybuddha</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Oct 2016 04:05:00 +0000</created>
                <updated>Thu, 27 Oct 2016 10:52:05 +0000</updated>
                            <resolved>Thu, 27 Oct 2016 09:57:53 +0000</resolved>
                                    <version>2.1.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15610090" author="kinow" created="Wed, 26 Oct 2016 23:56:26 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I successfully reproduced the issue with:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Create a simple Maven project&lt;/li&gt;
	&lt;li&gt;Add the following dependencies: org.apache.commons:commons-dbcp2:2.1.1, and org.springframework:spring-core:3.2.4.RELEASE, and org.springframework:spring-context:3.2.4.RELEASE&lt;/li&gt;
	&lt;li&gt;Copy the XML with bean definition provided in this issue, as something like spring.xml in the src/main/resources&lt;/li&gt;
	&lt;li&gt;And then finally create a class with code similar to the following&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; test;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.BasicDataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.springframework.context.ApplicationContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.springframework.context.support.ClassPathXmlApplicationContext;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;App {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        ApplicationContext ctx = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassPathXmlApplicationContext(&lt;span class=&quot;code-quote&quot;&gt;&quot;spring.xml&quot;&lt;/span&gt;);
        BasicDataSource ds = (BasicDataSource) ctx.getBean(&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(ds.getUrl());
        ((ClassPathXmlApplicationContext) ctx).close();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;OK!&quot;&lt;/span&gt;);
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running this code, instead of getting the DataSource URL, followed by OK!, you will get the following stack trace:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Oct 27, 2016 12:49:13 PM org.springframework.context.support.ClassPathXmlApplicationContext prepareRefresh
INFO: Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@c4437c4: startup date [Thu Oct 27 12:49:13 NZDT 2016]; root of context hierarchy
Oct 27, 2016 12:49:13 PM org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions
INFO: Loading XML bean definitions from class path resource [spring.xml]
Oct 27, 2016 12:49:13 PM org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletons
INFO: Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@49e4cb85: defining beans [dataSource]; root of factory hierarchy
Oct 27, 2016 12:49:13 PM org.springframework.beans.factory.support.DefaultListableBeanFactory destroySingletons
INFO: Destroying singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@49e4cb85: defining beans [dataSource]; root of factory hierarchy
Exception in thread &quot;main&quot; org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;dataSource&apos; defined in class path resource [spring.xml]: Error setting property values; nested exception is org.springframework.beans.NotWritablePropertyException: Invalid property &apos;connectionInitSqls&apos; of bean class [org.apache.commons.dbcp2.BasicDataSource]: Bean property &apos;connectionInitSqls&apos; is not writable or has an invalid setter method. Does the parameter type of the setter match the return type of the getter?
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1423)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1128)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:458)
	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:295)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:223)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:292)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:194)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:628)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:932)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:479)
	at org.springframework.context.support.ClassPathXmlApplicationContext.&amp;lt;init&amp;gt;(ClassPathXmlApplicationContext.java:139)
	at org.springframework.context.support.ClassPathXmlApplicationContext.&amp;lt;init&amp;gt;(ClassPathXmlApplicationContext.java:83)
	at test.App.main(App.java:10)
Caused by: org.springframework.beans.NotWritablePropertyException: Invalid property &apos;connectionInitSqls&apos; of bean class [org.apache.commons.dbcp2.BasicDataSource]: Bean property &apos;connectionInitSqls&apos; is not writable or has an invalid setter method. Does the parameter type of the setter match the return type of the getter?
	at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:1042)
	at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:902)
	at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:75)
	at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:57)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1420)
	... 13 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, I believe this was fixed in &lt;a href=&quot;https://jira.spring.io/browse/SPR-10995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SPR-10995&lt;/a&gt;, released in Spring 3.2.5.RELEASE. If you update your pom.xml, to use 3.2.5, the issue is gone, and you see the right output.&lt;/p&gt;

&lt;p&gt;Further issues included in &lt;a href=&quot;http://docs.spring.io/spring/docs/3.2.5.RELEASE/changelog.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.2.5 changelog&lt;/a&gt;, which was released in 2013-11-06.&lt;/p&gt;

&lt;p&gt;The issue is not really related to Commons Dbcp, but to dependency injection libraries. And if you use the latest stable versions (4.3.3.RELEASE from 2016-09-20 or 3.2.17.RELEASE from 2016-05-06) you won&apos;t have this problem.&lt;/p&gt;</comment>
                            <comment id="15610151" author="happybuddha" created="Thu, 27 Oct 2016 00:24:17 +0000"  >&lt;p&gt;Thanks for your comment. What would someone who cannot move from spring&apos;s 3.2.4-RELEASE do ?&lt;/p&gt;</comment>
                            <comment id="15610216" author="kinow" created="Thu, 27 Oct 2016 00:54:21 +0000"  >&lt;p&gt;Perhaps you could wrap the datasource object, and in the wrapper object you would return List&amp;lt;String&amp;gt; and set with List&amp;lt;String&amp;gt; too. Or use an older version of commons-dbcp if that works; though I would suggest the former option, if you really can&apos;t upgrade Spring.&lt;/p&gt;

&lt;p&gt;But note too, that there are security fixes at 3.2.15. 3.2.9 and other releases after 3.2.4. Even if that fixes your problem, your application would still be vulnerable to other issues &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15611397" author="kinow" created="Thu, 27 Oct 2016 09:57:53 +0000"  >&lt;p&gt;Marking the issue as Not A Problem.&lt;/p&gt;

&lt;p&gt;The issue happens in the other library (Spring in this case), not really in Commons Dbcp.&lt;/p&gt;

&lt;p&gt;Having symmetrical getter and setter types could be discussed, but having some arguments, and use cases would be helpful.&lt;/p&gt;

&lt;p&gt;The issue can be solved using any recent release, either 4.x or 3.x. Or it can also be solved wrapping the Commons Dbcp with another class, like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.BasicDataSource;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyBasicDataSource &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; BasicDataSource {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; getConnectionInitSqls() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getConnectionInitSqls();
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setConnectionInitSqls(List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; arg0) {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.setConnectionInitSqls(arg0);
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then just update the bean to use this class instead of BasicDataSource.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12999521">DBCP-469</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12999521">DBCP-469</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35a7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-470] Create a new BasicDataSource, the database hasn&apos;t start, the DBCP&apos;s pool will be leaked</title>
                <link>https://issues.apache.org/jira/browse/DBCP-470</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;First the database hasn&apos;t start, then create a new BasicDataSource.  The method createDataSource judge dataSource == null, will create a new dataSource. The first step is create a connectionPool, second create a connectionFactory, but validateConnectionFactory will throw a SQLNestedException, the dataSource will be null again. Next itme repeat the steps again and again. The most import issue is create the connectionPool will be refered by a java.lang.Timer, so it can&apos;t be collected by GC. If the minIdle is positive, when database status is ok, it will create connection also.&lt;br/&gt;
As a word, the bug will cause memory leak and may cause connection leak.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All environment&lt;/p&gt;</environment>
        <key id="12999884">DBCP-470</key>
            <summary>Create a new BasicDataSource, the database hasn&apos;t start, the DBCP&apos;s pool will be leaked</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jeho0815">jeho0815</reporter>
                        <labels>
                            <label>robustness</label>
                            <label>security</label>
                    </labels>
                <created>Thu, 25 Aug 2016 02:14:51 +0000</created>
                <updated>Mon, 30 Jan 2023 23:44:43 +0000</updated>
                            <resolved>Mon, 30 Jan 2023 23:44:43 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="15436144" author="jeho0815" created="Thu, 25 Aug 2016 02:27:35 +0000"  >&lt;p&gt;Class Name	Shallow Heap	Retained Heap&lt;br/&gt;
org.apache.commons.dbcp.PoolableConnection @ 0xad601d30	48	128&lt;br/&gt;
org.apache.commons.dbcp.PoolableConnection @ 0xad5f8110	48	128&lt;br/&gt;
org.apache.commons.dbcp.PoolableConnection @ 0xad5f2f40	48	128&lt;br/&gt;
org.apache.commons.dbcp.PoolableConnection @ 0xad5e0d00	48	128&lt;br/&gt;
there are 512 connections leak, if the server wait timeout is long, may cause denie of service!&lt;/p&gt;</comment>
                            <comment id="15436149" author="jeho0815" created="Thu, 25 Aug 2016 02:31:30 +0000"  >&lt;p&gt;has two solutions:&lt;br/&gt;
1&#12289;if validate connectionFactory failed, close the pool&lt;br/&gt;
2&#12289;Such as dbcp2&#65292; change the order&#65292;first create the factory, then create the pool&#12290;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32rh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-469] getter/setter for connectionInitSqls have different types</title>
                <link>https://issues.apache.org/jira/browse/DBCP-469</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Using blueprint to setup BasicManagedDatasource fails because  getter/setter for connectionInitSqls have different types. &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;csi-ds-derby-embedded (281)
---------------------------
Status: Failure
Blueprint
23.08.16 13:22
Exception:
Error setting property: PropertyDescriptor &amp;lt;name: connectionInitSqls, getter: class org.apache.commons.dbcp2.BasicDataSource.getConnectionInitSqls(), setter: [class org.apache.commons.dbcp2.BasicDataSource.setConnectionInitSqls(interface java.util.Collection)]
org.osgi.service.blueprint.container.ComponentDefinitionException: Error setting property: PropertyDescriptor &amp;lt;name: connectionInitSqls, getter: class org.apache.commons.dbcp2.BasicDataSource.getConnectionInitSqls(), setter: [class org.apache.commons.dbcp2.BasicDataSource.setConnectionInitSqls(interface java.util.Collection)]
        at org.apache.aries.blueprint.container.BeanRecipe.setProperty(BeanRecipe.java:939)
        at org.apache.aries.blueprint.container.BeanRecipe.setProperties(BeanRecipe.java:905)
        at org.apache.aries.blueprint.container.BeanRecipe.setProperties(BeanRecipe.java:886)
        at org.apache.aries.blueprint.container.BeanRecipe.internalCreate2(BeanRecipe.java:820)
        at org.apache.aries.blueprint.container.BeanRecipe.internalCreate(BeanRecipe.java:787)
        at org.apache.aries.blueprint.di.AbstractRecipe$1.call(AbstractRecipe.java:79)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at org.apache.aries.blueprint.di.AbstractRecipe.create(AbstractRecipe.java:88)
        at org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:247)
        at org.apache.aries.blueprint.container.BlueprintRepository.createAll(BlueprintRepository.java:183)
        at org.apache.aries.blueprint.container.BlueprintContainerImpl.instantiateEagerComponents(BlueprintContainerImpl.java:682)
        at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:377)
        at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:269)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at org.apache.aries.blueprint.container.ExecutorServiceWrapper.run(ExecutorServiceWrapper.java:106)
        at org.apache.aries.blueprint.utils.threading.impl.DiscardableRunnable.run(DiscardableRunnable.java:48)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:744)
Caused by: org.osgi.service.blueprint.container.ComponentDefinitionException: At least one Setter method has to match the type of the Getter method for property connectionInitSqls
        at org.apache.aries.blueprint.utils.ReflectionUtils$MethodPropertyDescriptor.findMethodByClass(ReflectionUtils.java:708)
        at org.apache.aries.blueprint.utils.ReflectionUtils$MethodPropertyDescriptor.findSetter(ReflectionUtils.java:687)
        at org.apache.aries.blueprint.utils.ReflectionUtils$MethodPropertyDescriptor.internalSet(ReflectionUtils.java:627)
        at org.apache.aries.blueprint.utils.ReflectionUtils$PropertyDescriptor.set(ReflectionUtils.java:380)
        at org.apache.aries.blueprint.container.BeanRecipe.setProperty(BeanRecipe.java:937)
        ... 23 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;blueprint fragment used:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp2.managed.BasicManagedDataSource&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;transactionManager&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;jtaTransactionManager&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:derby:${db.location}/csids;create=true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxTotal&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${db.connectionPoolMaxActive}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${db.connectionPoolMaxIdle}&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${db.connectionPoolMaxIdle}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;connectionInitSqls&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;list&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;set isolation READ COMMITTED&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/list&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;karaf 3.0.6, datasource configured via blueprint.&lt;/p&gt;</environment>
        <key id="12999521">DBCP-469</key>
            <summary>getter/setter for connectionInitSqls have different types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="jkleemann">Jens Kleemann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Aug 2016 06:53:43 +0000</created>
                <updated>Thu, 27 Oct 2016 10:52:04 +0000</updated>
                            <resolved>Thu, 27 Oct 2016 10:52:04 +0000</resolved>
                                    <version>2.1</version>
                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15611518" author="kinow" created="Thu, 27 Oct 2016 10:52:04 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-471&quot; title=&quot;Cannot use connectionInitSqls property in BasicDataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-471&quot;&gt;&lt;del&gt;DBCP-471&lt;/del&gt;&lt;/a&gt;. The only difference is that in this case we have Apache Aries Blueprint, and not Spring. In this case, would be good to find a way to fix the issue in Blueprint.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13014624">DBCP-471</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13014624">DBCP-471</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32p8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-468] Hardcoded value false for fastFailValidation on constructor</title>
                <link>https://issues.apache.org/jira/browse/DBCP-468</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Debugging my code, i Found that fastFailValidation is always false because of this Constructor:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp2.PoolableConnection&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
    *
    * @param conn my underlying connection
    * @param pool the pool to which I should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; when closed
    * @param jmxName JMX name
    */
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; PoolableConnection(Connection conn,
           ObjectPool&amp;lt;PoolableConnection&amp;gt; pool, ObjectName jmxName) {
       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(conn, pool, jmxName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that 4th and 5th params are for fastFailValidation. It will always be false. (and null for sql codes)&lt;/p&gt;

&lt;p&gt;My Pool definition (spring):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp2.managed.BasicManagedDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;transactionManager&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;jbossTransactionManager&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;xxx&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;xxx&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;xxx&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;xxx&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;defaultAutoCommit&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxTotal&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxWaitMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;5000&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testOnBorrow&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testOnReturn&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fastFailValidation&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;validationQuery&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;select 1 go&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12994644">DBCP-468</key>
            <summary>Hardcoded value false for fastFailValidation on constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lagar84">Euclides M</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Aug 2016 17:34:12 +0000</created>
                <updated>Wed, 2 Nov 2016 21:42:36 +0000</updated>
                            <resolved>Wed, 2 Nov 2016 21:42:36 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15630627" author="markt" created="Wed, 2 Nov 2016 21:42:36 +0000"  >&lt;p&gt;Thanks for the report.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31v5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-465] OSGi import-package has repeated packages causing a runtime failure</title>
                <link>https://issues.apache.org/jira/browse/DBCP-465</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Building from trunk or 2.2rc1, here&apos;s the import-package manifest:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Import-Package: javax.management,javax.naming,javax.naming.spi,javax.s
 ql,javax.transaction,javax.transaction.xa,org.apache.commons.logging,
 org.apache.commons.pool2,org.apache.commons.pool2.impl,javax.transact
 ion;version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.1.0&quot;&lt;/span&gt;,javax.transaction.xa;version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.1.0&quot;&lt;/span&gt;;partial=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
 ;mandatory:=partial
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As can be seen, the JTA packages are being imported twice. This is causing a runtime failure in Karaf on startup of this bundle.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Karaf 3.0.4, Java 8, DBCP 2.2 rc1&lt;/p&gt;</environment>
        <key id="12994340">DBCP-465</key>
            <summary>OSGi import-package has repeated packages causing a runtime failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mattsicker">Matt Sicker</assignee>
                                    <reporter username="mattsicker">Matt Sicker</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Aug 2016 16:50:06 +0000</created>
                <updated>Tue, 2 Aug 2016 18:33:35 +0000</updated>
                            <resolved>Tue, 2 Aug 2016 18:33:34 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15404385" author="jvz" created="Tue, 2 Aug 2016 16:59:08 +0000"  >&lt;p&gt;It appears the issue was because of where the &lt;tt&gt;*&lt;/tt&gt; was located in the &lt;tt&gt;Import-Package&lt;/tt&gt; instruction in the pom. Putting it at the end generate the correct manifest. I&apos;d like to add a unit test, though, and that&apos;s less trivial.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12946952">DBCP-454</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31t9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-464] managed shared connections can lead to a NPE on close</title>
                <link>https://issues.apache.org/jira/browse/DBCP-464</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;in CompletionListener the delegate will be set to false but the connection will not be closed so when calling close later and if the connection exited a transaction context then it will try to close it and lead to a NPE&lt;/p&gt;

&lt;p&gt;Here my workaround:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; DataSource createDataSourceInstance() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TransactionRegistry transactionRegistry = getTransactionRegistry();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transactionRegistry == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;TransactionRegistry has not been set&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getConnectionPool() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Pool has not been set&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PoolingDataSource&amp;lt;PoolableConnection&amp;gt; pds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ManagedDataSource&amp;lt;PoolableConnection&amp;gt;(getConnectionPool(), transactionRegistry) {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Connection getConnection() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ManagedConnection&amp;lt;PoolableConnection&amp;gt;(getPool(), transactionRegistry, isAccessToUnderlyingConnectionAllowed()) {
                    @Override
                      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isClosedInternal()) {
                            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != getDelegateInternal()) {
                                    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.close();
                                }
                            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                                setClosedInternal(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                            }
                          }
                    }
 
                    @Override
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; isClosedInternal() || &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != getDelegateInternal() &amp;amp;&amp;amp; getDelegateInternal().isClosed();
                      }
                };
            }
        };
        pds.setAccessToUnderlyingConnectionAllowed(isAccessToUnderlyingConnectionAllowed());
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pds;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12986783">DBCP-464</key>
            <summary>managed shared connections can lead to a NPE on close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="romain.manni-bucau">Romain Manni-Bucau</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jul 2016 10:58:49 +0000</created>
                <updated>Wed, 2 Nov 2016 21:52:32 +0000</updated>
                            <resolved>Wed, 2 Nov 2016 21:52:32 +0000</resolved>
                                    <version>1.4</version>
                    <version>2.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                    <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12856937">DBCP-446</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12986779">TOMEE-1860</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30j6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-463] Spelling error: setMaxOpenPrepatedStatements[PoolableConnectionFactory.java]</title>
                <link>https://issues.apache.org/jira/browse/DBCP-463</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;From the mailing list:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I am using DBCP2-2.1.1 and there is a little bug in class&lt;br/&gt;
org.apache.commons.dbcp2.PoolableConnectionFactory :&lt;/p&gt;

&lt;p&gt;The name of the setter is setMaxOpenPrepatedStatements : a &apos;T&apos; instead of a&lt;br/&gt;
&apos;R&apos; in .prepared..&lt;/p&gt;

&lt;p&gt;So to set the maxOpenPreparedStatements parameter you must define the&lt;br/&gt;
maxOpenPrepatedStatements property.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12979947">DBCP-463</key>
            <summary>Spelling error: setMaxOpenPrepatedStatements[PoolableConnectionFactory.java]</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Jun 2016 19:07:38 +0000</created>
                <updated>Wed, 2 Nov 2016 21:57:44 +0000</updated>
                            <resolved>Wed, 2 Nov 2016 21:57:44 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="15630668" author="markt" created="Wed, 2 Nov 2016 21:57:44 +0000"  >&lt;p&gt;Fix with the old method deprecated so existing clients aren&apos;t broken.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zl4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-461] Prepared statements are not cached with XA</title>
                <link>https://issues.apache.org/jira/browse/DBCP-461</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Prepared statements are not getting cached when I use XA datasource. &lt;br/&gt;
 Please find the below program :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TransactionManager transactionManager = TransactionManagerFactory.getTransactionManager();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PoolProperties poolProperties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolProperties();

&#160;&#160;&#160;&#160;&#160;&#160;&#160; SQLServerDataSource dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; com.microsoft.sqlserver.jdbc.SQLServerDataSource();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; dataSource.setUser(&lt;span class=&quot;code-quote&quot;&gt;&quot;sa&quot;&lt;/span&gt;);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; dataSource.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;$9Lserver&quot;&lt;/span&gt;);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; dataSource.setURL(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:sqlserver:&lt;span class=&quot;code-comment&quot;&gt;//sdwivedi63ks022:1433;sendStringParametersAsUnicode=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;);
&lt;/span&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dataSource.setDatabaseName(&lt;span class=&quot;code-quote&quot;&gt;&quot;himalaya&quot;&lt;/span&gt;);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; poolProperties.setDataSource(dataSource);

&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; jdbcInterceptors = &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.tomcat.jdbc.pool.interceptor.StatementCache(prepared=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,callable=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)&quot;&lt;/span&gt;;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; poolProperties.setJdbcInterceptors(jdbcInterceptors);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; org.apache.tomcat.jdbc.pool.DataSource pooledOracleDatasource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.tomcat.jdbc.pool.XADataSource(poolProperties);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; javax.sql.DataSource oracleDataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.openejb.resource.jdbc.managed.xa.ManagedXADataSource(pooledOracleDatasource, transactionManager,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TransactionProvider.getTransactionSynchronizationRegistry());
&#160;&#160;&#160;&#160;&#160;&#160;&#160; Connection connection = oracleDataSource.getConnection();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 50; i++) {
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; PreparedStatement preparedStatement = connection.prepareStatement(&lt;span class=&quot;code-quote&quot;&gt;&quot;insert into MyTableNew values (&quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;);
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(preparedStatement.getClass().getName());
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; preparedStatement.execute();
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; preparedStatement.close();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }

&#160;&#160;&#160;&#160;&#160;&#160;&#160; connection.close();
&#160;&#160;&#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I run the above program, the output I see is:&lt;br/&gt;
 com.sun.proxy.$Proxy11&lt;/p&gt;

&lt;p&gt;If I just change the above program to use XA datasource, i.e.&lt;br/&gt;
 Change the following line&lt;br/&gt;
 SQLServerDataSource dataSource = new com.microsoft.sqlserver.jdbc.SQLServerDataSource();&lt;br/&gt;
 To&lt;br/&gt;
 SQLServerXADataSource dataSource = new com.microsoft.sqlserver.jdbc.SQLServerXADataSource();&lt;br/&gt;
 The output is :&lt;br/&gt;
 com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement&lt;/p&gt;</description>
                <environment>&lt;p&gt;TomEE Version : Apache Tomcat Version 7.0.63&lt;/p&gt;</environment>
        <key id="12970652">DBCP-461</key>
            <summary>Prepared statements are not cached with XA</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sailaja_r">Sailaja</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 May 2016 06:52:48 +0000</created>
                <updated>Mon, 13 Aug 2018 19:13:17 +0000</updated>
                            <resolved>Mon, 13 Aug 2018 19:13:17 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15288670" author="sebb@apache.org" created="Wed, 18 May 2016 09:24:18 +0000"  >&lt;p&gt;Given that the statement varies between loop iterations (it contains the loop index), I don&apos;t see how it can be reused, regardless of whether it is cached or not.&lt;/p&gt;

&lt;p&gt;A PreparedStatement normally contains one or more parameters that can be varied between invocations.&lt;br/&gt;
Your example has 50 &lt;b&gt;different&lt;/b&gt; statements:&lt;br/&gt;
insert into MyTableNew values (0);&lt;br/&gt;
insert into MyTableNew values (1);&lt;br/&gt;
...&lt;br/&gt;
insert into MyTableNew values (49);&lt;/p&gt;</comment>
                            <comment id="15288752" author="sailaja_r" created="Wed, 18 May 2016 10:31:08 +0000"  >&lt;p&gt;Yes. The insert should be parameterized. Even if it was parameterized there is a defect, the object returned for the prepared statement was &lt;br/&gt;
com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement instead of a proxy object if I use XA datasource. By using non XA datasource I am seeing a Proxy object being returned,&lt;/p&gt;

&lt;p&gt;I tried parameterized statements and the result remained the same.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception 
	{
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TransactionManager transactionManager = TransactionManagerFactory
				.getTransactionManager();
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PoolProperties poolProperties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolProperties();
		
		SQLServerXADataSource dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; com.microsoft.sqlserver.jdbc.SQLServerXADataSource();
		dataSource.setUser(&lt;span class=&quot;code-quote&quot;&gt;&quot;sa&quot;&lt;/span&gt;);
		dataSource.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;$9Lserver&quot;&lt;/span&gt;);
		dataSource.setURL(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:sqlserver:&lt;span class=&quot;code-comment&quot;&gt;//sdwivedi63ks022:1433;sendStringParametersAsUnicode=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;);
&lt;/span&gt;		dataSource.setDatabaseName(&lt;span class=&quot;code-quote&quot;&gt;&quot;himalaya&quot;&lt;/span&gt;);
		poolProperties.setDataSource(dataSource);
		
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; jdbcInterceptors = &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.tomcat.jdbc.pool.interceptor.StatementCache(prepared=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,callable=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)&quot;&lt;/span&gt;;
		poolProperties.setJdbcInterceptors(jdbcInterceptors);
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; org.apache.tomcat.jdbc.pool.DataSource pooledOracleDatasource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.tomcat.jdbc.pool.XADataSource(
				poolProperties);
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; javax.sql.DataSource oracleDataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.openejb.resource.jdbc.managed.xa.ManagedXADataSource(
				pooledOracleDatasource, transactionManager,
				TransactionProvider.getTransactionSynchronizationRegistry());
		Connection connection = oracleDataSource.getConnection();
		
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; preparedStatementString = &lt;span class=&quot;code-quote&quot;&gt;&quot;insert into MyTableNew (ID) values(?)&quot;&lt;/span&gt;;

		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;50; i++)
		{
			PreparedStatement preparedStatement = connection.prepareStatement(preparedStatementString);
			preparedStatement.setInt(1, i);
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(preparedStatement.getClass().getName());
			preparedStatement.execute();
			preparedStatement.close();
		}
		connection.close();
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="16516415" author="garydgregory" created="Mon, 18 Jun 2018 22:18:09 +0000"  >&lt;p&gt;I think we should close this unless &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sailaja_r&quot; class=&quot;user-hover&quot; rel=&quot;sailaja_r&quot;&gt;sailaja_r&lt;/a&gt; can tell us this is an issue for the current version.&lt;/p&gt;</comment>
                            <comment id="16556816" author="b.eckenfels" created="Thu, 26 Jul 2018 02:52:24 +0000"  >&lt;p&gt;Are you sure you reported this in the right project? Seems to me like a problem in the interceptor from the Tomcat project. The DBCP uses `poolPreparedStatements=true` instead.&lt;/p&gt;</comment>
                            <comment id="16577883" author="sailaja_r" created="Mon, 13 Aug 2018 06:32:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=b.eckenfels&quot; class=&quot;user-hover&quot; rel=&quot;b.eckenfels&quot;&gt;b.eckenfels&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The issue still exists in TomEE 7.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As per our analysis the root cause of the problem is that for XA connections, instead of getting a proxy statement object the client gets the actual statement object which the client ends up closing. The test code submitted&#160;by us can confirm this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Is this not the right project for this ticket?&lt;/p&gt;

&lt;p&gt;If not, it will be great if you could let us know where this ticket should be created?&lt;/p&gt;</comment>
                            <comment id="16578805" author="garydgregory" created="Mon, 13 Aug 2018 19:11:53 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sailaja_r&quot; class=&quot;user-hover&quot; rel=&quot;sailaja_r&quot;&gt;sailaja_r&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;If you want this to go anywhere here, you should provide a PR at&#160;&lt;a href=&quot;https://github.com/apache/commons-dbcp/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-dbcp/&lt;/a&gt; that contains a unit test to reproduce&#160;your&#160;issue. In order to do so, I would use a standalone Java-based DB like H2.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16578807" author="markt" created="Mon, 13 Aug 2018 19:13:17 +0000"  >&lt;p&gt;This is nothing to do with DBCP. The OP is using Tomcat&apos;s own pooling implementation.&lt;br/&gt;
&lt;a href=&quot;http://tomcat.apache.org/bugreport.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tomcat.apache.org/bugreport.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y4lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-459] InterruptedException consumed and not reset by PoolingDataSource.getConnection()</title>
                <link>https://issues.apache.org/jira/browse/DBCP-459</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;If while &lt;tt&gt;PoolingDataSource.getConnection()&lt;/tt&gt; is waiting for an available connection, &lt;tt&gt;Thread.interrupt()&lt;/tt&gt; is called against the current thread, an &lt;tt&gt;java.lang.InterruptedException&lt;/tt&gt; is caught internally but not reset.&lt;/p&gt;

&lt;p&gt;It is however thrown out wrapped in an &lt;tt&gt;java.sql.SQLException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;A stack trace of such an occurrence is as follows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.sql.SQLException: Cannot get a connection, general error
	at org.apache.commons.dbcp2.PoolingDataSource.getConnection(PoolingDataSource.java:146)
	at org.apache.commons.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:1533)
Caused by: java.lang.InterruptedException
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1220)
	at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:335)
	at org.apache.commons.pool2.impl.LinkedBlockingDeque.pollFirst(LinkedBlockingDeque.java:624)
	at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:444)
	at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:363)
	at org.apache.commons.dbcp2.PoolingDataSource.getConnection(PoolingDataSource.java:134)
	... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since the interrupt status flag is not reset, it is left to the caller to look out for it and perform the interrupt specific logic, or reset the flag.  i.e.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    ds.getConnection()
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e.getCause() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; InterruptedException) {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.current.interrupted();
    }
    ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12957602">DBCP-459</key>
            <summary>InterruptedException consumed and not reset by PoolingDataSource.getConnection()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="antak">Atsushi Nakagawa</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Apr 2016 04:05:26 +0000</created>
                <updated>Thu, 3 Nov 2016 09:03:12 +0000</updated>
                            <resolved>Thu, 3 Nov 2016 09:03:12 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vwsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-457] Creating a pool with an inital size &gt; 0 via BasicDataSourceFactory means the abandoned log writer cannot be set </title>
                <link>https://issues.apache.org/jira/browse/DBCP-457</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;If the BasicDataSourceFactory.createDataSource() method is called with an initialSize value of &amp;gt; 0, then the underlying object pool is eagerly created (see BasicDataSourceFactory line 594). Then calling setAbandonedLogWriter() on the returned BasicDataSourcehas no effect on the newly created object pool as it is already created.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12956026">DBCP-457</key>
            <summary>Creating a pool with an inital size &gt; 0 via BasicDataSourceFactory means the abandoned log writer cannot be set </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="markgaylard">Mark Gaylard</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Apr 2016 03:18:06 +0000</created>
                <updated>Thu, 3 Nov 2016 09:40:29 +0000</updated>
                            <resolved>Thu, 3 Nov 2016 09:40:29 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15632219" author="markt" created="Thu, 3 Nov 2016 09:40:29 +0000"  >&lt;p&gt;Changes to all the configuration properties for abandoned connections are now passed to the underlying pool and will take effect immediately.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vn2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-456] The softMiniEvictableIdleTimeMillis of the configuration page is incorrect</title>
                <link>https://issues.apache.org/jira/browse/DBCP-456</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The parameter name softMiniEvictableIdleTimeMillis of the BasicDataSource Configuration Parameters page is incorrect.&lt;br/&gt;
The softMinEvictableIdleTimeMillis is correct.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12950213">DBCP-456</key>
            <summary>The softMiniEvictableIdleTimeMillis of the configuration page is incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Kyohei Nakamura">Kyohei Nakamura</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Mar 2016 07:24:43 +0000</created>
                <updated>Thu, 17 Mar 2016 14:35:17 +0000</updated>
                            <resolved>Thu, 17 Mar 2016 14:35:17 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15194851" author="kyohei nakamura" created="Tue, 15 Mar 2016 07:25:25 +0000"  >&lt;p&gt;patch&lt;/p&gt;</comment>
                            <comment id="15199626" author="markt" created="Thu, 17 Mar 2016 14:35:17 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793491" name="configuration.xml.patch" size="1287" author="Kyohei Nakamura" created="Tue, 15 Mar 2016 07:25:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2unon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-455] Even if the cacheState is false, the getAutoCommit and isReadOnly method always return cached value</title>
                <link>https://issues.apache.org/jira/browse/DBCP-455</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Even if the cacheState is false, the getAutoCommit and isReadOnly method always return cached value when the poolPreparedStatements is false.&lt;/p&gt;

&lt;p&gt;In my analytics, the cacheState is set to the PoolingConnection but is not set to the PoolableConnetcion.&lt;br/&gt;
Therefore, the PoolableConnetcion always enable caching.&lt;/p&gt;

&lt;p&gt;The PoolableConnetcion should be set the cacheState.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12950187">DBCP-455</key>
            <summary>Even if the cacheState is false, the getAutoCommit and isReadOnly method always return cached value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Kyohei Nakamura">Kyohei Nakamura</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Mar 2016 05:51:25 +0000</created>
                <updated>Thu, 17 Mar 2016 14:19:37 +0000</updated>
                            <resolved>Thu, 17 Mar 2016 14:19:37 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15194755" author="kyohei nakamura" created="Tue, 15 Mar 2016 05:54:18 +0000"  >&lt;p&gt;patchs&lt;/p&gt;</comment>
                            <comment id="15199585" author="markt" created="Thu, 17 Mar 2016 14:19:37 +0000"  >&lt;p&gt;Thanks for the patches.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793483" name="PoolableConnectionFactory.java.patch" size="618" author="Kyohei Nakamura" created="Tue, 15 Mar 2016 05:54:18 +0000"/>
                            <attachment id="12793484" name="PoolableManagedConnectionFactory.java.patch" size="939" author="Kyohei Nakamura" created="Tue, 15 Mar 2016 05:54:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2univ:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-454] OSGi declarations contain multiple import headers for javax.transaction</title>
                <link>https://issues.apache.org/jira/browse/DBCP-454</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-445&quot; title=&quot;java.lang.NoClassDefFoundError: javax/transaction/SystemException after update&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-445&quot;&gt;&lt;del&gt;DBCP-445&lt;/del&gt;&lt;/a&gt; an issue for &quot;javax.transaction&quot; import-packages was addressed. Though with the fix for this issue the import-packages will contain &quot;javax.transaction&quot; twice:&lt;/p&gt;

&lt;p&gt;Import-Package: javax.management,javax.naming,javax.naming.spi,javax.s&lt;br/&gt;
 ql,javax.transaction,javax.transaction.xa,org.apache.commons.logging,&lt;br/&gt;
 org.apache.commons.pool2,org.apache.commons.pool2.impl,javax.transact&lt;br/&gt;
 ion.xa;version=&quot;1.1.0&quot;;partial=true;mandatory:=partial,javax.transact&lt;br/&gt;
 ion;version=&quot;1.1.0&quot;&lt;/p&gt;

&lt;p&gt;Thus the bundle can&apos;t be loaded as duplicate import declarations are prohibited and i.e. Felix will complain about this and refuse to install the bundle. The fix is quite simple by appending the &apos;*&apos; to the end (see attached patch).&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSGi&lt;/p&gt;</environment>
        <key id="12946952">DBCP-454</key>
            <summary>OSGi declarations contain multiple import headers for javax.transaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="mattsicker">Matt Sicker</assignee>
                                    <reporter username="pmarx">Philipp Marx</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2016 10:41:57 +0000</created>
                <updated>Wed, 10 Oct 2018 12:19:17 +0000</updated>
                                            <version>2.2.0</version>
                                    <fixVersion>2.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15179795" author="pmarx" created="Fri, 4 Mar 2016 12:04:05 +0000"  >&lt;p&gt;With the fix the bundle doesn&apos;t contain the duplicate import packages anymore. Still the bundle can&apos;t be resolved properly in my OGSi environment (karaf 3.0.5 / java 1.8 / MacOS). If I remove the extra import declarations for &quot;javax.transaction&quot; completely it works without problems. Are we sure that these declarations are absolutely required in the bundle? Isn&apos;t it the responsibility of the runtime to ensure the packages are properly exported, i.e. Karaf seems to take care of this?&lt;/p&gt;</comment>
                            <comment id="15404568" author="jvz" created="Tue, 2 Aug 2016 18:40:04 +0000"  >&lt;p&gt;I cam across this issue during the 2.2 rc1. I came to the same conclusion as the patch here (see the duplicate ticket). I&apos;m trying to get a working unit test using pax-exam, but it&apos;s a bit more difficult than I expected.&lt;/p&gt;</comment>
                            <comment id="15404626" author="smigfu" created="Tue, 2 Aug 2016 19:18:59 +0000"  >&lt;p&gt;If you change ths osgi.import declaration to &quot;&amp;lt;commons.osgi.import&amp;gt;*&amp;lt;/commons.osgi.import&amp;gt;&quot; it works w/o problem (see also my previous comment).&lt;/p&gt;</comment>
                            <comment id="15404640" author="jvz" created="Tue, 2 Aug 2016 19:28:11 +0000"  >&lt;p&gt;It looks like version 1.1 is needed at least (&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-445&quot; title=&quot;java.lang.NoClassDefFoundError: javax/transaction/SystemException after update&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-445&quot;&gt;&lt;del&gt;DBCP-445&lt;/del&gt;&lt;/a&gt;), so a version range would be more appropriate anyways. That&apos;s the problem with Java EE APIs; they aren&apos;t versioned properly for OSGi.&lt;/p&gt;</comment>
                            <comment id="15404656" author="jvz" created="Tue, 2 Aug 2016 19:47:58 +0000"  >&lt;p&gt;Fixed in revision 1754999. I gave up on trying to make a pax-exam unit test as it&apos;s far too complicated to get working for this type of use case. Right now, the best way to verify that this works is to simply install the jar (and dependencies) to a Karaf container and make sure you can run &lt;tt&gt;bundle:start&lt;/tt&gt; on it. More proper OSGi tests are included in the &lt;a href=&quot;https://github.com/ops4j/org.ops4j.pax.jdbc/tree/master/pax-jdbc-pool-dbcp2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pax-jdbc version&lt;/a&gt; of dbcp2.&lt;/p&gt;</comment>
                            <comment id="15404762" author="garydgregory" created="Tue, 2 Aug 2016 20:50:12 +0000"  >&lt;p&gt;Can you not do something like we do in Log4j using Equinox or Felix?&lt;/p&gt;</comment>
                            <comment id="15404769" author="jvz" created="Tue, 2 Aug 2016 21:00:45 +0000"  >&lt;p&gt;Log4j doesn&apos;t require any dependencies, but dbcp does, so it makes it a lot more complicated than the AbstractLoadBundleTest from Log4j. I figured pax-exam would provide the capability of adding all those dependencies for me, but then I got other errors instead that are unrelated to dbcp or osgi. &lt;a href=&quot;https://github.com/ops4j/org.ops4j.pax.jdbc/blob/master/pax-jdbc-itest/src/test/java/org/ops4j/pax/jdbc/test/pool/PoolDbcp2Test.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&apos;s a related test&lt;/a&gt; that would fail if dbcp itself was exporting the wrong headers (as with this bug). The thing is with pax projects is that these types of tests are run in a separate maven module, presumably to prevent the issues I was having, and that would require a restructuring of dbcp which is rather complicated.&lt;/p&gt;</comment>
                            <comment id="15404781" author="garydgregory" created="Tue, 2 Aug 2016 21:05:17 +0000"  >&lt;p&gt;Is that because the test wants to load a jar as opposed to a .class files from a Maven target folder?&lt;/p&gt;</comment>
                            <comment id="15404789" author="jvz" created="Tue, 2 Aug 2016 21:08:03 +0000"  >&lt;p&gt;Yeah, basically. That&apos;s how pax-exam is supposed to work by default which sounds rather out of place when you&apos;re trying to integration test modules in the same repository (e.g., snapshot builds). I might be reading the documentation wrong, but even that is unhelpful as all the examples are too trivial.&lt;/p&gt;</comment>
                            <comment id="15404799" author="garydgregory" created="Tue, 2 Aug 2016 21:11:41 +0000"  >&lt;p&gt;Testing a jar makes sense to me. It just makes sure that we are testing what the users will use. The bigger issue is that we should do this for all Commons component to make a jar from loaded in an OSGi container.&lt;/p&gt;</comment>
                            <comment id="15404817" author="jvz" created="Tue, 2 Aug 2016 21:17:55 +0000"  >&lt;p&gt;It would be really neat to make a more commons-friendly generic unit test that can be copied around to make sure that each component properly installs into an OSGi container.&lt;/p&gt;</comment>
                            <comment id="15404829" author="garydgregory" created="Tue, 2 Aug 2016 21:21:55 +0000"  >&lt;p&gt;My thoughts precisely!&lt;/p&gt;</comment>
                            <comment id="15404834" author="jvz" created="Tue, 2 Aug 2016 21:25:49 +0000"  >&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-467&quot; title=&quot;Add OSGi integration tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-467&quot;&gt;&lt;del&gt;DBCP-467&lt;/del&gt;&lt;/a&gt; to add such a test here at least. Maybe it could end up being generified to a sort of commons-osgi-itest type of artifact that can be included as a test-scoped dependency on each commons project. Then each project can reuse those generic tests.&lt;/p&gt;</comment>
                            <comment id="15412100" author="jvz" created="Mon, 8 Aug 2016 17:16:06 +0000"  >&lt;p&gt;I don&apos;t think that partial thing is correct, either. I get the following error when installing this new version in Karaf 3.0.4:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.Exception: Could not start bundle mvn:org.apache.commons/commons-dbcp2/2.2 in feature(s) commons-dbcp2-2.2: Unresolved constraint in bundle org.apache.commons.dbcp2 [269]: Unable to resolve 269.0: missing requirement [269.0] osgi.wiring.package; (&amp;amp;(osgi.wiring.package=javax.transaction.xa)(version&amp;gt;=1.1.0)(partial=true))
	at org.apache.karaf.features.internal.FeaturesServiceImpl.startBundle(FeaturesServiceImpl.java:521)[20:org.apache.karaf.features.core:3.0.4]
	at org.apache.karaf.features.internal.FeaturesServiceImpl.installFeatures(FeaturesServiceImpl.java:476)[20:org.apache.karaf.features.core:3.0.4]
	at org.apache.karaf.features.internal.FeaturesServiceImpl.installFeature(FeaturesServiceImpl.java:417)[20:org.apache.karaf.features.core:3.0.4]
	at Proxy3ddcd89e_6018_4343_b5b3_8693418616e1.installFeature(Unknown Source)[:]
	at Proxy1c5ca9a8_a504_40c1_a273_6f4767d76de4.installFeature(Unknown Source)[:]
	at org.apache.karaf.kar.internal.KarServiceImpl.installFeatures(KarServiceImpl.java:215)[109:org.apache.karaf.kar.core:3.0.4]
	at org.apache.karaf.kar.internal.KarServiceImpl.install(KarServiceImpl.java:96)[109:org.apache.karaf.kar.core:3.0.4]
	at org.apache.karaf.kar.internal.KarServiceImpl.install(KarServiceImpl.java:84)[109:org.apache.karaf.kar.core:3.0.4]
	at Proxy670dd4c1_ba32_408b_9988_4daea71b6bc9.install(Unknown Source)[:]
	at Proxye95b24d0_c408_4277_a3ea_4b500b9f30a0.install(Unknown Source)[:]
	at org.apache.karaf.deployer.kar.KarArtifactInstaller.install(KarArtifactInstaller.java:50)[111:org.apache.karaf.deployer.kar:3.0.4]
	at Proxy370ffdac_0056_40be_877f_c9735fc99d7c.install(Unknown Source)[:]
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.install(DirectoryWatcher.java:931)[7:org.apache.felix.fileinstall:3.5.0]
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.install(DirectoryWatcher.java:865)[7:org.apache.felix.fileinstall:3.5.0]
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.doProcess(DirectoryWatcher.java:482)[7:org.apache.felix.fileinstall:3.5.0]
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.process(DirectoryWatcher.java:358)[7:org.apache.felix.fileinstall:3.5.0]
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.run(DirectoryWatcher.java:310)[7:org.apache.felix.fileinstall:3.5.0]
Caused by: org.osgi.framework.BundleException: Unresolved constraint in bundle org.apache.commons.dbcp2 [269]: Unable to resolve 269.0: missing requirement [269.0] osgi.wiring.package; (&amp;amp;(osgi.wiring.package=javax.transaction.xa)(version&amp;gt;=1.1.0)(partial=true))
	at org.apache.felix.framework.Felix.resolveBundleRevision(Felix.java:3974)[org.apache.felix.framework-4.2.1.jar:]
	at org.apache.felix.framework.Felix.startBundle(Felix.java:2037)[org.apache.felix.framework-4.2.1.jar:]
	at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:955)[org.apache.felix.framework-4.2.1.jar:]
	at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:942)[org.apache.felix.framework-4.2.1.jar:]
	at org.apache.karaf.features.internal.FeaturesServiceImpl.startBundle(FeaturesServiceImpl.java:518)[20:org.apache.karaf.features.core:3.0.4]
	... 16 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve installed the transaction feature first which imports JTA 1.1.0, so it&apos;s definitely available.&lt;/p&gt;

&lt;p&gt;Also, some info about this partial/mandatory hack: &lt;a href=&quot;http://apache-geronimo.328035.n3.nabble.com/Understanding-the-quot-partial-true-mandatory-partial-quot-trick-td396729.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-geronimo.328035.n3.nabble.com/Understanding-the-quot-partial-true-mandatory-partial-quot-trick-td396729.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16644898" author="vladimirfx" created="Wed, 10 Oct 2018 12:15:56 +0000"  >&lt;p&gt;Temporal workaround for Karaf with Pax Wrap protocol:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;wrap:mvn:org.apache.commons/commons-dbcp2/2.5.0$overwrite=merge&lt;font color=&quot;#6d9cbe&quot;&gt;&amp;amp;&lt;/font&gt;Import-Package=javax.transaction;version=&quot;1.1.0&quot;,javax.transaction.xa;version=&quot;1.1.0&quot;,javax.management,javax.naming,javax.naming.spi,javax.sql,org.apache.commons.logging,org.apache.commons.pool2,org.apache.commons.pool2.impl&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12994340">DBCP-465</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791447" name="patch" size="744" author="pmarx" created="Fri, 4 Mar 2016 10:42:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u5in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-453] BasicDataSource should set setSoftMinEvictableIdleTimeMillis on GenericObjectPool</title>
                <link>https://issues.apache.org/jira/browse/DBCP-453</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Setting the setSoftMinEvictableIdleTimeMillis on the BasicDataSource will not set this property on the underlying connection pool, if it hasn&apos;t been created yet.&lt;/p&gt;

&lt;p&gt;BasicDataSource#createConnectionPool should set the property on the GenericObjectPool.&lt;/p&gt;

&lt;p&gt;There had been a similar issue for DBCP 1.x as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-334&quot; title=&quot;BasicDataSource does not consider the method &amp;quot;setSoftMinEvictableIdleTimeMillis&amp;quot; of CommonsPool.GenericObjectPool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-334&quot;&gt;&lt;del&gt;DBCP-334&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12936359">DBCP-453</key>
            <summary>BasicDataSource should set setSoftMinEvictableIdleTimeMillis on GenericObjectPool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="smigfu">Philipp Marx</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2016 15:09:05 +0000</created>
                <updated>Thu, 17 Mar 2016 14:31:10 +0000</updated>
                            <resolved>Thu, 17 Mar 2016 14:31:10 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15199612" author="markt" created="Thu, 17 Mar 2016 14:31:10 +0000"  >&lt;p&gt;Thanks for the patch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791281" name="patch" size="2947" author="pmarx" created="Thu, 3 Mar 2016 23:44:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2scz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-452] BasicDataSourceFactory ignores jmxName property</title>
                <link>https://issues.apache.org/jira/browse/DBCP-452</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When a property named &quot;jmxName&quot; is supplied to BasicDataSourceFactory, the property is not set on the BasicDataSource instance created by the factory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12919567">DBCP-452</key>
            <summary>BasicDataSourceFactory ignores jmxName property</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Dec 2015 04:07:31 +0000</created>
                <updated>Mon, 7 Dec 2015 12:28:16 +0000</updated>
                            <resolved>Mon, 7 Dec 2015 12:28:16 +0000</resolved>
                                    <version>2.0</version>
                    <version>2.0.1</version>
                    <version>2.1</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15044339" author="psteitz" created="Mon, 7 Dec 2015 04:08:16 +0000"  >&lt;p&gt;The problem is that PROP_JMX_NAME is missing from ALL_PROPERTIES.&lt;/p&gt;</comment>
                            <comment id="15044845" author="psteitz" created="Mon, 7 Dec 2015 12:28:16 +0000"  >&lt;p&gt;Fixed in r1718242.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pih3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-451] Add constructor DriverManagerConnectionFactory(String)</title>
                <link>https://issues.apache.org/jira/browse/DBCP-451</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Add ctor DriverManagerConnectionFactory(String)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Apache Maven 3.3.3 (7994120775791599e205a5524ec3e0dfe41d4a06; 2015-04-22T04:57:37-07:00)&lt;br/&gt;
Maven home: C:\Java\apache-maven-3.3.3&lt;br/&gt;
Java version: 1.7.0_79, vendor: Oracle Corporation&lt;br/&gt;
Java home: C:\Program Files\Java\jdk1.7.0_79\jre&lt;br/&gt;
Default locale: en_US, platform encoding: Cp1252&lt;br/&gt;
OS name: &quot;windows 7&quot;, version: &quot;6.1&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;&lt;/p&gt;</environment>
        <key id="12909052">DBCP-451</key>
            <summary>Add constructor DriverManagerConnectionFactory(String)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Oct 2015 21:57:46 +0000</created>
                <updated>Fri, 30 Oct 2015 00:25:56 +0000</updated>
                            <resolved>Fri, 30 Oct 2015 00:13:01 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14981544" author="garydgregory" created="Thu, 29 Oct 2015 23:16:45 +0000"  >&lt;p&gt;Fixed in trunk.&lt;/p&gt;</comment>
                            <comment id="14981622" author="psteitz" created="Fri, 30 Oct 2015 00:13:01 +0000"  >&lt;p&gt;Change status to resolved until this is released.&lt;/p&gt;</comment>
                            <comment id="14981626" author="psteitz" created="Fri, 30 Oct 2015 00:13:41 +0000"  >&lt;p&gt;Change release version to 2.2 as this is not a bug fix.&lt;/p&gt;</comment>
                            <comment id="14981640" author="garydgregory" created="Fri, 30 Oct 2015 00:25:56 +0000"  >&lt;p&gt;Should we change the version in the POM to 2.2 then?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2npsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-450] Veracode Static Analysis indicates SQL injection in Commons DBCP jar</title>
                <link>https://issues.apache.org/jira/browse/DBCP-450</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Veracode Static scan have indicated 3 High severity SQL injection flaws in this jar &lt;/p&gt;

&lt;p&gt;Instances found via Static Scan&lt;br/&gt;
Module # Class # Module Location Fix By Flaw Id&lt;br/&gt;
8 - commons-dbcp2-&lt;br/&gt;
2.1.1.jar&lt;br/&gt;
.../DelegatingPreparedStatement.java 83 16477&lt;br/&gt;
9 - commons-dbcp2-&lt;br/&gt;
2.1.1.jar&lt;br/&gt;
.../DelegatingStatement.java 291 16479&lt;br/&gt;
17 - commons-dbcp2-&lt;br/&gt;
2.1.1.jar&lt;br/&gt;
.../PoolableConnectionFactory.java 325 16476&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12909044">DBCP-450</key>
            <summary>Veracode Static Analysis indicates SQL injection in Commons DBCP jar</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="i-min.mau">I-Min Mau</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Thu, 29 Oct 2015 21:40:19 +0000</created>
                <updated>Thu, 29 Oct 2015 22:03:09 +0000</updated>
                            <resolved>Thu, 29 Oct 2015 21:57:22 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14981390" author="psteitz" created="Thu, 29 Oct 2015 21:57:22 +0000"  >&lt;p&gt;The SQL executed in these locations is either part of the implementation of the JDBC API or core DBCP functionality.&lt;/p&gt;</comment>
                            <comment id="14981404" author="i-min.mau" created="Thu, 29 Oct 2015 22:03:09 +0000"  >&lt;p&gt;Thank  you very much!  That&apos;s how we will remediate.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2npqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-449] Cannot use DBCP on Google App Engine</title>
                <link>https://issues.apache.org/jira/browse/DBCP-449</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;There is no way to disable the use of JMX when using PoolableConnections. Line 53 of PoolableConnection.java uses the ManagementFactory which is blacklisted in Google App Engine.&lt;/p&gt;

&lt;p&gt;MBEAN_SERVER = ManagementFactory.getPlatformMBeanServer();&lt;/p&gt;

&lt;p&gt;&quot;java.lang.NoClassDefFoundError: java.lang.management.ManagementFactory is a restricted class. Please see the Google App Engine developer&apos;s guide for more details.&quot;&lt;/p&gt;

&lt;p&gt;Closed issue &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-418&quot; title=&quot;Cannot Disable JMX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-418&quot;&gt;&lt;del&gt;DBCP-418&lt;/del&gt;&lt;/a&gt; should catch (NoClassDefFoundError | Exception ex) instead of (Exception ex)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Google App Engine&lt;/p&gt;</environment>
        <key id="12908234">DBCP-449</key>
            <summary>Cannot use DBCP on Google App Engine</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="photoworld">Grzegorz D.</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Oct 2015 14:06:34 +0000</created>
                <updated>Fri, 29 Jul 2016 00:31:50 +0000</updated>
                            <resolved>Wed, 28 Oct 2015 18:47:02 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14976790" author="garydgregory" created="Tue, 27 Oct 2015 17:27:17 +0000"  >&lt;p&gt;I&apos;m not sure that&apos;s going to cut it. We might need to create a separate class to handle JMX and JNDI features so they are not loaded when a main class is loaded.&lt;/p&gt;</comment>
                            <comment id="14977911" author="photoworld" created="Wed, 28 Oct 2015 07:47:30 +0000"  >&lt;p&gt;I added NoClassDefFoundError to this catch block and DBCP 2.1.1 works great on GAE.&lt;/p&gt;</comment>
                            <comment id="14978981" author="garydgregory" created="Wed, 28 Oct 2015 18:36:09 +0000"  >&lt;p&gt;OK, I&apos;ll patch...&lt;/p&gt;</comment>
                            <comment id="14978994" author="garydgregory" created="Wed, 28 Oct 2015 18:47:02 +0000"  >&lt;p&gt;Committed revision 1711099.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                            <comment id="14996165" author="photoworld" created="Mon, 9 Nov 2015 07:51:26 +0000"  >&lt;p&gt;Compiled from trunk 2.2-SNAPSHOT, working great on GAE 1.9.27.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="14996167" author="photoworld" created="Mon, 9 Nov 2015 07:52:02 +0000"  >&lt;p&gt;Tested on GAE 1.9.27&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12712383">DBCP-418</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nksv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-447] java.sql.SQLException: Data source is closed</title>
                <link>https://issues.apache.org/jira/browse/DBCP-447</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Recently we have upgraded below connection pooling jars so that they are compatible with type 4/JDK 6.0.&lt;br/&gt;
Common dbcp 1.2 to dbcp 1.4  &lt;br/&gt;
Common pool 1.2 to pool 1.6&lt;/p&gt;

&lt;p&gt;Sporadically we are getting quartz scheduler error.&lt;/p&gt;

&lt;p&gt;Here is the stack trace:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; org.quartz.JobPersistenceException: Failed to obtain DB connection&lt;br/&gt;
from data source &apos;springNonTxDataSource.QuartzScheduler&apos;:&lt;br/&gt;
java.sql.SQLException: Data source is closed [See nested exception:&lt;br/&gt;
java.sql.SQLException: Data source is closed]&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.quartz.impl.jdbcjobstore.JobStoreCMT.getNonManagedTXConnection(JobStoreCMT.java:168)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.quartz.impl.jdbcjobstore.JobStoreSupport.doRecoverMisfires(JobStoreSupport.java:3169)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.quartz.impl.jdbcjobstore.JobStoreSupport$MisfireHandler.manage(JobStoreSupport.java:3935)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.quartz.impl.jdbcjobstore.JobStoreSupport$MisfireHandler.run(JobStoreSupport.java:3956)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Caused by: java.sql.SQLException: Data source is closed&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1362)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     at&lt;br/&gt;
org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:1044)&lt;/p&gt;

&lt;p&gt;Is this issue related to Spring/hibernate?&lt;br/&gt;
Please Suggest ..&lt;/p&gt;</description>
                <environment>&lt;p&gt;mysql  Ver 14.14 Distrib 5.5.32, for Win64 (x86)&lt;/p&gt;</environment>
        <key id="12895051">DBCP-447</key>
            <summary>java.sql.SQLException: Data source is closed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Asmita.Shinde">Asmita Maruti Shinde</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Sep 2015 07:04:07 +0000</created>
                <updated>Mon, 21 Sep 2015 23:46:37 +0000</updated>
                            <resolved>Mon, 21 Sep 2015 23:46:37 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14901636" author="psteitz" created="Mon, 21 Sep 2015 23:46:37 +0000"  >&lt;p&gt;Feel free to reopen if you can demonstrate somehow that this is actually a DBCP bug.  DBCP is throwing the SQL Exception because the BasicDataSource has been closed (as the message says).  In versions of DBCP prior to 1.3/1.4, there was no such check, which may be why upgrade to 1.4 triggers the failure.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lc0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-446] NullPointerException thrown when calling ManagedConnection.isClosed()</title>
                <link>https://issues.apache.org/jira/browse/DBCP-446</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hello all,&lt;br/&gt;
I&apos;m using commons-dbcp 1.4, and I found this exception. I don&apos;t if it&apos;s reported already before, I have done some searches in google, but nothing found. &lt;/p&gt;

&lt;p&gt;Here is the call stack.&lt;/p&gt;

&lt;p&gt;2015-08-18 15:01:50,091 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-49&amp;#93;&lt;/span&gt; console : ERROR -   ... 44 more&lt;br/&gt;
2015-08-18 16:04:57,963 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR - java.lang.NullPointerException&lt;br/&gt;
2015-08-18 16:04:57,965 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR -   at org.apache.commons.dbcp.DelegatingConnection.isClosed(DelegatingConnection.java:386)&lt;br/&gt;
2015-08-18 16:04:57,965 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR -   at org.hibernate.engine.jdbc.internal.LogicalConnectionImpl.releaseConnection(LogicalConnectionImpl.java:237)&lt;br/&gt;
2015-08-18 16:04:57,965 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR -   at org.hibernate.engine.jdbc.internal.LogicalConnectionImpl.aggressiveRelease(LogicalConnectionImpl.java:200)&lt;br/&gt;
2015-08-18 16:04:57,965 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR -   at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.afterTransaction(JdbcCoordinatorImpl.java:272)&lt;br/&gt;
2015-08-18 16:04:57,965 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR -   at org.hibernate.engine.transaction.internal.TransactionCoordinatorImpl.afterTransaction(TransactionCoordinatorImpl.java:144)&lt;br/&gt;
2015-08-18 16:04:57,965 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR -   at org.hibernate.engine.transaction.internal.jta.JtaTransaction.afterAfterCompletion(JtaTransaction.java:179)&lt;br/&gt;
2015-08-18 16:04:57,966 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-45&amp;#93;&lt;/span&gt; console : ERROR -   at org.hibernate.engine.transaction.spi.AbstractTransactionImpl.rollback(AbstractTransactionImpl.java:219)&lt;/p&gt;

&lt;p&gt;So when I debugged it, it created a ManagedConnection, which is a sub-class of DelegatingConnection, and the _conn is initialized with null, and the _closed is false by default. So when hibernate calls the isClosed(), it throws a nullpointer exception.&lt;/p&gt;

&lt;p&gt;Could you guys tell me if in your side, or the hibernate side ?&lt;br/&gt;
Do not hesitate to contact me if you need more information.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12856937">DBCP-446</key>
            <summary>NullPointerException thrown when calling ManagedConnection.isClosed()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yfeng">feng yang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Aug 2015 14:51:57 +0000</created>
                <updated>Wed, 2 Nov 2016 21:52:33 +0000</updated>
                            <resolved>Thu, 21 Jul 2016 03:56:59 +0000</resolved>
                                    <version>1.4</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14701642" author="psteitz" created="Tue, 18 Aug 2015 17:25:38 +0000"  >&lt;p&gt;This looks like the same issue (at least will get fixed by the same change) as &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-438&quot; title=&quot;Nested connections in a transaction (local) throws null pointer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-438&quot;&gt;&lt;del&gt;DBCP-438&lt;/del&gt;&lt;/a&gt;.  Should backport the fix for 1.4.1, assuming there is a 1.4.1.  Upgrading to 2.1.1 should also fix this.&lt;/p&gt;</comment>
                            <comment id="15380842" author="lagar84" created="Sat, 16 Jul 2016 16:28:02 +0000"  >&lt;p&gt;On 2.1.1 i also having nullpointerexception on isClosed&lt;br/&gt;
Did not find the null check there.&lt;br/&gt;
Is this a different issue?&lt;/p&gt;</comment>
                            <comment id="15383141" author="lagar84" created="Mon, 18 Jul 2016 21:47:28 +0000"  >&lt;p&gt;Since I am not the issue owner, could the reporter or an admin change the Affect version to also include 2.1.1? I could sucefully reproduce the same problem on 2.1.1 (using hibernate 4 and a conn pool org.apache.commons.dbcp2.managed.BasicManagedDataSource).&lt;br/&gt;
Altering the source code to put a null check on isClosed, no errors found:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp2.DelegatingConnection.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
    	
    	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(_conn == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;   &lt;span class=&quot;code-comment&quot;&gt;//I put &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line to make the error go away
&lt;/span&gt;    	
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _closed || _conn.isClosed();
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15387111" author="garydgregory" created="Thu, 21 Jul 2016 03:56:59 +0000"  >&lt;p&gt;The fix I made is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _closed || _conn == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || _conn.isClosed();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15392562" author="lagar84" created="Mon, 25 Jul 2016 19:54:31 +0000"  >&lt;p&gt;Thanks Gary!&lt;br/&gt;
Is there an estimate when a version of DBCP will be released with this fix?&lt;/p&gt;</comment>
                            <comment id="15393985" author="garydgregory" created="Tue, 26 Jul 2016 15:51:36 +0000"  >&lt;p&gt;There is no planned release date at the moment, but someone already expressed interested in volunteering to be the release manager. Could be a week or two, or more. I am sorry I cannot be more precise.&lt;/p&gt;</comment>
                            <comment id="15394320" author="jvz" created="Tue, 26 Jul 2016 18:49:49 +0000"  >&lt;p&gt;I&apos;ll be working on starting the release this week, so if the release candidate goes well, it should be released by next week.&lt;/p&gt;</comment>
                            <comment id="15394342" author="lagar84" created="Tue, 26 Jul 2016 19:02:14 +0000"  >&lt;p&gt;Excellent news, thank you all!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12986783">DBCP-464</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j233:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-445] java.lang.NoClassDefFoundError: javax/transaction/SystemException after update</title>
                <link>https://issues.apache.org/jira/browse/DBCP-445</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Updating dbcp in my OSGi application, from 2.0.1 to 2.1.1 I now get the following exception:&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;dataSource&apos;: FactoryBean threw exception on object creation; nested exception is java.lang.NoClassDefFoundError: javax/transaction/SystemException&lt;br/&gt;
	at org.springframework.beans.factory.support.FactoryBeanRegistrySupport.doGetObjectFromFactoryBean(FactoryBeanRegistrySupport.java:175) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.servicemix.bundles.spring-beans-4.2.0.RELEASE_1.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.springframework.beans.factory.support.FactoryBeanRegistrySupport.getObjectFromFactoryBean(FactoryBeanRegistrySupport.java:103) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.servicemix.bundles.spring-beans-4.2.0.RELEASE_1.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.springframework.beans.factory.support.AbstractBeanFactory.getObjectForBeanInstance(AbstractBeanFactory.java:1574) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.servicemix.bundles.spring-beans-4.2.0.RELEASE_1.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:316) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.servicemix.bundles.spring-beans-4.2.0.RELEASE_1.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:196) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.servicemix.bundles.spring-beans-4.2.0.RELEASE_1.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:351) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.servicemix.bundles.spring-beans-4.2.0.RELEASE_1.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 72 common frames omitted&lt;br/&gt;
Caused by: java.lang.NoClassDefFoundError: javax/transaction/SystemException&lt;br/&gt;
	at org.apache.commons.dbcp2.managed.LocalXAConnectionFactory.&amp;lt;init&amp;gt;(LocalXAConnectionFactory.java:57) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.commons.dbcp2.managed.BasicManagedDataSource.createConnectionFactory(BasicManagedDataSource.java:139) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.commons.dbcp2.BasicDataSource.createDataSource(BasicDataSource.java:2033) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.commons.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:1533) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.softmodeler.server.persistence.BasicManagedDataSourceFactory.getBasicManagedDataSource(BasicManagedDataSourceFactory.java:115) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.softmodeler.server.persistence.BasicManagedDataSourceFactory.getObject(BasicManagedDataSourceFactory.java:331) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.softmodeler.server.persistence.BasicManagedDataSourceFactory.getObject(BasicManagedDataSourceFactory.java:1) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.springframework.beans.factory.support.FactoryBeanRegistrySupport.doGetObjectFromFactoryBean(FactoryBeanRegistrySupport.java:168) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.servicemix.bundles.spring-beans-4.2.0.RELEASE_1.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 77 common frames omitted&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: javax.transaction.SystemException cannot be found by org.apache.commons.dbcp2_2.1.1&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:389) &lt;span class=&quot;error&quot;&gt;&amp;#91;org.eclipse.osgi_3.10.100.v20150529-1857.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:352) &lt;span class=&quot;error&quot;&gt;&amp;#91;org.eclipse.osgi_3.10.100.v20150529-1857.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:344) &lt;span class=&quot;error&quot;&gt;&amp;#91;org.eclipse.osgi_3.10.100.v20150529-1857.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.ModuleClassLoader.loadClass(ModuleClassLoader.java:160) &lt;span class=&quot;error&quot;&gt;&amp;#91;org.eclipse.osgi_3.10.100.v20150529-1857.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 85 common frames omitted&lt;/p&gt;

&lt;p&gt;In my environment I have javax.transaction 1.2, I suspected that since there is no version declared in the MANIFEST.MF, the JRE package &quot;javax.transaction&quot; is used. &lt;br/&gt;
Where there is no SystemException.&lt;/p&gt;

&lt;p&gt;So changing the Manifest.MF from  &lt;br/&gt;
 javax.transaction,&lt;br/&gt;
 javax.transaction.xa&lt;br/&gt;
to&lt;br/&gt;
 javax.transaction;version=&quot;1.1.0&quot;,&lt;br/&gt;
 javax.transaction.xa;version=&quot;1.1.0&quot;,&lt;br/&gt;
solves the issue.&lt;/p&gt;

&lt;p&gt;Setting it to version 1.1.0 instead of 1.2.0 since there is no sign that 1.2.0 is required.&lt;/p&gt;</description>
                <environment>&lt;p&gt;java 8, OSGi&lt;/p&gt;</environment>
        <key id="12856834">DBCP-445</key>
            <summary>java.lang.NoClassDefFoundError: javax/transaction/SystemException after update</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="flavio.donze">Flavio Donz&#233;</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Aug 2015 07:24:03 +0000</created>
                <updated>Fri, 29 Jul 2016 00:31:49 +0000</updated>
                            <resolved>Tue, 8 Sep 2015 22:35:14 +0000</resolved>
                                    <version>1.4</version>
                    <version>2.0</version>
                    <version>2.0.1</version>
                    <version>2.1</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14701529" author="psteitz" created="Tue, 18 Aug 2015 16:32:55 +0000"  >&lt;p&gt;What is strange is that 2.0.1, 2.0, 2.1 all have the same import-package specification.  I don&apos;t understand why any 2.x version works in your environment and 2.1.1 does not.&lt;/p&gt;</comment>
                            <comment id="14701608" author="flavio.donze" created="Tue, 18 Aug 2015 17:07:36 +0000"  >&lt;p&gt;I thought maybe SystemException is only used by 2.1.1, but both versions have a dependency in TransactionContext and TransactionRegistry.&lt;/p&gt;

&lt;p&gt;Is there a possibility that there is a use case where those two classes were not used in 2.0.1 and are used in 2.1.1?&lt;/p&gt;</comment>
                            <comment id="14701622" author="flavio.donze" created="Tue, 18 Aug 2015 17:16:05 +0000"  >&lt;p&gt;Ups, sorry my bad I also had the MANIFEST.MF of the 2.0.1 manipulated and didn&apos;t remember.&lt;br/&gt;
javax.transaction;version=&quot;1.1.0&quot;,javax.transaction.xa;version=&quot;1.1.0&quot;&lt;/p&gt;

&lt;p&gt;So this is not a problem of the 2.1.1 release but of the 2.0.1.&lt;/p&gt;</comment>
                            <comment id="14701798" author="b.eckenfels" created="Tue, 18 Aug 2015 19:03:23 +0000"  >&lt;p&gt;Not completely sure which versions to use. Also see this: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/felix-users/201211.mbox/%3CCAPr=90M+5vYjPqAvyTU+gYHr64y_FosBYELeUYcU_rFEJF3Cxw@mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/felix-users/201211.mbox/%3CCAPr=90M+5vYjPqAvyTU+gYHr64y_FosBYELeUYcU_rFEJF3Cxw@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14702578" author="flavio.donze" created="Wed, 19 Aug 2015 06:31:17 +0000"  >&lt;p&gt;I think version 1.0.0 would be ok as well, as long as there is a version on the imported package.&lt;/p&gt;

&lt;p&gt;Just noticed that I also had the dbcp 1.4 MANIFEST.MF modified as well. &lt;/p&gt;</comment>
                            <comment id="14735755" author="psteitz" created="Tue, 8 Sep 2015 22:35:14 +0000"  >&lt;p&gt;Fixed in r1701879.&lt;/p&gt;</comment>
                            <comment id="15179717" author="pmarx" created="Fri, 4 Mar 2016 10:44:41 +0000"  >&lt;p&gt;I don&apos;t think the fix is correct see &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-454&quot; title=&quot;OSGi declarations contain multiple import headers for javax.transaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-454&quot;&gt;DBCP-454&lt;/a&gt; for details.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j1gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-444] InvalidateConnection can result in closed connection returned by getConnection</title>
                <link>https://issues.apache.org/jira/browse/DBCP-444</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;BasicDataSource#invalidateConnection closes the pooled connection before invalidating it.  If a getConnection request arrives between the close and invalidate, a closed connection could be returned to a client.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12855602">DBCP-444</key>
            <summary>InvalidateConnection can result in closed connection returned by getConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Aug 2015 16:55:35 +0000</created>
                <updated>Fri, 29 Jul 2016 00:31:49 +0000</updated>
                            <resolved>Thu, 13 Aug 2015 13:52:54 +0000</resolved>
                                    <version>2.1</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14695238" author="psteitz" created="Thu, 13 Aug 2015 13:52:54 +0000"  >&lt;p&gt;Unnecessary connection close removed in r1695710.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2iu07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-443] Evictor thread not passing DBCP connectionProperties to Driver.connect()</title>
                <link>https://issues.apache.org/jira/browse/DBCP-443</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;DBCP 1.3.0 is passing connectionProperties to Driver.connect() when called during borrow, but not when called by the evictor thread. This is a problem when using DBCP with Connector/J because that MySQL JDBC driver defaults to connectTimeout=0 (indefinite hang). I am setting connectTimeout=10000 in my DBCP &amp;lt;Resource&amp;gt; connectionProperties to explicitly avoid this issue, but DBCP is not always using it in Driver.connect() calls.&lt;/p&gt;

&lt;p&gt;I did not see this issue in DBCP change log (&lt;a href=&quot;http://commons.apache.org/proper/commons-dbcp/changes-report.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-dbcp/changes-report.html&lt;/a&gt;) so I am reporting it. I am wondering if this also affects DBCP 1.4/2.x for Java 6/7 respectively, but I don&apos;t have an environment to test that.&lt;/p&gt;

&lt;p&gt;Here is the stack being used:&lt;/p&gt;

&lt;p&gt;        Tomcat 5.5.31 ===&amp;gt; DBCP 1.3.0 (w/ Pool 1.5.4) ===&amp;gt; HA-JDBC 2.0.15 ===&amp;gt; Connector/J 5.1.31&lt;/p&gt;

&lt;p&gt;For background, HA-JDBC is a JDBC proxy connection. It does two-phase to two underlying Connector/J databases defined in a separate config file. However, the issue has nothing to do with HA-JDBC.&lt;/p&gt;

&lt;p&gt;The issue is right at the DBCP entry point into Driver.connect(). In my case, that Driver.connect() call is into HA-JDBC, and it passes any connection properties down to each Connector/J Driver.connect() call.&lt;/p&gt;

&lt;p&gt;I put a debug on the first line of HA-JDBC&apos;s Driver.connect() to confirm this issue. I logged a stack trace with the value of connectTimeout passed in from DBCP. For DBCP borrow stack traces, I see connectTimeout=10000. For DBCP evictor stack traces, I see connectTimeot=null. For example:&lt;/p&gt;

&lt;p&gt;        java.lang.Exception: Driver.connect url=jdbc:ha-jdbc:cspm_mysql connectTimeout=null&lt;br/&gt;
                at net.sf.hajdbc.sql.Driver.connect(Driver.java:86)&lt;br/&gt;
                at org.apache.tomcat.dbcp.dbcp.DriverConnectionFactory.createConnection(DriverConnectionFactory.java:38)&lt;br/&gt;
                at org.apache.tomcat.dbcp.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:582)&lt;br/&gt;
                at org.apache.tomcat.dbcp.pool.impl.GenericObjectPool.addObject(GenericObjectPool.java:1617)&lt;br/&gt;
                at org.apache.tomcat.dbcp.pool.impl.GenericObjectPool.ensureMinIdle(GenericObjectPool.java:1575)&lt;br/&gt;
                at org.apache.tomcat.dbcp.pool.impl.GenericObjectPool.access$700(GenericObjectPool.java:190)&lt;br/&gt;
                at org.apache.tomcat.dbcp.pool.impl.GenericObjectPool$Evictor.run(GenericObjectPool.java:1709)&lt;br/&gt;
                at java.util.TimerThread.mainLoop(Unknown Source)&lt;br/&gt;
                at java.util.TimerThread.run(Unknown Source)&lt;/p&gt;

&lt;p&gt;If I am defining DBCP connectionProperties, I would expect DBCP to pass those properties to all calls of Driver.connect(). I see a Properties object is passed in the evictor thread, but it does not seem to be initialized properly. I am not sure how to trace that back to BasicDataSource, though.&lt;/p&gt;

&lt;p&gt;Here is my DBCP &amp;lt;Resource&amp;gt;. You can see my connectionProperties for HA-JDBC includes connectTimeout=10000.&lt;/p&gt;

&lt;p&gt;            &amp;lt;Resource name=&quot;jdbc/mydb&quot; auth=&quot;Container&quot; type=&quot;javax.sql.DataSource&quot;&lt;br/&gt;
              maxActive=&quot;100&quot; maxIdle=&quot;25&quot; minIdle=&quot;5&quot;&lt;br/&gt;
              removeAbandoned=&quot;true&quot; removeAbandonedTimeout=&quot;28800&quot; logAbandoned=&quot;true&quot;&lt;br/&gt;
              validationQueryTimeout=&quot;15&quot; validationQuery=&quot;/* ping */ SELECT 1 FOR UPDATE&quot;&lt;br/&gt;
              testOnBorrow=&quot;true&quot; testOnReturn=&quot;false&quot; maxWait=&quot;15000&quot;&lt;br/&gt;
              testWhileIdle=&quot;false&quot; timeBetweenEvictionRunsMillis=&quot;900000&quot; numTestsPerEvictionRun=&quot;10&quot; minEvictableIdleTimeMillis=&quot;1800000&quot;&lt;br/&gt;
              username=&quot;mydbpublic&quot; password=&quot;mydbpwd&quot;&lt;br/&gt;
              driverClassName=&quot;net.sf.hajdbc.sql.Driver&quot; url=&quot;jdbc:ha-jdbc:mysql&quot;&lt;br/&gt;
              connectionProperties=&quot;connectTimeout=10000;socketTimeout=20000;useUnicode=true;characterSetResults=utf8;cacheServerConfiguration=true;alwaysSendSetIsolation=false;useLocalSessionState=true;useLocalTransactionState=true;useHostsInPrivileges=false;enableQueryTimeouts=true;maintainTimeStats=false;maxAllowedPacket=-1;&quot;/&amp;gt;&lt;/p&gt;



&lt;p&gt;Another consequence of this issue is Commons Pool 1.5.4 uses a TimerTask for the evictor thread. TimerTask does not wait for previous iterations to complete. If the evictor timer runs frequenctly, this issue could accumulate socket and file descriptor resources for hung Connector/J connections. Maybe that is not a problem for DBCP -&amp;gt; Connector/J setups, but it is for DBCP -&amp;gt; HA-JDBC -&amp;gt; Connector/J stacks where HA-JDBC attempts to connect to both but only needs one of the underlying databases to connect while the other hangs.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tomcat 5.5.31 (bundles DBCP 1.3.0 and Pool 1.5.4)&lt;br/&gt;
MySQL Connector/J 5.1.31&lt;br/&gt;
MySQL 5.1&lt;/p&gt;</environment>
        <key id="12850265">DBCP-443</key>
            <summary>Evictor thread not passing DBCP connectionProperties to Driver.connect()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="justincranford@hotmail.com">Justin Cranford</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jul 2015 14:19:19 +0000</created>
                <updated>Tue, 3 Nov 2015 21:34:22 +0000</updated>
                            <resolved>Sun, 2 Aug 2015 23:00:09 +0000</resolved>
                                    <version>1.3</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14647990" author="psteitz" created="Thu, 30 Jul 2015 17:28:13 +0000"  >&lt;p&gt;Thanks for the report and work to trace.  This likely affects 2.x as well, assuming there is not something extra-DBCP/POOL going on.  What is strange is that the properties should be attached to the connection factory when the pool is initialized and the same factory is used by both the evictor and the datasource.  I will dig into this some more.  Other eyeballs, ideas welcome.&lt;/p&gt;</comment>
                            <comment id="14648273" author="psteitz" created="Thu, 30 Jul 2015 20:33:08 +0000"  >&lt;p&gt;One thing that you should try is upgrading to pool 1.5.7.  There are quite a few bug fixes between 1.5.4 and 1.5.7.  It is possible that you are hitting one of these.&lt;/p&gt;</comment>
                            <comment id="14648759" author="psteitz" created="Fri, 31 Jul 2015 05:09:05 +0000"  >&lt;p&gt;Can you see the other properties in the stack trace above?  I assume username and password at least must be going. At this point, I would suspect a driver thread-safety issue.  Have you tried upgrading to the latest version of the driver that you can use (I mean net.sf.hajdbc.sql.Driver version here, not the underlying mysql driver)?  &lt;/p&gt;</comment>
                            <comment id="14651257" author="psteitz" created="Sun, 2 Aug 2015 23:00:09 +0000"  >&lt;p&gt;I can&apos;t find evidence of a DBCP or POOL bug here.  Feel free to re-open if you can develop a unit test showing a bug in DBCP.&lt;/p&gt;</comment>
                            <comment id="14988171" author="justincranford@hotmail.com" created="Tue, 3 Nov 2015 21:34:22 +0000"  >&lt;p&gt;I found a workaround. I am not sure it points to an issue with DBCP or not.&lt;/p&gt;

&lt;p&gt;For background, my JDBC stack is: DBCP 2.1 BasicDataSource -&amp;gt; HA-JDBC 3.0.4 DataSource -&amp;gt; MySQL Connector/J 5.1.31&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DBCP2 BasicDataSource config -&amp;gt; Tomcat server.xml (without connectionProperties)&lt;/li&gt;
	&lt;li&gt;HA-JDBC DataSource config -&amp;gt; ha-jdbc-mycluster.xml (with connectionProperties)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To workaround the issue with DBCP2 evictor thread not getting connectionProperties, I copied the connectionProperties from my HA-JDBC DataSource config to my DBCP2 BasicDataSource config. After that, DBCP2 evictor thread gets the connectionProperties.&lt;/p&gt;


&lt;p&gt;I am not sure if this is expected behaviour for DBCP2 or not. I assumed DBCP2 BasicDataSource used a delegate pattern for all internal JDBC calls (ex: evictor thread) go whatever DataSource object is wraps (ex: a HA-JDBC DataSource instance). That is not the case, though. It seems to be doing delegate calls to a wrapped DataSource instance, but mixing in Driver.connect() calls which are not connected to the delegate DataSource object. By doing Driver.connect() calls, it is establishing new connections and explicitly passing its own connectionProperties instead of reusing what the DataSource already has.&lt;/p&gt;

&lt;p&gt;Anyway, I have a workaround. I thought I would let you know so you can decide if this is a DBCP2 issue or not.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i4iv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-442] All connections to MS SQL Server fail when SharedPoolDataSource has testOnBorrow set</title>
                <link>https://issues.apache.org/jira/browse/DBCP-442</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When testOnBorrow is set on a SharedPoolDataSource with connections on MS SQL Server, the first (and all subsequent) connections retrieved from the pool get the exception in this stack trace as a result of executing Connection.isValid() in the validation on borrow.&lt;/p&gt;

&lt;p&gt;java -cp &quot;.;$CLASSPATH&quot; Dbcp2TestOnBorrowFailure &apos;jdbc:sqlserver://myserver.example.com;databasename=mydb&apos; myuser mypassword&lt;br/&gt;
Iteration: 0&lt;br/&gt;
PooledConnection was reused, withoutits previous Connection being closed.&lt;br/&gt;
java.sql.SQLException: PooledConnection was reused, withoutits previous Connection being closed.&lt;br/&gt;
        at org.apache.commons.dbcp2.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:183)&lt;br/&gt;
        at org.apache.commons.dbcp2.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:951)&lt;br/&gt;
        at Dbcp2TestOnBorrowFailure.getConnection(Dbcp2TestOnBorrowFailure.java:30)&lt;br/&gt;
        at Dbcp2TestOnBorrowFailure.main(Dbcp2TestOnBorrowFailure.java:42)&lt;/p&gt;

&lt;p&gt;The code for this example is pasted in here (the preview shows that the code indentation and formatting is lost &amp;#8211; sorry):&lt;br/&gt;
----------------------------------------------------------------------&lt;br/&gt;
import java.sql.Connection;&lt;br/&gt;
import java.sql.Driver;&lt;br/&gt;
import java.sql.SQLException;&lt;br/&gt;
import java.util.Properties;&lt;/p&gt;

&lt;p&gt;import org.apache.commons.dbcp2.cpdsadapter.DriverAdapterCPDS;&lt;br/&gt;
import org.apache.commons.dbcp2.datasources.SharedPoolDataSource;&lt;/p&gt;

&lt;p&gt;public final class Dbcp2TestOnBorrowFailure {&lt;/p&gt;

&lt;p&gt;    private static final int MAX_CONNECTIONS = 3;&lt;/p&gt;

&lt;p&gt;    private final SharedPoolDataSource poolDataSource&lt;br/&gt;
        = new SharedPoolDataSource();&lt;/p&gt;

&lt;p&gt;    public Dbcp2TestOnBorrowFailure(String jdbcUrl) &lt;/p&gt;
{
        DriverAdapterCPDS cpds = new DriverAdapterCPDS();
        cpds.setUrl(jdbcUrl);

        poolDataSource.setConnectionPoolDataSource(cpds);
        poolDataSource.setMaxTotal(MAX_CONNECTIONS);
        poolDataSource.setMaxConnLifetimeMillis(300000);
        poolDataSource.setDefaultMaxWaitMillis(1000);
        poolDataSource.setDefaultAutoCommit(Boolean.TRUE);
        poolDataSource.setDefaultTestOnBorrow(true);
        poolDataSource.setValidationQueryTimeout(3000);
    }

&lt;p&gt;    public Connection getConnection(String user, String pwd) throws Exception &lt;/p&gt;
{
        return poolDataSource.getConnection(user, pwd);
    }

&lt;p&gt;    public static void main(String[] args) {&lt;br/&gt;
        if (args.length != 3) &lt;/p&gt;
{
            usage();
        }

&lt;p&gt;        Dbcp2TestOnBorrowFailure poolFailure = new Dbcp2TestOnBorrowFailure(args&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;);&lt;br/&gt;
        for (int i = 0; i &amp;lt; 10; ++i) {&lt;br/&gt;
            System.err.println(&quot;Iteration: &quot; + i);&lt;br/&gt;
            Connection conn = null;&lt;br/&gt;
            try &lt;/p&gt;
{
                conn = poolFailure.getConnection(args[1], args[2]);
                conn.close();
                conn = null;
            }
&lt;p&gt;            catch (Exception e) &lt;/p&gt;
{
                System.err.println(e.getMessage());
                e.printStackTrace(System.err);
                System.exit(88);
            }
&lt;p&gt;            finally {&lt;br/&gt;
                try {&lt;br/&gt;
                    if (conn != null) &lt;/p&gt;
{
                        conn.close();
                    }
&lt;p&gt;                } catch (SQLException e) {&lt;/p&gt;

&lt;p&gt;                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    private static void usage() &lt;/p&gt;
{
        System.err.println(&quot;Usage: java -cp ... Dbcp2TestOnBorrowFailure jdbcUrl user password&quot;);
        System.exit(77);
    }
&lt;p&gt;}&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7, fully updated as of 2015-07-24, Cygwin, Oracle Java 1.8.0_40, DBCP 2.1, MS SQL Server driver sqljdbc42.jar&lt;/p&gt;</environment>
        <key id="12849052">DBCP-442</key>
            <summary>All connections to MS SQL Server fail when SharedPoolDataSource has testOnBorrow set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jgreifwork">Jeff Greif (work)</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Jul 2015 01:13:52 +0000</created>
                <updated>Fri, 7 Aug 2015 03:42:14 +0000</updated>
                            <resolved>Sun, 26 Jul 2015 01:24:08 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.1</version>
                                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14641738" author="jgreifwork" created="Sat, 25 Jul 2015 17:52:00 +0000"  >&lt;p&gt;Same behavior for MySQL (driver mysql-connector-java-5.1.21-bin.jar).&lt;/p&gt;</comment>
                            <comment id="14641809" author="psteitz" created="Sun, 26 Jul 2015 00:30:58 +0000"  >&lt;p&gt;Thanks for reporting this.  Definitely a bug.  Requires a null validation query.  &lt;/p&gt;

&lt;p&gt;The problem is in KeyedCPDSConnectionFactory#validateObject.  If the validation query is null, the validation code just checks the connection; but unfortunately does not close the logical connection implicitly created by&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; valid = pconn.getConnection().isValid(timeout);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.&lt;/p&gt;</comment>
                            <comment id="14641818" author="psteitz" created="Sun, 26 Jul 2015 01:24:08 +0000"  >&lt;p&gt;Fixed in r1692677.&lt;/p&gt;</comment>
                            <comment id="14641819" author="jgreifwork" created="Sun, 26 Jul 2015 01:30:44 +0000"  >&lt;p&gt;The same bug appears in CPDSConnectionFactory#validateObject, I think, as the code is nearly identical.  Two questions:&lt;/p&gt;

&lt;p&gt;1.  Is the fix just including the &apos;finally&apos; clause from elsewhere in he same method in the try/catch that has the problem?&lt;/p&gt;

&lt;p&gt;2.  Is there a scheduled date for a 2.2 release?&lt;/p&gt;
</comment>
                            <comment id="14641820" author="psteitz" created="Sun, 26 Jul 2015 01:40:47 +0000"  >&lt;p&gt;Good catch.  Yes, CPDSConnectionFactory#validateObject, has the same problem.&lt;/p&gt;

&lt;p&gt;1.  Yes, the fix makes the null validation query path do the same thing that the branch that executes a query does - close the logical connection in a finally block.  &lt;/p&gt;

&lt;p&gt;2.  Should be next couple of weeks and may actually be 2.1.1&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14641995" author="psteitz" created="Sun, 26 Jul 2015 15:42:25 +0000"  >&lt;p&gt;Fix for CPDSConnectionFactory added in r1692727.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hx8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-441] Update DBCP2 configuration web page to add missing properties from BasicDataSource API and BasicDataSourceFactory config</title>
                <link>https://issues.apache.org/jira/browse/DBCP-441</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;This web page documents DBCP 2 configuration properties:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://commons.apache.org/proper/commons-dbcp/configuration.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-dbcp/configuration.html&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;I compared the listed properties to DBCP 2.1 classes BasicDataSource and BasicDataSourceFactory. I noticed 5 configuration properties supported by the code which are missing from the DBCP configuration web page. Please add these properties to the configuration documentation. Thank you.&lt;/p&gt;

&lt;p&gt;1) jmxName - mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-418&quot; title=&quot;Cannot Disable JMX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-418&quot;&gt;&lt;del&gt;DBCP-418&lt;/del&gt;&lt;/a&gt;, supported by both BasicDataSource and BasicDataSourceFactory, but not documented on the DBCP configuration web page&lt;/p&gt;

&lt;p&gt;2) enableAutoCommitOnReturn - mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-351&quot; title=&quot;setAutoCommit called too many times&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-351&quot;&gt;&lt;del&gt;DBCP-351&lt;/del&gt;&lt;/a&gt;, supported by both BasicDataSource and BasicDataSourceFactory, but not documented on the DBCP configuration web page&lt;/p&gt;

&lt;p&gt;3) rollbackOnReturn - mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-399&quot; title=&quot;Rollback on PoolableConnectionFactory.passivateObject() has to be configuration controlled.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-399&quot;&gt;&lt;del&gt;DBCP-399&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-436&quot; title=&quot;Avoid executing ROLLBACK when transaction is not active&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-436&quot;&gt;&lt;del&gt;DBCP-436&lt;/del&gt;&lt;/a&gt;, supported by both BasicDataSource and BasicDataSourceFactory, but not documented on the DBCP configuration web page&lt;/p&gt;

&lt;p&gt;4) validationQueryTimeout - mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-163&quot; title=&quot;[dbcp] Use setQueryTimeout in combination with validationQuery to recover from network problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-163&quot;&gt;&lt;del&gt;DBCP-163&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-226&quot; title=&quot;DBCP should support configuration of queryTimeout for validation queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-226&quot;&gt;&lt;del&gt;DBCP-226&lt;/del&gt;&lt;/a&gt;, supported by both BasicDataSource and BasicDataSourceFactory, but not documented on the DBCP configuration web page&lt;/p&gt;

&lt;p&gt;5) defaultQueryTimeout - mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-340&quot; title=&quot;setQueryTimeout(int)  should be set through property.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-340&quot;&gt;&lt;del&gt;DBCP-340&lt;/del&gt;&lt;/a&gt;, supported by both BasicDataSource and BasicDataSourceFactory, but not documented on the DBCP configuration web page&lt;/p&gt;

&lt;p&gt;Note: I also noticed BasicDataSource API supports setAbandonedUsageTracking which passes a configuration option to Commons Pool 2. This option is only available in BasicDataSource API, not in BasicDataSourceFactory config, so I am not sure if it was intentionally left out of BasicDataSourceFactory and the DBCP configuration web page.&lt;/p&gt;</description>
                <environment>&lt;p&gt;&lt;a href=&quot;http://commons.apache.org/proper/commons-dbcp/configuration.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-dbcp/configuration.html&lt;/a&gt;&lt;/p&gt;</environment>
        <key id="12845689">DBCP-441</key>
            <summary>Update DBCP2 configuration web page to add missing properties from BasicDataSource API and BasicDataSourceFactory config</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="justincranford@hotmail.com">Justin Cranford</reporter>
                        <labels>
                            <label>documentation</label>
                            <label>easyfix</label>
                    </labels>
                <created>Thu, 16 Jul 2015 19:05:56 +0000</created>
                <updated>Fri, 7 Aug 2015 03:41:11 +0000</updated>
                            <resolved>Sun, 2 Aug 2015 22:50:39 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14630203" author="psteitz" created="Thu, 16 Jul 2015 19:13:09 +0000"  >&lt;p&gt;Thanks for reporting this.  Patches welcome!&lt;/p&gt;</comment>
                            <comment id="14647138" author="psteitz" created="Thu, 30 Jul 2015 04:00:49 +0000"  >&lt;p&gt;Missing BDSFactory property added in r1693385.&lt;/p&gt;</comment>
                            <comment id="14651249" author="psteitz" created="Sun, 2 Aug 2015 22:50:39 +0000"  >&lt;p&gt;Missing documentation added in r1693835.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hcqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-438] Nested connections in a transaction (local) throws null pointer</title>
                <link>https://issues.apache.org/jira/browse/DBCP-438</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In a transaction context, if we open multiple connections and close each of them after commit, we get a null pointer exception. Sample code:&lt;br/&gt;
		transactionManager.begin();&lt;/p&gt;

&lt;p&gt;		Connection c1 = null;&lt;br/&gt;
		Connection c2 = null;&lt;/p&gt;

&lt;p&gt;		c1 = newConnection();&lt;br/&gt;
		c2 = newConnection();&lt;/p&gt;

&lt;p&gt;		transactionManager.commit();&lt;/p&gt;

&lt;p&gt;		try&lt;/p&gt;
{
			c1.close();
		}
&lt;p&gt;catch(Exception e)&lt;/p&gt;
{
			e.printStackTrace();
		}

&lt;p&gt;		try&lt;/p&gt;
{
			c2.close();
		}
&lt;p&gt;catch(Exception e)&lt;/p&gt;
{
			//throws execption
			e.printStackTrace();
		}

&lt;p&gt;Null pointer is thrown at:&lt;br/&gt;
org.apache.commons.dbcp2.DelegatingConnection.closeInternal&lt;/p&gt;

&lt;p&gt;Affects versions-- 2.1, 2.0&lt;/p&gt;</description>
                <environment>&lt;p&gt;All (linux, aix, windows)&lt;/p&gt;</environment>
        <key id="12826266">DBCP-438</key>
            <summary>Nested connections in a transaction (local) throws null pointer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="raihan">Raihan Kibria</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Apr 2015 10:23:45 +0000</created>
                <updated>Sat, 16 Jul 2016 00:55:27 +0000</updated>
                            <resolved>Sun, 19 Jul 2015 23:23:56 +0000</resolved>
                                    <version>2.0</version>
                    <version>2.1</version>
                                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14521288" author="raihan" created="Thu, 30 Apr 2015 10:28:30 +0000"  >&lt;p&gt;The file can be tested as it is in maven test;&lt;/p&gt;

&lt;p&gt;location:&lt;br/&gt;
src\test\java\org\apache\commons\dbcp2\managed&lt;/p&gt;

&lt;p&gt;In the console you will see the null pointer exception stacktrace.&lt;/p&gt;</comment>
                            <comment id="14521293" author="raihan" created="Thu, 30 Apr 2015 10:34:06 +0000"  >&lt;p&gt;This stack trace is from version 2.1&lt;/p&gt;</comment>
                            <comment id="14521304" author="adrianc@hlmksw.com" created="Thu, 30 Apr 2015 10:42:44 +0000"  >&lt;p&gt;We are having a similar problem in OFBiz:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OFBIZ-6218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OFBIZ-6218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;DBCP 2 v 2.1&lt;/p&gt;</comment>
                            <comment id="14522732" author="psteitz" created="Fri, 1 May 2015 03:56:17 +0000"  >&lt;p&gt;Thanks for reporting this and extra thanks for the test case.  I think the problem is likely in the updateTransactionStatus method in ManagedConnection.  &lt;/p&gt;</comment>
                            <comment id="14522739" author="psteitz" created="Fri, 1 May 2015 04:06:34 +0000"  >&lt;p&gt;A quick fix that would eliminate the NPE would be to just have DelegatingConnection#closeInternal null-check _conn.  But we should verify correctness of the logic in MC updateTransactionStatus.&lt;/p&gt;</comment>
                            <comment id="14623849" author="psteitz" created="Sun, 12 Jul 2015 15:23:52 +0000"  >&lt;p&gt;Adding the null check to DelegatingConnection#closeInternal  fixes the reported issue here (and is probably not a bad idea in any case), but I suspect that what is really going on here is that we don&apos;t correctly support the use case in the example.  I am not a JTA expert, so could use some help reviewing the code in ManagedConnection.  It looks to me like the code in this example triggers incorrect (at least incomprehensible to me) behavior in ManagedConnection#updateTransactionStatus.  Looks to me like the first connection will get closed and returned to the pool when the second one is opened.   &lt;/p&gt;</comment>
                            <comment id="14624180" author="raihan" created="Mon, 13 Jul 2015 04:14:48 +0000"  >&lt;p&gt;Our production system is running smoothly after we added the null-pointer check in the code. We configured DBCP as DataSource to run on a J2EE app-server as a separate war. The EJBs from different applications are using the DBCP data-source to get connection. The only way we could overcome the NPE was to add the null-pointer check in the source code of DBCP iteself. Handling the exception in the calling apps does not work because of different domains (exception does not get propagated to the calling apps). I wish I could help, but I am not an expert on JTA. I will need a lot of time to study the correctness of the code.&lt;/p&gt;
</comment>
                            <comment id="14632958" author="psteitz" created="Sun, 19 Jul 2015 23:23:56 +0000"  >&lt;p&gt;Null check added to DelegatingConnection#close  in r1691861.&lt;/p&gt;</comment>
                            <comment id="15380389" author="lagar84" created="Sat, 16 Jul 2016 00:55:27 +0000"  >&lt;p&gt;I am getting nullpointer also on method isClosed. Did this received the null check? I guess its related to #446&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-446&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-446&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12729461" name="TestManagedDataSourceInNesetedConnTx.java" size="2137" author="raihan" created="Thu, 30 Apr 2015 10:28:30 +0000"/>
                            <attachment id="12729462" name="dbcpNull.png" size="101701" author="raihan" created="Thu, 30 Apr 2015 10:34:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e4uf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-437] BasicDataSource does not set disconnectionSql properties on its PoolableConnectionFactory</title>
                <link>https://issues.apache.org/jira/browse/DBCP-437</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The fastFailValidation and disconnectionSqlCodes properties added in version 2.1 are not passed by BasicDataSource to its underlying PoolableConnectionFactory.  As a result, they do nothing when set on the BasicDataSource.  To work in version 2.1, these properties have to be set directly on the PoolableConnectionFactory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12823618">DBCP-437</key>
            <summary>BasicDataSource does not set disconnectionSql properties on its PoolableConnectionFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Apr 2015 00:22:21 +0000</created>
                <updated>Fri, 7 Aug 2015 03:40:10 +0000</updated>
                            <resolved>Fri, 24 Apr 2015 00:35:03 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14510146" author="psteitz" created="Fri, 24 Apr 2015 00:35:03 +0000"  >&lt;p&gt;Fixed in r1675737&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dp13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-434] Disable JMX for Statement Pool</title>
                <link>https://issues.apache.org/jira/browse/DBCP-434</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I&apos;m using the PoolableConnectionFactory and don&apos;t care about JMX, so I don&apos;t set the dataSourceJmxName, but I want to use a pool for my PreparedStatements. The makeObject() method initializes this pool automatically (lines 224-243) but seems to forget to disable JMX completely if I don&apos;t want it, i.e. GenericKeyedObjectPoolConfig.setJmxEnabled(...) is never called and always has the default value (=true). Therefore the JMX registration happens, which can cause a problem for me because of security constraints.&lt;/p&gt;

&lt;p&gt;Because of the way the makeObject() method is written, I have no influence on this part, so my quick solution was to disable the poolStatement option for the PoolableConnectionFactory and provide a custom ConnectionFactory object instead that basically does the same thing with the statement pool and also disables the JMX option.&lt;/p&gt;</description>
                <environment>&lt;p&gt;commons-dbcp2: 2.0.1&lt;br/&gt;
commons-pool2: 2.3&lt;/p&gt;</environment>
        <key id="12773430">DBCP-434</key>
            <summary>Disable JMX for Statement Pool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="thieringer">Thomas Thieringer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Feb 2015 11:11:14 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:08 +0000</updated>
                            <resolved>Fri, 13 Feb 2015 04:02:22 +0000</resolved>
                                    <version>2.0.1</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14316210" author="psteitz" created="Wed, 11 Feb 2015 13:46:52 +0000"  >&lt;p&gt;Any objections to this patch?&lt;/p&gt;</comment>
                            <comment id="14319538" author="psteitz" created="Fri, 13 Feb 2015 04:02:22 +0000"  >&lt;p&gt;More complete fix committed in r1659452.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12698081" name="DBCP-434.patch" size="784" author="psteitz" created="Wed, 11 Feb 2015 13:46:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25czr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-433] Connection leak when SQLException is thrown while enlisting in XA transaction</title>
                <link>https://issues.apache.org/jira/browse/DBCP-433</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In ManagedConnection when delegate connection is null new real (driver) connection is borroved from pool. If SQLExcetion is thrown in &apos;TransactionContext.enlistResource()&apos;  that borrowed connection is lost (leaked).&lt;br/&gt;
Short fail on network side may immediately exhaust the pool.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="12772372">DBCP-433</key>
            <summary>Connection leak when SQLException is thrown while enlisting in XA transaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vladimirfx">Vladimir Konkov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Feb 2015 14:01:50 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:16 +0000</updated>
                            <resolved>Tue, 10 Feb 2015 02:52:21 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14305090" author="vladimirfx" created="Wed, 4 Feb 2015 14:06:22 +0000"  >&lt;p&gt;Simple patch attached. &lt;br/&gt;
Sorry, I can&apos;t imaginate how to test that change. Patch is verified in our production systems.&lt;/p&gt;</comment>
                            <comment id="14311949" author="tn" created="Mon, 9 Feb 2015 09:14:20 +0000"  >&lt;p&gt;Attached a test that shows the failure.&lt;/p&gt;

&lt;p&gt;The test does the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;inject a faulty TransactionRegistry into the LocalXAConnectionFactory&lt;/li&gt;
	&lt;li&gt;the TransactionRegistry returns a Transaction which always fails when enlisting a XAResource&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For the test it was necessary to use reflection, but I guess this is acceptable in this case.&lt;/p&gt;

&lt;p&gt;I was also wondering why the connection is invalidated rather than returned to the pool. Can the connection not be used after such an exception has happened? Did you try this out in your environment?&lt;/p&gt;</comment>
                            <comment id="14312406" author="psteitz" created="Mon, 9 Feb 2015 16:23:56 +0000"  >&lt;p&gt;Thanks, Thomas!&lt;/p&gt;

&lt;p&gt;Good question on the invalidate vs. close.  Seems a bit safer to invalidate; but not knowing how this actually happens in production, I am not sure which is best.  &lt;/p&gt;</comment>
                            <comment id="14312593" author="tn" created="Mon, 9 Feb 2015 18:38:10 +0000"  >&lt;p&gt;The OP mentioned that in this scenario the pool can be quickly exhausted, but I guess the same will happen when the connection is invalidated -&amp;gt; destroyed. At least the connection will not be leaked but properly cleaned up.&lt;/p&gt;</comment>
                            <comment id="14312605" author="psteitz" created="Mon, 9 Feb 2015 18:44:13 +0000"  >&lt;p&gt;Right, the cleanup is the key thing because it frees capacity to create new connections.&lt;/p&gt;</comment>
                            <comment id="14312609" author="tn" created="Mon, 9 Feb 2015 18:46:52 +0000"  >&lt;p&gt;Ah thats what I missed, the pool has a maximum number of connections it can manage, so if all connections are leaked the pool can not create more connections.&lt;/p&gt;</comment>
                            <comment id="14313422" author="psteitz" created="Tue, 10 Feb 2015 02:52:21 +0000"  >&lt;p&gt;Patches committed in r1658616.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12696467" name="DBCP-433_patch.diff" size="2274" author="vladimirfx" created="Wed, 4 Feb 2015 14:06:22 +0000"/>
                            <attachment id="12697438" name="TestManagedConnection.java" size="7420" author="tn" created="Mon, 9 Feb 2015 09:14:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i256kn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-432] BasicDataSource createDataSource can return partially initialized DataSource</title>
                <link>https://issues.apache.org/jira/browse/DBCP-432</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The BasicDataSource instance variable, dataSource, is DCL-controlled in createDataSource; but within the sync block it is set directly and then subsequently initialized.  Threads that request connections, or access createDataSource directly while initialization is in progress will get partially initialized dataSources.  In particular, logWriters may be null and initial pool capacity may not be provisioned (if initialSize &amp;gt; 0).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12771547">DBCP-432</key>
            <summary>BasicDataSource createDataSource can return partially initialized DataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Sat, 31 Jan 2015 19:40:55 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:08 +0000</updated>
                            <resolved>Wed, 4 Feb 2015 13:44:22 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14299956" author="psteitz" created="Sat, 31 Jan 2015 19:45:06 +0000"  >&lt;p&gt;Patch to fix this issue, with unit test.&lt;/p&gt;</comment>
                            <comment id="14299968" author="adrianc@hlmksw.com" created="Sat, 31 Jan 2015 20:23:45 +0000"  >&lt;p&gt;Why not use AtomicReference?&lt;/p&gt;</comment>
                            <comment id="14299978" author="adrianc@hlmksw.com" created="Sat, 31 Jan 2015 20:48:00 +0000"  >&lt;p&gt;I&apos;m not a DBCP expert, but maybe the attached patch will be of some use.&lt;/p&gt;</comment>
                            <comment id="14300039" author="psteitz" created="Sun, 1 Feb 2015 00:34:44 +0000"  >&lt;p&gt;Thanks for  having a look, Adrian!&lt;/p&gt;

&lt;p&gt;The problem we have here is that we need the sync protection around the initialization block, which is just executed once, by the first thread that tries to get a connection to the pool (or non-standardly, by a thread that directly calls createDataSource).   We only want that code executed once.   Once the datasource is created and initialized, we want subsequent calls to return as fast as possible.  That is why the DCL setup is there.  What my patch does is to delay setting the instance field until it is initialized fully.  One could argue that it is better to let the pre-loading happen while other requests get served.  The dbcp/pool setup is robust enough so that does not cause problems.&lt;/p&gt;</comment>
                            <comment id="14301982" author="markt" created="Mon, 2 Feb 2015 21:42:44 +0000"  >&lt;p&gt;Your first patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="14305076" author="psteitz" created="Wed, 4 Feb 2015 13:44:22 +0000"  >&lt;p&gt;First patch applied in r1657221.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12695771" name="DBCP-432-AtomicReference.patch" size="2941" author="adrianc@hlmksw.com" created="Sat, 31 Jan 2015 20:48:00 +0000"/>
                            <attachment id="12695767" name="DBCP-432.patch" size="3361" author="psteitz" created="Sat, 31 Jan 2015 19:45:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i251mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-431] SQLException: Error preloading the connection pool after upgrade to commons-dbcp2</title>
                <link>https://issues.apache.org/jira/browse/DBCP-431</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hi all,&lt;/p&gt;

&lt;p&gt;We have a continuous integration environment (Jenkins) to launch our JUnits tests.&lt;br/&gt;
We had the version 1.4 of commons-dbcp to create the connection pools with Spring. The configuration was the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSourceTemplate&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.BasicDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;${aplicacion.datasource.driverClassName}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;${aplicacion.datasource.url}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;${aplicacion.datasource.user}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;${aplicacion.datasource.password}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxActive&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;15&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxIdle&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;2&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;accessToUnderlyingConnectionAllowed&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;${aplicacion.datasource.accessToUnderlyingConnectionAllowed}&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We use JUnit 4.11 and maven cobertura plugin 1.6. to launch the tests.&lt;br/&gt;
This configuration was working CORRECTLY.&lt;/p&gt;

&lt;p&gt;After upgrade to commons-dbcp2, version 2.0.1. Some unit tests are reporting errors with the following message:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Error preloading the connection pool.&lt;/p&gt;

&lt;p&gt;We launch one unit test each time, one by one. We create and destroy the connection pool every time.&lt;/p&gt;

&lt;p&gt;What can we do to solve this problem?? &lt;br/&gt;
Thank you very much.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP&lt;br/&gt;
Junit 4.11&lt;br/&gt;
Java 1.7&lt;br/&gt;
Spring 4.0&lt;br/&gt;
maven-compiler-plugin 3.2&lt;br/&gt;
maven.surefire.plugin 2.17&lt;br/&gt;
maven-cobertura-plugin 2.6&lt;br/&gt;
Jenkins 1.549&lt;/p&gt;</environment>
        <key id="12770298">DBCP-431</key>
            <summary>SQLException: Error preloading the connection pool after upgrade to commons-dbcp2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="scuenca">Sergio Cuenca</reporter>
                        <labels>
                            <label>commons-dbcp2</label>
                            <label>connection-pooling</label>
                    </labels>
                <created>Tue, 27 Jan 2015 08:56:40 +0000</created>
                <updated>Fri, 30 Jan 2015 13:27:30 +0000</updated>
                            <resolved>Fri, 30 Jan 2015 11:47:41 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14293419" author="britter" created="Tue, 27 Jan 2015 12:16:57 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scuenca&quot; class=&quot;user-hover&quot; rel=&quot;scuenca&quot;&gt;scuenca&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;the bug tracker is not a support forum. If you&apos;re having problems upgrading to the latest release, you&apos;ll probably be better of asking your question on the user mailing list (&lt;a href=&quot;http://commons.apache.org/proper/commons-dbcp/mail-lists.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-dbcp/mail-lists.html&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;regards,&lt;br/&gt;
Benedikt&lt;/p&gt;</comment>
                            <comment id="14293466" author="scuenca" created="Tue, 27 Jan 2015 13:01:11 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=britter&quot; class=&quot;user-hover&quot; rel=&quot;britter&quot;&gt;britter&lt;/a&gt;,&lt;br/&gt;
Thank you. I have sent the question to the users mailing list.&lt;/p&gt;</comment>
                            <comment id="14293972" author="psteitz" created="Tue, 27 Jan 2015 18:58:19 +0000"  >&lt;p&gt;I think this may be indicating a bug in BasicDataSource#createDataSource().  In 2.0, we relaxed the sync on this method.  I don&apos;t have a unit test yet to confirm, but I suspect the following is possible now for a pool with initialSize &amp;gt;= 1.&lt;/p&gt;

&lt;p&gt;Thread 1 - createDataSource() - enters sync block and starts creating datasource.  Executes  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; dataSource = createDataSourceInstance();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; so dataSource is not null.&lt;br/&gt;
Thread 2 - createDataSource() - gets not-yet-initialzed dataSource immediately (since not null and no sync)&lt;br/&gt;
Thread 2 - closes dataSource&lt;br/&gt;
Thread 1 - starts to initialize dataSource - bang!&lt;/p&gt;</comment>
                            <comment id="14298523" author="scuenca" created="Fri, 30 Jan 2015 11:47:04 +0000"  >&lt;p&gt;Finally we have solved the problem we had with the connection pool creation:&lt;/p&gt;

&lt;p&gt;Now, we are using the same connection pool for all unit tests. In every unit test we check if the pool is null, if it&apos;s null we create it, if it&apos;s not null we use it to get the connection.&lt;/p&gt;

&lt;p&gt;The version 1.4. of commons-dbcp worked correctly creating one connection pool for each unit test but not the 2.0 version.&lt;/p&gt;</comment>
                            <comment id="14298615" author="psteitz" created="Fri, 30 Jan 2015 13:27:30 +0000"  >&lt;p&gt;Sequence above is not possible because close is synchronized and thread 1 createDataSource performs initialization in sync(this) block.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24u0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-429] socket randomly timeout while getting connection </title>
                <link>https://issues.apache.org/jira/browse/DBCP-429</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
Our application is using DBCP1.2.2, recently our support noticed that the quartz scheduler will not execute job in a timely manner, it will get delayed about 15min or so, then run the job. From dynatrace, we noriced that the getconnection timed out at sock read.&lt;/p&gt;

&lt;p&gt;I googled online, saw similar issue reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-244&quot; title=&quot;Connection socket hangs sporadically in DBCP 1.2.2 but not 1.2.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-244&quot;&gt;&lt;del&gt;DBCP-244&lt;/del&gt;&lt;/a&gt;, in that case, the issue was in mysql, but we are using oracle11g, not sure if it is related.&lt;/p&gt;

&lt;p&gt;Your help is deeply appreciated!&lt;/p&gt;

&lt;p&gt;Cissy&lt;/p&gt;</description>
                <environment>&lt;p&gt;tomcat 7, dbcp1.2.2, oracle 11g&lt;/p&gt;</environment>
        <key id="12751430">DBCP-429</key>
            <summary>socket randomly timeout while getting connection </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cissyzhang">cissy zhang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Oct 2014 17:07:13 +0000</created>
                <updated>Wed, 29 Oct 2014 19:38:01 +0000</updated>
                            <resolved>Wed, 29 Oct 2014 19:38:01 +0000</resolved>
                                    <version>1.2.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14188863" author="psteitz" created="Wed, 29 Oct 2014 19:38:01 +0000"  >&lt;p&gt;Please use the Commons User mailing list to ask for help troubleshooting usage questions.  If you think you have actually identified a DBCP bug, feel free to reopen; but usage questions should go on the user list.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21q6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-428] Unsuccessful Connection enlistment in XA Transaction ignored by TransactionContext</title>
                <link>https://issues.apache.org/jira/browse/DBCP-428</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When TransactionContext call &apos;enlistResource()&apos; on Transaction it is ignored returned result. This hapens at least when XAResource throws XAException in enlistResource method. By contract XAException should not be propagated by &apos;enlistResource()&apos; , instead &apos;false&apos; is returned.&lt;br/&gt;
As result:&lt;br/&gt;
1. ManagedConnection returned by pool is not enlisted in transaction (application think it does)&lt;br/&gt;
2. Transaction itself marked for rollback (because of XaException).&lt;br/&gt;
3. ManagedConnection returned by pool used by application without any errors until commit on transaction is called. Changes made in not enlisted connection may be commited on other use of native connection or rolled back depending on pool config.&lt;/p&gt;

&lt;p&gt;Issue is very dangerous especialy if changed made by application will be commited later but XA transaction in witch it made has bin rolled back.&lt;/p&gt;

&lt;p&gt;We are hit by this bug in production using MS SQL Server and PostgreSQL JDBC drivers.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="12746058">DBCP-428</key>
            <summary>Unsuccessful Connection enlistment in XA Transaction ignored by TransactionContext</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vladimirfx">Vladimir Konkov</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Oct 2014 08:18:14 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:15 +0000</updated>
                            <resolved>Wed, 31 Dec 2014 16:04:17 +0000</resolved>
                                    <version>1.4</version>
                    <version>2.0.1</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14160094" author="vladimirfx" created="Mon, 6 Oct 2014 08:28:12 +0000"  >&lt;p&gt;I&apos;ve attached simple patch for this issue. Unfortunately, with current test infrastructure provide test case is very time demand. Currently code path with connection enlistment is tested only by optimistic path. I will try create separate test suite for test XA interation.&lt;/p&gt;</comment>
                            <comment id="14262274" author="psteitz" created="Wed, 31 Dec 2014 16:04:17 +0000"  >&lt;p&gt;Patch (plus test) applied in r1648727.&lt;/p&gt;

&lt;p&gt;Thanks for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12673069" name="DBCP-428.diff" size="1355" author="vladimirfx" created="Mon, 6 Oct 2014 08:28:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20tpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-426] DBCP should allow clients to mark connections as invalid</title>
                <link>https://issues.apache.org/jira/browse/DBCP-426</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Currently there is no way for a DBCP client to mark a connection as invalid, effectively requesting the pool to try to close it, remove it from the pool and reclaim pool capacity.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12744772">DBCP-426</key>
            <summary>DBCP should allow clients to mark connections as invalid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Sep 2014 19:59:08 +0000</created>
                <updated>Wed, 12 Aug 2015 16:56:45 +0000</updated>
                            <resolved>Wed, 1 Oct 2014 01:00:37 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14152285" author="kaspersor" created="Mon, 29 Sep 2014 21:01:28 +0000"  >&lt;p&gt;Here&apos;s my suggested patch (to be added in BasicDataSource):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Manually invalidates a connection, effectively requesting the pool to &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
     * to close it, remove it from the pool and reclaim pool capacity.
     * 
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IllegalStateException
     *             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; invalidating the connection failed.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void invalidateConnection(Connection connection) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IllegalStateException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connection == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connectionPool == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot invalidate connection: ConnectionPool is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.&quot;&lt;/span&gt;);
        }

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PoolableConnection poolableConnection;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            poolableConnection = connection.unwrap(PoolableConnection.class);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (poolableConnection == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot invalidate connection: Connection is not a poolable connection.&quot;&lt;/span&gt;);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot invalidate connection: Unwrapping poolable connection failed.&quot;&lt;/span&gt;, e);
        }

        &lt;span class=&quot;code-comment&quot;&gt;// attempt to close the connection &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; good measure
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            connection.close();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-comment&quot;&gt;// ignore any exceptions here
&lt;/span&gt;        }

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            connectionPool.invalidateObject(poolableConnection);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalidating connection threw unexpected exception&quot;&lt;/span&gt;, e);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14154147" author="psteitz" created="Wed, 1 Oct 2014 01:00:37 +0000"  >&lt;p&gt;Many thanks for the patch.  Applied in r1628584.&lt;/p&gt;</comment>
                            <comment id="14693314" author="bcoughlan" created="Wed, 12 Aug 2015 10:57:01 +0000"  >&lt;p&gt;I believe there is there a race condition here where the object could be borrowed from the pool after &apos;connection.close()&apos; returns it to the pool, and the underlying connection will be closed while it is borrowed by another thread.&lt;/p&gt;</comment>
                            <comment id="14693830" author="psteitz" created="Wed, 12 Aug 2015 16:56:45 +0000"  >&lt;p&gt;Thanks for the review and report, Barry.  &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-444&quot; title=&quot;InvalidateConnection can result in closed connection returned by getConnection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-444&quot;&gt;&lt;del&gt;DBCP-444&lt;/del&gt;&lt;/a&gt; opened to track this issue.  Patches / test case demonstrating the bug welcome on that ticket.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20lrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-425] Example code for pooling driver should be fixed.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-425</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Referring to &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-412&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-412&lt;/a&gt; the example code for pooling driver should also be fixed, since the same problem occurs here, too. As of now this has only been fixed in the pooling datasource example. &lt;/p&gt;

&lt;p&gt;Adding &lt;/p&gt;

&lt;p&gt;poolableConnectionFactory.setPool(connectionPool); &lt;/p&gt;

&lt;p&gt;is the solution.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12734374">DBCP-425</key>
            <summary>Example code for pooling driver should be fixed.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mutex7c">Sebastian Hinckel</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Aug 2014 09:28:10 +0000</created>
                <updated>Fri, 15 Aug 2014 15:22:46 +0000</updated>
                            <resolved>Fri, 15 Aug 2014 15:22:46 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14098666" author="mutex7c" created="Fri, 15 Aug 2014 15:22:46 +0000"  >&lt;p&gt;This is already being taken care of due to a comment to the original issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412314</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yxif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412301</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-421] java.sql.SQLException: Closed Connection</title>
                <link>https://issues.apache.org/jira/browse/DBCP-421</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We have problem similar writen in a bug &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-290&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-290&lt;/a&gt;, but for version 1.4.&lt;/p&gt;

&lt;p&gt;DBCP return not valid closed connection and this is floating bug.&lt;br/&gt;
Also after we can&apos;t rollback transaction in Spring, becouse connection is closed.&lt;/p&gt;

&lt;p&gt; Closed Connection; nested exception is java.sql.SQLException: Closed Connection&lt;br/&gt;
        at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:83)&lt;br/&gt;
        at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)&lt;br/&gt;
        at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)&lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:603)&lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:615)&lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate.batchUpdate(JdbcTemplate.java:884)&lt;br/&gt;
........some stacktrace of our code        at sun.reflect.GeneratedMethodAccessor113.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:319)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)&lt;br/&gt;
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:110)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:80)&lt;br/&gt;
........some stacktrace of our code&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor81.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:621)&lt;br/&gt;
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:610)&lt;br/&gt;
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:65)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:90)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)&lt;br/&gt;
........some stacktrace of our code&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor111.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:319)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)&lt;br/&gt;
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:110)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:90)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)&lt;br/&gt;
        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)&lt;br/&gt;
........some stacktrace of our code&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
        at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
Caused by: java.sql.SQLException: Closed Connection&lt;br/&gt;
        at oracle.jdbc.driver.SQLStateMapping.newSQLException(SQLStateMapping.java:70)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.newSQLException(DatabaseError.java:133)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:199)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:263)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:271)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:445)&lt;br/&gt;
        at oracle.jdbc.driver.PhysicalConnection.prepareStatement(PhysicalConnection.java:3127)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Oracle, Spring 3.1.2.&lt;/p&gt;</environment>
        <key id="12718352">DBCP-421</key>
            <summary>java.sql.SQLException: Closed Connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gurinderu">Nick Pavlov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jun 2014 09:59:57 +0000</created>
                <updated>Thu, 29 Feb 2024 20:00:51 +0000</updated>
                                            <version>1.3</version>
                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>396551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1w9t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>396672</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-420] InstanceKeyDataSource discards native SQLException when given password does not match password used to create the connection</title>
                <link>https://issues.apache.org/jira/browse/DBCP-420</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The throw in InstanceKeyDataSource at line 936 does not pass on the native SQL exception from the connection test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException ex) {
                &lt;span class=&quot;code-comment&quot;&gt;// Password has not changed, so refuse client, but &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; connection to the pool
&lt;/span&gt;                closeDueToException(info);
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Given password did not match password used&quot;&lt;/span&gt;
                                       + &lt;span class=&quot;code-quote&quot;&gt;&quot; to create the PooledConnection.&quot;&lt;/span&gt;);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It would be great if this throw could include the cause exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Given password did not match password used&quot;&lt;/span&gt;
                                       + &lt;span class=&quot;code-quote&quot;&gt;&quot; to create the PooledConnection.&quot;&lt;/span&gt;, ex);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;as we have code that detects login related SQLExceptions and takes actions on them. &lt;/p&gt;



</description>
                <environment></environment>
        <key id="12716054">DBCP-420</key>
            <summary>InstanceKeyDataSource discards native SQLException when given password does not match password used to create the connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rembjo0">Bjorn Vidar Remme</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 May 2014 12:08:39 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:05 +0000</updated>
                            <resolved>Fri, 23 May 2014 15:10:42 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14005861" author="rembjo0" created="Thu, 22 May 2014 12:16:47 +0000"  >&lt;p&gt;Attached a possible patch w/tests. &lt;/p&gt;

&lt;p&gt;Only the &apos;testConnectingForUserWithExistingConnectionWhenPasswordMismatchThrowsNestedSQLExceptionIfNewPasswordNotValid&apos; test is needed for this patch. &lt;/p&gt;

&lt;p&gt;Added two more tests that verify the other cases and they work as intended. No code changed needed in the code to make those pass.&lt;/p&gt;</comment>
                            <comment id="14007226" author="sebb@apache.org" created="Fri, 23 May 2014 15:10:42 +0000"  >&lt;p&gt;Thanks for the report; fixed:&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1597113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1597113&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-420&quot; title=&quot;InstanceKeyDataSource discards native SQLException when given password does not match password used to create the connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-420&quot;&gt;&lt;del&gt;DBCP-420&lt;/del&gt;&lt;/a&gt; InstanceKeyDataSource discards native SQLException when given password does not match password used to create the connection&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/dbcp/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/dbcp/trunk/src/main/java/org/apache/commons/dbcp2/datasources/InstanceKeyDataSource.java&lt;/p&gt;</comment>
                            <comment id="14008790" author="rembjo0" created="Mon, 26 May 2014 12:09:48 +0000"  >&lt;p&gt;Nice! This tiny patch was the final detail in our transition from dbcp to dbcp2. The nasty threading problem we had with the old dbcp is gone, dbcp2 looks really solid. Impressive resolve time on this issue. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12646283" name="dbcp_420_patch.txt" size="5584" author="rembjo0" created="Thu, 22 May 2014 12:16:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vvv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394401</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-419] Thread got locked while getting connection for MSSQLServer 2008DB</title>
                <link>https://issues.apache.org/jira/browse/DBCP-419</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Below exception was seen in getting connection for MSSQLServer 2008&lt;br/&gt;
pool-3-thread-17&quot; prio=10 tid=0x00002aaac0158000 nid=0x4cb7 in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000043d77000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
	at java.lang.Class.forName0(Native Method)&lt;br/&gt;
	at java.lang.Class.forName(Unknown Source)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1130)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x000000078002b498&amp;gt; (a org.apache.commons.dbcp.BasicDataSource)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:880)&lt;br/&gt;
--------------------&lt;br/&gt;
My application needs only one connection for every 60 seconds and I am using default properties of BasicDataSource.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;AIX, JDK1.7&lt;/p&gt;</environment>
        <key id="12713589">DBCP-419</key>
            <summary>Thread got locked while getting connection for MSSQLServer 2008DB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="santhosh.daida">Santhosh Daida</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 May 2014 09:54:19 +0000</created>
                <updated>Mon, 12 May 2014 18:45:04 +0000</updated>
                            <resolved>Mon, 12 May 2014 18:45:04 +0000</resolved>
                                    <version>1.2.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13995450" author="psteitz" created="Mon, 12 May 2014 18:45:04 +0000"  >&lt;p&gt;This looks like normal behavior to me.  This appears to be part of a thread dump showing one thread holding a lock.  Please use the Commons User list to ask usage questions.  If you can demonstrate a deadlock or other actual bug, feel free to reopen.  Also, it would be a good idea to upgrade to a less ancient version of DBCP.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>391905</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vhtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>392108</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-418] Cannot Disable JMX</title>
                <link>https://issues.apache.org/jira/browse/DBCP-418</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;There is no way to disable the use of JMX when using PoolableConnections. Line 48 of PoolableConnection.java uses the ManagementFactory which is blacklisted in Google App Engine.&lt;/p&gt;

&lt;p&gt;    private static MBeanServer MBEAN_SERVER = ManagementFactory.getPlatformMBeanServer();&lt;/p&gt;

&lt;p&gt;There should be a way to disable all JMX bindings for environments like GAE.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Google App Engine&lt;/p&gt;</environment>
        <key id="12712383">DBCP-418</key>
            <summary>Cannot Disable JMX</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wspeirs">Bill Speirs</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 May 2014 18:52:37 +0000</created>
                <updated>Tue, 27 Oct 2015 14:06:34 +0000</updated>
                            <resolved>Mon, 12 May 2014 19:33:53 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13991955" author="psteitz" created="Wed, 7 May 2014 16:02:12 +0000"  >&lt;p&gt;I am not sure this will actually fix GAE; but attached is the simplest fix for this.  As long as jmxName is not set in BDS or passed in to the constructor for PC, the static member will never be accessed, so no NPE.  A cleaner alternative might be to get rid of the static member altogether, but that might have a small performance impact.  Or a larger refactoring to pull out JMX altogether when jmxNames are not registered.  Better suggestions welcome.  Also, testing the patch with GAE.&lt;/p&gt;</comment>
                            <comment id="13995523" author="psteitz" created="Mon, 12 May 2014 19:33:53 +0000"  >&lt;p&gt;Patch committed in r1594068. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12908234">DBCP-449</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12643778" name="DBCP-418.patch" size="900" author="psteitz" created="Wed, 7 May 2014 16:02:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390699</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vanz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390944</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-417] BasicManagedDataSource does not free connection after transaction is commited</title>
                <link>https://issues.apache.org/jira/browse/DBCP-417</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When a JTA Transaction is commited, the Managed connection is not available again. The pool is becomes exhausted.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Jotm jotm = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Jotm(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
JdbcDataSource h2DataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JdbcDataSource();
h2DataSource.setUrl(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:h2:mem:test_mem&quot;&lt;/span&gt;);
BasicManagedDataSource basicManagedDataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicManagedDataSource();
basicManagedDataSource.setTransactionManager(jotm.getTransactionManager());
basicManagedDataSource.setXaDataSourceInstance(h2DataSource);
basicManagedDataSource.setMaxTotal(2);
basicManagedDataSource.setMaxIdle(2);

UserTransaction userTransaction = jotm.getUserTransaction();
userTransaction.begin();
Connection connection = basicManagedDataSource.getConnection();
connection.close();
userTransaction.commit();

userTransaction.begin();
connection = basicManagedDataSource.getConnection();
connection.close();
userTransaction.commit();

&lt;span class=&quot;code-comment&quot;&gt;// The managed datasource will block here as there is no available connection
&lt;/span&gt;userTransaction.begin();
connection = basicManagedDataSource.getConnection();
connection.close();
userTransaction.commit();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set the priority to Blocker as BasicManagedDataSource cannot be used at all with the bug.&lt;/p&gt;

&lt;p&gt;Tested with Geronimo Transaction Manager and JOTM.&lt;/p&gt;

&lt;p&gt;This worked well with version 1.4.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Geronimo TM and JOTM, H2Database JDBC Driver&lt;/p&gt;</environment>
        <key id="12708905">DBCP-417</key>
            <summary>BasicManagedDataSource does not free connection after transaction is commited</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="balazs.zsoldos">Balazs Zsoldos</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Apr 2014 20:41:34 +0000</created>
                <updated>Sat, 31 May 2014 04:00:34 +0000</updated>
                            <resolved>Sat, 3 May 2014 00:13:28 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13971948" author="balazs.zsoldos" created="Wed, 16 Apr 2014 20:59:49 +0000"  >&lt;p&gt;Attaching a test project that reproduces the problem. See the Unit test under src/test/java.&lt;/p&gt;</comment>
                            <comment id="13974996" author="psteitz" created="Sat, 19 Apr 2014 23:22:46 +0000"  >&lt;p&gt;Thanks for reporting this.  It looks to me like this was caused by the refactoring changes in r1547553.  &lt;/p&gt;</comment>
                            <comment id="13974997" author="psteitz" created="Sat, 19 Apr 2014 23:24:42 +0000"  >&lt;p&gt;Test case and proposed patch.  I am not sure I understand fully the intent of the r1547553 changes, so will wait for review to commit.&lt;/p&gt;</comment>
                            <comment id="13988461" author="psteitz" created="Sat, 3 May 2014 00:13:28 +0000"  >&lt;p&gt;Patch committed in r1592132&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640965" name="DBCP-417.patch" size="2652" author="psteitz" created="Sat, 19 Apr 2014 23:24:42 +0000"/>
                            <attachment id="12640534" name="test-dbcp2-BasicManagedDataSource.zip" size="4122" author="balazs.zsoldos" created="Wed, 16 Apr 2014 20:59:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387228</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1upfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387491</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-416] TestConnectionPool.testThreaded() sometimes fails</title>
                <link>https://issues.apache.org/jira/browse/DBCP-416</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;TestConnectionPool.testThreaded() sometimes fails for me:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.sql.SQLException: org.apache.commons.dbcp2.PoolablePreparedStatement with address: &lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-quote&quot;&gt;&apos;literal&apos;&lt;/span&gt;, SYSDATE from dual&quot;&lt;/span&gt; is closed.
	at org.apache.commons.dbcp2.DelegatingStatement.checkOpen(DelegatingStatement.java:120)
	at org.apache.commons.dbcp2.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:77)
	at org.apache.commons.dbcp2.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:82)
	at org.apache.commons.dbcp2.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:82)
	at org.apache.commons.dbcp2.TestConnectionPool$TestThread.run(TestConnectionPool.java:601)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12708163">DBCP-416</key>
            <summary>TestConnectionPool.testThreaded() sometimes fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Apr 2014 22:00:12 +0000</created>
                <updated>Sun, 13 Apr 2014 22:04:56 +0000</updated>
                            <resolved>Sun, 13 Apr 2014 22:04:56 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13967954" author="psteitz" created="Sun, 13 Apr 2014 22:04:56 +0000"  >&lt;p&gt;The changes committed in r1586926 were to make this happen consistently.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12708122">DBCP-415</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386486</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ukvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386750</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-415] Pooled PreparedStatements may be closed when accessed</title>
                <link>https://issues.apache.org/jira/browse/DBCP-415</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Under high concurrency, connections using pooled PreparedStatements may encounter SQLExceptions with messages of the form &quot;org.apache.commons.dbcp2.PoolablePreparedStatement with address: &apos;quoted SQL&apos; is closed.&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12708122">DBCP-415</key>
            <summary>Pooled PreparedStatements may be closed when accessed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Apr 2014 06:09:12 +0000</created>
                <updated>Tue, 15 Apr 2014 20:45:16 +0000</updated>
                            <resolved>Tue, 15 Apr 2014 20:45:16 +0000</resolved>
                                    <version>2.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13967745" author="psteitz" created="Sun, 13 Apr 2014 06:18:36 +0000"  >&lt;p&gt;Test case (commented out) added to TestPStmtPoolingBasicDataSource  in r1586926 to illustrate this bug.  I think this is likely a regression due to the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-180&quot; title=&quot;[dbcp] Dbcp doesn&amp;#39;t meet JDBC specification&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-180&quot;&gt;&lt;del&gt;DBCP-180&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</comment>
                            <comment id="13967930" author="psteitz" created="Sun, 13 Apr 2014 19:57:31 +0000"  >&lt;p&gt;The test succeeds if I move the finalizer for DelegatingStatment to PoolablePreparedStatement (and to PoolableCalledStatement too).  I think that what is going on here is that PoolablePreparedStatements themselves wrap DelegatingStatements (created by their owning PoolingConnection&apos;s delegate) and we don&apos;t want these wrapped statements to be closed by finalizers.  Limiting close-by-finalizer to the PoolableXxxStatements themselves gets them returned to the pool and does not have this effect.&lt;/p&gt;</comment>
                            <comment id="13967995" author="sebb@apache.org" created="Mon, 14 Apr 2014 00:38:07 +0000"  >&lt;p&gt;I&apos;m seeing a different problem (I think).&lt;/p&gt;

&lt;p&gt;DelegatingPreparedStatement.executeQuery() calls getDelegate(). It looks like sometimes this returns a statement created in a different thread. This looks to be because it is using a PoolablePreparedStatement &lt;br/&gt;
This extends DelegatingPreparedStatement which extends DelegatingStatement which is not thread-safe; in particular the _closed flag is not volatile. However _stmt is also not synch, nor is _conn.&lt;br/&gt;
Ideally those two should be made final. Although there is a setDelegate() method it does not appear to be used.&lt;/p&gt;

&lt;p&gt;Setting all three volatile seems to reduce the number of failures, but does not solve the problem completely.&lt;/p&gt;</comment>
                            <comment id="13968045" author="psteitz" created="Mon, 14 Apr 2014 03:50:13 +0000"  >&lt;p&gt;@Sebb - I don&apos;t think that is actually a problem.  Only one thread at a time should have access to a given PoolingConnection at a time (else we have a &lt;span class=&quot;error&quot;&gt;&amp;#91;pool&amp;#93;&lt;/span&gt; problem, which I first thought this might be, but now think it is not).  As long as clients adhere to the pool contract (which I am pretty sure DBCP does and I know the test code does from DBCP standpoint - no retained references / use after connection close), there will be no concurrent access to a single PoolingConnection.  In addition to that protection, the PoolalePreparedStatements are accessed only through their PooledObject wrappers in the GKOP owned by the PoolingConnection that they belong to.  I could be wrong, but I am pretty sure that the problem here is the &quot;back door&quot; access to the DelegatingStatement via the finalizer.  I am -0 to the volatile changes, OK if they can be shown to have zero performance impact.&lt;/p&gt;</comment>
                            <comment id="13968749" author="sebb@apache.org" created="Mon, 14 Apr 2014 19:51:39 +0000"  >&lt;p&gt;OK, having thought some more I agree it&apos;s probably not the lack of synch within the class (though it would not do any harm to limit mutability).&lt;/p&gt;

&lt;p&gt;I still think we should document the thread safety of the various classes so end users know not to share statements etc between threads.&lt;/p&gt;

&lt;p&gt;Note that it is not only concurrent access that can cause a problem, the Java memory model means that synch. is needed to ensure safe publication of updates to mutable fields.&lt;/p&gt;

&lt;p&gt;We sh/could also point out in a general page that POOL takes special care to ensure safe publication of changes to mutable fields, which is why the instances can be shared via the pool.&lt;/p&gt;</comment>
                            <comment id="13969231" author="psteitz" created="Tue, 15 Apr 2014 05:01:55 +0000"  >&lt;p&gt;Returning to the actual issue here, I am not sure now I really get the need for the finalizer as described in the javadoc for DelegatingStatement#finalize.  When statement pooling is enabled the PoolableXxxStatements are strongly held by the statement pool in the allObjects maps under their keys, so I don&apos;t see how they end up garbage collected.  On the other hand, I can see why the close needs to be there on finalization if we want the auto-cleanup behavior asked for in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-180&quot; title=&quot;[dbcp] Dbcp doesn&amp;#39;t meet JDBC specification&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-180&quot;&gt;&lt;del&gt;DBCP-180&lt;/del&gt;&lt;/a&gt;.  Unfortunately, IIUC what is going on here, the change that I suggested above will not trigger the close-on-GC behavior in general.  If we want both, we probably need to explicitly guard against the case where a DelegatingStatement is wrapped by a PoolableXxxStatement.  Could be I am missing something about the issue and fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-180&quot; title=&quot;[dbcp] Dbcp doesn&amp;#39;t meet JDBC specification&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-180&quot;&gt;&lt;del&gt;DBCP-180&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13969417" author="sebb@apache.org" created="Tue, 15 Apr 2014 10:34:59 +0000"  >&lt;p&gt;I think the PPS needs to be treated as the Statement to be finalised.&lt;br/&gt;
If it were a subclass of Statement rather than a wrapper &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, it would not make sense to close the statement without closing the PPS - the statement is an intrinsic part of the PPS.&lt;br/&gt;
So I agree that allowing the DelegatingStatement (DS) to finalise itself seems wrong; only poolable object knows when it is no longer needed by the application.&lt;/p&gt;

&lt;p&gt;I think it might be useful to add some debugging to the various finalisers to see how the DS finaliser can run if its PPS has not been finalised - if indeed that is happening.&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; this is an analogy, not a suggestion to change the code!&lt;/p&gt;</comment>
                            <comment id="13969700" author="psteitz" created="Tue, 15 Apr 2014 16:37:24 +0000"  >&lt;p&gt;The problem, if I understand the intent of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-180&quot; title=&quot;[dbcp] Dbcp doesn&amp;#39;t meet JDBC specification&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-180&quot;&gt;&lt;del&gt;DBCP-180&lt;/del&gt;&lt;/a&gt; and the current code correctly, is that when statement pooling is not enabled, you do in fact need to clean up DelegatingStatements.  The one case where you do &lt;b&gt;not&lt;/b&gt; want to close-on-finalize is when the DelegatingStatement is wrapped by a PPS.  So it seems to me the safest thing to do is to find a way to guard on that condition.&lt;/p&gt;</comment>
                            <comment id="13969734" author="b.eckenfels" created="Tue, 15 Apr 2014 16:55:37 +0000"  >&lt;p&gt;Hmm, I am not sure I follow. When using a connection pool, no matter if it is caching prepared statements or not I would expect it to track statements and resultsets issued for a certain pooled connection. If you close that all dependend objects need to be closed or at least invalidated (ideally it should be configurable if a warning is issued or not).&lt;/p&gt;

&lt;p&gt;If this is done, then there is no need for finalizers on the dependend objects.&lt;/p&gt;

&lt;p&gt;For a connection you could have a finalizer, but I think a more natural way is to have a &quot;checkout timeout&quot; since this catches other problems as well. This also avoids the need for finalizers which are so evil - not only in this bug.&lt;/p&gt;</comment>
                            <comment id="13969745" author="psteitz" created="Tue, 15 Apr 2014 17:04:41 +0000"  >&lt;p&gt;@Bernd - I agree with you, which is why I participated in the multi-year punting of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-180&quot; title=&quot;[dbcp] Dbcp doesn&amp;#39;t meet JDBC specification&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-180&quot;&gt;&lt;del&gt;DBCP-180&lt;/del&gt;&lt;/a&gt;.  Have a look at that issue, which explains why the finalizer is there (I think).&lt;/p&gt;</comment>
                            <comment id="13969970" author="peronen" created="Tue, 15 Apr 2014 19:38:08 +0000"  >&lt;p&gt;This seems to be the same issue as &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-414&quot; title=&quot;PoolablePreparedStatement can get closed while it&amp;#39;s being used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-414&quot;&gt;&lt;del&gt;DBCP-414&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13970040" author="psteitz" created="Tue, 15 Apr 2014 20:44:36 +0000"  >&lt;p&gt;Thanks, Pasi, you are correct.  I somehow missed that report before opening this one.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12707932">DBCP-414</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12708163">DBCP-416</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ukmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386709</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-414] PoolablePreparedStatement can get closed while it&apos;s being used</title>
                <link>https://issues.apache.org/jira/browse/DBCP-414</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I&apos;ve found a case where a PoolablePreparedStatement that&apos;s currently in active use can get closed (resulting in &quot;PoolablePreparedStatement with address: ... is closed&quot; SQLException to the application), from a finalizer of another DelegatingPreparedStatement (that&apos;s obviously not in use, since it&apos;s being garbage collected). &lt;/p&gt;

&lt;p&gt;Details:&lt;/p&gt;

&lt;p&gt;0. Starting point: application has a Connection (it&apos;s a PoolGuardConnectionWrapper wrapping PoolableConnection wrapping PoolingConnection wrapping com.mysql.jdbc.JDBC4Connection), statement pooling is enabled, and prepareStatement has never been called&lt;/p&gt;

&lt;p&gt;1. Application calls conn.prepareStatement. The statement pool is empty, so this ends up in PoolingConnection.makeObject, which then calls MySQL to get a PreparedStatement (stmt1), and wraps it in PoolablePreparedStatement (stmt2). PoolableConnection.prepareStatement wraps it in new DelegatingPreparedStatement (stmt3), and PoolGuardConnectionWrapper wraps it again (stmt4).&lt;/p&gt;

&lt;p&gt;2. Application does something with stmt4, and eventually calls stmt4.close(). The call ends up in stmt2.close (in PoolablePreparedStatement) which returns stmt2 to the statement pool. Stmt2.passivate() gets called, setting the _closed flag to true.&lt;/p&gt;

&lt;p&gt;3. Application forgets all about stmt4&lt;/p&gt;

&lt;p&gt;4. Later, application calls conn.prepareStatement (with same SQL) again. The result is the old MySQL PreparedStatement (stmt1) wrapped in the old PoolablePreparedStatement (stmt2) wrapped in new DelegatingPreparedStatement stmt5 wrapped in new DelegatingPreparedStatement stmt6.  Stmt2.activate() gets called, setting the _closed flag to false.&lt;/p&gt;

&lt;p&gt;5. Now, garbage collection gets run, and stmt4 gets gc&apos;d. stmt4.finalize() calls stmt4.close() which calls stmt3.close() which calls stmt2.close(). Since stmt2 is not closed any more (_closed was just set to false above), it gets closed and returned to the pool.&lt;/p&gt;

&lt;p&gt;6. Applications calls something in stmt6, which ends up in stmt2, and stmt2.checkOpen() throws exception java.sql.SQLException: org.apache.commons.dbcp2.PoolablePreparedStatement with address: &quot;com.mysql.jdbc.ServerPreparedStatement&lt;span class=&quot;error&quot;&gt;&amp;#91;12&amp;#93;&lt;/span&gt; - select 1&quot; is closed.&lt;/p&gt;

&lt;p&gt;PoolGuardConnectionWrapper prevents the application from accidentally calling stmt4.close() later again, but this doesn&apos;t prevent the finalizer.... DBCP 1.4 did not have any finalizers, so it doesn&apos;t have this bug. &lt;/p&gt;

&lt;p&gt;I guess DelegatingStatement.close() should check isClosed(), and in the finally block, also do setDelegate(null) (like PoolGuardConnectionWrapper does), to make sure the delegate (which might be in active use by someone else) can never get called via this DelegatingStatement again (although most methods in DelegatingStatement start with checkOpen(), not all of them do!).&lt;/p&gt;</description>
                <environment>&lt;p&gt;DBCP 2.0&lt;/p&gt;</environment>
        <key id="12707932">DBCP-414</key>
            <summary>PoolablePreparedStatement can get closed while it&apos;s being used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="peronen">Pasi Eronen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Apr 2014 12:54:05 +0000</created>
                <updated>Wed, 24 May 2017 07:30:14 +0000</updated>
                            <resolved>Wed, 23 Apr 2014 11:25:33 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13970043" author="psteitz" created="Tue, 15 Apr 2014 20:46:19 +0000"  >&lt;p&gt;See comments on the duplicate issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-415&quot; title=&quot;Pooled PreparedStatements may be closed when accessed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-415&quot;&gt;&lt;del&gt;DBCP-415&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13972024" author="psteitz" created="Wed, 16 Apr 2014 22:17:45 +0000"  >&lt;p&gt;I think the analysis in the bug description is correct.  In r1588087, I changed DelegatingStatement close to null the delegate reference and no-op on close.  All tests pass now.  Leaving open for now, pending review.&lt;/p&gt;</comment>
                            <comment id="13974631" author="psteitz" created="Fri, 18 Apr 2014 23:28:33 +0000"  >&lt;p&gt;Test committed in r1588592 verifying that DelegatingStatement close does not re-close wrapped PPS.  Per comments in the description, DBCP itself did not expose this bug prior to 2.0.  The changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-180&quot; title=&quot;[dbcp] Dbcp doesn&amp;#39;t meet JDBC specification&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-180&quot;&gt;&lt;del&gt;DBCP-180&lt;/del&gt;&lt;/a&gt; exposed it.&lt;/p&gt;

&lt;p&gt;Thanks, Pasi, for the report and analysis.&lt;/p&gt;</comment>
                            <comment id="13978081" author="markt" created="Wed, 23 Apr 2014 11:25:33 +0000"  >&lt;p&gt;Fix looks good to me.&lt;/p&gt;</comment>
                            <comment id="16021145" author="tmielke" created="Tue, 23 May 2017 12:44:42 +0000"  >&lt;p&gt;Apologies for commenting on this old bug but is someone able to clarify if this bug would likely also exist on version 1.4? &lt;br/&gt;
I understand it was raised against version 2.0 and wonder if this could also show up on 1.4...&lt;/p&gt;

&lt;p&gt;Any feedback is highly appreciated.&lt;/p&gt;</comment>
                            <comment id="16021465" author="psteitz" created="Tue, 23 May 2017 16:54:15 +0000"  >&lt;p&gt;Torsten - not likely this bug.  The issue documented on this ticket was (we think) a regression introduced in 2.0.&lt;/p&gt;</comment>
                            <comment id="16022452" author="tmielke" created="Wed, 24 May 2017 07:30:14 +0000"  >&lt;p&gt;Many thanks for confirming Phil!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12708122">DBCP-415</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ujgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-413] Closing a Connection does not close Statement objects created on that connection, by way of the close() method.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-413</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;While using the MS SQL 2012 jdbc drivers with dbcp, I noticed that if you create a connection, then create a preparedStatement from that connection, and close the connection object, PreparedStatement.isClosed() will return false, but you will get a SQLException stating the statement has been closed if you attempt to call any of the set or execute methods.&lt;/p&gt;

&lt;p&gt;From the JDBC spec:&lt;/p&gt;

&lt;p&gt;Connection.close&lt;/p&gt;

&lt;p&gt;An application calls the method Connection.close() to indicate that it has finished using a connection. All Statement objects created from a given Connection object will be closed when the close method for the Connection object is called.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12707541">DBCP-413</key>
            <summary>Closing a Connection does not close Statement objects created on that connection, by way of the close() method.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Mark_W">Mark W</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Apr 2014 20:06:20 +0000</created>
                <updated>Mon, 12 May 2014 21:16:01 +0000</updated>
                            <resolved>Mon, 12 May 2014 21:16:01 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13964637" author="garydgregory" created="Wed, 9 Apr 2014 20:36:54 +0000"  >&lt;p&gt;Could this be a driver issue?&lt;/p&gt;

&lt;p&gt;Can you try with the current version of DBCP as well?&lt;/p&gt;</comment>
                            <comment id="13964681" author="mark_w" created="Wed, 9 Apr 2014 21:26:38 +0000"  >&lt;p&gt;it may be a driver issues, but I didn&apos;t know which it was, DBCP or our drivers. Thought I would start here. I doubt I will be able to upgrade DBCP. Do you know of a way for me to verify that it is the MS drivers?&lt;/p&gt;</comment>
                            <comment id="13964885" author="psteitz" created="Thu, 10 Apr 2014 01:38:29 +0000"  >&lt;p&gt;Do you have statement pooling configured?  In general, once you close a connection, your client code should discard references to and not attempt further operations on the connection or any statements or resultsets created using it.  DBCP does try to comply with the spec above so in fact the statements should be getting closed on connection close.  Can you provide more info on exactly what your client code is doing?&lt;/p&gt;</comment>
                            <comment id="13964908" author="b.eckenfels" created="Thu, 10 Apr 2014 02:12:07 +0000"  >&lt;p&gt;I have used the follwing test code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; test;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Connection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.PreparedStatement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.SQLException;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.sql.DataSource;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.ConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.DriverManagerConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.PoolableConnection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.PoolableConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp2.PoolingDataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool2.ObjectPool;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool2.impl.GenericObjectPool;


&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DBCPTest
{

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException
    {
        DataSource ds = setupDataSource(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:h2:target/testdb&quot;&lt;/span&gt;);
        Connection c = ds.getConnection();
        PreparedStatement ps = c.prepareStatement(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 1 FROM DUAL&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;impls: connection=&quot;&lt;/span&gt; + c.getClass() + &lt;span class=&quot;code-quote&quot;&gt;&quot; ps=&quot;&lt;/span&gt; + ps.getClass());
        c.close();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;ps is closed? &quot;&lt;/span&gt; + ps.isClosed());
        ps.close();
    }


    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DataSource setupDataSource(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connectURI)
    {
        ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DriverManagerConnectionFactory(connectURI,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(connectionFactory, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        ObjectPool&amp;lt;PoolableConnection&amp;gt; connectionPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool&amp;lt;&amp;gt;(poolableConnectionFactory);
        poolableConnectionFactory.setPool(connectionPool);
        PoolingDataSource&amp;lt;PoolableConnection&amp;gt; dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource&amp;lt;&amp;gt;(connectionPool);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dataSource;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And with H2 database it returns true for isClosed() and it silently skips the close on the ps:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;impls: connection=&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.commons.dbcp2.PoolingDataSource$PoolGuardConnectionWrapper ps=&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.commons.dbcp2.DelegatingPreparedStatement
ps is closed? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suggest the OP tries it with MSSQL and jTDS drivers.&lt;/p&gt;</comment>
                            <comment id="13965534" author="psteitz" created="Thu, 10 Apr 2014 16:52:07 +0000"  >&lt;p&gt;DBCP should both set the isClosed property on its wrapper for the PreparedStatement and close the actual JDBC statement when a connection borrowed from the pool is closed.  The driver should treat repeated close on a statement as no-op.  What does not make sense in this case is isClosed returning false. That could point to a DBCP bug (though not what the title for this issue suggests).  If statement pooling is enabled and there are concurrent clients involved, this scenario is possible with the right timing and does not indicate a bug in DBCP - just reconfirms that clients should &lt;b&gt;not&lt;/b&gt; use anything associated with a connection once it has been returned to the pool.&lt;/p&gt;</comment>
                            <comment id="13974901" author="psteitz" created="Sat, 19 Apr 2014 16:13:14 +0000"  >&lt;p&gt;Unless a test case or code illustrating an actual bug here is provided, I am inclined to close this as invalid.  &lt;/p&gt;</comment>
                            <comment id="13995642" author="psteitz" created="Mon, 12 May 2014 21:16:01 +0000"  >&lt;p&gt;Feel free to reopen if / when a test case showing an actual bug can be constructed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uh1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-412] dbcp2.PoolableConnection.close raises NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/DBCP-412</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I found a critical error while closing a PoolableConnection.&lt;br/&gt;
Here&apos;s the code to reproduce the bug (largely copied from the example shown in the Apache DBCP site):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;PoolingDataSourceExample2.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;&lt;/span&gt;);
    DataSource dataSource = setupDataSource(jdbcUrl);

    Connection connection = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    PreparedStatement statement = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    ResultSet result = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        connection = dataSource.getConnection();
        statement = connection.prepareStatement(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 1&quot;&lt;/span&gt;);
        result = statement.executeQuery();
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        result.close();
        statement.close();
        connection.close();
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DataSource setupDataSource(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connectURI) {
    ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DriverManagerConnectionFactory(connectURI, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(connectionFactory, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    ObjectPool&amp;lt;PoolableConnection&amp;gt; connectionPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool&amp;lt;&amp;gt;(poolableConnectionFactory);
    PoolingDataSource&amp;lt;PoolableConnection&amp;gt; dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource&amp;lt;&amp;gt;(connectionPool);

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dataSource;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the code tries to close the connection (in the final block), an exception is raised:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;PoolingDataSourceExample2.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException
	at org.apache.commons.dbcp2.PoolableConnection.close(PoolableConnection.java:151)
	at org.apache.commons.dbcp2.DelegatingConnection.closeInternal(DelegatingConnection.java:235)
	at org.apache.commons.dbcp2.DelegatingConnection.close(DelegatingConnection.java:218)
	at org.apache.commons.dbcp2.PoolingDataSource$PoolGuardConnectionWrapper.close(PoolingDataSource.java:212)
	at dbcp.PoolingDataSourceExample2.closeQuietly(PoolingDataSourceExample2.java:64)
	at dbcp.PoolingDataSourceExample2.main(PoolingDataSourceExample2.java:43)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As I can see, the problem is the &quot;_pool&quot; variable inside PoolableConnection but I could not find any solution.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OSX, Java 7, SQLAzure&lt;/p&gt;</environment>
        <key id="12706393">DBCP-412</key>
            <summary>dbcp2.PoolableConnection.close raises NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="DavideCaroselli">Davide Caroselli</reporter>
                        <labels>
                            <label>NullPointerException</label>
                            <label>PoolableConnection</label>
                    </labels>
                <created>Thu, 3 Apr 2014 10:10:22 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:06 +0000</updated>
                            <resolved>Sat, 14 Feb 2015 00:04:56 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13959040" author="psteitz" created="Thu, 3 Apr 2014 18:01:03 +0000"  >&lt;p&gt;The problem is in the example code.  In version 2, the PoolableConnectionFactory constructor no longer takes the parent pool as a parameter.  To correctly set up the pool manually, we need to set the pool property of the PoolableConnectionFactory using its setPool method.  So above we need to add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; poolableConnectionFactory.setPool(connectionPool) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should fix this in the example and add unit tests confirming that the examples work.  Patches welcome.&lt;/p&gt;</comment>
                            <comment id="13959087" author="psteitz" created="Thu, 3 Apr 2014 18:59:54 +0000"  >&lt;p&gt;It might also a good idea to have the PoolingDataSource constructor check that its pool&apos;s factory refers back to itself.&lt;/p&gt;</comment>
                            <comment id="13959716" author="davidecaroselli" created="Fri, 4 Apr 2014 07:31:43 +0000"  >&lt;p&gt;Ok, I&apos;ve modified the code but I found another issue (maybe). This is the example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;PoolingDataSourceExample2.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;&lt;/span&gt;);
    DataSource dataSource = setupDataSource(jdbcUrl);

    Connection connection = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    PreparedStatement statement = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    ResultSet result = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

    &lt;span class=&quot;code-comment&quot;&gt;// = EDITED ==============
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 100; i++)
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            connection = dataSource.getConnection();
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(connection.hashCode());
            statement = connection.prepareStatement(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 1&quot;&lt;/span&gt;);
            result = statement.executeQuery();
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            result.close();
            statement.close();
            connection.close();
        }
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DataSource setupDataSource(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connectURI) {
    ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DriverManagerConnectionFactory(connectURI, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(connectionFactory, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    ObjectPool&amp;lt;PoolableConnection&amp;gt; connectionPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool&amp;lt;&amp;gt;(poolableConnectionFactory);

    &lt;span class=&quot;code-comment&quot;&gt;// = EDITED ==============
&lt;/span&gt;    connectionPool.setMaxTotal(1);
    poolableConnectionFactory.setPool(connectionPool);

    PoolingDataSource&amp;lt;PoolableConnection&amp;gt; dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource&amp;lt;&amp;gt;(connectionPool);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dataSource;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now the code does not throw exceptions anymore, but it returns always a new connection.&lt;br/&gt;
I request 100 times, but every time the connection hashcode is different; I&apos;ve made a similar example but with DBCP v1.4 over Common Pool 1.6 and with these jars the hashcode is always the same.&lt;/p&gt;

&lt;p&gt;Is this normal or does it really create new connection anytime?&lt;/p&gt;</comment>
                            <comment id="13959971" author="psteitz" created="Fri, 4 Apr 2014 13:49:46 +0000"  >&lt;p&gt;The difference in behavior is likely due to the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-358&quot; title=&quot;Equals implementations in DelegatingXxx classes are not symmetric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-358&quot;&gt;&lt;del&gt;DBCP-358&lt;/del&gt;&lt;/a&gt;.  The hashcodes you are examining are those of the DelegatingConnection instances returned by PoolingDataSource.  As of 2.0, DelegatingConnection instances wrapping the same underlying physical connection are not equal.  If you have a way to see the physical connections in the database, you should be able to verify that there is just one being used by the code (else there is a bug here).&lt;/p&gt;</comment>
                            <comment id="13960176" author="davidecaroselli" created="Fri, 4 Apr 2014 17:41:32 +0000"  >&lt;p&gt;Ok I&apos;ve made a test as you suggested and you&apos;re right! Although the connection wrapper is different everytime, the open connections db-side are exactly equals to the value set by setMaxTotal. Great, thanks!&lt;/p&gt;</comment>
                            <comment id="13960959" author="psteitz" created="Sat, 5 Apr 2014 04:20:47 +0000"  >&lt;p&gt;Sample code in PoolingDataSourceExample fixed in r1584958.&lt;/p&gt;

&lt;p&gt;Still to do:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Update other examples (incl header comments)&lt;/li&gt;
	&lt;li&gt;Add unit tests to verify examples work - for this example, either TesterDriver has to modified to handle uid/pwd in URL or example has to set props&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13975206" author="psteitz" created="Sun, 20 Apr 2014 17:59:33 +0000"  >&lt;p&gt;Thinking about this some more, I think it would be a good idea to have the PoolingDataSource constructor check and if necessary fix the factory-pool linkage.  Attached patch does this.  Comments / better ideas welcome.&lt;/p&gt;</comment>
                            <comment id="13988428" author="psteitz" created="Fri, 2 May 2014 23:34:09 +0000"  >&lt;p&gt;PDS constructor check added in r1592119&lt;/p&gt;</comment>
                            <comment id="14098378" author="mutex7c" created="Fri, 15 Aug 2014 09:19:42 +0000"  >&lt;p&gt;The same problem still exists in the examples for the pooling driver. Adding &lt;/p&gt;

&lt;p&gt;poolableConnectionFactory.setPool(connectionPool) &lt;/p&gt;

&lt;p&gt;solves the problem here, too.&lt;/p&gt;</comment>
                            <comment id="14098664" author="psteitz" created="Fri, 15 Aug 2014 15:17:28 +0000"  >&lt;p&gt;Thanks for pointing out the inconsistency in current code in the examples, Sebastien.  The check added in r1592119 makes it unnecessary to add the setPool (once this code is released).  Reopening as we should make the examples consistent.  I think we should add the setPool calls for now as current released code requires them.  Will get to this ASAP unless someone beats me to it. &lt;/p&gt;</comment>
                            <comment id="14321014" author="psteitz" created="Sat, 14 Feb 2015 00:04:56 +0000"  >&lt;p&gt;Fixed examples in r1659726.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640994" name="DBCP-412.patch" size="2680" author="psteitz" created="Sun, 20 Apr 2014 17:59:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384716</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u9zr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384983</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-411] BasicManagedDataSource - unregister from JMX on close()</title>
                <link>https://issues.apache.org/jira/browse/DBCP-411</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;There is a JMX registration issue in TestBasicManagedDataSource.&lt;/p&gt;

&lt;p&gt;If the test is run with logging:&lt;/p&gt;

&lt;p&gt;mvn test -Dtest=TestBasicManagedDataSource -Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.SimpleLog&lt;/p&gt;

&lt;p&gt;then lots of stack traces are shown as below.&lt;/p&gt;

&lt;p&gt;This appears to be because each name can only be registered once.&lt;/p&gt;

&lt;p&gt;Perhaps the test is flawed, and it should deregister the name in tearDown() ?&lt;br/&gt;
However there does not seem to be a way to deregister the name.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[WARN] BasicDataSource - Failed to complete JMX registration &amp;lt;javax.management.InstanceAlreadyExistsException: org.apache.commons.dbcp2:name=test&amp;gt;javax.management.InstanceAlreadyExistsException: org.apache.commons.dbcp2:name=test
        at com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:437)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerWithRepository(DefaultMBeanServerInterceptor.java:1898)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:966)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:900)
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:324)
        at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:522)
        at org.apache.commons.dbcp2.BasicDataSource.jmxRegister(BasicDataSource.java:2224)
        at org.apache.commons.dbcp2.BasicDataSource.createDataSource(BasicDataSource.java:1909)
        at org.apache.commons.dbcp2.BasicDataSource.getConnection(BasicDataSource.java:1433)
        at org.apache.commons.dbcp2.TestBasicDataSource.getConnection(TestBasicDataSource.java:48)
        at org.apache.commons.dbcp2.TestConnectionPool.testHashing(TestConnectionPool.java:530)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at junit.framework.TestCase.runTest(TestCase.java:176)
        at junit.framework.TestCase.runBare(TestCase.java:141)
        at junit.framework.TestResult$1.protect(TestResult.java:122)
        at junit.framework.TestResult.runProtected(TestResult.java:142)
        at junit.framework.TestResult.run(TestResult.java:125)
        at junit.framework.TestCase.run(TestCase.java:129)
        at junit.framework.TestSuite.runTest(TestSuite.java:255)
        at junit.framework.TestSuite.run(TestSuite.java:250)
        at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:84)
        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:264)
        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:153)
        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:124)
        at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:200)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:153)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:103)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12697251">DBCP-411</key>
            <summary>BasicManagedDataSource - unregister from JMX on close()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Feb 2014 23:25:24 +0000</created>
                <updated>Sat, 3 Jan 2015 19:31:12 +0000</updated>
                            <resolved>Wed, 26 Feb 2014 16:04:07 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13912341" author="sebb@apache.org" created="Wed, 26 Feb 2014 00:55:20 +0000"  >&lt;p&gt;Adding the following code to the close() method seems to avoid the problem&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (registeredJmxName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        mbs.unregisterMBean(registeredJmxName);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (JMException e) {
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to unregister the JMX name: &quot;&lt;/span&gt; + registeredJmxName, e);
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        registeredJmxName = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does that make sense to apply?&lt;/p&gt;</comment>
                            <comment id="13912748" author="markt" created="Wed, 26 Feb 2014 10:33:01 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;</comment>
                            <comment id="13913070" author="sebb@apache.org" created="Wed, 26 Feb 2014 16:04:07 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1572118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1572118&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-411&quot; title=&quot;BasicManagedDataSource - unregister from JMX on close()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-411&quot;&gt;&lt;del&gt;DBCP-411&lt;/del&gt;&lt;/a&gt; BasicManagedDataSource - unregister from JMX on close()&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/dbcp/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/dbcp/trunk/src/main/java/org/apache/commons/dbcp2/BasicDataSource.java&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1squn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376021</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-410] build.xml: wrong path for javadoc.overview</title>
                <link>https://issues.apache.org/jira/browse/DBCP-410</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Path needs to be updated for dbcp2 to solve javadoc error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12694152">DBCP-410</key>
            <summary>build.xml: wrong path for javadoc.overview</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="a17r">Andreas Sturmlechner</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sun, 9 Feb 2014 13:00:04 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:20 +0000</updated>
                            <resolved>Mon, 10 Feb 2014 09:28:19 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13895892" author="a17r" created="Sun, 9 Feb 2014 13:02:01 +0000"  >&lt;p&gt;trivial fix&lt;/p&gt;</comment>
                            <comment id="13896354" author="markt" created="Mon, 10 Feb 2014 09:28:19 +0000"  >&lt;p&gt;Thanks for the report and the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12627860" name="commons-dbcp-2.0.0_pre20140209-build.xml.patch" size="701" author="a17r" created="Sun, 9 Feb 2014 13:02:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372661</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s813:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372965</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-408] dbcp samples need revising</title>
                <link>https://issues.apache.org/jira/browse/DBCP-408</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;This is regarding the examples given under commons-dbcp project. &lt;br/&gt;
Recently, I tried PoolingDriverExample.java but it came up with few issues.&lt;/p&gt;

&lt;p&gt;Please let me know if it&apos;s because I used the latest set of jars.&lt;/p&gt;

&lt;p&gt;commons-collections4-4.0&lt;br/&gt;
commons-dbcp-1.4&lt;br/&gt;
commons-pool2-2.0&lt;/p&gt;

&lt;p&gt;The package import statements do need to change but there seems to be more changes needed in the code.&lt;/p&gt;

&lt;p&gt;I didn&apos;t try the other 2 samples. It would be great if those are revised too.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;OS: Windows 7, Web server/container: apache tomcat 7&lt;/p&gt;</environment>
        <key id="12682885">DBCP-408</key>
            <summary>dbcp samples need revising</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="john77eipe">john eipe</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Dec 2013 12:12:01 +0000</created>
                <updated>Sat, 3 Jan 2015 19:32:18 +0000</updated>
                            <resolved>Thu, 5 Dec 2013 12:22:50 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13840045" author="markt" created="Thu, 5 Dec 2013 12:22:50 +0000"  >&lt;p&gt;DBCP 1.x depends on Pool 1.x.&lt;/p&gt;

&lt;p&gt;You can&apos;t mix and match 1.x and 2.x libraries with Pool and DBCP.&lt;/p&gt;</comment>
                            <comment id="13840111" author="john77eipe" created="Thu, 5 Dec 2013 14:34:29 +0000"  >&lt;p&gt;There is something wrong with the packages mentioned in the file and the actual import statements. Could some one test this example classes?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362142</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qfav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-407] PoolablePreparedStatement invalidated because of non cleared batch</title>
                <link>https://issues.apache.org/jira/browse/DBCP-407</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In PoolablePreparedStatement, passivate() method:&lt;br/&gt;
The first thing in this method is to consider the statement as closed. But then, if a batch has been added, the clearBatch() method is called.&lt;br/&gt;
That call is delegated to DelegatingStatement that send an SQLException because Statement is already considered as closed.&lt;br/&gt;
Then the statement is removed from the pool cache because of this so the cache is useless.&lt;br/&gt;
Maybe it should be better to get the innermost delegate in passivate() and then call clearBatch() on the underlying statement?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12682395">DBCP-407</key>
            <summary>PoolablePreparedStatement invalidated because of non cleared batch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="steeveb">Steeve Beroard</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Dec 2013 14:29:26 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:19 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 23:37:54 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                    <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12533878">DBCP-372</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361652</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 48 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qcbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361950</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-404] Mutable fields should be private</title>
                <link>https://issues.apache.org/jira/browse/DBCP-404</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Non-private mutable fields make thread-safety harder.&lt;/p&gt;

&lt;p&gt;Make all mutable fields private (or at worst package-protected), and use getters/setters for access if necessary.&lt;/p&gt;

&lt;p&gt;This allows synchronisation to be easily added later if necessary, as well as potentially allowing validation of values.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12676950">DBCP-404</key>
            <summary>Mutable fields should be private</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Oct 2013 20:11:00 +0000</created>
                <updated>Sat, 31 May 2014 04:07:46 +0000</updated>
                            <resolved>Sun, 2 Feb 2014 20:38:10 +0000</resolved>
                                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356326</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pffj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356614</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-403] DelegatingStatement.close() fails with NPE if statement is null</title>
                <link>https://issues.apache.org/jira/browse/DBCP-403</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;DelegatingStatement.close() fails with NPE if the _stmt field is null.&lt;/p&gt;

&lt;p&gt;The code should check whether the field is null before trying to close the statement.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12676925">DBCP-403</key>
            <summary>DelegatingStatement.close() fails with NPE if statement is null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Oct 2013 18:28:54 +0000</created>
                <updated>Sat, 3 Jan 2015 19:32:42 +0000</updated>
                            <resolved>Thu, 31 Oct 2013 18:35:11 +0000</resolved>
                                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13810533" author="sebb@apache.org" created="Thu, 31 Oct 2013 18:35:11 +0000"  >&lt;p&gt;Note: this was found by fixing Eclipse warnings about unclosed resources&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1537577&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1537577&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-403&quot; title=&quot;DelegatingStatement.close() fails with NPE if statement is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-403&quot;&gt;&lt;del&gt;DBCP-403&lt;/del&gt;&lt;/a&gt; DelegatingStatement.close() fails with NPE if statement is null&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/dbcp/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/dbcp/trunk/src/java/org/apache/commons/dbcp2/DelegatingStatement.java&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356301</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pf9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-401] PoolableConnectionFactory.validateConnection() doesn&apos;t test connection.isValid()</title>
                <link>https://issues.apache.org/jira/browse/DBCP-401</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;On my environment, we sometimes get notified that something was changed on the DB servers (servers added/removed from the pool, master/slave promotion, etc).&lt;/p&gt;

&lt;p&gt;In these cases, we want to discard all existing connections in the pool and let it create new ones with the updated configuration.&lt;/p&gt;

&lt;p&gt;My initial idea is to have existing Connections returning isValid() == false after these events.&lt;br/&gt;
But, after lots of debugging, it turns out that having the connection.isValid() returning false doesn&apos;t make it go away from the connection pool, since it is never checked.&lt;/p&gt;

&lt;p&gt;Fixing it would be very simple, and I can send you the patch, but I don&apos;t know if there is any reason it was left out in the first place, or if it would cause compatibility issues (Probably not).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12674054">DBCP-401</key>
            <summary>PoolableConnectionFactory.validateConnection() doesn&apos;t test connection.isValid()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="paulo_raca">Paulo Costa</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Oct 2013 03:33:09 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:07 +0000</updated>
                            <resolved>Wed, 5 Feb 2014 22:40:15 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13796458" author="paulo_raca" created="Wed, 16 Oct 2013 05:55:48 +0000"  >&lt;p&gt;I propose this diff: &lt;a href=&quot;http://pastebin.com/AyswZmP1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pastebin.com/AyswZmP1&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12505412">DBCP-357</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353677</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oz6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-400] The documentation of maxOpenPreparedStatements parameter seems to be wrong</title>
                <link>https://issues.apache.org/jira/browse/DBCP-400</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We had earlier a datasource, which had no maxOpenPreparedStatements property defined. Something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;basicDataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.BasicDataSource&quot;&lt;/span&gt; init-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;createDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;poolPreparedStatements&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.url}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.driverClassName}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.username}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.password}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.initialSize}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxActive&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.maxActive}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.maxIdle}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.minIdle}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;timeBetweenEvictionRunsMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.timeBetweenEvictionRunsMillis}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minEvictableIdleTimeMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.minEvictableIdleTimeMillis}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxWait&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.maxWait}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then we wanted to have a parameter to limit the prepared statement pool, so we added a new line for the maxOpenPreparedStatements (for compatibility reasons we added the line with a config file having &apos;0&apos; value which should mean unlimited according to the documentation at &lt;a href=&quot;http://commons.apache.org/proper/commons-dbcp/configuration.html):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-dbcp/configuration.html):&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;basicDataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.BasicDataSource&quot;&lt;/span&gt; init-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;createDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;poolPreparedStatements&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxOpenPreparedStatements&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.maxOpenPreparedStatements}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;		
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.url}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.driverClassName}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.username}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.password}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.initialSize}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxActive&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.maxActive}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.maxIdle}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.minIdle}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;timeBetweenEvictionRunsMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.timeBetweenEvictionRunsMillis}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minEvictableIdleTimeMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.minEvictableIdleTimeMillis}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxWait&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${datasource.maxWait}&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We ended up in having the following exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.sql.SQLException: MaxOpenPreparedStatements limit reached
	at org.apache.commons.dbcp.PoolingConnection.prepareStatement(PoolingConnection.java:109)
	at org.apache.commons.dbcp.DelegatingConnection.prepareStatement(DelegatingConnection.java:281)
	at org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.prepareStatement(PoolingDataSource.java:313)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
...
...
[:1.7.0_07]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)[:1.7.0_07]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)[:1.7.0_07]
	at java.lang.reflect.Method.invoke(Method.java:601)[:1.7.0_07]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:309)
	at org.springframework.osgi.service.importer.support.internal.aop.ServiceInvoker.doInvoke(ServiceInvoker.java:58)
	at org.springframework.osgi.service.importer.support.internal.aop.ServiceInvoker.invoke(ServiceInvoker.java:62)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:131)
	at org.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.osgi.service.util.internal.aop.ServiceTCCLInterceptor$1.run(ServiceTCCLInterceptor.java:47)
	at org.springframework.osgi.util.internal.PrivilegedUtils.executeWithCustomTCCL(PrivilegedUtils.java:124)[80:org.springframework.osgi.core:1.2.1]
	at org.springframework.osgi.service.util.internal.aop.ServiceTCCLInterceptor.invokePrivileged(ServiceTCCLInterceptor.java:44)
	at org.springframework.osgi.service.util.internal.aop.ServiceTCCLInterceptor.invoke(ServiceTCCLInterceptor.java:36)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.osgi.service.importer.support.LocalBundleContextAdvice.invoke(LocalBundleContextAdvice.java:59)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:131)
	at org.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)
	at $Proxy69.getSpecializedSequenceProvider(Unknown Source)
	at ...)
	... 36 more
Caused by: java.util.NoSuchElementException: Pool exhausted
	at org.apache.commons.pool.impl.GenericKeyedObjectPool.borrowObject(GenericKeyedObjectPool.java:1143)
	at org.apache.commons.dbcp.PoolingConnection.prepareStatement(PoolingConnection.java:107)
	... 67 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it turned out, that the documentation is wrong. Only negative numbers like -1 mean unlimited. 0 seems to mean limited to one item. Please correct the documentation to avoid problems of others.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12660059">DBCP-400</key>
            <summary>The documentation of maxOpenPreparedStatements parameter seems to be wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gabor.liptak">G&#225;bor Lipt&#225;k</reporter>
                        <labels>
                            <label>limit</label>
                            <label>pool</label>
                    </labels>
                <created>Fri, 26 Jul 2013 13:50:59 +0000</created>
                <updated>Sat, 31 May 2014 04:06:57 +0000</updated>
                            <resolved>Sat, 11 Jan 2014 20:05:36 +0000</resolved>
                                    <version>1.4</version>
                    <version>1.4.1</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13721099" author="psteitz" created="Fri, 26 Jul 2013 19:17:15 +0000"  >&lt;p&gt;Thanks for reporting this.  You are correct, the documentation should say that negative values indicate no limit.&lt;/p&gt;

&lt;p&gt;We should make sure to fix all javadoc as well.  In several cases, we incorrectly (and non-standardly) use the term &quot;non-positive&quot; when we mean &quot;negative.&quot;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1monj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340569</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-399] Rollback on PoolableConnectionFactory.passivateObject() has to be configuration controlled.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-399</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In certain databases like IBM DB2, the rollback calls are costly. Also, on any database, this avoids an unnecessary call to DB upon returning a connection back to pool, and thus enhances the application performance.&lt;/p&gt;

&lt;p&gt;So it would be good, if there is an optional configuration parameter that controls the &quot;rollbackAsCleanUpAction&quot; behaviour. This can be made &quot;false&quot; (can be true by default, aiming current users) if the application can guarantee itself that, no connection is returned to the pool without an explicit call to commit() or rollback(), even in the case of a non-readonly and non-autocommit connection.&lt;/p&gt;

&lt;p&gt;A few more bits: This caused a 1/11, i.e. approx 10% performance loss in our application. Hence making this a bug (a performance issue), and not a Feature Request / Improvement!&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any databases, especially on those, where the rollback calls are costly.&lt;/p&gt;</environment>
        <key id="12657991">DBCP-399</key>
            <summary>Rollback on PoolableConnectionFactory.passivateObject() has to be configuration controlled.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="girishadat">Girish Adat</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>performance</label>
                    </labels>
                <created>Tue, 16 Jul 2013 12:52:25 +0000</created>
                <updated>Sat, 31 May 2014 04:07:23 +0000</updated>
                            <resolved>Fri, 14 Feb 2014 11:47:24 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13852989" author="yossis" created="Thu, 19 Dec 2013 16:02:50 +0000"  >&lt;p&gt;The same is true with the passivate object calling conn.setAutoCommit(true); whenever autocommit is disabled.&lt;/p&gt;</comment>
                            <comment id="13901360" author="markt" created="Fri, 14 Feb 2014 11:47:24 +0000"  >&lt;p&gt;New option rollbackOnReturn added &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338185</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mbxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-398] DBCP hangs on common pool borrowObject when PoolableConnection is used and the underlying connection closed unexpectedly (connection resets/timouts)</title>
                <link>https://issues.apache.org/jira/browse/DBCP-398</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The bug is in org.apache.commons.dbcp.PoolableConnection as isClosed method on this calls super.isClosed which returns true (as DelegatingConnection::isClosed &lt;/p&gt;
{ _closed || _conn.isClosed() }
&lt;p&gt;). Since PoolableConnection needs to release objects to pool even if the underlying connection is closed the isClosed method should be overridden in this class and should return _closed. This _closed is the delegating connection close which will be set to false even if the underlying connection is closed (_conn.isClosed). The fix should also not throw on PoolableConnection::Close method if underlying connection is closed as this state is a valid state and is expected.&lt;/p&gt;

&lt;p&gt;Also currently the way it stands the clients of PoolableConnection will/may not call Close() as isClosed always returns true in this case.&lt;/p&gt;

&lt;p&gt;Below is the stack that the thread hangs on:&lt;/p&gt;

&lt;p&gt;&#9726;waiting on &amp;lt;0x00000007b5a50e48&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool$Latch)&lt;br/&gt;
 at java.lang.Object.wait(Object.java:503)&lt;br/&gt;
 at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1104)&lt;br/&gt;
&#9726;locked &amp;lt;0x00000007b5a50e48&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool$Latch)&lt;br/&gt;
 at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:106)&lt;br/&gt;
 at org.datanucleus.store.rdbms.ConnectionProviderPriorityList.getConnection(ConnectionProviderPriorityList.java:57)&lt;br/&gt;
 at org.datanucleus.store.rdbms.ConnectionFactoryImpl$ManagedConnectionImpl.getConnection(ConnectionFactoryImpl.java:354)&lt;br/&gt;
 at org.datanucleus.store.rdbms.ConnectionFactoryImpl$ManagedConnectionImpl.getXAResource(ConnectionFactoryImpl.java:314)&lt;br/&gt;
 at org.datanucleus.store.connection.ConnectionManagerImpl.enlistResource(ConnectionManagerImpl.java:386)&lt;br/&gt;
 at org.datanucleus.store.connection.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:252)&lt;br/&gt;
 at org.datanucleus.store.connection.AbstractConnectionFactory.getConnection(AbstractConnectionFactory.java:60)&lt;br/&gt;
 at org.datanucleus.store.AbstractStoreManager.getConnection(AbstractStoreManager.java:449)&lt;br/&gt;
 at org.datanucleus.store.AbstractStoreManager.getConnection(AbstractStoreManager.java:418)&lt;br/&gt;
 at org.datanucleus.store.rdbms.query.JDOQLQuery.performExecute(JDOQLQuery.java:595)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12648699">DBCP-398</key>
            <summary>DBCP hangs on common pool borrowObject when PoolableConnection is used and the underlying connection closed unexpectedly (connection resets/timouts)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sarvesh.sn">Sarvesh Sakalanaga</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 May 2013 19:59:58 +0000</created>
                <updated>Sat, 11 Apr 2015 04:25:50 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 21:27:52 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                    <version>2.0</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13664140" author="garydgregory" created="Wed, 22 May 2013 14:27:24 +0000"  >&lt;p&gt;Can you provide a unit test that exhibits this behavior?&lt;/p&gt;</comment>
                            <comment id="13664216" author="garydgregory" created="Wed, 22 May 2013 16:08:40 +0000"  >&lt;p&gt;What version are you using?&lt;/p&gt;</comment>
                            <comment id="13664249" author="sarvesh.sn" created="Wed, 22 May 2013 16:52:41 +0000"  >&lt;p&gt;Version 1.4&lt;/p&gt;</comment>
                            <comment id="13664259" author="sarvesh.sn" created="Wed, 22 May 2013 17:05:16 +0000"  >&lt;p&gt;Unfortunately it&#8217;s not that easy to write a unit test that can do this. If you are using sql server and Data nucleus as your ORM (or any client that uses PoolableConnection) then you can do something like this to repro the bug.&lt;/p&gt;

&lt;p&gt;1) Take table exclusive connection lock&lt;/p&gt;

&lt;p&gt;SET TRANSACTION ISOLATION LEVEL SERIALIZABLE&lt;br/&gt;
GO&lt;br/&gt;
BEGIN TRANSACTION&lt;br/&gt;
UPDATE sds&lt;br/&gt;
SET CD_ID = CD_ID&lt;br/&gt;
WAITFOR DELAY &apos;00:06:00&apos;  &amp;#8211; 6 minutes   hh:mm:ss&lt;br/&gt;
ROLLBACK TRANSACTION&lt;br/&gt;
GO&lt;/p&gt;

&lt;p&gt;2) Connect to the server using the client that used PoolableConnection&lt;br/&gt;
3) You should see the connections when you do : SELECT * FROM sys.dm_exec_sessions&lt;br/&gt;
4) Execute some query on the table. EG: Select * from sds;&lt;br/&gt;
5) Execute &quot;Kill XXX&quot; (replace XXX with spid) to kill the connections. This should close the underlyingconnection but the PoolableConnection will not be closed.&lt;br/&gt;
6) Call IsClosed on PoolableConnection. (BUG as it returns true);&lt;br/&gt;
7) Since IsClosed returns true the client will never call Close and the object is not release to pool.&lt;/p&gt;

&lt;p&gt;Hope this helps!&lt;/p&gt;</comment>
                            <comment id="13664292" author="garydgregory" created="Wed, 22 May 2013 17:30:08 +0000"  >&lt;p&gt;A seemingly simple change like replacing &lt;tt&gt;isClosed()&lt;/tt&gt; an implementation like: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _conn == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; : _conn.isClosed();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;causes a lot of unit tests to fail.&lt;/p&gt;

&lt;p&gt;You can get the code from &lt;a href=&quot;https://svn.apache.org/repos/asf/commons/proper/dbcp/branches/DBCP_1_4_x_BRANCH&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/commons/proper/dbcp/branches/DBCP_1_4_x_BRANCH&lt;/a&gt; and try it yourself.&lt;/p&gt;

&lt;p&gt;You can then provide a patch. You use an local Java database like H2 or HyperSQL for your unit tests.&lt;/p&gt;

&lt;p&gt;The next release would be 1.4.1, which we could push out ASAP since there are other fixes ready.&lt;/p&gt;
</comment>
                            <comment id="13664345" author="sarvesh.sn" created="Wed, 22 May 2013 18:00:45 +0000"  >&lt;p&gt;Here is the patch. Unit tests are passing on my system and I have also verified that the problem does not repro after this fix. &lt;/p&gt;</comment>
                            <comment id="13664658" author="garydgregory" created="Wed, 22 May 2013 23:13:57 +0000"  >&lt;p&gt;I confirm that the patch applies cleanly and does not cause the tests to fail.&lt;/p&gt;

&lt;p&gt;Can someone else review the patch to confirm that we are OK with the changes in behavior?&lt;/p&gt;

&lt;p&gt;Tested with Revision: 1485419&lt;br/&gt;
Apache Maven 3.0.5 (r01de14724cdef164cd33c7c8c2fe155faf9602da; 2013-02-19 08:51:28-0500)&lt;br/&gt;
Maven home: C:\Java\apache-maven-3.0.5\bin\..&lt;br/&gt;
Java version: 1.7.0_21, vendor: Oracle Corporation&lt;br/&gt;
Java home: C:\Program Files\Java\jdk1.7.0_21\jre&lt;br/&gt;
Default locale: en_US, platform encoding: Cp1252&lt;br/&gt;
OS name: &quot;windows 7&quot;, version: &quot;6.1&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;&lt;/p&gt;</comment>
                            <comment id="13664719" author="psteitz" created="Thu, 23 May 2013 00:04:16 +0000"  >&lt;p&gt;I will take a careful look in the next couple of days.  We should also develop unit tests illustrating the problem. I will think about it some more, but I am not sure I am OK with swallowing the exception when an underlying connection that has been closed without the knowledge of the pool is passivated.  I also need to do some detailed tracing to make sure the analysis above is correct.  Here again, unit tests are key to understanding.  The mock objects in src/test should be useful for this.&lt;/p&gt;</comment>
                            <comment id="13665381" author="psteitz" created="Thu, 23 May 2013 17:24:56 +0000"  >&lt;p&gt;I have a question for the OP.  Does your problem go away if you omit the exception suppression from the patch?  I am still working on tests / traces, but it looks to me like on the path indicated, the pooled connection should get invalidated, so there should be no premature pool starvation.  Is it possible that the client code is holding additional connection handles that get abandoned due to the exception not being handled?  Have you tried turning on abandoned connection tracking?  If pool counters are getting corrupted, this is a serious issue; if not, it really just impacts direct users of PoolableConnection.&lt;/p&gt;</comment>
                            <comment id="13665396" author="sarvesh.sn" created="Thu, 23 May 2013 17:39:38 +0000"  >&lt;p&gt;No the actual problem is with isClosed method. The client code is very simple. It first checks to see if the PoolableConnection is closed and if its closed it does not call close on it.&lt;br/&gt;
No I have not turned on abandoned connection tracking and AFAIK this impacts only  users of PoolableConnection.&lt;/p&gt;</comment>
                            <comment id="13665399" author="sarvesh.sn" created="Thu, 23 May 2013 17:41:16 +0000"  >&lt;p&gt;Here is the client code : &lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.datanucleus/datanucleus-rdbms/2.0.4/org/datanucleus/store/rdbms/ConnectionFactoryImpl.java#ConnectionFactoryImpl.ManagedConnectionImpl.close%28%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.datanucleus/datanucleus-rdbms/2.0.4/org/datanucleus/store/rdbms/ConnectionFactoryImpl.java#ConnectionFactoryImpl.ManagedConnectionImpl.close%28%29&lt;/a&gt; &lt;br/&gt;
Look at ManagedConnectionImpl::Close - Line 589&lt;/p&gt;</comment>
                            <comment id="13666376" author="psteitz" created="Fri, 24 May 2013 14:48:16 +0000"  >&lt;p&gt;Thanks, Sarvesh. Looking at the client code, I now understand what is going on. You are using isClosed() to decide whether or not to close (i.e. return to the pool) the PoolableConnection.  Sorry for being a little slow. I agree that the isClosed implementation in PoolableConnection is questionable, but it arguably conforms to the JDBC spec (closed means it can no longer be used to connect to the database) and I wonder what other client apps might break if we change it.  I am on the fence and would appreciate some more community input on whether or not we should make this change, which is a basically a change in the contract for PoolableConnection#isClosed.  It could be that it is best to make this change in 2.0 (which has the same behavior) or via a new method (see below).  Arguably, the client code should not be testing isClosed, but just invoking close directly.  As of 1.3/1.4, close is idempotent, so there is no risk of exception on multiple close.  In any case, once a connection has been returned to the pool, clients should discard references to it.&lt;/p&gt;

&lt;p&gt;What do others think about the proposed changes in behavior:&lt;/p&gt;

&lt;p&gt;(1) drop _con.isClosed() test from PoolableConnection#isClosed() (so &quot;closed&quot; really means &quot;has been returned to the pool&quot;) &lt;br/&gt;
(2) do not throw when a connection that has been closed without knowledge of the pool is closed.&lt;/p&gt;

&lt;p&gt;One more note on this. If we do decide to make change (1), it might be better to implement it in the PoolGuardConnectionWrapper, possibly even implementing a new method, isDiscarded() or somesuch to disambiguate isClosed.&lt;/p&gt;</comment>
                            <comment id="13666409" author="sarvesh.sn" created="Fri, 24 May 2013 16:04:49 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phil%40steitz.com&quot; class=&quot;user-hover&quot; rel=&quot;phil@steitz.com&quot;&gt;phil@steitz.com&lt;/a&gt; for diligence, lets wait for some community feedback. I am +1 for option 1) as I think IsClosed needs to be disambiguated.   &lt;/p&gt;</comment>
                            <comment id="13666463" author="garydgregory" created="Fri, 24 May 2013 17:03:18 +0000"  >&lt;p&gt;WRT (1), looking at the JDBC Javadoc:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Retrieves whether &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &amp;lt;code&amp;gt;Connection&amp;lt;/code&amp;gt; object has been
     * closed.  A connection is closed &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the method &amp;lt;code&amp;gt;close&amp;lt;/code&amp;gt;
     * has been called on it or &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; certain fatal errors have occurred.
     * This method is guaranteed to &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/code&amp;gt; only when
     * it is called after the method &amp;lt;code&amp;gt;Connection.close&amp;lt;/code&amp;gt; has
     * been called.
     * &amp;lt;P&amp;gt;
     * This method generally cannot be called to determine whether a
     * connection to a database is valid or invalid.  A typical client
     * can determine that a connection is invalid by catching any
     * exceptions that might be thrown when an operation is attempted.
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/code&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &amp;lt;code&amp;gt;Connection&amp;lt;/code&amp;gt; object
     *         is closed; &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/code&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it is still open
     * @exception SQLException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a database access error occurs
     */
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since we manage our own &apos;closed&apos; ivar, it seems valid to only look at its value for our implementation of &lt;tt&gt;isClosed&lt;/tt&gt;. This assumes that the ivar state is correct at all times.&lt;/p&gt;</comment>
                            <comment id="13666835" author="psteitz" created="Fri, 24 May 2013 23:41:44 +0000"  >&lt;p&gt;I am inclined to agree that having isClosed return true iff close has been called on the DelegatingConnection would be better. The spec allows what we do now, but especially the 4.0 version makes it clear that isClosed should mean the client has called close (so the &quot;or if certain fatal errors have occurred&quot; should really be dropped from above).  What I worry about is the impact on any apps that may depend on the current behavior.&lt;/p&gt;</comment>
                            <comment id="13709948" author="thomaslee" created="Tue, 16 Jul 2013 17:20:25 +0000"  >&lt;p&gt;We&apos;re getting bitten by this bug fairly frequently on a pre-production system. The proposed patch looks simple enough that I&apos;m thinking I may simply be able to extend PoolingDataSource &amp;amp; override the isClosed() method with the proposed implementation, but are there any other work-arounds we can try first?&lt;/p&gt;</comment>
                            <comment id="13709976" author="psteitz" created="Tue, 16 Jul 2013 17:43:06 +0000"  >&lt;p&gt;Consensus on the dev list &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is that we should &lt;b&gt;not&lt;/b&gt; change the isClosed contract.  Client code should not test isClosed before returning a connection and should not rely on properties of the connection handle once a connection has been returned.  Javadoc will be updated, but we are not going to change the implementation.  The simple workaround is not to test isClosed before returning the connection to the pool.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://markmail.org/thread/qzevcticenh7cabx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/qzevcticenh7cabx&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13710197" author="thomaslee" created="Tue, 16 Jul 2013 20:39:35 +0000"  >&lt;p&gt;So does that mean the check on line 77 in the current implementation of PoolableConnection is incorrect?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/commons/proper/dbcp/trunk/src/java/org/apache/commons/dbcp2/PoolableConnection.java?view=markup&amp;amp;pathrev=1431684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/commons/proper/dbcp/trunk/src/java/org/apache/commons/dbcp2/PoolableConnection.java?view=markup&amp;amp;pathrev=1431684&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like it&apos;s doing the one work of returning the connection to the pool.&lt;/p&gt;

&lt;p&gt;For the record, we&apos;re using PoolingDataSource + QueryRunner from commons-dbutils. QueryRunner doesn&apos;t concern itself with pooling &amp;amp; instead relies on the underlying DataSource + Connection objects to borrow &amp;amp; return objects respectively. Here, I think that means PoolingDataSource + PoolableConnection:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;PoolingDataSource.getConnection() borrows the connection from the pool.&lt;/li&gt;
	&lt;li&gt;PoolableConnection.close() should then return the connection to the pool.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;How would we have PoolableConnection correctly return itself to the pool? Neither our code nor QueryRunner seems to make any attempt to explicitly return connections to the pool &amp;#8211; instead, both rely on the semantics of PoolableConnection.close() to return the connection to the pool.&lt;/p&gt;

&lt;p&gt;Entirely possible I&apos;m getting confused here, just trying to clarify &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13711783" author="psteitz" created="Wed, 17 Jul 2013 23:15:25 +0000"  >&lt;p&gt;Hi Tom,&lt;/p&gt;

&lt;p&gt;Thanks for having a look at the code. The code you reference is correct per the current (in need of better documentation) contract.  When a connection is returned by the client (by calling close on its handle), DBCP checks to make sure that the underlying physical connection has not been closed.  If that is the case, something bad has happened - i.e., the physical connection has been closed without the knowledge of the pool.  In that case, the wrapper object is &lt;b&gt;not&lt;/b&gt; returned to the pool, but rather destroyed and an exception is generated (so as not to silently ignore what could be an important infrastructure problem).&lt;/p&gt;

&lt;p&gt;If I understand your statements above about how you are using PoolingDataSource, it should work correctly just calling close() on connection handles, which really means &quot;return me to the pool.&quot;  In general, there is no need to test isClosed() before returning a connection to the pool and, per comments above, this is in general not a good thing to do.  Also, if connections being managed by the pool are being closed without the pool&apos;s involvement, the root cause of this infrastructure problem should be determined and resolved.&lt;/p&gt;</comment>
                            <comment id="13889938" author="markt" created="Mon, 3 Feb 2014 21:27:52 +0000"  >&lt;p&gt;It is worth noting that the behaviour has been modified slightly in 2.x to address &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-391&quot; title=&quot;Close on invalid connections throws unexpected exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-391&quot;&gt;&lt;del&gt;DBCP-391&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I have clarified the Javadoc for PoolableConnection#isClosed() in 2.x and 1.5.x.&lt;/p&gt;</comment>
                            <comment id="14487459" author="elyograg" created="Thu, 9 Apr 2015 14:55:03 +0000"  >&lt;p&gt;I seem to be having this problem, or at least one that&apos;s very similar, with DBCP 2.1.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;b&quot; prio=10 tid=0x00007fcc7450c800 nid=0x65e2 waiting on condition [0x00007fcc1bbb4000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  &amp;lt;0x00000000db121ea8&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
        at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:583)
        at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:442)
        at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:363)
        at org.apache.commons.dbcp2.PoolingDataSource.getConnection(PoolingDataSource.java:134)
        at com.REDACTED.idxbuild.db.Database.getConnection(Database.java:221)
        at com.REDACTED.idxbuild.db.Database.getColumnSet(Database.java:571)
        at com.REDACTED.idxbuild.solr.Chain.doReinsert(Chain.java:1332)
        - locked &amp;lt;0x00000000db0011c8&amp;gt; (a java.lang.Object)
        at com.REDACTED.idxbuild.solr.Chain.updateIndex(Chain.java:1985)
        at com.REDACTED.idxbuild.solr.Chain.run(Chain.java:2145)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This issue says fixed, but doesn&apos;t indicate which version.  Should I file a new issue, or sign up for the mailing list for further discussion?&lt;/p&gt;

&lt;p&gt;I&apos;m using mysql-connector-java-5.1.35-bin.jar for JDBC.  My validation query is &quot;SELECT 1&quot;, and the validation timeout is 5.&lt;/p&gt;</comment>
                            <comment id="14490772" author="psteitz" created="Sat, 11 Apr 2015 04:25:50 +0000"  >&lt;p&gt;Better to post to the user list.  Quick look at the trace above looks like normal behavior waiting for an available connection.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12584347" name="DBCP-398.0.patch" size="840" author="sarvesh.sn" created="Wed, 22 May 2013 18:00:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329054</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 29 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1krtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-397] Exception ORA-01000 [Number of open cursors exceeds the limit] is faced when prepared statement pooling is enabled in DBCP 1.3</title>
                <link>https://issues.apache.org/jira/browse/DBCP-397</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Previously our application was using following setting with DBCP 1.2.1&lt;/p&gt;

&lt;p&gt;&amp;lt;property name=&quot;poolPreparedStatements&quot;&amp;gt;&lt;br/&gt;
&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;property name=&quot;maxOpenPreparedStatements&quot;&amp;gt;&lt;br/&gt;
&amp;lt;value&amp;gt;40&amp;lt;/value&amp;gt; &lt;/p&gt;

&lt;p&gt;And in the oracle DB around 30 open cursors were found during high load. &lt;/p&gt;

&lt;p&gt;But when we upgrade DBCP version to 1.3 even during normal load conditions the number of open cursors keeps on increasing and reaches up to the maximum allowed limit (i.e. 1000 cursors per connection). It results an exception &quot;nested exception is java.sql.SQLException: ORA-01000: maximum open cursors exceeded&quot;. After this exception no DB query is processed.  &lt;/p&gt;

&lt;p&gt;Same problematic behavior is noticed with DBCP 1.4.&lt;/p&gt;

&lt;p&gt;When poolPreparedStatements is set to false the number of maximum open cursors never goes beyond 6 (in all DBCP versions 1.2.1/1.3/1.4)&lt;/p&gt;</description>
                <environment>&lt;p&gt;jdk 1.6_u25&lt;br/&gt;
dbcp 1.3/1.4&lt;br/&gt;
SunOS&lt;br/&gt;
Spring 2.0.6&lt;br/&gt;
Oracle 10.0.2&lt;/p&gt;</environment>
        <key id="12638779">DBCP-397</key>
            <summary>Exception ORA-01000 [Number of open cursors exceeds the limit] is faced when prepared statement pooling is enabled in DBCP 1.3</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pejoshi">Peeyush Joshi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Mar 2013 05:25:01 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:16 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 23:39:20 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13613153" author="psteitz" created="Mon, 25 Mar 2013 21:22:17 +0000"  >&lt;p&gt;Does your application do batch updates?  If so, this could be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-372&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-372&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Do you have abandoned connection removal configured?  Can you provide the full DBCP config?&lt;/p&gt;

&lt;p&gt;One final question: do you have multiple threads concurrently accessing the same logical connection (check out once from pool and share across threads)?&lt;/p&gt;</comment>
                            <comment id="13613510" author="pejoshi" created="Tue, 26 Mar 2013 05:22:15 +0000"  >&lt;p&gt;Yes it&apos;s case 1: our application does batch updates. &lt;/p&gt;

&lt;p&gt;Thank you. &lt;/p&gt;</comment>
                            <comment id="13614096" author="psteitz" created="Tue, 26 Mar 2013 15:09:49 +0000"  >&lt;p&gt;Actually looks like a duplicate - in any case, likely same root cause: bugged fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-264&quot; title=&quot;clear batch when closing statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-264&quot;&gt;&lt;del&gt;DBCP-264&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12533878">DBCP-372</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12533878">DBCP-372</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j33j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-395] Please help.. Oracle connection problems.. Is it over connected or stucked?</title>
                <link>https://issues.apache.org/jira/browse/DBCP-395</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We had ran email sendding system over 10 years. Recently we had oracle connection problem. We have 8 servers and all servers had same problem.&lt;br/&gt;
My system&apos;s thread dump is following. I appreciate any helps. Thanks.&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
&quot;Thread-6293&quot; daemon prio=10 tid=0x00007f65cc35e800 nid=0x637c waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f65c6e3b000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
        at ep.server.epmailer.util.EPPoolingDataSource.getConnection(EPPoolingDataSource.java:72)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x00000000fb430c20&amp;gt; (a java.lang.Class for ep.server.epmailer.util.EPPoolingDataSource)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.checkOtherMailerStatus(EPMailSenderThread.java:2799)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.run(EPMailSenderThread.java:438)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Thread-6292&quot; daemon prio=10 tid=0x00007f65cc35d800 nid=0x637b waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f65beab4000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
        at ep.server.epmailer.util.EPPoolingDataSource.getConnection(EPPoolingDataSource.java:72)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x00000000fb430c20&amp;gt; (a java.lang.Class for ep.server.epmailer.util.EPPoolingDataSource)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.updateSuccessMail(EPMailSenderThread.java:2597)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.run(EPMailSenderThread.java:330)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
&quot;Thread-6291&quot; daemon prio=10 tid=0x00007f65cc80c000 nid=0x6377 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f65beaf4000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
        at java.net.SocketInputStream.read(SocketInputStream.java:129)&lt;br/&gt;
        at oracle.net.ns.Packet.receive(Unknown Source)&lt;br/&gt;
        at oracle.net.ns.NSProtocol.connect(Unknown Source)&lt;br/&gt;
        at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:844)&lt;br/&gt;
        at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:268)&lt;br/&gt;
        at oracle.jdbc.driver.PhysicalConnection.&amp;lt;init&amp;gt;(PhysicalConnection.java:414)&lt;br/&gt;
        at oracle.jdbc.driver.T4CConnection.&amp;lt;init&amp;gt;(T4CConnection.java:165)&lt;br/&gt;
        at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:35)&lt;br/&gt;
        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:801)&lt;br/&gt;
        at java.sql.DriverManager.getConnection(DriverManager.java:582)&lt;br/&gt;
        at java.sql.DriverManager.getConnection(DriverManager.java:185)&lt;br/&gt;
        at org.apache.commons.dbcp.DriverManagerConnectionFactory.createConnection(DriverManagerConnectionFactory.java:48)&lt;br/&gt;
        at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:290)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00000000c231e9a8&amp;gt; (a org.apache.commons.dbcp.PoolableConnectionFactory)&lt;br/&gt;
        at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:771)&lt;br/&gt;
        at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:95)&lt;br/&gt;
        at ep.server.epmailer.util.EPPoolingDataSource.getConnection(EPPoolingDataSource.java:75)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00000000fb430c20&amp;gt; (a java.lang.Class for ep.server.epmailer.util.EPPoolingDataSource)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.checkOtherMailerStatus(EPMailSenderThread.java:2799)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.run(EPMailSenderThread.java:438)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Thread-6290&quot; daemon prio=10 tid=0x00007f65cc1b8800 nid=0x6376 waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f65c68e6000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
        at ep.server.epmailer.util.EPPoolingDataSource.getConnection(EPPoolingDataSource.java:72)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x00000000fb430c20&amp;gt; (a java.lang.Class for ep.server.epmailer.util.EPPoolingDataSource)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.checkOtherMailerStatus(EPMailSenderThread.java:2799)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.run(EPMailSenderThread.java:438)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Thread-6289&quot; daemon prio=10 tid=0x00007f65cc318800 nid=0x6375 waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f65bebb8000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
        at ep.server.epmailer.util.EPPoolingDataSource.getConnection(EPPoolingDataSource.java:72)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x00000000fb430c20&amp;gt; (a java.lang.Class for ep.server.epmailer.util.EPPoolingDataSource)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.updateRecvTable(EPMailSenderThread.java:2943)&lt;br/&gt;
        at ep.server.epmailer.EPMailSenderThread.run(EPMailSenderThread.java:463)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;...&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS : Ubuntu 11.10&lt;br/&gt;
JDK : 1.6&lt;br/&gt;
Database : Oracle 10g&lt;br/&gt;
JDBC Driver : oracle jdbc driver type 4&lt;br/&gt;
DB Commits per secs : 600&lt;/p&gt;</environment>
        <key id="12628671">DBCP-395</key>
            <summary>Please help.. Oracle connection problems.. Is it over connected or stucked?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="i1befree">Jungryong Lee</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Jan 2013 07:49:52 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:15 +0000</updated>
                            <resolved>Tue, 22 Jan 2013 09:05:00 +0000</resolved>
                                    <version>1.2.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13559464" author="i1befree" created="Tue, 22 Jan 2013 07:52:45 +0000"  >&lt;p&gt;For more details, I attached thread dump file.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13559494" author="markt" created="Tue, 22 Jan 2013 09:05:00 +0000"  >&lt;p&gt;Jira is not a support forum. Please use the users mailing list.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12565913" name="epmailer.out_" size="1052204" author="i1befree" created="Tue, 22 Jan 2013 07:52:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>307196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ahuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>269357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-394] BasicDataSource doesn&apos;t work correct when using two objects with different connection URLs</title>
                <link>https://issues.apache.org/jira/browse/DBCP-394</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;It looks like that if I create one BasicDataSource for one DB and second BasicDataSource for another DB that they connections got messed up so the app brakes. &lt;/p&gt;

&lt;p&gt;I moved not to use BasicDataSource but plain connections and the problem looks like being resolved.&lt;/p&gt;

&lt;p&gt;I put this as a major issue since I don&apos;t find it documented and of course two objects shall be supported unless it&apos;s singleton. Also this could brake app in production which happened to me.&lt;/p&gt;</description>
                <environment>&lt;p&gt;N/A, but using Mysql and Linux&lt;/p&gt;</environment>
        <key id="12618514">DBCP-394</key>
            <summary>BasicDataSource doesn&apos;t work correct when using two objects with different connection URLs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mladen.adamovic">Mladen Adamovic</reporter>
                        <labels>
                    </labels>
                <created>Sun, 2 Dec 2012 22:11:27 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:21 +0000</updated>
                            <resolved>Sun, 2 Dec 2012 23:47:58 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="302400">84h</timeoriginalestimate>
                            <timeestimate seconds="302400">84h</timeestimate>
                                        <comments>
                            <comment id="13508401" author="mladen.adamovic" created="Sun, 2 Dec 2012 23:47:58 +0000"  >&lt;p&gt;the reason for braking the code was not BasicDataSource problem but another static caching which was app crossing. Sorry about the invalid report.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>293332</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sws7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166788</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-391] Close on invalid connections throws unexpected exception</title>
                <link>https://issues.apache.org/jira/browse/DBCP-391</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;If the underlying connection of a PoolableConnection becomes invalid due to network errors etc., it is not possible to remove it from the pool by using the close-strategy. In case of an exception I&apos;d check if the connection is already closed (=returned to pool). If not I&apos;d close it to return it to the pool. &lt;/p&gt;

&lt;p&gt;Two problems:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The method isClosed() returns true, even if the PoolableConnection has not the _closed state because of _conn.isClosed() returns true. The defective connection remains active, consuming connections.&lt;/li&gt;
	&lt;li&gt;The method close throws an SQLException (&quot;already closed&quot;) if (and only if) the underlying connection is closed. If the PoolableConnection is in _closed state, close() returns silently (as expected)&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="12606261">DBCP-391</key>
            <summary>Close on invalid connections throws unexpected exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mstier">Markus Stier</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Sep 2012 15:48:27 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:10 +0000</updated>
                            <resolved>Fri, 31 Jan 2014 21:09:03 +0000</resolved>
                                    <version>1.2.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13888173" author="markt" created="Fri, 31 Jan 2014 21:09:03 +0000"  >&lt;p&gt;Thanks for the report and the analysis. Sorry it has taken so long to address this.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed trunk for the 2.x series the 1.5.x branch. It will be included in the next release of each.&lt;/p&gt;

&lt;p&gt;If there are further 1.3.x and 1.4.x releases (currently being discussed on the dev mailing list) my expectation is that they will be generated from the 1.5.x branch so will pick up this fix too.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-390] calling invalidObject(badConnection) damage the counting of the objects in the pool. </title>
                <link>https://issues.apache.org/jira/browse/DBCP-390</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We are using DBCP pool.  The pattern of using DBCP pool is same as Apache DBCP pool example PoolingDataSourceDataSourceExample.java. When cleaning bad connections, I noticed that it called pool.invalidObject(object)  method to clean the bad connection object from the pool.  Recently we found that calling invalidObject(object) could damage the number of active connections of  the pool because this method always silently reduce the number  regardless the objects was removed from pool or not.  For example, when the connection object is null (creating database connection timeout happens),  calling invalidObject(badConnection) would cause the number of Active connections to be reduce one even the method did not remove any object from pool. This damage the counting of the object in the pool.  &lt;br/&gt;
This method should only reduce the number of the objects in the pool when it successfully removed an object from the pool.  &lt;br/&gt;
Note: I understand that we may resolve the problem by checking object is null (or object is in pool) before calling invalidObject() method. But I think it is just a first-aid solution.  &lt;/p&gt;</description>
                <environment>&lt;p&gt;All env&lt;/p&gt;</environment>
        <key id="12601592">DBCP-390</key>
            <summary>calling invalidObject(badConnection) damage the counting of the objects in the pool. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="neng1998">neng xu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Aug 2012 18:01:35 +0000</created>
                <updated>Sat, 31 May 2014 04:10:19 +0000</updated>
                            <resolved>Fri, 31 Jan 2014 19:42:54 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13888072" author="markt" created="Fri, 31 Jan 2014 19:42:54 +0000"  >&lt;p&gt;From the description provided I can&apos;t reproduce this. All the code paths I can see where a Factory might return a null connection trigger an ISE.&lt;/p&gt;

&lt;p&gt;Please feel free to re-open this issue if you can provide a JUnit test case that demonstrates the issue.&lt;/p&gt;

&lt;p&gt;Note that this issue will not affect DBCP 2.x as it depends on Pool 2.x that implements full object tracking and is therefore able to keep a better tracl of the number of active and idle objects.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12548535">POOL-213</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90420</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-386] Osgi imports and classpath for Class.forName</title>
                <link>https://issues.apache.org/jira/browse/DBCP-386</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The bundle MANIFEST does not provide a Dynamic import, this forces you to either attach data sources as a fragment or load them via exposed system classes.&lt;br/&gt;
A dynamic import * would simplify this.&lt;/p&gt;

&lt;p&gt;&amp;lt;commons.osgi.dynamicImport&amp;gt;*&amp;lt;/commons.osgi.dynamicImport&amp;gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSGi, felix, equinox, karaf&lt;/p&gt;</environment>
        <key id="12594954">DBCP-386</key>
            <summary>Osgi imports and classpath for Class.forName</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="joed">Carl Johan Erik Edstrom</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jun 2012 15:53:32 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:11 +0000</updated>
                            <resolved>Sat, 11 Jan 2014 18:59:42 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13395984" author="jwcarman" created="Mon, 18 Jun 2012 16:02:48 +0000"  >&lt;p&gt;Thank you, Johan!  We&apos;ll get this added in right away.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12509747">DBCP-363</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255706</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 20 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90422</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-385] Please update to support Java 7 and JDBC 4.1</title>
                <link>https://issues.apache.org/jira/browse/DBCP-385</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I&apos;m currently working on the transition of all Java packages in Ubuntu from Java 6 to Java 7.&lt;/p&gt;

&lt;p&gt;This means we have to be able to build packages from source using openjdk-7.&lt;/p&gt;

&lt;p&gt;At the moment we carry a pretty heavy patch for commons-dbcp to no-op all of the new features in the JDBC 4.1 API.  I know the Fedora Java team have done the same (they are the source of the patch).&lt;/p&gt;

&lt;p&gt;It would be great if commons-dbcp could be updated to meet these new API requirements.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 12.10/openjdk-7&lt;/p&gt;</environment>
        <key id="12559544">DBCP-385</key>
            <summary>Please update to support Java 7 and JDBC 4.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="javacruft">James Page</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jun 2012 14:49:49 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:16 +0000</updated>
                            <resolved>Wed, 30 Oct 2013 14:48:55 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>4</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13668234" author="ebourg" created="Tue, 28 May 2013 11:07:20 +0000"  >&lt;p&gt;For the reference, here is the patch used by Fedora and Debian/Ubuntu:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=796638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugzilla.redhat.com/show_bug.cgi?id=796638&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://anonscm.debian.org/viewvc/pkg-java/trunk/libcommons-dbcp-java/debian/patches/02_java7_compat.patch?view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://anonscm.debian.org/viewvc/pkg-java/trunk/libcommons-dbcp-java/debian/patches/02_java7_compat.patch?view=markup&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fts7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90423</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-384] PoolingDriver.accessToUnderlyingConnectionAllowed is thread-hostile</title>
                <link>https://issues.apache.org/jira/browse/DBCP-384</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The field PoolingDriver.accessToUnderlyingConnectionAllowed is static but mutable; this is inherently thread-hostile.&lt;/p&gt;

&lt;p&gt;It seems completely unnecessary for the field to be static; surely it could be an instance variable?&lt;br/&gt;
Better yet, drop the setter/getter and make the field final, set by the ctor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553059">DBCP-384</key>
            <summary>PoolingDriver.accessToUnderlyingConnectionAllowed is thread-hostile</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Apr 2012 22:58:03 +0000</created>
                <updated>Sat, 31 May 2014 04:04:19 +0000</updated>
                            <resolved>Tue, 3 Dec 2013 09:36:37 +0000</resolved>
                                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13837496" author="markt" created="Tue, 3 Dec 2013 09:36:37 +0000"  >&lt;p&gt;API changed so this will only be fixed in 2.0 onwards.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 48 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90424</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-383] NPE during XA commit (possibly doing startup recovery)</title>
                <link>https://issues.apache.org/jira/browse/DBCP-383</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Encountering nullpointer exception at &lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.commons.dbcp.managed.LocalXAConnectionFactory$LocalXAResource.commit(LocalXAConnectionFactory.java:201)&lt;br/&gt;
	at com.atomikos.datasource.xa.XAResourceTransaction.commit(XAResourceTransaction.java:784)&lt;br/&gt;
	at com.atomikos.icatch.imp.CommitMessage.send(CommitMessage.java:73)&lt;br/&gt;
	at com.atomikos.icatch.imp.PropagationMessage.submit(PropagationMessage.java:111)&lt;br/&gt;
	at com.atomikos.icatch.imp.Propagator$PropagatorThread.run(Propagator.java:87)&lt;br/&gt;
	at com.atomikos.icatch.imp.Propagator.submitPropagationMessage(Propagator.java:66)&lt;br/&gt;
	at com.atomikos.icatch.imp.HeurHazardStateHandler.onTimeout(HeurHazardStateHandler.java:120)&lt;br/&gt;
	at com.atomikos.icatch.imp.CoordinatorImp.alarm(CoordinatorImp.java:1105)&lt;br/&gt;
	at com.atomikos.timing.PooledAlarmTimer.notifyListeners(PooledAlarmTimer.java:112)&lt;br/&gt;
	at com.atomikos.timing.PooledAlarmTimer.run(PooledAlarmTimer.java:99)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12552812">DBCP-383</key>
            <summary>NPE during XA commit (possibly doing startup recovery)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lichtin">Martin Lichtin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Apr 2012 08:44:49 +0000</created>
                <updated>Sat, 31 May 2014 04:06:24 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 21:57:55 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13262662" author="sebb@apache.org" created="Thu, 26 Apr 2012 15:17:23 +0000"  >&lt;p&gt;Looks like the NPE is caused by current Xid == null.&lt;/p&gt;

&lt;p&gt;The current Xid is saved by start() and set to null by commit(), rollback() and forget(), so it looks like an invalid sequence of calls has been used.&lt;/p&gt;

&lt;p&gt;However, the code should not throw an NPE.&lt;/p&gt;

&lt;p&gt;It would be more helpful if it threw an IllegalStateException (or similar).&lt;/p&gt;</comment>
                            <comment id="13262685" author="lichtin" created="Thu, 26 Apr 2012 15:47:03 +0000"  >&lt;p&gt;It occured while running the test code from &lt;a href=&quot;https://github.com/muellerc/camel-in-transaction&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/muellerc/camel-in-transaction&lt;/a&gt;&lt;br/&gt;
I have a slight problem re-running the test, as it almost always completely locks up my machine &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
After reboot, my guess is that Atomikos TM needs to recover some in-doubt transactions and then I saw above NPE.&lt;/p&gt;</comment>
                            <comment id="13889967" author="markt" created="Mon, 3 Feb 2014 21:57:55 +0000"  >&lt;p&gt;I&apos;ve changed this to throw XAException. There didn&apos;t seem much point swapping one unchecked exception (NPE) for another (ISE).&lt;/p&gt;

&lt;p&gt;This changed has been made in 2.x and 1.5.x.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237034</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-382] Could not set flag &quot;accessToUnderlyingConnectionAllowed&quot; in &quot;context.xml&quot; for DriverAdapterCPDS/PerUserPoolDataSource</title>
                <link>https://issues.apache.org/jira/browse/DBCP-382</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Could not set flag &quot;accessToUnderlyingConnectionAllowed&quot; in context.xml for DriverAdapterCPDS/PerUserPoolDataSource because the property is not considered from the factory.&lt;br/&gt;
A possible solution is to add following lines to class &quot;DriverAdapterCPDS&quot; on the end of method &quot;getObjectInstance&quot;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ra = ref.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;accessToUnderlyingConnectionAllowed&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ra != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; ra.getContent() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
	setAccessToUnderlyingConnectionAllowed(&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.valueOf(ra.getContent().toString()).booleanValue());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Apache Tomcat 6.0.32 / DBCP 1.3&lt;/p&gt;</environment>
        <key id="12551439">DBCP-382</key>
            <summary>Could not set flag &quot;accessToUnderlyingConnectionAllowed&quot; in &quot;context.xml&quot; for DriverAdapterCPDS/PerUserPoolDataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="srempfer">Stefan Rempfer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Apr 2012 10:41:59 +0000</created>
                <updated>Sat, 31 May 2014 04:08:30 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 20:21:41 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13887013" author="markt" created="Thu, 30 Jan 2014 20:21:41 +0000"  >&lt;p&gt;Thanks for the report and the patch. Sorry it has taken so long to apply it.&lt;/p&gt;

&lt;p&gt;I&apos;ve applied the patch to trunk for the 2.x series and to the 1.5.x branch. It will be included in the next release of each.&lt;/p&gt;

&lt;p&gt;If there are further 1.3.x and 1.4.x releases (currently being discussed on the dev mailing list) my expectation is that they will be generated from the 1.5.x branch so will pick up this fix too.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90426</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-381] Threads BLOCKED on stress tests</title>
                <link>https://issues.apache.org/jira/browse/DBCP-381</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;We are performing stress tests of OpenCMS. The database used is Oracle one. The pool of connections that OpenCMS is using is the DBCP pool.&lt;/p&gt;

&lt;p&gt;While performing performance tests we see that with minimal load already generated, almost all of the threads in java get &quot;BLOCKED&quot; trying to release back connections to the pool, and the performance of the application is really poor. We also see that the CPU consumption on the application server machine goes up to 100%. We are not generating enough load to cause this consumption. I believe that the CPU is all spent trying to handle those BLOCK threads.&lt;/p&gt;

&lt;p&gt;We did perform a thread dump of the Java on many occasions and the pattern is always similar. Plenty of connections blocked releasing the connection:&lt;/p&gt;

&lt;p&gt;-------------------&lt;br/&gt;
&quot;TP-Processor8&quot; daemon prio=10 tid=0x00007fa2848b4000 nid=0x4713 waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007fa2833f8000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
        at org.apache.commons.pool.impl.GenericObjectPool.returnObject(GenericObjectPool.java:916)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x0000000780ba7cc8&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool)&lt;br/&gt;
        at org.apache.commons.dbcp.PoolableConnection.close(PoolableConnection.java:87)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00000007811a6f78&amp;gt; (a org.apache.commons.dbcp.PoolableConnection)&lt;br/&gt;
        at org.apache.commons.dbcp.PoolingDriver$PoolGuardConnectionWrapper.close(PoolingDriver.java:269)&lt;br/&gt;
        at org.opencms.ocee.db.transaction.CmsTransactionConnection.close(CmsTransactionConnection.java:79)&lt;br/&gt;
        at org.opencms.ocee.db.transaction.CmsTransaction.close(CmsTransaction.java:121)&lt;br/&gt;
        at org.opencms.ocee.db.transaction.CmsTransactionDbContext.clear(CmsTransactionDbContext.java:99)&lt;br/&gt;
        at org.opencms.db.CmsSecurityManager.readFile(CmsSecurityManager.java:3351)&lt;br/&gt;
        at org.opencms.file.CmsObject.readFile(CmsObject.java:2725)&lt;br/&gt;
        at org.opencms.file.CmsObject.readFile(CmsObject.java:2777)&lt;br/&gt;
        at org.opencms.file.CmsObject.readFile(CmsObject.java:2747)&lt;br/&gt;
        at org.apache.jsp.WEB_002dINF.jsp.online.system.modules.org_opentrends_upf_template.templates.mainUPF_jsp._jspService(mainUPF_jsp.java:654)&lt;br/&gt;
        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:98)&lt;br/&gt;
-------------&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And one thread active releasing the connection:&lt;/p&gt;

&lt;p&gt;-------------&lt;br/&gt;
&quot;TP-Processor10&quot; daemon prio=10 tid=0x00007fa284b34800 nid=0x4715 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007fa2831f4000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
        at java.net.SocketInputStream.read(SocketInputStream.java:129)&lt;br/&gt;
        at oracle.net.ns.Packet.receive(Unknown Source)&lt;br/&gt;
        at oracle.net.ns.DataPacket.receive(Unknown Source)&lt;br/&gt;
        at oracle.net.ns.NetInputStream.getNextPacket(Unknown Source)&lt;br/&gt;
        at oracle.net.ns.NetInputStream.read(Unknown Source)&lt;br/&gt;
        at oracle.net.ns.NetInputStream.read(Unknown Source)&lt;br/&gt;
        at oracle.net.ns.NetInputStream.read(Unknown Source)&lt;br/&gt;
        at oracle.jdbc.driver.T4CMAREngine.unmarshalUB1(T4CMAREngine.java:1104)&lt;br/&gt;
        at oracle.jdbc.driver.T4CMAREngine.unmarshalSB1(T4CMAREngine.java:1075)&lt;br/&gt;
        at oracle.jdbc.driver.T4C7Ocommoncall.receive(T4C7Ocommoncall.java:106)&lt;br/&gt;
        at oracle.jdbc.driver.T4CConnection.doRollback(T4CConnection.java:568)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x00000007810e2ac0&amp;gt; (a oracle.jdbc.driver.T4CConnection)&lt;br/&gt;
        at oracle.jdbc.driver.PhysicalConnection.rollback(PhysicalConnection.java:1164)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00000007810e2ac0&amp;gt; (a oracle.jdbc.driver.T4CConnection)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingConnection.rollback(DelegatingConnection.java:328)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingConnection.rollback(DelegatingConnection.java:328)&lt;br/&gt;
        at org.apache.commons.dbcp.PoolableConnectionFactory.passivateObject(PoolableConnectionFactory.java:359)&lt;br/&gt;
        at org.apache.commons.pool.impl.GenericObjectPool.addObjectToPool(GenericObjectPool.java:926)&lt;br/&gt;
        at org.apache.commons.pool.impl.GenericObjectPool.returnObject(GenericObjectPool.java:917)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x0000000780ba7cc8&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool)&lt;br/&gt;
        at org.apache.commons.dbcp.PoolableConnection.close(PoolableConnection.java:87)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00000007810e29b0&amp;gt; (a org.apache.commons.dbcp.PoolableConnection)&lt;br/&gt;
        at org.apache.commons.dbcp.PoolingDriver$PoolGuardConnectionWrapper.close(PoolingDriver.java:269)&lt;br/&gt;
        at org.opencms.ocee.db.transaction.CmsTransactionConnection.close(CmsTransactionConnection.java:79)&lt;br/&gt;
        at org.opencms.ocee.db.transaction.CmsTransaction.close(CmsTransaction.java:121)&lt;br/&gt;
        at org.opencms.ocee.db.transaction.CmsTransactionDbContext.clear(CmsTransactionDbContext.java:99)&lt;br/&gt;
        at org.opencms.db.CmsSecurityManager.readFile(CmsSecurityManager.java:3351)&lt;br/&gt;
        at org.opencms.file.CmsObject.readFile(CmsObject.java:2725)&lt;br/&gt;
------------&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As we can see the thread releasing the connection is performing a rollback, probably so that the connection gets back clean to the pool.&lt;/p&gt;

&lt;p&gt;In this case the application is not performing Updates/Deletes or Inserts. In the future it will, but not in the stress tests. &lt;/p&gt;

&lt;p&gt;This is a big issue, as a Rollback is not a light operation, even when it has not to rollback many actions.&lt;/p&gt;

&lt;p&gt;This is affecting the pool, as while the connection is performing rollback nobody can use the pool as it is locked.&lt;/p&gt;

&lt;p&gt;This does not make any sense.&lt;/p&gt;

&lt;p&gt;I believe that what is happening is:&lt;/p&gt;

&lt;p&gt;1) I lock the pool&lt;br/&gt;
2) I perform a rollback of the connection&lt;br/&gt;
3) I return the connection to the pool&lt;br/&gt;
4) I unlock the pool&lt;/p&gt;

&lt;p&gt;Why is the rollback holding the pool??? The rollback should be done before locking the pool. It would be better if:&lt;/p&gt;

&lt;p&gt;1) I perform a rollback of the connection&lt;br/&gt;
2) I lock the pool&lt;br/&gt;
3) I return the connection to the pool&lt;br/&gt;
4) I unlock the pool&lt;/p&gt;

&lt;p&gt;I have seen many threads on internet of people having this kind of locking under stress tests, and I believe this could be the cause. The lock should be hold really the shortest time possible.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Carlos&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12550788">DBCP-381</key>
            <summary>Threads BLOCKED on stress tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="carlosm_es">Carlos Martinez</reporter>
                        <labels>
                            <label>BLOCKED</label>
                            <label>PERFORMANCE</label>
                            <label>ROLLBACK</label>
                    </labels>
                <created>Fri, 13 Apr 2012 07:39:56 +0000</created>
                <updated>Sat, 31 May 2014 04:08:43 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 12:55:48 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13886545" author="markt" created="Thu, 30 Jan 2014 12:55:48 +0000"  >&lt;p&gt;The sync on returnObject() was fixed in Pool 1.4 onwards. See &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-93&quot; title=&quot;Reduce contention by making borrow &amp;amp; return more independent from each other&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-93&quot;&gt;&lt;del&gt;POOL-93&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-108&quot; title=&quot;GenericObjectPool does per-resource work (e.g. validate) in a synchronized context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-108&quot;&gt;&lt;del&gt;POOL-108&lt;/del&gt;&lt;/a&gt; for details.&lt;/p&gt;

&lt;p&gt;Resolved as INVALID since the bug was in Pool, not DBCP.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235652</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90427</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-380] DelegatingConnection isWrapperFor dies on older JDBC drivers</title>
                <link>https://issues.apache.org/jira/browse/DBCP-380</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The isWrapperFor function simply calls towards to the delegated connection iswrappedfor function instead of checking the result first by hand like in the unwrap function.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12550662">DBCP-380</key>
            <summary>DelegatingConnection isWrapperFor dies on older JDBC drivers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="balazs.zsoldos">Balazs Zsoldos</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Apr 2012 11:14:26 +0000</created>
                <updated>Sat, 31 May 2014 04:09:00 +0000</updated>
                            <resolved>Mon, 9 Dec 2013 20:55:26 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13252340" author="balazs.zsoldos" created="Thu, 12 Apr 2012 11:15:50 +0000"  >&lt;p&gt;With the tiny patch applied the isWrappedFor function will work well even with JDBC drivers that do not implement this function (e.g. Postgres 9.1 or H2)&lt;/p&gt;</comment>
                            <comment id="13843544" author="markt" created="Mon, 9 Dec 2013 20:55:26 +0000"  >&lt;p&gt;Thanks for the patch. It has been applied to svn and will be included in the next release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12522399" name="DelegatingConnection.java.patch" size="657" author="balazs.zsoldos" created="Thu, 12 Apr 2012 11:15:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fttb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90428</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-379] number of connections created has crossed more than maxActive </title>
                <link>https://issues.apache.org/jira/browse/DBCP-379</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I found that when the minIdle is configured then during loads, common pool creates more number of connections  it will be greater than maxActive.&lt;/p&gt;

&lt;p&gt;When I had following settings:&lt;/p&gt;

&lt;p&gt;maxActive = 50&lt;br/&gt;
maxIdle = 30&lt;br/&gt;
minIdle=30&lt;br/&gt;
factory=org.apache.commons.dbcp.BasicDataSourceFactory&lt;br/&gt;
maxWait=10000&lt;br/&gt;
timeBetweenEvictionRunsMillis=900000&lt;br/&gt;
numTestsPerEvictionRun=50&lt;br/&gt;
minEvictableIdleTimeMillis=1800000&lt;br/&gt;
testWhileIdle=true&lt;br/&gt;
testOnBorrow = true&lt;br/&gt;
validationQuery=&apos;select 1 from dual&apos;&lt;/p&gt;


&lt;p&gt;Number of connections in the pool went upto 121. (found thru netstat)&lt;/p&gt;

&lt;p&gt;When I changed minIdle to 15 and did my load test connecitons in the pool went upto 66&lt;/p&gt;

&lt;p&gt;Looks like maxActive is getting bypassed with minIdle.&lt;/p&gt;

&lt;p&gt;When I changed minIdle to 10 and maxActive to 30 and maxIdle to 30 then number of connections went upto 40.&lt;/p&gt;

&lt;p&gt;Can someone please throw light on what is going on here? I am using DBCP 1.2.1 and common pool 1.3.&lt;/p&gt;

&lt;p&gt;Bhaskar&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS:Red Hat Enterprise Linux AS release 4 (Nahant Update 2)&lt;br/&gt;
uname:Linux 2.6.9-22.ELsmp #1 SMP Mon Sep 19 18:32:14 EDT 2005 i686&lt;br/&gt;
vm_info: Java HotSpot(TM) Server VM (1.4.2_13-b06) for&lt;br/&gt;
linux-x86, built&lt;br/&gt;
on Oct 18 2006 09:55:11 by unknown with unknown compiler&lt;/p&gt;</environment>
        <key id="12380526">DBCP-379</key>
            <summary>number of connections created has crossed more than maxActive </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bhaskar">Bhaskar NA</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Oct 2007 12:06:20 +0000</created>
                <updated>Sat, 31 May 2014 04:13:52 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 15:38:54 +0000</resolved>
                                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12535234" author="bhaskar" created="Tue, 16 Oct 2007 12:16:00 +0000"  >&lt;p&gt;When I changed minIdle to 0 and maxActive to 30 and maxIdle to 30 then number of connections went upto 29. &lt;/p&gt;

&lt;p&gt;In all the above tests, i had 40 concurrent threads that intern caused application code to get a connection from pool.&lt;/p&gt;</comment>
                            <comment id="12535436" author="bhaskar" created="Wed, 17 Oct 2007 07:30:57 +0000"  >&lt;p&gt;Today i tried again with common DBCP 1.2.2 but found the same issue.&lt;br/&gt;
I had &lt;br/&gt;
maxIdle=30&lt;br/&gt;
minIdle=30&lt;br/&gt;
maxActive=30&lt;/p&gt;

&lt;p&gt;after doing the loadtest, i found in netstat that there were 120 connections established. &lt;/p&gt;

&lt;p&gt;I don&apos;t see an issue of crossing the maxActive if i set minIdle to 0.&lt;/p&gt;</comment>
                            <comment id="12540086" author="psteitz" created="Sun, 4 Nov 2007 18:02:47 +0000"  >&lt;p&gt;The pool code to ensure minIdle should not cause this to happen.  &lt;br/&gt;
Can you provide some more information on your setup and load test?  In particular,&lt;br/&gt;
How is the DBCP datasource being instantiated?  Is DBCP running in a web container?&lt;br/&gt;
What is the database? Is it remote from the host running the pool?  Are all of the TCP connections ESTABLISHED?  Are you sure they are all associated with the client connection pool?  &lt;br/&gt;
Are client threads timing out waiting for connections during the test (i.e.., do you see org.apache.commons.dbcp.SQLNestedException: Cannot get a connection, pool error Timeout waiting for idle object)?&lt;br/&gt;
What does the DBCP client do with connections obtained during the test?&lt;br/&gt;
Is the load constant, with threads just repeating the same requests with no delays in between requests?&lt;br/&gt;
What is the duration of the test?&lt;/p&gt;</comment>
                            <comment id="12540137" author="bhaskar" created="Mon, 5 Nov 2007 06:06:48 +0000"  >&lt;p&gt;How is the DBCP datasource being instantiated? Is DBCP running in a web container? &lt;/p&gt;

&lt;p&gt;In tomcat&apos;s server.xml, in ResourceParams, factory param is configured to use org.apache.commons.dbcp.BasicDataSourceFactory.&lt;br/&gt;
In the code, we do the jndi lookup for the above ds and call ds.getConnection().&lt;/p&gt;

&lt;p&gt;What is the database? Is it remote from the host running the pool?&lt;br/&gt;
oracle is the database and it is in a remote machine&lt;/p&gt;

&lt;p&gt;Are all of the TCP connections ESTABLISHED?&lt;br/&gt;
yes&lt;/p&gt;

&lt;p&gt;Are you sure they are all associated with the client connection pool? &lt;br/&gt;
yes. &lt;/p&gt;


&lt;p&gt;Are client threads timing out waiting for connections during the test (i.e.., do you see org.apache.commons.dbcp.SQLNestedException: Cannot get a connection, pool error Timeout waiting for idle object)? &lt;/p&gt;

&lt;p&gt;Yes, if i have too many concurrent threads then i use to hit this issue.&lt;/p&gt;

&lt;p&gt;What does the DBCP client do with connections obtained during the test? &lt;br/&gt;
query/update&apos;s &lt;br/&gt;
and then giveback connection to pool&lt;/p&gt;

&lt;p&gt;Is the load constant, with threads just repeating the same requests with no delays in between requests? &lt;br/&gt;
load was constant.&lt;br/&gt;
they use to repeat same work&lt;/p&gt;

&lt;p&gt;What is the duration of the test? &lt;br/&gt;
30 min.&lt;/p&gt;</comment>
                            <comment id="12554622" author="psteitz" created="Thu, 27 Dec 2007 22:08:59 +0000"  >&lt;p&gt;I can&apos;t reproduce or verify this as a pool or dbcp bug.   The only way I can understand this happening is if connections or associated sockets are failing to close.  I have not been able to reproduce this behavior with Oracle, MySql or postgres, using same or similar settings to above.  &lt;br/&gt;
Leaving open but changing fix version to 2.0.  &lt;/p&gt;</comment>
                            <comment id="12695929" author="markt" created="Sun, 5 Apr 2009 22:36:23 +0000"  >&lt;p&gt;I can re-create this, but only by forcing a particular execution sequence with a debugger. The issue lies within the for loop in ensureMinIdle(). Consider the case where _numIdle=0, _minIdle&amp;gt;0 and _numActive+1 == _maxActive. If a client thread enters borrowObject() at the point where the evictor thread is about to call addObject() both threads will create objects leaving _numIdle==1 &amp;amp; _numActive==_maxActive. The next client call to borrowObject() will result in _numActive==_maxActive+1&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-44&quot; title=&quot;[dbcp] Evictor thread in GenericObjectPool has potential for deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-44&quot;&gt;&lt;del&gt;DBCP-44&lt;/del&gt;&lt;/a&gt; contains a patch that addresses this for GenericObjectPool. The other pools need a similar patch. Since it is pool that needs to be patched, I&apos;ll use this issue to track progress rather than &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-44&quot; title=&quot;[dbcp] Evictor thread in GenericObjectPool has potential for deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-44&quot;&gt;&lt;del&gt;DBCP-44&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12696139" author="markt" created="Mon, 6 Apr 2009 15:46:38 +0000"  >&lt;p&gt;This has been fixed for both GOP and GKOP based on the patch attached &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-44&quot; title=&quot;[dbcp] Evictor thread in GenericObjectPool has potential for deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-44&quot;&gt;&lt;del&gt;DBCP-44&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12742303" author="krystians" created="Wed, 12 Aug 2009 11:59:01 +0000"  >&lt;p&gt;Hi&lt;br/&gt;
We were using commons-pool 1.4 in our application and we came across this issue.&lt;br/&gt;
Unfortunately it is critical for us :/&lt;/p&gt;

&lt;p&gt;When I have a setting of:&lt;br/&gt;
max active: 10&lt;br/&gt;
max:idle 5&lt;br/&gt;
min idle:2&lt;/p&gt;

&lt;p&gt;When running test with 20 threads I get:&lt;br/&gt;
before test is ran:&lt;br/&gt;
num active: 0&lt;br/&gt;
num idle: 2&lt;/p&gt;

&lt;p&gt;during test:&lt;br/&gt;
num active: 20&lt;br/&gt;
num idle: 0&lt;/p&gt;

&lt;p&gt;after the test is done:&lt;br/&gt;
num active: 0&lt;br/&gt;
num idle: 5&lt;/p&gt;

&lt;p&gt;I&apos;ve updated commons-pool to 1.5.2 and unfortunately same thing happens, I cannot control maximum of active connections!&lt;br/&gt;
I&apos;ve tried changing the min idle and max idle to many different settings but was never able to limit the number of active connections!&lt;/p&gt;</comment>
                            <comment id="12742310" author="markt" created="Wed, 12 Aug 2009 12:12:50 +0000"  >&lt;p&gt;Please provide some sample code that demonstrates the issue.&lt;/p&gt;</comment>
                            <comment id="12742342" author="krystians" created="Wed, 12 Aug 2009 13:21:36 +0000"  >&lt;p&gt;I&apos;m sorry Mark,&lt;/p&gt;

&lt;p&gt;I came back here to remove my comment as after building the app from scratch I have found that by default it used &lt;br/&gt;
WhenExhaustedAction = GROW and not BLOCK!&lt;/p&gt;

&lt;p&gt;Sorry  about that, tiredness.&lt;br/&gt;
It works fine now!&lt;/p&gt;</comment>
                            <comment id="12742346" author="markt" created="Wed, 12 Aug 2009 13:27:32 +0000"  >&lt;p&gt;No problem. Good to hear 1.5.2 is working for you.&lt;/p&gt;</comment>
                            <comment id="12831528" author="manoj@castiron.com" created="Tue, 9 Feb 2010 16:38:22 +0000"  >&lt;p&gt;The problem of exceeding maximum number of  connection still happens for us even after upgrading to 1.5.2.&lt;/p&gt;

&lt;p&gt;The issue is that it keep max active to the value set while creating the GenericObjectPool but in the backend it keep creating and closing the connections so it doesn&apos;t get Exhausted. We have not WhenExhaustedAction since it default to BLOCK. This is only reproducible in the hight load scenario.&lt;/p&gt;
</comment>
                            <comment id="12831974" author="psteitz" created="Wed, 10 Feb 2010 13:02:30 +0000"  >&lt;p&gt;Manoj,&lt;/p&gt;

&lt;p&gt;The latest version is 1.5.4.  Can you try upgrading to the latest version?  If your problem persists, please post your full pool configuration.  &lt;/p&gt;</comment>
                            <comment id="12832355" author="manoj@castiron.com" created="Thu, 11 Feb 2010 01:55:09 +0000"  >&lt;p&gt;Yes I have installed 1.5.4 and we are still able to reproduce the issue.  The configuration for the connection pool is following.&lt;br/&gt;
GenericObjectPool connectionPool = new GenericObjectPool();&lt;br/&gt;
connectionPool.setMaxActive(25);&lt;br/&gt;
connectionPool.setMidIdle(3);&lt;br/&gt;
connectioinPool.setMinEvictableIdleTimeMillis(120*60*1000);&lt;br/&gt;
connectionPool.setTimeBetweenEvictionRunsMillis(1*60*1000);&lt;br/&gt;
connectionPool.setTestOnReturn(false);&lt;br/&gt;
connectionPool.setTestOnBorrow(true);&lt;/p&gt;

&lt;p&gt;This is reproducible as said above only high load that is lot of parallel threads running. &lt;/p&gt;</comment>
                            <comment id="12908512" author="psteitz" created="Sun, 12 Sep 2010 17:37:38 +0000"  >&lt;p&gt;Fix version (1.5) has been released.&lt;/p&gt;</comment>
                            <comment id="13176506" author="vicnov" created="Wed, 28 Dec 2011 07:54:01 +0000"  >&lt;p&gt;The problem with minIdle still exists in 1.5.7, steps to reproduce:&lt;/p&gt;

&lt;p&gt;1) start connection pool with *&lt;b&gt;disconnected&lt;/b&gt;* database (I used mysql and stopped it)&lt;br/&gt;
2) try to execute several qieries - yes, you will get errors of course&lt;br/&gt;
3) turn on the database&lt;br/&gt;
4) execute some queries (their quantity should be &amp;gt; maxActive)&lt;br/&gt;
5) look at connection count from database side, it will be &amp;gt; maxActive and will increase at each query (until limit in database is reached)&lt;/p&gt;

&lt;p&gt;So, the problem still occurs when you start working with database turned off and then you turn it on. But I can confirm that if you start with database already turned on, then no problem!&lt;/p&gt;

&lt;p&gt;My config was:&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;initialSize&quot; value=&quot;10&quot; /&amp;gt;&lt;br/&gt;
		&amp;lt;property name=&quot;minIdle&quot; value=&quot;5&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;maxActive&quot; value=&quot;30&quot; /&amp;gt;&amp;lt;!-- -1=&quot;no limit&quot; --&amp;gt;&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;maxWait&quot; value=&quot;10000&quot; /&amp;gt;				&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;60000&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;		&amp;lt;property name=&quot;validationQuery&quot; value=&quot;SELECT 1 FROM DUAL&quot; /&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13176507" author="vicnov" created="Wed, 28 Dec 2011 07:55:54 +0000"  >&lt;p&gt;All the connections I mentined above are ESTABLISHED.&lt;br/&gt;
Workaround with minIdle=0 also helps.&lt;/p&gt;</comment>
                            <comment id="13176636" author="markt" created="Wed, 28 Dec 2011 13:09:30 +0000"  >&lt;p&gt;Re-open as fix may be incomplete&lt;/p&gt;</comment>
                            <comment id="13206526" author="markt" created="Sun, 12 Feb 2012 21:47:47 +0000"  >&lt;p&gt;I&apos;ve spent some time looking at this and I am struggling to see how the described behavior could occur. The configuration provided looks like a JNDI resource definition from a container environment. You do not say which container or which version. Neither do you say which version of DBCP you are using. Further, there is no configuration that suggests that it isn&apos;t the container that is providing the connection pool. Neither is a stack trace provided of the initial errors that occur which would be very enlightening.&lt;/p&gt;

&lt;p&gt;Making a whole rash of assumptions (Tomcat is the container, the container provides the pool, latest Tomcat version) then if MySQL is not running, the connection pool will not be created when an attempt is made to obtain a connection. This will continue until the database is started at which point a connection pool will be created. In this scenario, the previous failures will have no effect on the pool that is created.&lt;/p&gt;

&lt;p&gt;Without sufficient detail to reproduce this issue, the assumption is going to be that the problem is somewhere (container code, application code) rather then POOL or DBCP.&lt;/p&gt;</comment>
                            <comment id="13239526" author="dsav" created="Tue, 27 Mar 2012 14:46:22 +0000"  >&lt;p&gt;The problem is reproduced exact as described by Victor N with commons-dbcp-1.4 and commons-pool-1.6. Pool should be created prior to DB became available.&lt;/p&gt;

&lt;p&gt;There is a problem method in org.apache.commons.dbcp.BasicDataSource class:&lt;/p&gt;

&lt;p&gt;    protected void createConnectionPool() {&lt;br/&gt;
        // Create an object pool to contain our active connections&lt;br/&gt;
        GenericObjectPool gop;&lt;br/&gt;
        if ((abandonedConfig != null) &amp;amp;&amp;amp; (abandonedConfig.getRemoveAbandoned())) &lt;/p&gt;
{
            gop = new AbandonedObjectPool(null,abandonedConfig);
        }
&lt;p&gt;        else &lt;/p&gt;
{
            gop = new GenericObjectPool();
        }
&lt;p&gt;        gop.setMaxActive(maxActive);&lt;br/&gt;
        gop.setMaxIdle(maxIdle);&lt;br/&gt;
        gop.setMinIdle(minIdle);&lt;br/&gt;
        gop.setMaxWait(maxWait);&lt;br/&gt;
        gop.setTestOnBorrow(testOnBorrow);&lt;br/&gt;
        gop.setTestOnReturn(testOnReturn);&lt;br/&gt;
        gop.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);&lt;br/&gt;
        gop.setNumTestsPerEvictionRun(numTestsPerEvictionRun);&lt;br/&gt;
        gop.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);&lt;br/&gt;
        gop.setTestWhileIdle(testWhileIdle);&lt;br/&gt;
        connectionPool = gop;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;When client application calls getConnection() method there will be an attempt to create real data source. There are some steps that will be performed:&lt;br/&gt;
1) createConnectionPool() creates connection pool and starts evictor thread if minEvictableIdleTimeMillis &amp;gt; 0. This additional thread will clean up pool and create new connections to met the &quot;minIdle&quot; connection count if it&apos;s &amp;gt; 0.&lt;br/&gt;
2) createPoolableConnectionFactory() will create connection factory. And pool created on previous step will get this factory.  After that evictor will start trying to get the number of connections defined by &quot;minIdle&quot; parameter even if DB is unavailable.&lt;/p&gt;

&lt;p&gt;The problem appears is on step 1. If (connectionPool != null) we will lose previously created pool with connection factory set and evictor started. And this happens every time BasicDataSource::getConnection() method is called.&lt;/p&gt;

&lt;p&gt;So, when DB will became available there will be a lot of lost connection pools each trying to get the minIdle connections.&lt;/p&gt;

&lt;p&gt;We&apos;ve solved this by extending BasicDataSource and overriding of createConnectionPool method in such a way:&lt;/p&gt;

&lt;p&gt;   protected void createConnectionPool()&lt;br/&gt;
   {&lt;br/&gt;
      if (connectionPool != null)&lt;br/&gt;
      {&lt;br/&gt;
         try&lt;/p&gt;
         {
            connectionPool.close();
         }
&lt;p&gt;         catch (Exception e)&lt;br/&gt;
         {&lt;br/&gt;
         }&lt;br/&gt;
      }&lt;br/&gt;
      super.createConnectionPool();&lt;br/&gt;
   }&lt;/p&gt;</comment>
                            <comment id="13244455" author="markt" created="Mon, 2 Apr 2012 18:59:01 +0000"  >&lt;p&gt;Moved to DBCP since the issue described is as DBCP issue.&lt;/p&gt;</comment>
                            <comment id="13254691" author="antoine_" created="Mon, 16 Apr 2012 13:50:34 +0000"  >&lt;p&gt;Hello,&lt;br/&gt;
I also experience a similar issue: the number of connection rises above any limit set in the config. It causes a lot of trouble. It is probably in the case when a lot of connections are open at the same time. Please let me know if I can do something to help spot the issue.&lt;/p&gt;

&lt;p&gt;In my case, I use DBCP as part of Tomcat 6 with Grails and Hibernate.&lt;/p&gt;</comment>
                            <comment id="13886673" author="markt" created="Thu, 30 Jan 2014 15:38:54 +0000"  >&lt;p&gt;Based on the analysis of the root cause by Dmytro Savchenko (which I have reviewed and agree with) this is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-342&quot; title=&quot;Not cleaned up commons pool&amp;#39;s evictor task when SQLException occurs after the GenericObjectPool is initialized in createDataSource.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-342&quot;&gt;&lt;del&gt;DBCP-342&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12473220">DBCP-342</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166695</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fttj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90429</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-378] ManagedDataSource returns uses the same underlying DB connection across JTA tx</title>
                <link>https://issues.apache.org/jira/browse/DBCP-378</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;It seems that when more than one JTA transaction is used within the same thread (suspend/resume transaction), the ManagedDataSource always uses the same underlying DB connection. This scenario is common in EJB containers! If the same DB connection is used the JTA suspend/resume actions have no effect. The JTA semantics is violated this behaviour.&lt;/p&gt;

&lt;p&gt;Use the following code to setup a unit test that works in your environment&lt;/p&gt;

&lt;p&gt;// DS setup&lt;br/&gt;
            XADataSource ods = new oracle.jdbc.xa.client.OracleXADataSource();&lt;br/&gt;
            ...&lt;br/&gt;
            TransactionManager tm = ...&lt;/p&gt;

&lt;p&gt;            DataSourceXAConnectionFactory cf = new DataSourceXAConnectionFactory(tm, ods);&lt;/p&gt;

&lt;p&gt;            AbandonedConfig ab = new AbandonedConfig();&lt;br/&gt;
            ab.setLogAbandoned(false);&lt;br/&gt;
            ab.setRemoveAbandoned(true);&lt;br/&gt;
            ab.setRemoveAbandonedTimeout(15*60);&lt;/p&gt;

&lt;p&gt;            connPool = new GenericObjectPool(null);&lt;/p&gt;

&lt;p&gt;            // registers itself on the pool&lt;br/&gt;
            KeyedObjectPoolFactory stmtPool = = new StackKeyedObjectPoolFactory(5);&lt;/p&gt;

&lt;p&gt;            new PoolableManagedConnectionFactory(cf, connPool, stmtPool, &lt;br/&gt;
                                          null, 5, &lt;br/&gt;
                                          (Collection&amp;lt;String&amp;gt;) null, // init sql &lt;br/&gt;
                                          false, // read-only &lt;br/&gt;
                                          false, // auto-commit&lt;br/&gt;
                                          Connection.TRANSACTION_READ_COMMITTED,&lt;br/&gt;
                                          (String) null, // catalog&lt;br/&gt;
                                          ab);&lt;br/&gt;
            ds = new ManagedDataSource(connPool, cf.getTransactionRegistry());&lt;/p&gt;


&lt;p&gt;// Unit test&lt;br/&gt;
        tm.begin();&lt;br/&gt;
        Connection c1 = source.getConnection();&lt;br/&gt;
        Connection ic1 = ((ManagedConnection) c1).getInnermostDelegate(); &lt;br/&gt;
        c1.close();&lt;/p&gt;

&lt;p&gt;        Transaction tx = tm.suspend();&lt;br/&gt;
        tm.begin();&lt;br/&gt;
        c2 = source.getConnection();&lt;br/&gt;
        ic2 = ((ManagedConnection) c2).getInnermostDelegate();&lt;br/&gt;
        c2.close();&lt;/p&gt;

&lt;p&gt;        assertNotSame(&quot;Pool must NOT use identical connection across tx&quot;, ic1, ic2);&lt;br/&gt;
        tm.commit();&lt;br/&gt;
        tm.resume(tx);&lt;br/&gt;
        tm.commit();&lt;/p&gt;</description>
                <environment></environment>
        <key id="12548504">DBCP-378</key>
            <summary>ManagedDataSource returns uses the same underlying DB connection across JTA tx</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="oglueck">Ortwin Glueck</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Mar 2012 14:54:38 +0000</created>
                <updated>Sat, 31 May 2014 04:02:53 +0000</updated>
                            <resolved>Wed, 28 Mar 2012 17:05:28 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13240543" author="oglueck" created="Wed, 28 Mar 2012 17:05:28 +0000"  >&lt;p&gt;ManagedDataSource behaves correctly. The test is wrong (it compares null with null)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tje7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-377] Dbcp Idle Check Mechanism Doesn&apos;t Work</title>
                <link>https://issues.apache.org/jira/browse/DBCP-377</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Using :commons-dbcp-1.4.jar version&lt;/p&gt;

&lt;p&gt;we use a distributed data access layer for Database Sharding with mysql&lt;br/&gt;
our web servers use mysql jdbc driver 1.5.4 to connect to this middleware layer with F5 between them for load balance.&lt;br/&gt;
the middleware layer will discard db links that idle for longger than 1 hour,and our dbcp configures to close links that idle for &lt;br/&gt;
longger than 30 minutes.&lt;/p&gt;

&lt;p&gt;here we occurred exceptions as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    java.net.SocketException
MESSAGE: Broken pipe

STACKTRACE:

java.net.SocketException: Broken pipe
        at java.net.SocketOutputStream.socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
        at com.mysql.jdbc.MysqlIO.send(MysqlIO.java:2637)
        at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1554)
        at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1665)
        at com.mysql.jdbc.Connection.execSQL(Connection.java:3176)
        at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1153)
        at com.mysql.jdbc.PreparedStatement.execute(PreparedStatement.java:794)
        ....
        at org.apache.commons.dbcp.DelegatingPreparedStatement.execute(DelegatingPreparedStatement.java:172)
        at org.apache.commons.dbcp.DelegatingPreparedStatement.execute(DelegatingPreparedStatement.java:172)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it seems that there are times when the links get from pool they have already been broken,we know that they are forcely closed by the middleware layer&#12289;but as dbcp idle check more frequently than the middleware layer(30m to 60m). How can this happen as the idle links&lt;br/&gt;
should have been closed by dbcp first. Are there any problems for the dbcp idle check Mechanism&#65311;&lt;/p&gt;

&lt;p&gt;our dbcp configurations are as follows&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxActive&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;20&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;1&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxWait&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;60000&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxIdle&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;20&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minIdle&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;5&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;removeAbandoned&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;removeAbandonedTimeout&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;180&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;connectionProperties&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;clientEncoding=GBK&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;timeBetweenEvictionRunsMillis&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;60000&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minEvictableIdleTimeMillis&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;1800000&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testWhileIdle&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testOnBorrow&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testOnReturn&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;validationQuery&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;SELECT @@SQL_MODE&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;numTestsPerEvictionRun&quot;&lt;/span&gt;&amp;gt;&amp;lt;value&amp;gt;32&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Linux mysql 5.1.4&lt;/p&gt;</environment>
        <key id="12545180">DBCP-377</key>
            <summary>Dbcp Idle Check Mechanism Doesn&apos;t Work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="michael he">yixin he</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Mar 2012 14:02:22 +0000</created>
                <updated>Sat, 31 May 2014 04:02:32 +0000</updated>
                            <resolved>Sat, 11 Jan 2014 20:08:11 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13222645" author="markt" created="Mon, 5 Mar 2012 22:00:34 +0000"  >&lt;p&gt;I&apos;m not aware of any known issues with idle object eviction.&lt;/p&gt;

&lt;p&gt;It shouldn&apos;t be the app holding on to an idle connection too long before returning it since the removeAbandoned* settings will handle that after 5 minutes.&lt;/p&gt;

&lt;p&gt;I assume that you are 100% certain that the middleware layer is dropping the connections after 1 hour.&lt;/p&gt;

&lt;p&gt;Can you provide some idea of the frequency this occurs? E.g x failures per hour and y connections borrowed per second. I&apos;m trying to understand how rare the issue is.&lt;/p&gt;

&lt;p&gt;Some things to check:&lt;br/&gt;
1. What version of commons-pool are you using and if it isn&apos;t the latest does upgrading fix the issue?&lt;br/&gt;
2. numTestsPerEvictionRun=32 seems too high if maxIdle=20&lt;br/&gt;
3. Is it possible that the app could obtain a connection from the pool but never use it? That would reset DBCP&apos;s idle timer but not the middleware layer&apos;s.&lt;/p&gt;</comment>
                            <comment id="13222960" author="pavarotti17" created="Tue, 6 Mar 2012 03:09:52 +0000"  >&lt;p&gt;(I am )The broken connection is either closed by F5 or the middleware, for that when dbcp connect directly to middleware rather than through F5, some connections (less than 1 per hour) kept idle longer than 1 hour are closed by middleware (which is showed in middleware&apos;s log). &lt;/p&gt;

&lt;p&gt;I suspect:&lt;br/&gt;
1, as Mark said: app could obtain a connection from the pool but never use it&lt;br/&gt;
2, is it possible that, dbcp makes GeneralObjectPool&apos;s lock granularity finer which cause concurrent problem. So that evictor miss some connections for check.&lt;/p&gt;</comment>
                            <comment id="13223160" author="dave@daveoxley.co.uk" created="Tue, 6 Mar 2012 11:07:31 +0000"  >&lt;p&gt;This might be a red herring but I recently found and fixed a thread safety issue when validating connections in DBCP. I don&apos;t know if it is relevant to the idle check mechanism but it might be worth trying out the fix. Find the patch attached to issue &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-376&quot; title=&quot;Thread safety issue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-376&quot;&gt;&lt;del&gt;DBCP-376&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13223409" author="michael he" created="Tue, 6 Mar 2012 16:47:15 +0000"  >&lt;p&gt;Hi Mark:&lt;/p&gt;

&lt;p&gt;this could occur one to several times per day under heavy load&lt;br/&gt;
we use commons-pool 1.5.4&lt;br/&gt;
ok we will check whether the app really obtains never-used connectios and then adjust somes configures for more tests.&lt;/p&gt;

&lt;p&gt;thanks for your help.&lt;/p&gt;
</comment>
                            <comment id="13868866" author="markt" created="Sat, 11 Jan 2014 20:08:11 +0000"  >&lt;p&gt;No further information from the OP so closing as I can&apos;t reproduce this neither can I see a code path that could trigger it. Feel free to re-open this issue if you experience and are able to provide the steps to reproduce it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fttr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-376] Thread safety issue</title>
                <link>https://issues.apache.org/jira/browse/DBCP-376</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Under high load commons-dbcp (or commons-pool) exhibits thread safety issues and begins throwing various exceptions. I don&apos;t yet know the cause of the issue but it looks like a connection maybe handed out to multiple threads concurrently. Here&apos;s a few examples of the exceptions we are getting:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jvm 1    | Caused by: java.sql.SQLException: Attempted to use PooledConnection after closed() was called.
jvm 1    |      at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.assertOpen(PooledConnectionImpl.java:163)
jvm 1    |      at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:174)
jvm 1    |      at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
jvm 1    |      at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
jvm 1    |      at uk.co.webessence.kernel.database.DriverAdapterConnectionPool.acquireConnection(DriverAdapterConnectionPool.java:101)
jvm 1    |      ... 94 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jvm 1    | Caused by: java.sql.SQLException: PooledConnection was reused, withoutits previous Connection being closed.
jvm 1    |      at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:179)
jvm 1    |      at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
jvm 1    |      at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
jvm 1    |      at uk.co.webessence.kernel.database.DriverAdapterConnectionPool.acquireConnection(DriverAdapterConnectionPool.java:101)
jvm 1    |      ... 77 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jvm 1    | Caused by: java.sql.SQLException: Invalid state, the ResultSet object is closed.
jvm 1    |      at net.sourceforge.jtds.jdbc.JtdsResultSet.checkOpen(JtdsResultSet.java:299)
jvm 1    |      at net.sourceforge.jtds.jdbc.JtdsResultSet.getColumn(JtdsResultSet.java:273)
jvm 1    |      at net.sourceforge.jtds.jdbc.JtdsResultSet.getObject(JtdsResultSet.java:840)
jvm 1    |      at org.apache.commons.dbcp.DelegatingResultSet.getObject(DelegatingResultSet.java:325)
jvm 1    |      at uk.co.webessence.kernel.persistence.Preloader.getDataArray(Preloader.java:428)
jvm 1    |      at uk.co.webessence.kernel.persistence.Preloader.processSingleRow(Preloader.java:175)
jvm 1    |      at uk.co.webessence.kernel.persistence.PersistenceHandler.processRecordReload(PersistenceHandler.java:471)
jvm 1    |      at uk.co.webessence.kernel.persistence.PersistenceHandler$1.doLoad(PersistenceHandler.java:447)
jvm 1    |      ... 71 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Message:   TDS Protocol error: Invalid packet type 0x4
jvm 1    | Caused by: java.sql.SQLException: TDS Protocol error: Invalid packet type 0x4
jvm 1    |      at net.sourceforge.jtds.jdbc.TdsCore.nextToken(TdsCore.java:2314)
jvm 1    |      at net.sourceforge.jtds.jdbc.TdsCore.getNextRow(TdsCore.java:764)
jvm 1    |      at net.sourceforge.jtds.jdbc.JtdsResultSet.next(JtdsResultSet.java:593)
jvm 1    |      at org.apache.commons.dbcp.DelegatingResultSet.next(DelegatingResultSet.java:207)
jvm 1    |      at uk.co.webessence.kernel.persistence.Preloader.loadData(Preloader.java:142)
jvm 1    |      at uk.co.webessence.kernel.persistence.PersistenceHandler$3.doLoad(PersistenceHandler.java:592)
jvm 1    |      ... 111 more
jvm 1    | Caused by: net.sourceforge.jtds.jdbc.ProtocolException: Invalid packet type 0x4
jvm 1    |      at net.sourceforge.jtds.jdbc.TdsCore.nextToken(TdsCore.java:2301)
jvm 1    |      ... 116 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12539371">DBCP-376</key>
            <summary>Thread safety issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dave@daveoxley.co.uk">Dave Oxley</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Jan 2012 01:04:31 +0000</created>
                <updated>Wed, 25 Feb 2015 00:27:12 +0000</updated>
                            <resolved>Wed, 25 Feb 2015 00:27:12 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13190843" author="dave@daveoxley.co.uk" created="Mon, 23 Jan 2012 01:13:55 +0000"  >&lt;p&gt;A sample application that recreates the issue. I&apos;ve found that after a few runs it stop reproducing the issue on Linux. Clearing the file cache makes reproduce the issue again:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;sudo sync &amp;amp;&amp;amp; echo 3 | sudo tee /proc/sys/vm/drop_caches
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is an example of output from running the application:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Loading JDBC driver:
JDBC driver loaded succesfully
java.sql.SQLException: Attempted to use PooledConnection after closed() was called.
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.assertOpen(PooledConnectionImpl.java:163)
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:174)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:140)
	at java.lang.Thread.run(Thread.java:662)

java.sql.SQLException: Attempted to use PooledConnection after closed() was called.
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.assertOpen(PooledConnectionImpl.java:163)
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:174)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:140)
	at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13191864" author="dave@daveoxley.co.uk" created="Tue, 24 Jan 2012 04:27:26 +0000"  >&lt;p&gt;I&apos;ve just recreated the same issue with snapshots of dbcp2 and pool2. Here is the output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Loading JDBC driver:
JDBC driver loaded succesfully
INFO  - checkpointClose start
INFO  - checkpointClose end
CLOSING DOWN CONNECTION AS IT COULD NOT BE RETURNED TO THE POOL
java.sql.SQLException: PooledConnection was reused, withoutits previous Connection being closed.
	at org.apache.commons.dbcp2.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:184)
	at org.apache.commons.dbcp2.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:778)
	at org.apache.commons.dbcp2.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:685)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:143)
	at java.lang.Thread.run(Thread.java:662)

CLOSING DOWN CONNECTION AS IT COULD NOT BE RETURNED TO THE POOL
CLOSING DOWN CONNECTION AS IT COULD NOT BE RETURNED TO THE POOL
java.sql.SQLException: Attempted to use PooledConnection after closed() was called.
	at org.apache.commons.dbcp2.cpdsadapter.PooledConnectionImpl.assertOpen(PooledConnectionImpl.java:167)
	at org.apache.commons.dbcp2.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:179)
	at org.apache.commons.dbcp2.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:778)
	at org.apache.commons.dbcp2.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:685)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:143)
	at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13193029" author="markt" created="Wed, 25 Jan 2012 13:36:58 +0000"  >&lt;p&gt;That the pooling implementation has been completely re-written between 1.x and 2.x yet the problem continues points to a problem in DBCP or the app.&lt;/p&gt;

&lt;p&gt;I&apos;ll try and take a look at this when I get some cycles but that might not be for a while. On the plus side, having the test case you provided should make investigating this a lot easier.&lt;/p&gt;</comment>
                            <comment id="13193072" author="wspeirs" created="Wed, 25 Jan 2012 14:53:28 +0000"  >&lt;p&gt;For what it&apos;s worth, all of the creating of the table and selects calls don&apos;t impact the issue. I&apos;ve stripped down the run method in the thread to the following and still get similar errors (SELECT_LOOPS = 5000):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
            Connection c = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j=0; j &amp;lt; SELECT_LOOPS; j++) {
                    c = ds.getConnection();

                    c.close();
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException sqle) {
                handleException(sqle);
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Loading JDBC driver:
JDBC driver loaded succesfully
Exception in thread &quot;Thread-161&quot; java.lang.IllegalStateException: close() was called on a Connection, but I have no record of the underlying PooledConnection.
	at org.apache.commons.dbcp.datasources.KeyedCPDSConnectionFactory.connectionClosed(KeyedCPDSConnectionFactory.java:249)
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.notifyListeners(PooledConnectionImpl.java:229)
	at org.apache.commons.dbcp.cpdsadapter.ConnectionImpl.close(ConnectionImpl.java:78)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:96)
	at java.lang.Thread.run(Thread.java:662)

Exception in thread &quot;Thread-143&quot; java.lang.IllegalStateException: close() was called on a Connection, but I have no record of the underlying PooledConnection.
	at org.apache.commons.dbcp.datasources.KeyedCPDSConnectionFactory.connectionClosed(KeyedCPDSConnectionFactory.java:249)
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.notifyListeners(PooledConnectionImpl.java:229)
	at org.apache.commons.dbcp.cpdsadapter.ConnectionImpl.close(ConnectionImpl.java:78)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:96)
	at java.lang.Thread.run(Thread.java:662)

java.sql.SQLException: PooledConnection was reused, withoutits previous Connection being closed.
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:179)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:94)
	at java.lang.Thread.run(Thread.java:662)

java.sql.SQLException: PooledConnection was reused, withoutits previous Connection being closed.
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:179)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:94)
	at java.lang.Thread.run(Thread.java:662)

java.sql.SQLException: Attempted to use PooledConnection after closed() was called.
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.assertOpen(PooledConnectionImpl.java:163)
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:174)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:94)
	at java.lang.Thread.run(Thread.java:662)

java.sql.SQLException: PooledConnection was reused, withoutits previous Connection being closed.
	at org.apache.commons.dbcp.cpdsadapter.PooledConnectionImpl.getConnection(PooledConnectionImpl.java:179)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:768)
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:676)
	at com.daveoxley.dbcpbug.App$TestThread.run(App.java:94)
	at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13204257" author="dave@daveoxley.co.uk" created="Thu, 9 Feb 2012 05:04:45 +0000"  >&lt;p&gt;Attached patch fixes this issue by synchronising validatingMap and pcMap in KeyedCPDSConnectionFactory and CPDSConnectionFactory.&lt;/p&gt;</comment>
                            <comment id="13886621" author="markt" created="Thu, 30 Jan 2014 14:45:15 +0000"  >&lt;p&gt;Thanks for the report and test case. Sorry it has taken so long to fix this.&lt;/p&gt;

&lt;p&gt;A variation of the fix has been applied to trunk for 2.0 and to the 1.5.x branch. Assuming that the next 1.3.x and 1.4.x releases are auto generated from the 1.5.x branch they should pick up the fix too.&lt;/p&gt;

&lt;p&gt;I have also added a unit test, again based on your sample code.&lt;/p&gt;</comment>
                            <comment id="14335720" author="psteitz" created="Wed, 25 Feb 2015 00:27:05 +0000"  >&lt;p&gt;Should be resolved, but not closed (pending 1.4.1 release)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12513905" name="DBCP-376.diff" size="2588" author="dave@daveoxley.co.uk" created="Thu, 9 Feb 2012 05:04:45 +0000"/>
                            <attachment id="12511462" name="dbcp_bug.tar.gz" size="2739" author="dave@daveoxley.co.uk" created="Mon, 23 Jan 2012 01:13:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224873</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fttz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90431</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-375] initialSize &lt; minIdle =&gt; non-performing query plans are chosen</title>
                <link>https://issues.apache.org/jira/browse/DBCP-375</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We found a strange behaviour when setting initialSize=0 and minIdle=10:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;non-performing query plans are used on the DB&lt;/li&gt;
	&lt;li&gt;correct query plans are used by &quot;small&quot; java app without dhcp and pool (or by sqldeveloper)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Analysis:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;DB tracing showed no difference between the inputs of performing/non-performing queries&lt;/li&gt;
	&lt;li&gt;ojdbc tracing showed no difference neither&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Work-around:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;set initialSize = minIdle, e.g., both to 10.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;ul&gt;
	&lt;li&gt;dhcp 1.2.1, pool 1.2 (issue also tested with latests library version =&amp;gt; still there)&lt;/li&gt;
	&lt;li&gt;java 6&lt;/li&gt;
	&lt;li&gt;oracle 10.2 and 11 (ojdbc 4 - 6)&lt;/li&gt;
	&lt;li&gt;hibernate 2.1.8&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="12538125">DBCP-375</key>
            <summary>initialSize &lt; minIdle =&gt; non-performing query plans are chosen</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="paha">Patrick Hammer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Jan 2012 22:49:26 +0000</created>
                <updated>Sat, 31 May 2014 04:09:18 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 22:00:15 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>1.2.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13887145" author="markt" created="Thu, 30 Jan 2014 22:00:15 +0000"  >&lt;p&gt;I don&apos;t really see what the DBCP developers can do about this. I suspect it is a feature of the JDBC driver.&lt;/p&gt;

&lt;p&gt;Feel free to re-open this if there is a DBCP issue to be fixed. We&apos;ll need a test case that demonstrates it - ideally in the form of a unit test.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223631</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90432</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-374] commons-dbcp-1.4-src compile fail with apache-ant-1.8.2 and jdk1.7.0_02 and jdk1.6.0_29</title>
                <link>https://issues.apache.org/jira/browse/DBCP-374</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I downloaded commons-dbcp-1.4-src.tar.gz, untarred it to ~/commons-dbcp-1.4-src,&lt;br/&gt;
With ANT_HOME set to commons-dbcp-1.4-src and JAVA_HOME set to jdk1.7.0_02 &lt;br/&gt;
I ran ant dist and got the following errors:&lt;br/&gt;
$ ant dist&lt;br/&gt;
Buildfile: /home/sai/commons-dbcp-1.4-src/build.xml&lt;/p&gt;

&lt;p&gt;init:&lt;/p&gt;

&lt;p&gt;clean:&lt;/p&gt;

&lt;p&gt;check_depends:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Checking dependencies&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find /home/sai/commons-dbcp-1.4-src/../pool/dist/commons-pool.jar&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${junit.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${naming-common.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${naming-java.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${commons-logging.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${xerces.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${jta-spec.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${jta-impl.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${backport-util-concurrent.jar}&lt;/p&gt;

&lt;p&gt;check_jar:&lt;/p&gt;

&lt;p&gt;check_message:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Could not find ${ejb-spec.jar}&lt;/p&gt;

&lt;p&gt;prepare-nojdbc4:&lt;/p&gt;

&lt;p&gt;prepare-jdbc4:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; JDBC 4 was detected.&lt;/p&gt;

&lt;p&gt;prepare:&lt;/p&gt;

&lt;p&gt;compile:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;mkdir&amp;#93;&lt;/span&gt; Created dir: /home/sai/commons-dbcp-1.4-src/build/classes&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/build.xml:197: warning: &apos;includeantruntime&apos; was not set, defaulting to build.sysclasspath=last; set to false for repeatable builds&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Compiling 53 source files to /home/sai/commons-dbcp-1.4-src/build/classes&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;options&amp;#93;&lt;/span&gt; bootstrap class path not set in conjunction with -source 1.5&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/AbandonedObjectPool.java:24: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.PoolableObjectFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/AbandonedObjectPool.java:25: error: package org.apache.commons.pool.impl does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.impl.GenericObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/AbandonedObjectPool.java:36: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class AbandonedObjectPool extends GenericObjectPool {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                          ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol: class GenericObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/AbandonedObjectPool.java:54: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public AbandonedObjectPool(PoolableObjectFactory factory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class PoolableObjectFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class AbandonedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/BasicDataSource.java:33: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPoolFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/BasicDataSource.java:34: error: package org.apache.commons.pool.impl does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.impl.GenericKeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/BasicDataSource.java:35: error: package org.apache.commons.pool.impl does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.impl.GenericKeyedObjectPoolFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/BasicDataSource.java:36: error: package org.apache.commons.pool.impl does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.impl.GenericObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/BasicDataSource.java:1011: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected volatile GenericObjectPool connectionPool = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                        ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class GenericObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class BasicDataSource&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/BasicDataSource.java:1530: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             KeyedObjectPoolFactory statementPoolFactory, AbandonedConfig configuration) throws SQLException {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class BasicDataSource&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:26: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:27: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPoolFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:28: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.PoolableObjectFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:29: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.ObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:41: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class PoolableConnectionFactory implements PoolableObjectFactory {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                   ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol: class PoolableObjectFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:51: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:51: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:72: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:72: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:94: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:94: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:117: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:117: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:139: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:139: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:162: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:162: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:186: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:186: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:211: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                     ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:211: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnectionFactory(ConnectionFactory connFactory, ObjectPool pool, KeyedObjectPoolFactory stmtPoolFactory, String validationQuery, int validationQueryTimeout, Collection connectionInitSqls, boolean defaultReadOnly, boolean defaultAutoCommit, int defaultTransactionIsolation) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:236: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:237: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         KeyedObjectPoolFactory stmtPoolFactory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:266: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:267: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         KeyedObjectPoolFactory stmtPoolFactory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:299: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:300: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         KeyedObjectPoolFactory stmtPoolFactory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:334: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:335: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         KeyedObjectPoolFactory stmtPoolFactory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:371: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:372: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         KeyedObjectPoolFactory stmtPoolFactory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:410: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:411: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         KeyedObjectPoolFactory stmtPoolFactory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:450: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:451: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         KeyedObjectPoolFactory stmtPoolFactory,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:520: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     synchronized public void setPool(ObjectPool pool) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:535: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public synchronized ObjectPool getPool() {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:545: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public void setStatementPoolFactory(KeyedObjectPoolFactory stmtPoolFactory) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:726: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected volatile ObjectPool _pool = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                        ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnectionFactory.java:727: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected volatile KeyedObjectPoolFactory _stmtPoolFactory = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                        ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPoolFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableCallableStatement.java:26: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableCallableStatement.java:43: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     private final KeyedObjectPool _pool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                   ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableCallableStatement&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableCallableStatement.java:58: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableCallableStatement(CallableStatement stmt, Object key, KeyedObjectPool pool, Connection conn) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                          ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableCallableStatement&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnection.java:22: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.ObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnection.java:37: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected ObjectPool _pool = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnection&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnection.java:44: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnection(Connection conn, ObjectPool pool) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnection&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolableConnection.java:55: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolableConnection(Connection conn, ObjectPool pool, AbandonedConfig config) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolableConnection&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolablePreparedStatement.java:26: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolablePreparedStatement.java:45: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected KeyedObjectPool _pool = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolablePreparedStatement&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolablePreparedStatement.java:61: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolablePreparedStatement(PreparedStatement stmt, Object key, KeyedObjectPool pool, Connection conn) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                          ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolablePreparedStatement&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingConnection.java:27: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingConnection.java:28: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedPoolableObjectFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingConnection.java:45: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class PoolingConnection extends DelegatingConnection implements Connection, KeyedPoolableObjectFactory {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol: class KeyedPoolableObjectFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingConnection.java:47: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected KeyedObjectPool _pstmtPool = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingConnection&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingConnection.java:69: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolingConnection(Connection c, KeyedObjectPool pool) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                            ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingConnection&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDataSource.java:33: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.ObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDataSource.java:54: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public PoolingDataSource(ObjectPool pool) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                              ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingDataSource&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDataSource.java:58: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public void setPool(ObjectPool pool) throws IllegalStateException, NullPointerException {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingDataSource&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDataSource.java:168: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected ObjectPool _pool = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingDataSource&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDriver.java:39: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.ObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDriver.java:96: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public synchronized ObjectPool getPool(String name) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingDriver&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDriver.java:105: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public synchronized ObjectPool getConnectionPool(String name) throws SQLException {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingDriver&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDriver.java:143: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public synchronized void registerPool(String name, ObjectPool pool) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                        ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolingDriver&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDriver.java:256: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         private final ObjectPool pool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                       ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolGuardConnectionWrapper&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/PoolingDriver.java:259: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         PoolGuardConnectionWrapper(ObjectPool pool, Connection delegate) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolGuardConnectionWrapper&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/PooledConnectionImpl.java:36: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/PooledConnectionImpl.java:37: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedPoolableObjectFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/PooledConnectionImpl.java:47: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         implements PooledConnection, KeyedPoolableObjectFactory {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                      ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol: class KeyedPoolableObjectFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/PooledConnectionImpl.java:83: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     protected KeyedObjectPool pstmtPool = null;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PooledConnectionImpl&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/PooledConnectionImpl.java:95: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     PooledConnectionImpl(Connection connection, KeyedObjectPool pool) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                 ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PooledConnectionImpl&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/DriverAdapterCPDS.java:37: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/DriverAdapterCPDS.java:38: error: package org.apache.commons.pool.impl does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.impl.GenericKeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/PoolablePreparedStatementStub.java:23: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/cpdsadapter/PoolablePreparedStatementStub.java:44: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             KeyedObjectPool pool, Connection conn) {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class PoolablePreparedStatementStub&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/CPDSConnectionFactory.java:33: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.ObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/CPDSConnectionFactory.java:34: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.PoolableObjectFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/CPDSConnectionFactory.java:44: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         implements PoolableObjectFactory, ConnectionEventListener, PooledConnectionManager {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol: class PoolableObjectFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/CPDSConnectionFactory.java:53: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     private final ObjectPool _pool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                   ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class CPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/CPDSConnectionFactory.java:82: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                  ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                  ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class CPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/CPDSConnectionFactory.java:105: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                   ObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                   ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class CPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/CPDSConnectionFactory.java:124: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;      public ObjectPool getPool() {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class ObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class CPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/InstanceKeyDataSource.java:38: error: package org.apache.commons.pool.impl does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.impl.GenericObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                    ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/KeyedCPDSConnectionFactory.java:33: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/KeyedCPDSConnectionFactory.java:34: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.KeyedPoolableObjectFactory;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/KeyedCPDSConnectionFactory.java:44: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     implements KeyedPoolableObjectFactory, ConnectionEventListener, PooledConnectionManager {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol: class KeyedPoolableObjectFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/KeyedCPDSConnectionFactory.java:53: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     private final KeyedObjectPool _pool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                   ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class KeyedCPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/KeyedCPDSConnectionFactory.java:74: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                       KeyedObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                       ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class KeyedCPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/KeyedCPDSConnectionFactory.java:91: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                       KeyedObjectPool pool,&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                       ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class KeyedCPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/KeyedCPDSConnectionFactory.java:106: error: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;     public KeyedObjectPool getPool() {&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;            ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   symbol:   class KeyedObjectPool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;   location: class KeyedCPDSConnectionFactory&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/sai/commons-dbcp-1.4-src/src/java/org/apache/commons/dbcp/datasources/PerUserPoolDataSource.java:36: error: package org.apache.commons.pool does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.commons.pool.ObjectPool;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Note: Some input files use or override a deprecated API.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Note: Recompile with -Xlint:deprecation for details.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Note: Some input files use unchecked or unsafe operations.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Note: Recompile with -Xlint:unchecked for details.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 100 errors&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 1 warning&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
/home/sai/commons-dbcp-1.4-src/build.xml:197: Compile failed; see the compiler error output for details.&lt;/p&gt;

&lt;p&gt;Total time: 4 seconds&lt;/p&gt;

&lt;p&gt;I tried compiling dbcp with java jdk1.6.0_29 and got the same errors&lt;/p&gt;</description>
                <environment>&lt;p&gt;Red Hat Enterprise Linux Server release 5.7 (Tikanga)&lt;br/&gt;
Linux 2.6.18-274.7.1.el5 #1 SMP Mon Oct 17 11:57:14 EDT 2011 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;</environment>
        <key id="12536015">DBCP-374</key>
            <summary>commons-dbcp-1.4-src compile fail with apache-ant-1.8.2 and jdk1.7.0_02 and jdk1.6.0_29</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sowensma">Stephen Owens</reporter>
                        <labels>
                            <label>compile</label>
                    </labels>
                <created>Wed, 21 Dec 2011 14:02:00 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:04 +0000</updated>
                            <resolved>Thu, 29 Dec 2011 17:00:10 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13177270" author="markt" created="Thu, 29 Dec 2011 17:00:10 +0000"  >&lt;p&gt;You must use Java 6 to build.&lt;/p&gt;

&lt;p&gt;You need to configure the dependencies.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221698</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tjfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170458</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-372] Statement Leak occurs when batch update is used.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-372</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;org.apache.commons.dbcp.PoolablePreparedStatement#passivate()&lt;br/&gt;
execute clearBatch().&lt;br/&gt;
(&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-264&quot; title=&quot;clear batch when closing statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-264&quot;&gt;&lt;del&gt;DBCP-264&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;But this clearBatch() throw SQLException.&lt;br/&gt;
(DelegatingStatement#checkOpen() throw SQLException, because _closed is true.)&lt;/p&gt;

&lt;p&gt;The result,&lt;br/&gt;
the PoolablePreparedStatement doesn&apos;t return to pool, and&lt;br/&gt;
the PoolablePreparedStatement doesn&apos;t execute PreparedStatement#close().&lt;/p&gt;

&lt;p&gt;When a lot of data is processed, &lt;br/&gt;
in the case of Oracle&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ORA-00604&lt;/li&gt;
	&lt;li&gt;ORA-01000&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;occurs.&lt;/p&gt;


&lt;p&gt;Proposal:&lt;br/&gt;
&quot;clearBatch();&quot; in passivate() method&lt;br/&gt;
changes as follows.&lt;/p&gt;

&lt;p&gt;batchAdded = false;&lt;br/&gt;
getInnermostDelegate().clearBatch();&lt;/p&gt;</description>
                <environment>&lt;p&gt;Oracle 11g&lt;/p&gt;</environment>
        <key id="12533878">DBCP-372</key>
            <summary>Statement Leak occurs when batch update is used.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="taromaru">Naozumi Taromaru</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Dec 2011 13:10:08 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:15 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 23:20:33 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13492454" author="tn" created="Wed, 7 Nov 2012 16:06:08 +0000"  >&lt;p&gt;Indeed, the current passivate method in PoolablePreparedStatement does the following:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public void passivate() throws SQLException {
        _closed = true;
        if(_conn != null) {
            _conn.removeTrace(this);
        }

        // The JDBC spec requires that a statement closes any open
        // ResultSet&apos;s when it is closed.
        // FIXME The PreparedStatement we&apos;re wrapping should handle this for us.
        // See bug 17301 for what could happen when ResultSets are closed twice.
        List&amp;lt;AbandonedTrace&amp;gt; resultSets = getTrace();
        if( resultSets != null) {
            ResultSet[] set = resultSets.toArray(new ResultSet[resultSets.size()]);
            for (int i = 0; i &amp;lt; set.length; i++) {
                set[i].close();
            }
            clearTrace();
        }
        if (batchAdded) {
            clearBatch();
        }
        
        super.passivate();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thus, indicating that the connection is closed first, and then afterwards trying to clear any batches. Now the clearBatch method throws an exception if the connection is already marked as closed.&lt;/p&gt;

&lt;p&gt;Imho, the suggested fix would be fine, but we could also change the passivate method to call clearBatch before setting _closed to true.&lt;/p&gt;</comment>
                            <comment id="13614103" author="psteitz" created="Tue, 26 Mar 2013 15:14:19 +0000"  >&lt;p&gt;Any other comments / suggestions on this?  It might also be good to wrap and swallow SQLException per the first patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-264&quot; title=&quot;clear batch when closing statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-264&quot;&gt;&lt;del&gt;DBCP-264&lt;/del&gt;&lt;/a&gt; (along with Thomas&apos; suggested changes).&lt;/p&gt;</comment>
                            <comment id="13890096" author="markt" created="Mon, 3 Feb 2014 23:20:33 +0000"  >&lt;p&gt;Thanks for the report and the fix. Sorry it has taken so long to address this.&lt;/p&gt;

&lt;p&gt;I think, based on my testing, that the statement leak has been fixed by changes to Pool but that prior to this fix the problem manifested itself as the PreparedStatement always being invalidated on return to the pool (making the pooling of statements pointless) if batchUpdate() was used.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed trunk for the 2.x series the 1.5.x branch. It will be included in the next release of each.&lt;/p&gt;

&lt;p&gt;If there are further 1.3.x and 1.4.x releases (currently being discussed on the dev mailing list) my expectation is that they will be generated from the 1.5.x branch so will pick up this fix too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12638779">DBCP-397</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12638779">DBCP-397</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12682395">DBCP-407</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219604</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-371] DelegatingDatabaseMetaData</title>
                <link>https://issues.apache.org/jira/browse/DBCP-371</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When calling Connection.getMetaData() new objects of DelegationDatabaseMetaData and corresponding vendor specific objects (like IfxDatabaseMetaData) are created and never released for garabage collection. This bug seem to have been introduced in version 1.3. Version 1.2 does not have this problem.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Informix database&lt;/p&gt;</environment>
        <key id="12533406">DBCP-371</key>
            <summary>DelegatingDatabaseMetaData</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="frebe73">Fredrik Bertilsson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2011 06:37:43 +0000</created>
                <updated>Thu, 1 Dec 2011 09:57:40 +0000</updated>
                            <resolved>Thu, 1 Dec 2011 06:59:48 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13160695" author="psteitz" created="Thu, 1 Dec 2011 06:59:48 +0000"  >&lt;p&gt;This duplicates &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-330&quot; title=&quot;Calling getMetaData() without closing the connection lead to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-330&quot;&gt;&lt;del&gt;DBCP-330&lt;/del&gt;&lt;/a&gt;, which has been fixed in the DBCP_1_4 branch.  The fix will be included in DBCP 1.3.1 / 1.4.1&lt;/p&gt;</comment>
                            <comment id="13160782" author="jan.sall@logica.com" created="Thu, 1 Dec 2011 09:57:40 +0000"  >&lt;p&gt;Hi&lt;br/&gt;
When will the DBCP 1.3.1 / 1.4.1 be available?&lt;/p&gt;

&lt;p&gt;We need to decide how to do - wait for this or go to 1.2&lt;/p&gt;

&lt;p&gt;Best regards&lt;br/&gt;
jan&lt;/p&gt;




&lt;p&gt;Jan S&#228;ll Produkt&#228;gare och Utvecklingschef Palasso&lt;br/&gt;
BPO HRM | Logica Sweden&lt;br/&gt;
Magasin 3, L&#246;fbergskajen, 652 24  Karlstad | Sweden&lt;br/&gt;
T: +46 54 14 71 37 | M: +46 733 98 10 21&lt;/p&gt;

&lt;p&gt;jan.sall@logica.com&amp;lt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:jan.sall@logica.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jan.sall@logica.com&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&amp;gt; | www.logica.se&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://www.logica.se/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.logica.se/&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;Fr&#229;n: Fredrik Bertilsson &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:frebe73@gmail.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;frebe73@gmail.com&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
Skickat: den 1 december 2011 08:42&lt;br/&gt;
Till: S&#228;ll, Jan&lt;br/&gt;
&#196;mne: Fwd: &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Closed&amp;#93;&lt;/span&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-371&quot; title=&quot;DelegatingDatabaseMetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-371&quot;&gt;&lt;del&gt;DBCP-371&lt;/del&gt;&lt;/a&gt;) DelegatingDatabaseMetaData&lt;/p&gt;

&lt;p&gt;Hej,&lt;br/&gt;
verkar som att apache har en fix p&#229; g&#229;ng i version 1.4.1.&lt;/p&gt;

&lt;p&gt;Mvh Fredrik B&lt;br/&gt;
---------- Forwarded message ----------&lt;br/&gt;
From: Phil Steitz (Closed) (JIRA) &amp;lt;jira@apache.org&amp;lt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:jira@apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jira@apache.org&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&amp;gt;&amp;gt;&lt;br/&gt;
Date: Thu, Dec 1, 2011 at 8:01 AM&lt;br/&gt;
Subject: &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Closed&amp;#93;&lt;/span&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-371&quot; title=&quot;DelegatingDatabaseMetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-371&quot;&gt;&lt;del&gt;DBCP-371&lt;/del&gt;&lt;/a&gt;) DelegatingDatabaseMetaData&lt;br/&gt;
To: frebe73@gmail.com&amp;lt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:frebe73@gmail.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;frebe73@gmail.com&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&amp;gt;&lt;/p&gt;



&lt;p&gt;    [ &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-371?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DBCP-371?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Phil Steitz closed &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-371&quot; title=&quot;DelegatingDatabaseMetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-371&quot;&gt;&lt;del&gt;DBCP-371&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
----------------------------&lt;/p&gt;

&lt;p&gt;      Resolution: Duplicate&lt;br/&gt;
   Fix Version/s:     (was: 1.2)&lt;br/&gt;
                  1.4.1&lt;/p&gt;

&lt;p&gt;This duplicates &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-330&quot; title=&quot;Calling getMetaData() without closing the connection lead to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-330&quot;&gt;&lt;del&gt;DBCP-330&lt;/del&gt;&lt;/a&gt;, which has been fixed in the DBCP_1_4 branch.  The fix will be included in DBCP 1.3.1 / 1.4.1&lt;/p&gt;


&lt;p&gt;&amp;#8211;&lt;br/&gt;
This message is automatically generated by JIRA.&lt;br/&gt;
If you think it was sent incorrectly, please contact your JIRA administrators: &lt;a href=&quot;https://issues.apache.org/jira/secure/ContactAdministrators!default.jspa&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/ContactAdministrators!default.jspa&lt;/a&gt;&amp;lt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ContactAdministrators%21default.jspa&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/ContactAdministrators%21default.jspa&lt;/a&gt;&amp;gt;&lt;br/&gt;
For more information on JIRA, see: &lt;a href=&quot;http://www.atlassian.com/software/jira&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.atlassian.com/software/jira&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;&amp;#8211;&lt;br/&gt;
Mvh Fredrik Bertilsson&lt;br/&gt;
0766-519617&lt;/p&gt;


&lt;p&gt;Think green - keep it on the screen.&lt;br/&gt;
This e-mail and any attachment is for authorised use by the intended recipient(s) only. It may contain proprietary material, confidential information and/or be subject to legal privilege. It should not be copied, disclosed to, retained or used by, any other party. If you are not an intended recipient then please promptly delete this e-mail and any attachment and all copies and inform the sender. Thank you. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219134</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-369] Exception when using SharedPoolDataSource concurrently</title>
                <link>https://issues.apache.org/jira/browse/DBCP-369</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I get a ConcurrentModificationException when using instances of SharedPoolDataSource concurrently. The problem occurs when one thread calls setDataSourceName() while another thread calls close(), either on the same instance of SharedPoolDataSource or on different instances. I&apos;ll attach a short example program that leads to an exception for almost every run on my machine.&lt;/p&gt;

&lt;p&gt;The cause of the exception seems to be in InstanceKeyObjectFactory. registerNewInstance() is synchronized, but removeInstance() isn&apos;t. This allows concurrent accesses to the non-thread-safe &apos;instanceMap&apos;.&lt;/p&gt;

&lt;p&gt;Is this a bug? Or are SharedPoolDataSource and InstanceKeyObjectFactory not supposed to be thread-safe?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;


&lt;p&gt;import java.util.ArrayList;&lt;br/&gt;
import org.apache.commons.dbcp.datasources.SharedPoolDataSource;&lt;/p&gt;

&lt;p&gt;public class SharedPoolDataSourceTest {&lt;/p&gt;

&lt;p&gt;	public static void main(String[] args) &lt;/p&gt;
{
		new SharedPoolDataSourceTest().run();
	}

&lt;p&gt;	private void run() {&lt;br/&gt;
		final ArrayList&amp;lt;SharedPoolDataSource&amp;gt; dataSources = new ArrayList&amp;lt;SharedPoolDataSource&amp;gt;();&lt;br/&gt;
		for (int j = 0; j &amp;lt; 10000; j++) &lt;/p&gt;
{
			SharedPoolDataSource dataSource = new SharedPoolDataSource();
			dataSources.add(dataSource);
		}

&lt;p&gt;		Thread t1 = new Thread(new Runnable() {&lt;br/&gt;
			public void run() {&lt;br/&gt;
				for (SharedPoolDataSource dataSource : dataSources) &lt;/p&gt;
{
					dataSource.setDataSourceName(&quot;a&quot;);	
				}
&lt;p&gt;					&lt;br/&gt;
			}&lt;br/&gt;
		});&lt;br/&gt;
		Thread t2 = new Thread(new Runnable() {&lt;br/&gt;
			public void run() {&lt;br/&gt;
				for (SharedPoolDataSource dataSource : dataSources) {&lt;br/&gt;
					try &lt;/p&gt;
{ dataSource.close(); }
&lt;p&gt; catch (Exception e) {}	&lt;br/&gt;
				}&lt;/p&gt;

&lt;p&gt;			}&lt;br/&gt;
		});&lt;br/&gt;
		t1.start();&lt;br/&gt;
		t2.start();&lt;br/&gt;
		try &lt;/p&gt;
{
			t1.join();
			t2.join();
		}
&lt;p&gt; catch (InterruptedException ie) {}&lt;br/&gt;
	}	&lt;br/&gt;
}&lt;/p&gt;



&lt;p&gt;Exception in thread &quot;Thread-0&quot; java.util.ConcurrentModificationException&lt;br/&gt;
	at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
	at java.util.HashMap$KeyIterator.next(HashMap.java:828)&lt;br/&gt;
	at org.apache.commons.dbcp.datasources.InstanceKeyObjectFactory.registerNewInstance(InstanceKeyObjectFactory.java:51)&lt;br/&gt;
	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.setDataSourceName(InstanceKeyDataSource.java:246)&lt;br/&gt;
	at potentialBugs.SharedPoolDataSourceTest$1.run(SharedPoolDataSourceTest.java:23)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java Hotspot Server VM 1.6.0_07, Linux&lt;/p&gt;</environment>
        <key id="12526807">DBCP-369</key>
            <summary>Exception when using SharedPoolDataSource concurrently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="michaelpradel">Michael Pradel</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Oct 2011 07:34:13 +0000</created>
                <updated>Sat, 31 May 2014 04:09:55 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 21:56:42 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13492426" author="tn" created="Wed, 7 Nov 2012 15:29:29 +0000"  >&lt;p&gt;The access to the InstanceKeyObjectFactory is not fully synchronized. Some methods (registerNewInstance) were already synchronized, while others (removeInstance, closeAll) not.&lt;/p&gt;

&lt;p&gt;This lead to the ConcurrentModificationExceptions when multiple threads try to modify the internal instanceMap.&lt;/p&gt;

&lt;p&gt;The attached patch adds a unit test and fixes the problem by synchronizing all public/protected methods in the factory that modify / access the instanceMap.&lt;/p&gt;</comment>
                            <comment id="13887121" author="markt" created="Thu, 30 Jan 2014 21:56:42 +0000"  >&lt;p&gt;Thanks for the report and the test case. Sorry it has taken so long to address this.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed trunk for the 2.x series the 1.5.x branch. It will be included in the next release of each.&lt;/p&gt;

&lt;p&gt;If there are further 1.3.x and 1.4.x releases (currently being discussed on the dev mailing list) my expectation is that they will be generated from the 1.5.x branch so will pick up this fix too.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12552478" name="DBCP-369.patch" size="3236" author="tn" created="Wed, 7 Nov 2012 15:29:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90435</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-366] Getting Exception when trying to get the PrepareStatement from Connection From DBCP Pool</title>
                <link>https://issues.apache.org/jira/browse/DBCP-366</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Using commons-dbcp-1.2.2.jar version with Tomcat version 6.0.29.&lt;/p&gt;

&lt;p&gt;Getting the following exception when trying to get the java.sql.PrepareStatement using a Connection from DBCP Pool:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.sql.SQLException: Connection is closed.
        at org.apache.commons.dbcp.PoolingDriver$PoolGuardConnectionWrapper.checkOpen(PoolingDriver.java:263)
        at org.apache.commons.dbcp.PoolingDriver$PoolGuardConnectionWrapper.prepareStatement(PoolingDriver.java:366)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the configuration we are using for creating Connection Pool from DBCP:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void setupDriver(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connectURI, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; userName,
			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; dbPassword, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; maxActive, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; minIdle,
			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; maxWait, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; poolName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		GenericObjectPool.Config config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool.Config();
		config.maxActive = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(maxActive);
		config.minIdle = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(minIdle);
		config.maxWait = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(maxWait);
		config.whenExhaustedAction = 2;
		config.minEvictableIdleTimeMillis = 1800000;
		config.timeBetweenEvictionRunsMillis = 1800000;
		config.numTestsPerEvictionRun = 3;
		config.testOnBorrow = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
		config.testOnReturn = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
		config.testWhileIdle = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
		ObjectPool connectionPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, config);
		ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DriverManagerConnectionFactory(
				connectURI, userName, dbPassword);
		PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(
				connectionFactory, connectionPool, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
		poolableConnectionFactory.setValidationQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;select 1 from dual&quot;&lt;/span&gt;);
		driver = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDriver();
		driver.registerPool(poolName, connectionPool);

		driver.setAccessToUnderlyingConnectionAllowed(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
		&lt;span class=&quot;code-comment&quot;&gt;// PoolingDataSource dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource(connectionPool);
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dataSource;
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following code is used to get the Connection:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; java.sql.Connection getConnection(poolName) {
        Connection con = DriverManager.getConnection(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:apache:commons:dbcp:&quot;&lt;/span&gt;+poolName);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; con;				
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following code is used to release the connection:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void release(Connection conn) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; DBException {
	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
		conn.close();
	} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
		&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(e.getMessage(), e);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you let us know what might be the exact reason for the following exception?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux machine&lt;/p&gt;</environment>
        <key id="12524515">DBCP-366</key>
            <summary>Getting Exception when trying to get the PrepareStatement from Connection From DBCP Pool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sarojkumar.balusu@gmail.com">saroj kumar balusu</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 Sep 2011 16:33:23 +0000</created>
                <updated>Sat, 31 May 2014 04:11:05 +0000</updated>
                            <resolved>Tue, 3 Dec 2013 10:48:21 +0000</resolved>
                                    <version>1.2.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13837564" author="markt" created="Tue, 3 Dec 2013 10:48:21 +0000"  >&lt;p&gt;You are continuing to try and use the connection after you have closed it. That is not allowed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 48 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-365] StackOverflowError SharedPoolDataSource.getPooledConnectionAndInfo() Postgresql</title>
                <link>https://issues.apache.org/jira/browse/DBCP-365</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>
&lt;p&gt;This might be a problem with the JDBC driver for PostgreSQL 9.1 but it also shows up here. Since this is a StackOverflowError there isn&apos;t much information about what specifically is causing this. I&apos;m guessing it&apos;s a Class.forName() for one of the org.postgresql.* classes but not sure which one. The Class.forName() goes into a loop which throws the StackOverflowError.&lt;/p&gt;


&lt;p&gt;SharedPoolDataSource.getPooledConnectionAndInfo(String, String) line: 174	&lt;br/&gt;
SharedPoolDataSource(InstanceKeyDataSource).getConnection(String, String) line: 701	&lt;br/&gt;
SharedPoolDataSource(InstanceKeyDataSource).getConnection() line: 676	&lt;/p&gt;



&lt;p&gt;			spds = new org.apache.commons.dbcp.datasources.SharedPoolDataSource();&lt;br/&gt;
			cpds = new org.apache.commons.dbcp.cpdsadapter.DriverAdapterCPDS();&lt;br/&gt;
			cpds.setDriver(&quot;org.postgresql.Driver&quot;);&lt;br/&gt;
			cpds.setUrl(&quot;jdbc:postgresql://localhost:1234/mydatabasename&quot;);&lt;br/&gt;
			cpds.setUser(&quot;myuser&quot;);&lt;br/&gt;
			cpds.setPassword(&quot;mypass&quot;);&lt;br/&gt;
			spds.setConnectionPoolDataSource(cpds);&lt;br/&gt;
			spds.setMaxActive(30);&lt;br/&gt;
			spds.setMaxWait(50);&lt;/p&gt;

&lt;p&gt;			conn = spds.getConnection();&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP 64-bit multi-threaded&lt;/p&gt;</environment>
        <key id="12523354">DBCP-365</key>
            <summary>StackOverflowError SharedPoolDataSource.getPooledConnectionAndInfo() Postgresql</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dj_axl">Axl</reporter>
                        <labels>
                            <label>JDBC</label>
                            <label>postgresql</label>
                    </labels>
                <created>Fri, 16 Sep 2011 16:24:17 +0000</created>
                <updated>Sat, 31 May 2014 04:11:14 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 16:49:02 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13107280" author="psteitz" created="Sat, 17 Sep 2011 22:33:25 +0000"  >&lt;p&gt;I can&apos;t reproduce this using the build 901 postgres 9.1 jdbc driver.  What driver, exactly are you using, what JDK and what versions of commons pool and DBCP? If you are using DBCP 1.4, you should be using the JDBC 4 driver and JDK 1.6+&lt;/p&gt;</comment>
                            <comment id="13112856" author="dj_axl" created="Thu, 22 Sep 2011 19:41:53 +0000"  >&lt;p&gt;Hi this turns out to be a permissions issue on the .jar files. The improvement I would like to see is, added logging for Class.forName(), or added handling of Throwable instead of only Exceptions. Looking at the source I see handling of exceptions however errors are not caught. So whatever your recommendation would be here. Could for example wrap all Class.forName() calls. Or a larger effort would be catching Throwable everywhere. This could be made lower priority, unless it turns out others are experiencing this issue. Whatever you think, I don&apos;t do all that much Java so it&apos;s your call.&lt;/p&gt;</comment>
                            <comment id="13886768" author="markt" created="Thu, 30 Jan 2014 16:49:02 +0000"  >&lt;p&gt;I&apos;m struggling to see how a file permission error can lead to stack overflow. Either the Postgresql JAR is readable (in which case it works) or it isn&apos;t (in which case you get a single CNFE).&lt;/p&gt;

&lt;p&gt;I&apos;m happy to take another look at this if some steps are provided to re-create the stack overflow.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90438</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-363] dbcp bundle should use DynamicImport</title>
                <link>https://issues.apache.org/jira/browse/DBCP-363</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The bundle provided in the maven central of the commons.dbcp doesn&apos;t have a DynamicImport defined. This resolves in following error:&lt;br/&gt;
If you want to use a BasicDataSource class as dataSource and the class is provided by the osgi environment (equinox, ...) the dataSource is not able to be created due to a ClassNotFoundException. If the bundle would have set DynamicImport it works. (I had to change from your bundle to the commons.dbcp bundle provided by servicemix, because there the DynamicImport is set)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509747">DBCP-363</key>
            <summary>dbcp bundle should use DynamicImport</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="arcticwolf">Felix Mayerhuber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2011 18:41:00 +0000</created>
                <updated>Sat, 31 May 2014 04:10:28 +0000</updated>
                            <resolved>Tue, 4 Feb 2014 14:30:56 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13047865" author="h2o" created="Sat, 11 Jun 2011 08:52:53 +0000"  >&lt;p&gt;The whole purpose of OSGi is to &lt;b&gt;prevent&lt;/b&gt; the kind of unfettered access and more or less random class wiring established by DynamicImport; it&apos;s a bad practice that should die out. Instead of letting dbcp blindly create instances the right thing to do would be use proper OSGi lookup of a DataSource through an OSGi-aware factory.&lt;br/&gt;
See: &lt;a href=&quot;http://www.osgi.org/javadoc/r4v42/org/osgi/service/jdbc/DataSourceFactory.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.osgi.org/javadoc/r4v42/org/osgi/service/jdbc/DataSourceFactory.html&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="13224547" author="jukkaz" created="Wed, 7 Mar 2012 17:51:51 +0000"  >&lt;p&gt;Having DynamicImport in place does not prevent DBCP from also using the DataSourceFactory mechanism in OSGi.&lt;/p&gt;

&lt;p&gt;Meanwhile defining DynamicImport for DBCP does solve the problem for cases where the JDBC driver exports the relevant driver classes but does not (yet) implement a DataSourceFactory service.&lt;/p&gt;</comment>
                            <comment id="13832623" author="balazs.zsoldos" created="Tue, 26 Nov 2013 14:35:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt;: It takes about 10 min to write a DataSourceFactory for any JDBC driver. DynamicImport is one of the biggest mistake inside OSGi a developer can use.&lt;/p&gt;

&lt;p&gt;Instead, please make it possible to create a BasicDataSource based on another DataSource like at &lt;a href=&quot;https://github.com/everit-org/commons-dbcp-component/blob/master/src/main/java/org/everit/osgi/jdbc/commons/dbcp/BasicSimpleDataSource.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/everit-org/commons-dbcp-component/blob/master/src/main/java/org/everit/osgi/jdbc/commons/dbcp/BasicSimpleDataSource.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13890720" author="markt" created="Tue, 4 Feb 2014 14:30:56 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-389&quot; title=&quot;Provide a configurable implementation of OSGi 4.2 DataSourceFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-389&quot;&gt;&lt;del&gt;DBCP-389&lt;/del&gt;&lt;/a&gt; for the enhancement request to provide a DataSourceFactory&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12594954">DBCP-386</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>71410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90440</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-362] Cannot create PoolableConnectionFactory when system proxy is defined.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-362</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;19 maj 2011 09:03:57,458 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;JCLLoggerAdapter.info(265)&amp;#93;&lt;/span&gt; - Initializing connection provider: org.springframework.orm.hibernate3.LocalDataSource ConnectionProvider&lt;br/&gt;
After that line my application hangs, but only if i set poxy server* in internet connection.&lt;/p&gt;

&lt;p&gt;I have a database in local network.&lt;br/&gt;
Only I meant here is that if I set the internet connection proxy application hangs on a line that I mentioned above. &lt;/p&gt;

&lt;p&gt;*Set proxy server:&lt;br/&gt;
On the Tools menu in Internet Explorer, click Internet Options, click the Connections tab, and then click LAN Settings.&lt;br/&gt;
Under Proxy server, click to select the Use a proxy server for your LAN check box.&lt;br/&gt;
In the Address box, type the IP address of the proxy server.&lt;br/&gt;
In the Port box, type the port number that is used by the proxy server for client connections (by default, 8080).&lt;br/&gt;
Click OK to close the LAN Settings dialog box.&lt;br/&gt;
Click OK again to close the Internet Options dialog box.&lt;/p&gt;

&lt;p&gt;I even try select and unselect the Bypass proxy server for local addresses check box but it doesn&apos;t metter. &lt;/p&gt;

&lt;p&gt;When i turn of proxy in IE eveything works ok.&lt;/p&gt;

&lt;p&gt;I started debugin....&lt;br/&gt;
First of all after 5minutes i have got exception...&lt;br/&gt;
    org.apache.commons.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (JZ006: Caught IOException: java.net.SocketException: Malformed reply from SOCKS server)&lt;br/&gt;
    	at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1225)&lt;br/&gt;
    	at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:880)&lt;br/&gt;
    	at info.kkrzyzak.sunfire.dao.utils.DecryptingDataSource.getConnection(DecryptingDataSource.java:36)&lt;br/&gt;
    	at org.springframework.orm.hibernate3.LocalDataSourceConnectionProvider.getConnection(LocalDataSourceConnectionProvider.java:82)&lt;br/&gt;
    	at org.hibernate.cfg.SettingsFactory.buildSettings(SettingsFactory.java:114)&lt;br/&gt;
    	at org.hibernate.cfg.Configuration.buildSettingsInternal(Configuration.java:2163)&lt;br/&gt;
    	at org.hibernate.cfg.Configuration.buildSettings(Configuration.java:2159)&lt;br/&gt;
    	at org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1383)&lt;br/&gt;
    	at org.hibernate.cfg.AnnotationConfiguration.buildSessionFactory(AnnotationConfiguration.java:954)&lt;br/&gt;
    	at org.springframework.orm.hibernate3.LocalSessionFactoryBean.newSessionFactory(LocalSessionFactoryBean.java:814)&lt;br/&gt;
    	at org.springframework.orm.hibernate3.LocalSessionFactoryBean.buildSessionFactory(LocalSessionFactoryBean.java:732)&lt;br/&gt;
    	at org.springframework.orm.hibernate3.AbstractSessionFactoryBean.afterPropertiesSet(AbstractSessionFactoryBean.java:211)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1369)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)&lt;br/&gt;
    	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)&lt;br/&gt;
    	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:269)&lt;br/&gt;
    	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:104)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1245)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1010)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:472)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)&lt;br/&gt;
    	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:671)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:610)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:412)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.InjectionMetadata.injectFields(InjectionMetadata.java:105)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessAfterInstantiation(AutowiredAnnotationBeanPostProcessor.java:240)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:959)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:472)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)&lt;br/&gt;
    	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:671)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:610)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:412)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.InjectionMetadata.injectFields(InjectionMetadata.java:105)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessAfterInstantiation(AutowiredAnnotationBeanPostProcessor.java:240)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:959)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:472)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)&lt;br/&gt;
    	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:671)&lt;br/&gt;
    	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:610)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:412)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.InjectionMetadata.injectFields(InjectionMetadata.java:105)&lt;br/&gt;
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessAfterInstantiation(AutowiredAnnotationBeanPostProcessor.java:240)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:959)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:472)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409)&lt;br/&gt;
    	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380)&lt;br/&gt;
....&lt;/p&gt;

&lt;p&gt;I was based on the information contained in article &quot;Java Networking and Proxies&quot; (javase/6/docs/technotes/guides/net)&lt;br/&gt;
I turn off using proxy.&lt;/p&gt;

&lt;p&gt;I think for some reason the JRE tries to talk SOCKS protocol to a host, which is not a SOCKS proxy.&lt;br/&gt;
For clearly, I haven&apos;t SOCKS proxy server.&lt;/p&gt;

&lt;p&gt;Still debuging....&lt;/p&gt;

&lt;p&gt;(BasicDataSource.java)&lt;br/&gt;
It hangs in method protected static void validateConnectionFactory(PoolableConnectionFactor y connectionFactory) when try to call conn = (Connection) connectionFactory.makeObject();&lt;/p&gt;

&lt;p&gt;and as I mentioned after 5minutes throw above exception.&lt;/p&gt;</description>
                <environment>&lt;p&gt;w7(64b), hibernate 3.5.5, spring 2.5.6, dbcp  1.4, pool 1.5.6&lt;/p&gt;</environment>
        <key id="12507854">DBCP-362</key>
            <summary>Cannot create PoolableConnectionFactory when system proxy is defined.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kkrzyzak">Karol Krzyzak</reporter>
                        <labels>
                            <label>PoolableConnectionFactory</label>
                            <label>proxy</label>
                    </labels>
                <created>Fri, 20 May 2011 09:12:20 +0000</created>
                <updated>Mon, 30 May 2011 10:37:35 +0000</updated>
                            <resolved>Mon, 30 May 2011 10:37:34 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13041078" author="kkrzyzak" created="Mon, 30 May 2011 10:37:34 +0000"  >&lt;p&gt;The problem stemmed from the use of SAF (Simple Application Framework). Spring initialization has been performed in method initialize a proxy definition in the method main. After the transfer the following line of code to the initialize method, application start normally.&lt;br/&gt;
Code:&lt;/p&gt;

&lt;p&gt;System.setProperty(&quot;java.net.useSystemProxies&quot;,&quot;false&quot;);&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114636</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179104</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-360] BasicManagedDataSource fails with OracleXADataSource</title>
                <link>https://issues.apache.org/jira/browse/DBCP-360</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Using the same JDBC url and settings as in non-XA (driverClassName) mode, the BasicManagedDataSource will fail when it attempts to obtain an Oracle connection when using the Oracle oracle.jdbc.xa.client.OracleXADataSource datasource class.&lt;/p&gt;

&lt;p&gt;It appears that BasicManagedDataSource.createConnectionFactory is never actually setting the URL (I can&apos;t tell where if at all it is set, the exception must occur before then).&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;riceDataSource&quot; class=&quot;org.apache.commons.dbcp.managed.BasicManagedDataSource&quot; destroy-method=&quot;close&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;transactionManager&quot; ref=&quot;jotm&quot; /&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;url&quot; value=&quot;${datasource.url}&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;XADataSource&quot; value=&quot;${xadatasource.class}&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;maxActive&quot; value=&quot;${datasource.pool.maxActive}&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;minIdle&quot; value=&quot;${datasource.minIdle}&quot; /&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;initialSize&quot; value=&quot;${datasource.initialSize}&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;validationQuery&quot; value=&quot;${datasource.pool.validationQuery}&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;username&quot; value=&quot;${datasource.username}&quot; /&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;password&quot; value=&quot;${datasource.password}&quot; /&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;accessToUnderlyingConnectionAllowed&quot; value=&quot;${datasource.accessToUnderlyingConnectionAllowed}&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;connectionProperties&quot;&amp;gt;&amp;lt;value&amp;gt;driverType=thin;portNumber=1521&amp;lt;/value&amp;gt;&amp;lt;/property&amp;gt; &amp;lt;!-- as rumored on the internets --&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;org.springframework.jdbc.CannotGetJdbcConnectionException: Could not get JDBC Connection; nested exception is java.sql.SQLException: Cannot create PoolableConnectionFactory (Invalid Oracle URL specified: OracleDataSource.makeURL)&lt;br/&gt;
Caused by: java.sql.SQLException: Cannot create PoolableConnectionFactory (Invalid Oracle URL specified: OracleDataSource.makeURL)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.BasicManagedDataSource.createPoolableConnectionFactory(BasicManagedDataSource.java:200)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1388)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:1044)&lt;br/&gt;
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:113)&lt;br/&gt;
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:79)&lt;br/&gt;
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:276)&lt;br/&gt;
	at ConnectionTest$1.doInTransaction(ConnectionTest.java:79)&lt;br/&gt;
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:127)&lt;br/&gt;
	at ConnectionTest.testConnectionRecovery(ConnectionTest.java:76)&lt;br/&gt;
	at ConnectionTest.testOracleBMDSXARecovery(ConnectionTest.java:58)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
	at org.junit.internal.runners.TestMethod.invoke(TestMethod.java:59)&lt;br/&gt;
	at org.junit.internal.runners.MethodRoadie.runTestMethod(MethodRoadie.java:98)&lt;br/&gt;
	at org.junit.internal.runners.MethodRoadie$2.run(MethodRoadie.java:79)&lt;br/&gt;
	at org.junit.internal.runners.MethodRoadie.runBeforesThenTestThenAfters(MethodRoadie.java:87)&lt;br/&gt;
	at org.junit.internal.runners.MethodRoadie.runTest(MethodRoadie.java:77)&lt;br/&gt;
	at org.junit.internal.runners.MethodRoadie.run(MethodRoadie.java:42)&lt;br/&gt;
	at org.junit.internal.runners.JUnit4ClassRunner.invokeTestMethod(JUnit4ClassRunner.java:88)&lt;br/&gt;
	at org.junit.internal.runners.JUnit4ClassRunner.runMethods(JUnit4ClassRunner.java:51)&lt;br/&gt;
	at org.junit.internal.runners.JUnit4ClassRunner$1.run(JUnit4ClassRunner.java:44)&lt;br/&gt;
	at org.junit.internal.runners.ClassRoadie.runUnprotected(ClassRoadie.java:27)&lt;br/&gt;
	at org.junit.internal.runners.ClassRoadie.runProtected(ClassRoadie.java:37)&lt;br/&gt;
	at org.junit.internal.runners.JUnit4ClassRunner.run(JUnit4ClassRunner.java:42)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:49)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;br/&gt;
Caused by: java.sql.SQLException: Invalid Oracle URL specified: OracleDataSource.makeURL&lt;br/&gt;
	at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:112)&lt;br/&gt;
	at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:146)&lt;br/&gt;
	at oracle.jdbc.pool.OracleDataSource.makeURL(OracleDataSource.java:1353)&lt;br/&gt;
	at oracle.jdbc.pool.OracleDataSource.getURL(OracleDataSource.java:1064)&lt;br/&gt;
	at oracle.jdbc.xa.client.OracleXADataSource.getPooledConnection(OracleXADataSource.java:204)&lt;br/&gt;
	at oracle.jdbc.xa.client.OracleXADataSource.getXAConnection(OracleXADataSource.java:159)&lt;br/&gt;
	at oracle.jdbc.xa.client.OracleXADataSource.getXAConnection(OracleXADataSource.java:133)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.DataSourceXAConnectionFactory.createConnection(DataSourceXAConnectionFactory.java:103)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.PoolableManagedConnectionFactory.makeObject(PoolableManagedConnectionFactory.java:103)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.validateConnectionFactory(BasicDataSource.java:1556)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.BasicManagedDataSource.createPoolableConnectionFactory(BasicManagedDataSource.java:196)&lt;br/&gt;
	... 31 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12507417">DBCP-360</key>
            <summary>BasicManagedDataSource fails with OracleXADataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aaron">Aaron Bannert</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 May 2011 21:39:01 +0000</created>
                <updated>Mon, 16 May 2011 21:55:55 +0000</updated>
                            <resolved>Mon, 16 May 2011 21:55:50 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13034359" author="aaron" created="Mon, 16 May 2011 21:55:50 +0000"  >&lt;p&gt;invalid, the supported pattern is to inject a preconfigured XADataSource instance.  it might be worth making this a bit clearer in the docs: &quot;NOTE: your XADataSource implementation may require implementation-specific properties to be set.  If so, you must inject a preconstructed XADataSource object via setXaDataSource.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12411032">DBCP-279</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12423264">DBCP-289</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v09b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179015</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-359] DelegatingConnection.equals fails if both delegates are null</title>
                <link>https://issues.apache.org/jira/browse/DBCP-359</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DelegatingConnection conn3 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingConnection(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
assertTrue(conn3.equals(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingConnection(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test fails.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505998">DBCP-359</key>
            <summary>DelegatingConnection.equals fails if both delegates are null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joehni">Joerg Schaible</assignee>
                                    <reporter username="joehni">Joerg Schaible</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2011 00:38:43 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:07 +0000</updated>
                            <resolved>Tue, 3 May 2011 00:41:01 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13027964" author="joehni" created="Tue, 3 May 2011 00:41:01 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1098877&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1098877&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114633</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-358] Equals implementations in DelegatingXxx classes are not symmetric</title>
                <link>https://issues.apache.org/jira/browse/DBCP-358</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;For reasons unclear to me, DelegatingConnection, DelegatingStatement, PoolGuardConnectionWrappers and other DBCP classes implement equals so that the wrapping class is considered equal to its innermost delegate JDBC object.  This makes equals asymmetric when applied to a wrapper and its wrapped JDBC object - wrapper.equals(delegate) returns true, but delegate.equals(wrapper) will in general return false.&lt;/p&gt;

&lt;p&gt;I am pretty sure that DBCP itself does not rely on this bugged behavior, so I am inclined to fix it, making equals an equivalence relation on wrapper instances, with two considered equal iff their innermost delegates are equal.  I can&apos;t imagine use cases where the bugged behavior is required.  Can anyone else?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505732">DBCP-358</key>
            <summary>Equals implementations in DelegatingXxx classes are not symmetric</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Apr 2011 22:14:29 +0000</created>
                <updated>Sat, 31 May 2014 04:13:05 +0000</updated>
                            <resolved>Tue, 4 Feb 2014 13:45:08 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.2.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13027957" author="joehni" created="Tue, 3 May 2011 00:32:08 +0000"  >&lt;p&gt;This behavior is unfortunately used in the PoolableManagedConnection w/ TransactionRegistry. When a new connection is created in the pool, the unwrapped connection is registered (and used as key in the internal WeakHashMap). Later on the wrapped connection is used to unregister again (or to lookup the XAResource as done in org.apache.commons.dbcp.managed.TestBasicManagedDataSource.testReallyClose()). As workaround it is possible to wrap the registered connection if it is not wrapped yet:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: src/java/org/apache/commons/dbcp/managed/TransactionRegistry.java
===================================================================
--- src/java/org/apache/commons/dbcp/managed/TransactionRegistry.java   (revision 1098813)
+++ src/java/org/apache/commons/dbcp/managed/TransactionRegistry.java   (working copy)
@@ -28,7 +28,9 @@
 import javax.transaction.TransactionManager;
 import javax.transaction.xa.XAResource;
 
+import org.apache.commons.dbcp.DelegatingConnection;
 
+
 /**
  * TransactionRegistry tracks Connections and XAResources in a transacted environment for a single XAConnectionFactory.
  * &amp;lt;/p&amp;gt;
@@ -62,7 +64,10 @@
     public synchronized void registerConnection(Connection connection, XAResource xaResource) {
         if (connection == null) throw new NullPointerException(&quot;connection is null&quot;);
         if (xaResource == null) throw new NullPointerException(&quot;xaResource is null&quot;);
-        xaResources.put(connection, xaResource);
+        Connection key = connection instanceof DelegatingConnection 
+            ? connection 
+            : new DelegatingConnection(connection);
+        xaResources.put(key, xaResource);
     }
 
     /**
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This approach will also solve &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-356&quot; title=&quot;ManagedDataSource doesn&amp;#39;t work with an active transaction in progress on IBM JDK 6+&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-356&quot;&gt;&lt;del&gt;DBCP-356&lt;/del&gt;&lt;/a&gt; (another workaround is to use a HasMap instead of a WeakHashMap for the XAResources).&lt;/p&gt;</comment>
                            <comment id="13027967" author="joehni" created="Tue, 3 May 2011 00:44:21 +0000"  >&lt;p&gt;Thinking about it ... if I create a &lt;b&gt;temporary&lt;/b&gt; connection instance and use it as key in a WeakHashMap, it does not make too much sense either. OTOH, if I use an unwrapped connection as key that is also part of the WeakHashMap&apos;s value (the xaResource), the WeakHashMap is also useless. So, what do we try to solve with the WeakHashMap for the XAResources here?&lt;/p&gt;</comment>
                            <comment id="13832463" author="balazs.zsoldos" created="Tue, 26 Nov 2013 10:11:37 +0000"  >&lt;p&gt;Would be nice to fix this issue in a way that equals and hashcode does not use innermost.&lt;/p&gt;

&lt;p&gt;A short example why a programmer feels the current behavior is a bug::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Connection conn1 = dataSource.getConnection();
conn1.close();
Connection conn2 = dataSource.getConnection();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conn2.equals(conn1) &amp;amp;&amp;amp; conn1.isClosed() != conn2.isClosed()) {
    &lt;span class=&quot;code-comment&quot;&gt;// Oops they are equal but one of them is closed but the other is not
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13890611" author="markt" created="Tue, 4 Feb 2014 12:28:06 +0000"  >&lt;p&gt;I have a great deal of sympathy with the point that Balazs makes above. I intend to explore removing the custom equals and hashcode methods entirely. I know that this is going to break a bunch of tests. What I need to look at is whether the tests are just testing for the current behaviour or whether - like TransactionRegistry - the implementation actually depends on the current behaviour. Assuming it is the former, I&apos;ll change the tests. If it is the latter, I&apos;ll have to see what options I&apos;m left with.&lt;/p&gt;

&lt;p&gt;Regarding the TransactionRegistry, there is going to have to be a hack of some form somewhere. My preferred approach at the moment is to make getInnermostDelegateInternal() public but make it clear in the Javadoc that it is not part of the API. What I like about this is that it becomes very clear that the code that depends on the innermost delegate rather than having a dependency on an equals implementation several hops away. This should also provide a route to change any other code that depends on the current equals and hashcode behaviour.&lt;/p&gt;</comment>
                            <comment id="13890676" author="markt" created="Tue, 4 Feb 2014 13:45:08 +0000"  >&lt;p&gt;This can&apos;t be fixed prior to 2.0 because it requires API changes. It has been fixed in 2.0 onwards.&lt;/p&gt;

&lt;p&gt;The equals() implementations of the DelegatingXxx classes are now symmetric.&lt;br/&gt;
There are some important API changes underlying this fix:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;two DelegatingXxx instances are no longer considered equal if they have the same innermost delegate;&lt;/li&gt;
	&lt;li&gt;a DelegatingXxx instance is not considered equal to its innermost delegate;&lt;/li&gt;
	&lt;li&gt;the getInnermostDelegateInternal() method has been made public (but remains part of the internal API) to allow classes extending this implementation to access the innermost delegate when required.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12444651">DBCP-317</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12502264">DBCP-356</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114632</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90442</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-356] ManagedDataSource doesn&apos;t work with an active transaction in progress on IBM JDK 6+</title>
                <link>https://issues.apache.org/jira/browse/DBCP-356</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When using IBM JDK 6+ and trying to build commons-dbcp, these tests fail:&lt;/p&gt;

&lt;p&gt;org.apache.commons.dbcp.managed.TestBasicManagedDataSource&lt;br/&gt;
org.apache.commons.dbcp.managed.TestManagedDataSourceInTx&lt;/p&gt;

&lt;p&gt;with error:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Connection does not have a registered XAResource null, UserName=null, null&lt;br/&gt;
	at org.apache.commons.dbcp.managed.TransactionRegistry.getXAResource(TransactionRegistry.java:81)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.TransactionContext.setSharedConnection(TransactionContext.java:88)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.ManagedConnection.updateTransactionStatus(ManagedConnection.java:131)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.ManagedConnection.&amp;lt;init&amp;gt;(ManagedConnection.java:55)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.ManagedDataSource.getConnection(ManagedDataSource.java:76)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.TestManagedDataSource.getConnection(TestManagedDataSource.java:53)&lt;br/&gt;
	at org.apache.commons.dbcp.TestConnectionPool.newConnection(TestConnectionPool.java:81)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.TestManagedDataSourceInTx.testMaxActive(TestManagedDataSourceInTx.java:102)&lt;/p&gt;

&lt;p&gt;When used in conjunction with OpenEJB 3.1.4 examples, the error is the same.&lt;/p&gt;

&lt;p&gt;The problem disappears when switched to Oracle JDK 1.6.24 (so, all tests are passed and OpenEJB examples are working).&lt;/p&gt;

&lt;p&gt;I beleive this has something to do with differences in java.lang.ref.WeakReference implementations between IBM and Oracle JDKs, which was already discussed here:&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/dev@commons.apache.org/msg13107.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/dev@commons.apache.org/msg13107.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;IBM JDK 6&lt;br/&gt;
java version &quot;1.6.0&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build pwa6460sr9fp1-20110208_03(SR9 FP1))&lt;br/&gt;
IBM J9 VM (build 2.4, JRE 1.6.0 IBM J9 2.4 Windows 7 amd64-64 jvmwa6460sr9-20110203_74623 (JIT enabled, AOT enabled)&lt;br/&gt;
J9VM - 20110203_074623&lt;br/&gt;
JIT  - r9_20101028_17488ifx3&lt;br/&gt;
GC   - 20101027_AA)&lt;br/&gt;
JCL  - 20110203_01&lt;/p&gt;

&lt;p&gt;commons-dbcp of version 1.3 / 1.4&lt;/p&gt;</environment>
        <key id="12502264">DBCP-356</key>
            <summary>ManagedDataSource doesn&apos;t work with an active transaction in progress on IBM JDK 6+</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="anenvyguest">an envy guest</reporter>
                        <labels>
                            <label>ibm</label>
                            <label>xaresource</label>
                    </labels>
                <created>Thu, 24 Mar 2011 08:36:53 +0000</created>
                <updated>Sat, 31 May 2014 04:12:11 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 14:33:28 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13027352" author="psteitz" created="Sat, 30 Apr 2011 17:40:14 +0000"  >&lt;p&gt;IIUC what is going on here, fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-358&quot; title=&quot;Equals implementations in DelegatingXxx classes are not symmetric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-358&quot;&gt;&lt;del&gt;DBCP-358&lt;/del&gt;&lt;/a&gt; &lt;b&gt;may&lt;/b&gt; fix this.&lt;/p&gt;</comment>
                            <comment id="13032004" author="spandrav" created="Wed, 11 May 2011 19:57:15 +0000"  >&lt;p&gt;My application uses BasicManagedDatasource. Transaction management is handled using JOTM.&lt;br/&gt;
It is a standalone java application running inside a JVM.&lt;br/&gt;
The implementation works on Oracle JDK (1.6.24) but fails when it runs on AIX with an error.&lt;/p&gt;

&lt;p&gt;The call that fails is a simple &apos;getConnection&apos; on the BasicManagedDatsource.&lt;br/&gt;
The error logged is:&lt;br/&gt;
java.sql.SQLException: Unable to connect to database. Connection does not have a registered XAResource jdbc:oracle:thin:@xyz:1521:ABCD, UserName=XYZ, Oracle JDBC driver&lt;/p&gt;

&lt;p&gt;Is this the same error as in this issue?&lt;/p&gt;

&lt;p&gt;If it is, is there a workaround that I can use for the present?&lt;/p&gt;</comment>
                            <comment id="13032433" author="mglauche" created="Thu, 12 May 2011 14:43:29 +0000"  >&lt;p&gt;This is probably because of a bug in the IBM JDK, see &lt;a href=&quot;http://www-01.ibm.com/support/docview.wss?uid=swg1IZ96415&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www-01.ibm.com/support/docview.wss?uid=swg1IZ96415&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For a &quot;dirty&quot; workaround you can create a copy of TransactionRegistry in your local project (so it does overwrite the DBCP class) and change the WeakHashMap to HashMap. For short lived tests it should be ok, but don&apos;t run anything serious on this (it should eat up connections ...)&lt;/p&gt;
</comment>
                            <comment id="13032825" author="anenvyguest" created="Fri, 13 May 2011 04:40:22 +0000"  >&lt;p&gt;@Michael: I confirm your workaround is ok.&lt;br/&gt;
Basically, I faced this issue when running embedded OpenEJB container in unit tests, and I ended up with exactly what you are proposing: getting DBCP source, replacing WeakHashMap with HashMap and building my custom &apos;distribution&apos; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; For my purposes that sufficed since that were just unit tests and I didn&apos;t need solid rock stability in terms of connections leak.&lt;br/&gt;
However, that of course would be nice to have issue fixed.&lt;/p&gt;</comment>
                            <comment id="13252347" author="balazs.zsoldos" created="Thu, 12 Apr 2012 11:29:17 +0000"  >&lt;p&gt;I experienced this problem on JDK 1.6_30. I managed to solve it by applying the patch (not hacking equals or any other function just being sure that the same object is used during getting the XAResource from the weakhashmap)&lt;/p&gt;</comment>
                            <comment id="13283914" author="asaddi" created="Sat, 26 May 2012 06:15:57 +0000"  >&lt;p&gt;Running into this issue with Apple&apos;s JDK 1.6.0_31, OpenEJB, and the PostgreSQL 9.1 JDBC4 driver. (Though it works fine with the PostgreSQL 8.4 JDBC4 driver.) Balazs&apos; patch also fixes it in DBCP 1.4 &amp;#8211; the version that OpenEJB 4.0.0 uses. However, I had to tweak the patch a bit because the TestBasicManagedDataSource.testReallyClose unit test was failing.&lt;/p&gt;</comment>
                            <comment id="13889508" author="markt" created="Mon, 3 Feb 2014 14:33:28 +0000"  >&lt;p&gt;I&apos;ve just tested this with the latest IBM JVM and can&apos;t reproduce it. Given an earlier comment indicated that the root cause was a JVM bug, it looks like the JVM bug has been fixed.&lt;/p&gt;</comment>
                            <comment id="13889581" author="balazs.zsoldos" created="Mon, 3 Feb 2014 16:08:46 +0000"  >&lt;p&gt;@Mark Thomas: Did you read the comments? Did you check the contributed patch file? This issue can be reproduced on every JDK (Apple, IBM, Oracle). It was a long time ago I created the initial patch so I do not remember the cause exactly but I remember that this was not the issue of JDK but the code of commons-dbcp.&lt;/p&gt;</comment>
                            <comment id="13889894" author="markt" created="Mon, 3 Feb 2014 20:41:45 +0000"  >&lt;p&gt;Yes I read the comments. I think you may need to re-read them. The issue described is that of failing unit tests. The tests in question currently pass on all the JREs (including IBM which is explicitly called out as failing some unit tests) I have been able to get my hands on. If you have identified a different issue then please open a new bug and describe it. Better yet, provide a test case that fails, explain why the failure is a bug and propose a solution. &lt;/p&gt;</comment>
                            <comment id="13890027" author="balazs.zsoldos" created="Mon, 3 Feb 2014 22:37:30 +0000"  >&lt;p&gt;My mistake than. Based on the stacktrace I thuoght that I had the same issue.&lt;/p&gt;

&lt;p&gt;As I used PostgreSQL 9.1 driver (as Allan Saddi did later) I guess the exception is dropped due to that specific driver. When a version of commons-dbcp comes out that uses commons-pool 2.x I will re-check this behavior and if still exists and if it does, I will open a new issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12505732">DBCP-358</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12522402" name="TransactionRegistry.java.patch" size="1588" author="balazs.zsoldos" created="Thu, 12 Apr 2012 11:29:16 +0000"/>
                            <attachment id="12522401" name="TransactionRegistry.java.patch" size="1166" author="balazs.zsoldos" created="Thu, 12 Apr 2012 11:29:16 +0000"/>
                            <attachment id="12529847" name="commons-dbcp-TransactionRegistry.diff" size="1623" author="asaddi" created="Sat, 26 May 2012 06:15:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114630</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90444</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-355] DataSourceXAConnectionFactory does not store the XAConnection</title>
                <link>https://issues.apache.org/jira/browse/DBCP-355</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We have been diagnosing a leak with DBCP and XA mySQL and discovered that the mySQL driver expects close() to be invoked on the XAConnection obtained from xaDataSource.getXAConnection() instead of the java.sql.Connection returned by xaConnection.getConnection();&lt;/p&gt;

&lt;p&gt;The following code snippet in DataSourceXAConnectionFactory illustrates how the XAConnection is lost:&lt;/p&gt;

&lt;p&gt;    public Connection createConnection() throws SQLException {&lt;br/&gt;
        // create a new XAConection&lt;br/&gt;
        XAConnection xaConnection;&lt;br/&gt;
        if (username == null) &lt;/p&gt;
{
            xaConnection = xaDataSource.getXAConnection();
        }
&lt;p&gt; else &lt;/p&gt;
{
            xaConnection = xaDataSource.getXAConnection(username, password);
        }

&lt;p&gt;        // get the real connection and XAResource from the connection&lt;br/&gt;
        Connection connection = xaConnection.getConnection();&lt;br/&gt;
        XAResource xaResource = xaConnection.getXAResource();&lt;/p&gt;

&lt;p&gt;        // register the xa resource for the connection&lt;br/&gt;
        transactionRegistry.registerConnection(connection, xaResource);&lt;/p&gt;

&lt;p&gt;        return connection;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;In the code snippet above, the XAConnection is basically discarded after using it to obtain the java.sql.Connection and XAResource. It would be ideal if it actually associates the XAConnection in the transactionRegistry as well so that when PooledManagedConnection handles reallyClose(), it can also invoke close() on the XAConnection by interrogating the TransactionRegistry for the actual XAConnection to close.&lt;/p&gt;

&lt;p&gt;This may be something that&apos;s mySQL specific.&lt;/p&gt;</description>
                <environment>&lt;p&gt;MysqlXADataSource passed to BasicManagedDataSource&lt;/p&gt;</environment>
        <key id="12502250">DBCP-355</key>
            <summary>DataSourceXAConnectionFactory does not store the XAConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="panghy">Clement Pang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2011 03:03:28 +0000</created>
                <updated>Sat, 31 May 2014 04:12:28 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 13:52:42 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>4</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13634490" author="fguillaume" created="Wed, 17 Apr 2013 21:57:00 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I&apos;ve been hit by this problem as well. I&apos;m attaching a patch on top of 1.4, including a unit test for it.&lt;br/&gt;
(Nuxeo reference: &lt;a href=&quot;https://jira.nuxeo.com/browse/NXP-11433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;NXP-11433&lt;/a&gt;.)&lt;br/&gt;
Regards&lt;/p&gt;</comment>
                            <comment id="13889483" author="markt" created="Mon, 3 Feb 2014 13:52:42 +0000"  >&lt;p&gt;Thanks for the report and the fix. Sorry it has taken so long to address this.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed trunk for the 2.x series the 1.5.x branch. It will be included in the next release of each.&lt;/p&gt;

&lt;p&gt;I applied a slight variation of the proposed patch to take account of the naming conventions for tests and supporting classes within DBCP and to resolve some IDE warnings.&lt;/p&gt;

&lt;p&gt;If there are further 1.3.x and 1.4.x releases (currently being discussed on the dev mailing list) my expectation is that they will be generated from the 1.5.x branch so will pick up this fix too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12459640">DBCP-327</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12579211" name="DBCP-355.diff" size="14188" author="fguillaume" created="Wed, 17 Apr 2013 21:57:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114629</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-354] released dbcp 1.0 pom is broken</title>
                <link>https://issues.apache.org/jira/browse/DBCP-354</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The pom file for dbcp 1.0 contains the version &quot;1.0-dev&quot;, breaking dependency resolution for jars (like naming-config 0.8) that depend on it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500943">DBCP-354</key>
            <summary>released dbcp 1.0 pom is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jmhodges">Jeff Hodges</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2011 21:00:44 +0000</created>
                <updated>Sat, 31 May 2014 04:12:37 +0000</updated>
                            <resolved>Wed, 9 Mar 2011 23:51:06 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13004880" author="sebb@apache.org" created="Wed, 9 Mar 2011 23:49:00 +0000"  >&lt;p&gt;Raised &lt;a href=&quot;https://issues.sonatype.org/browse/MVNCENTRAL-57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.sonatype.org/browse/MVNCENTRAL-57&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AIUI, any issues with Maven Central metadata need to be raised there, as Commons developers cannot change already released artifacts.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114628</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170401</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-353] When DB Restarts(Bounce) the number ESTABLISHED DB connections exceeds its maximum configured limit.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-353</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We have set Max connections configuration to 100. There was heavy load on application. When we restarted DB in between, number of connections exceeds from 100 to 200,250...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12498194">DBCP-353</key>
            <summary>When DB Restarts(Bounce) the number ESTABLISHED DB connections exceeds its maximum configured limit.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="radhikazawar">Radhika Zawar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Feb 2011 05:58:24 +0000</created>
                <updated>Sat, 31 May 2014 04:12:49 +0000</updated>
                            <resolved>Wed, 11 Dec 2013 20:42:50 +0000</resolved>
                                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12993086" author="psteitz" created="Thu, 10 Feb 2011 15:15:21 +0000"  >&lt;p&gt;What versions of Commons DBCP and Pool are you using and how are your counting connections?  Is DBCP itself reporting the excessive number of connections?&lt;/p&gt;</comment>
                            <comment id="12993408" author="radhikazawar" created="Fri, 11 Feb 2011 09:24:10 +0000"  >&lt;p&gt;dbcp version - commons-dbcp-1.2.2&lt;br/&gt;
pool version - commons-pool-1.3&lt;/p&gt;

&lt;p&gt;We are counting connections using command&lt;/p&gt;

&lt;p&gt;netstat -an | grep &amp;lt;host&amp;gt;.1521 | grep ESTABLISHED | wc -l&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;Following are the actual steps that were performed&lt;br/&gt;
1. Run the load&lt;/p&gt;

&lt;p&gt; bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     100&lt;br/&gt;
2 . Shutdown DB&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
       3&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
       0&lt;br/&gt;
3. start DB&lt;/p&gt;

&lt;p&gt;bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
      77&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
      77&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
      83&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     112&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     133&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     154&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     191&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     128&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     128&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     129&lt;br/&gt;
bash-3.00# netstat -an | grep 1521 | grep  ESTABLISHED | wc -l&lt;br/&gt;
     128&lt;/p&gt;


</comment>
                            <comment id="12999241" author="radhikazawar" created="Fri, 25 Feb 2011 07:17:58 +0000"  >
&lt;p&gt;Any updates in this issue?&lt;/p&gt;</comment>
                            <comment id="13009555" author="radhikazawar" created="Tue, 22 Mar 2011 05:23:53 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Can you please let me know the solution to this issue.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13023598" author="psteitz" created="Sat, 23 Apr 2011 20:28:06 +0000"  >&lt;p&gt;Try upgrading to the latest release versions of Commons DBCP (1.3 for JDK 1.4-1.5, 1.4 for JDK 1.6) and Commons Pool 1.5.6.  If you can produce a test case that shows DBCP creating more than maxActive connections, please reopen.&lt;/p&gt;</comment>
                            <comment id="13024663" author="psteitz" created="Sun, 24 Apr 2011 18:40:32 +0000"  >&lt;p&gt;Sorry to keep flip-flopping on this; but it now occurs to me that this could be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-342&quot; title=&quot;Not cleaned up commons pool&amp;#39;s evictor task when SQLException occurs after the GenericObjectPool is initialized in createDataSource.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-342&quot;&gt;&lt;del&gt;DBCP-342&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Do you have minIdle and timeBetweenEvictionRunsMillis both set to positive values?&lt;/p&gt;</comment>
                            <comment id="13845710" author="markt" created="Wed, 11 Dec 2013 20:42:50 +0000"  >&lt;p&gt;Need more information from the OP to do anything with this. In the absence of further information, the assumption is that it is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-342&quot; title=&quot;Not cleaned up commons pool&amp;#39;s evictor task when SQLException occurs after the GenericObjectPool is initialized in createDataSource.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-342&quot;&gt;&lt;del&gt;DBCP-342&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12473220">DBCP-342</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114627</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 47 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90446</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-352] Repeated calls to getMetadata in a transaction leads to performance degredation</title>
                <link>https://issues.apache.org/jira/browse/DBCP-352</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;During long-running transactions that utilize conditional logic based on the database metadata, it is possible to get thousands of calls to Connection.getMetaData.  An ArrayList is built up containing objects which are never removed (this is the cause of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-330&quot; title=&quot;Calling getMetaData() without closing the connection lead to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-330&quot;&gt;&lt;del&gt;DBCP-330&lt;/del&gt;&lt;/a&gt;).  However, the array is shared with all other PreparedStatements, so the array scan and modification time keeps rising as the transaction progresses.&lt;/p&gt;

&lt;p&gt;I will attempt to attach an Eclipse project; profiling (or even a few JStacks) will show that most of the time is spent scanning the cluttered and growing array for objects to remove.&lt;/p&gt;</description>
                <environment>&lt;p&gt;PostgreSQL, MySQL, JDK 1.6&lt;/p&gt;</environment>
        <key id="12497342">DBCP-352</key>
            <summary>Repeated calls to getMetadata in a transaction leads to performance degredation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="derekhulley">Derek Hulley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Feb 2011 14:45:21 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:05 +0000</updated>
                            <resolved>Sat, 23 Apr 2011 23:57:05 +0000</resolved>
                                    <version>1.2.2</version>
                    <version>1.3.1</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12989225" author="derekhulley" created="Tue, 1 Feb 2011 14:51:41 +0000"  >&lt;p&gt;Requires table:&lt;br/&gt;
   CREATE TABLE dbcp_test( val integer NOT NULL );&lt;/p&gt;

&lt;p&gt;Example arguments:&lt;br/&gt;
jdbc:postgresql://localhost:5432/dbcptest&lt;br/&gt;
test&lt;br/&gt;
test&lt;br/&gt;
10000&lt;/p&gt;

&lt;p&gt;Crank up the getMetaData calls and profile.  Once you&apos;ve hit 100K getMetaData calls, things start looking really bad; CPU usage suffers.&lt;/p&gt;</comment>
                            <comment id="12989226" author="ggregory@seagullsw.com" created="Tue, 1 Feb 2011 14:52:31 +0000"  >&lt;p&gt;If you can make your example use an H2 (or any) in-memory database, it will be easier to reproduce and test for anyone. I suppose Derby would do the trick as well but I know from experience that H2 works great for standalone unit tests.&lt;/p&gt;</comment>
                            <comment id="12989236" author="psteitz" created="Tue, 1 Feb 2011 15:16:21 +0000"  >&lt;p&gt;The fix that I suggested for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-330&quot; title=&quot;Calling getMetaData() without closing the connection lead to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-330&quot;&gt;&lt;del&gt;DBCP-330&lt;/del&gt;&lt;/a&gt; should resolve this as well.  I would appreciate review and comments on the fix proposed there.&lt;/p&gt;</comment>
                            <comment id="12989596" author="derekhulley" created="Wed, 2 Feb 2011 10:59:57 +0000"  >&lt;p&gt;The table is deliberately simple, so use your database of choice.  I&apos;m not convinced that using an in-memory DB is the solution given that the test is designed to scale up to hundreds of thousands of insertions; it&apos;s probably better just to piggy back off a real DB.&lt;/p&gt;</comment>
                            <comment id="12989597" author="derekhulley" created="Wed, 2 Feb 2011 11:00:38 +0000"  >&lt;p&gt;Phil&apos;s suggested fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-330&quot; title=&quot;Calling getMetaData() without closing the connection lead to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-330&quot;&gt;&lt;del&gt;DBCP-330&lt;/del&gt;&lt;/a&gt; will also address this problem.&lt;/p&gt;</comment>
                            <comment id="12993012" author="derekhulley" created="Thu, 10 Feb 2011 11:26:01 +0000"  >&lt;p&gt;Patch diff&lt;/p&gt;</comment>
                            <comment id="12993013" author="derekhulley" created="Thu, 10 Feb 2011 11:29:14 +0000"  >&lt;p&gt;Results of running DBCPMetadataTest before and after applying trivial patch:&lt;/p&gt;

&lt;p&gt;Before:&lt;/p&gt;

&lt;p&gt;Found table dbcp_test&lt;br/&gt;
Inserted 5000 rows with average of 0ms per row.  Issued 0 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 0ms per row.  Issued 0 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 2ms per row.  Issued 5 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 1ms per row.  Issued 5 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 5ms per row.  Issued 10 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 2ms per row.  Issued 10 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 8ms per row.  Issued 15 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 4ms per row.  Issued 15 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 11ms per row.  Issued 20 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 5ms per row.  Issued 20 metadata queries per insert.&lt;/p&gt;

&lt;p&gt;After:&lt;/p&gt;

&lt;p&gt;Found table dbcp_test&lt;br/&gt;
Inserted 5000 rows with average of 0ms per row.  Issued 0 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 0ms per row.  Issued 0 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 0ms per row.  Issued 5 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 0ms per row.  Issued 5 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 0ms per row.  Issued 10 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 0ms per row.  Issued 10 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 0ms per row.  Issued 15 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 0ms per row.  Issued 15 metadata queries per insert.&lt;br/&gt;
Inserted 5000 rows with average of 0ms per row.  Issued 20 metadata queries per insert.&lt;br/&gt;
Inserted 10000 rows with average of 0ms per row.  Issued 20 metadata queries per insert.&lt;/p&gt;

&lt;p&gt;As is evident, the overhead of getMetadata() calls has disappeared.  The &quot;memory leak&quot; will have gone, too.&lt;br/&gt;
Similar results are obtained for other unit tests with long-running transactions.&lt;/p&gt;</comment>
                            <comment id="13023619" author="psteitz" created="Sat, 23 Apr 2011 23:57:05 +0000"  >&lt;p&gt;Fixed in trunk (r1096260) and 1_4 branch (r1096259).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12462025">DBCP-330</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12469928" name="DBCPMetadataTest.zip" size="400289" author="derekhulley" created="Tue, 1 Feb 2011 14:51:41 +0000"/>
                            <attachment id="12470770" name="commons-dbcp-1.4-patched.diff" size="664" author="derekhulley" created="Thu, 10 Feb 2011 11:26:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114626</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170392</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-351] setAutoCommit called too many times</title>
                <link>https://issues.apache.org/jira/browse/DBCP-351</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;passivateObject in PoolableConnectionFactory sets autoCommit to true, even if defaultAutoCommit is set to false. This results in two extra db queries for every use of the connection (set false, do work, set true). This creates a significant amount of overhead, even if the connection is never even used.&lt;/p&gt;

&lt;p&gt;I propose it be changed to:&lt;/p&gt;

&lt;p&gt;if(conn.getAutoCommit() != _defaultAutoCommit)&lt;br/&gt;
{&lt;br/&gt;
  conn.setAutoCommit(_defaultAutoCommit);&lt;br/&gt;
}&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12497329">DBCP-351</key>
            <summary>setAutoCommit called too many times</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="orangedog">OD</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Feb 2011 12:47:48 +0000</created>
                <updated>Sat, 31 May 2014 04:11:47 +0000</updated>
                            <resolved>Fri, 14 Feb 2014 11:47:39 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12989249" author="psteitz" created="Tue, 1 Feb 2011 15:34:25 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-97&quot; title=&quot;setAutoCommit(true) when returning connection to the pool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-97&quot;&gt;&lt;del&gt;DBCP-97&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-102&quot; title=&quot;[dbcp] setReadOnly &amp;amp; setAutoCommit called too many times&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-102&quot;&gt;&lt;del&gt;DBCP-102&lt;/del&gt;&lt;/a&gt;, especially the comment by Dain in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-97&quot; title=&quot;setAutoCommit(true) when returning connection to the pool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-97&quot;&gt;&lt;del&gt;DBCP-97&lt;/del&gt;&lt;/a&gt;.  We can discuss changing the implementation, but I tend to agree with Dain that it is better for passivate to prevent idle connections from holding open database transactions.  Given the back-and-forth on this, it might be best to make the behavior configurable.  Anyone have any better ideas?&lt;/p&gt;</comment>
                            <comment id="13023601" author="psteitz" created="Sat, 23 Apr 2011 20:48:33 +0000"  >&lt;p&gt;Changing fix version to 2.0.  I am still not sure how, if at all, we should address this; but I don&apos;t think this can be addressed in a patch release.&lt;/p&gt;</comment>
                            <comment id="13068061" author="jameshowe" created="Tue, 19 Jul 2011 23:21:21 +0000"  >&lt;p&gt;Re. Dain&apos;s comment, there&apos;s only a transaction open if one has sent BEGIN without then sending COMMIT/ROLLBACK, which should always have been done on return to pool.&lt;/p&gt;

&lt;p&gt;Would overall performance not be better if new connections are added to the pool to replace disconnected ones, rather than adding all this extra traffic on every request so that the existing connections can use autoReconnect?&lt;/p&gt;</comment>
                            <comment id="13901361" author="markt" created="Fri, 14 Feb 2014 11:47:39 +0000"  >&lt;p&gt;New option enableAutoCommitOnReturn added.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-350] Problem with DBCP 1.3 /jdk 6 and oracle spatial</title>
                <link>https://issues.apache.org/jira/browse/DBCP-350</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We have a GIS-application running on Tomcat 5.5. As webserver we are using&lt;br/&gt;
Apache httpd 2.2 connected to tomcat via ajp (mod_proxy_ajp).&lt;/p&gt;

&lt;p&gt;The application worked fine with Tomcat 5.5.28 until we tried to upgrade to Tomcat 5.5.31.&lt;/p&gt;

&lt;p&gt;After the upgrade we get - in certain situations a:&lt;br/&gt;
java.io.IOException: org.hibernatespatial.helper.FinderException: Couldn&apos;t get&lt;br/&gt;
at the OracleSpatial Connection object from the PreparedStatement.&lt;/p&gt;

&lt;p&gt;After looking through the Tomcat 5.5 changelogs we stumbled across a change&lt;br/&gt;
made in 5.5.30: Upgrade to DBCP 1.3.&lt;/p&gt;

&lt;p&gt;I can affirm now that the problem is gone when downgrading to DBCP 1.2.2.&lt;br/&gt;
The same problem occurs when using DBCP 1.4.&lt;/p&gt;

&lt;p&gt;It seems something has changed from 1.2.2 to 1.3 that has partially broken Oracle-Locator operations in dbcp 1.3&lt;br/&gt;
I&apos;ve seen some bug-reports for dbcp 1.3.1 which point in the same direction (oracle-db-error lead to java error) - perhaps these are the same problems...&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.5 x86_64, Oracle JDK 1.6u22 32bit, Tomcat 5.5.31, ojdbc6.jar&lt;/p&gt;</environment>
        <key id="12492162">DBCP-350</key>
            <summary>Problem with DBCP 1.3 /jdk 6 and oracle spatial</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="samron">Nils Hildebrand</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Dec 2010 14:47:11 +0000</created>
                <updated>Sat, 31 May 2014 04:11:57 +0000</updated>
                            <resolved>Thu, 11 Aug 2011 09:58:34 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12967212" author="sebb@apache.org" created="Mon, 6 Dec 2010 15:09:52 +0000"  >&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/bugzilla/show_bug.cgi?id=50326&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/bugzilla/show_bug.cgi?id=50326&lt;/a&gt; where this was originally reported.&lt;/p&gt;

&lt;p&gt;Can you provide a sample of the code that is failing?&lt;br/&gt;
That would make it easier to track down.&lt;/p&gt;

&lt;p&gt;Or at least a stack trace.&lt;/p&gt;</comment>
                            <comment id="12967225" author="samron" created="Mon, 6 Dec 2010 15:41:13 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;find below an example of the full error message - imho it does not say&lt;br/&gt;
much, since the first exception mentioned seems to be the problem.&lt;/p&gt;

&lt;p&gt;I did a network trace of the DB-connection and found some ORA-not-found&lt;br/&gt;
messages.&lt;br/&gt;
How can I trace this further down?&lt;/p&gt;

&lt;p&gt;Since I am not a java-developer I can&apos;t give you a short code snippet&lt;br/&gt;
that will trigger the same error.&lt;/p&gt;


&lt;p&gt;FATAL 2010-11-24 11:08:29,245 - TP-Processor8&lt;br/&gt;
de.ivu.web.common.web.FrontController: FrontController.doGet():&lt;br/&gt;
Exception im FrontController.doGet!!!&lt;br/&gt;
org.hibernate.HibernateException:&lt;br/&gt;
org.hibernatespatial.helper.FinderException: Couldn&apos;t get at the&lt;br/&gt;
OracleSpatial Connection object from the PreparedStatement.&lt;br/&gt;
        at&lt;br/&gt;
org.hibernatespatial.oracle.SDOGeometryType.nullSafeSet(SDOGeometryType.&lt;br/&gt;
java:109)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernatespatial.GeometryUserType.nullSafeSet(GeometryUserType.java:&lt;br/&gt;
184)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernate.type.CustomType.nullSafeSet(CustomType.java:156)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernate.loader.Loader.bindPositionalParameters(Loader.java:1707)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernate.loader.Loader.bindParameterValues(Loader.java:1678)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernate.loader.Loader.prepareQueryStatement(Loader.java:1563)&lt;br/&gt;
        at org.hibernate.loader.Loader.doQuery(Loader.java:673)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loade&lt;br/&gt;
r.java:236)&lt;br/&gt;
        at org.hibernate.loader.Loader.doList(Loader.java:2220)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernate.loader.Loader.listIgnoreQueryCache(Loader.java:2104)&lt;br/&gt;
        at org.hibernate.loader.Loader.list(Loader.java:2099)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernate.loader.criteria.CriteriaLoader.list(CriteriaLoader.java:94&lt;br/&gt;
)&lt;br/&gt;
        at org.hibernate.impl.SessionImpl.list(SessionImpl.java:1569)&lt;br/&gt;
        at org.hibernate.impl.CriteriaImpl.list(CriteriaImpl.java:283)&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.bamf.webgis.db.bohelper.SportvereinHelper.createBOs(SportvereinHe&lt;br/&gt;
lper.java:61)&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.bamf.webgis.db.bohelper.SportvereinHelper.createBOs(SportvereinHe&lt;br/&gt;
lper.java:83)&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.bamf.webgis.db.DefaultDBController.getFeatures(DefaultDBControlle&lt;br/&gt;
r.java:198)&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.bamf.webgis.worker.search.CalculateExtendedSearchResultWorker.dot&lt;br/&gt;
heWork(CalculateExtendedSearchResultWorker.java:576)&lt;br/&gt;
        at de.ivu.web.common.web.WebCommand.execute(WebCommand.java:93)&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.web.common.web.Dispatcher.dispatch(Dispatcher.java:106)&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.web.common.web.FrontController.doGet(FrontController.java:94)&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.web.common.web.FrontController.doPost(FrontController.java:177)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:647)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Applica&lt;br/&gt;
tionFilterChain.java:269)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilt&lt;br/&gt;
erChain.java:188)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValv&lt;br/&gt;
e.java:213)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValv&lt;br/&gt;
e.java:172)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java&lt;br/&gt;
:127)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java&lt;br/&gt;
:117)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.&lt;br/&gt;
java:108)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:1&lt;br/&gt;
74)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:200)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:775)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:&lt;br/&gt;
704)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.&lt;br/&gt;
java:897)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool&lt;br/&gt;
.java:689)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: org.hibernatespatial.helper.FinderException: Couldn&apos;t get at&lt;br/&gt;
the OracleSpatial Connection object from the PreparedStatement.&lt;br/&gt;
        at&lt;br/&gt;
org.hibernatespatial.oracle.DefaultConnectionFinder.find(DefaultConnecti&lt;br/&gt;
onFinder.java:73)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernatespatial.oracle.DefaultConnectionFinder.find(DefaultConnecti&lt;br/&gt;
onFinder.java:51)&lt;br/&gt;
        at&lt;br/&gt;
org.hibernatespatial.oracle.SDOGeometryType.nullSafeSet(SDOGeometryType.&lt;br/&gt;
java:105)&lt;br/&gt;
        ... 38 more&lt;/p&gt;

&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Nils&lt;/p&gt;


</comment>
                            <comment id="12967239" author="sebb@apache.org" created="Mon, 6 Dec 2010 16:09:49 +0000"  >&lt;p&gt;The stack trace is not an IOException, so does not appear to be the same as the original report.&lt;/p&gt;

&lt;p&gt;Also, DBCP does not appear in the stack trace, so this is probably a different error.&lt;/p&gt;

&lt;p&gt;Can you provide an example of the IOException please?&lt;/p&gt;</comment>
                            <comment id="12968689" author="psteitz" created="Tue, 7 Dec 2010 11:38:04 +0000"  >&lt;p&gt;Can you please post your DBCP config?&lt;/p&gt;</comment>
                            <comment id="12968691" author="samron" created="Tue, 7 Dec 2010 11:46:11 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;ok - that was the trace of another error, that, too - was gone when&lt;br/&gt;
downgrading to 1.2.2 - I thought it was the same thing.&lt;/p&gt;

&lt;p&gt;But again - dbcp is not visible in that stacktrace. At the moment I am&lt;br/&gt;
following a different path:&lt;br/&gt;
This could be a oracle-rights-problem. We tried to reproduce the error&lt;br/&gt;
with dbcp 1.3 (tomcat 5.5.31) while using our developement environment&lt;br/&gt;
(Eclipse) - there the error was absent. After further invstigation we&lt;br/&gt;
found that the db-access was done with the scheme-owner - so the rights&lt;br/&gt;
of the access-user were unlimited in the development environment.&lt;/p&gt;

&lt;p&gt;I am now comparing sql-traces between dbcp 1.4 with limited access-user&lt;br/&gt;
(where the problem exists) and dbcp 1.2.2 with the same limited&lt;br/&gt;
access-user (where the problem does not exist).&lt;/p&gt;

&lt;p&gt;Was there a change regarding access-error handling where dbcp 1.2.2&lt;br/&gt;
ignored the error and 1.4/1.3?&lt;br/&gt;
But why does dbcp not turn up in the stacktrace?&lt;/p&gt;

&lt;p&gt;Here it comes:&lt;/p&gt;

&lt;p&gt;ERROR 2010-12-07 12:31:12,640 - TP-Processor2&lt;br/&gt;
org.apache.catalina.core.ContainerBase.&lt;span class=&quot;error&quot;&gt;&amp;#91;Catalina&amp;#93;&lt;/span&gt;.&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt;.&lt;span class=&quot;error&quot;&gt;&amp;#91;/BAMF&amp;#93;&lt;/span&gt;.[f&lt;br/&gt;
rontControl]: ApplicationDispatcher.invoke(): Servlet.service() for&lt;br/&gt;
servlet frontControl threw exception&lt;br/&gt;
java.io.IOException: org.hibernatespatial.helper.FinderException:&lt;br/&gt;
Couldn&apos;t get at the OracleSpatial Connection object from the&lt;br/&gt;
PreparedStatement.&lt;br/&gt;
        at&lt;br/&gt;
de.ivu.web.common.web.FrontController.doGet(FrontController.java:101)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:627)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Applica&lt;br/&gt;
tionFilterChain.java:269)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilt&lt;br/&gt;
erChain.java:188)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatc&lt;br/&gt;
her.java:659)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationDispatcher.processRequest(Applicatio&lt;br/&gt;
nDispatcher.java:459)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDisp&lt;br/&gt;
atcher.java:395)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispat&lt;br/&gt;
cher.java:311)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardHostValve.custom(StandardHostValve.java&lt;br/&gt;
:364)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardHostValve.status(StandardHostValve.java&lt;br/&gt;
:285)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardHostValve.throwable(StandardHostValve.j&lt;br/&gt;
ava:229)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java&lt;br/&gt;
:135)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java&lt;br/&gt;
:117)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.&lt;br/&gt;
java:108)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:1&lt;br/&gt;
74)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:200)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:775)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:&lt;br/&gt;
704)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.&lt;br/&gt;
java:897)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool&lt;br/&gt;
.java:689)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

</comment>
                            <comment id="12968692" author="samron" created="Tue, 7 Dec 2010 11:52:09 +0000"  >&lt;p&gt;Hi Phil,&lt;/p&gt;

&lt;p&gt;sure. This is from the tomcat-server.xml. I replaced username, password,&lt;br/&gt;
url-db, port and sid with dummy-values.&lt;br/&gt;
DB-Connect is done via two resources using the dbcp-factory:&lt;/p&gt;


&lt;p&gt;        &amp;lt;Resource name=&quot;WEBGISREAD&quot;&lt;br/&gt;
                auth=&quot;Container&quot;&lt;br/&gt;
                type=&quot;javax.sql.DataSource&quot;&lt;br/&gt;
                factory=&quot;org.apache.commons.dbcp.BasicDataSourceFactory&quot;&lt;br/&gt;
                username=&quot;DB_READER_ROLE&quot; password=&quot;SECRET&quot;&lt;br/&gt;
                driverClassName=&quot;oracle.jdbc.OracleDriver&quot;&lt;br/&gt;
                url=&quot;jdbc:oracle:thin:@db4711:4711:db4711&quot;&lt;br/&gt;
                maxWait=&quot;-1&quot;&lt;br/&gt;
                removeAbandoned=&quot;true&quot;&lt;br/&gt;
                maxActive=&quot;30&quot;&lt;br/&gt;
                maxIdle=&quot;10&quot;&lt;br/&gt;
                removeAbandonedTimeout=&quot;60&quot;&lt;br/&gt;
                logAbandoned=&quot;true&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;Resource name=&quot;WEBGISWRITE&quot;&lt;br/&gt;
                auth=&quot;Container&quot;&lt;br/&gt;
                type=&quot;javax.sql.DataSource&quot;&lt;br/&gt;
                factory=&quot;org.apache.commons.dbcp.BasicDataSourceFactory&quot;&lt;br/&gt;
                username=&quot;DB_WRITER_ROLE&quot; password=&quot;TOPSECRET&quot;&lt;br/&gt;
                driverClassName=&quot;oracle.jdbc.OracleDriver&quot;&lt;br/&gt;
                url=&quot;jdbc:oracle:thin:@db4711:4711:db4711&quot;&lt;br/&gt;
                maxWait=&quot;-1&quot;&lt;br/&gt;
                removeAbandoned=&quot;true&quot;&lt;br/&gt;
                maxActive=&quot;30&quot;&lt;br/&gt;
                maxIdle=&quot;10&quot;&lt;br/&gt;
                removeAbandonedTimeout=&quot;60&quot;&lt;br/&gt;
                logAbandoned=&quot;true&quot;&lt;br/&gt;
                defaultAutoCommit=&quot;false&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Nils&lt;/p&gt;


</comment>
                            <comment id="12969261" author="markt" created="Wed, 8 Dec 2010 09:49:21 +0000"  >&lt;p&gt;I believe there is a configuration problem.&lt;/p&gt;

&lt;p&gt;The conection pools are using the deprecated &quot;oracle.jdbc.OracleDriver&quot; that return connections of type oracle.jdbc.OracleConnection. However, the HibernateSpatial (trunk at least) is looking for the newer oracle.jdbc.driver.OracleConnection which are returned when using the newer oracle.jdbc.driver.OracleDriver. I suspect switching your connection pools to use oracle.jdbc.driver.OracleDriver will fix this issue.&lt;/p&gt;</comment>
                            <comment id="12969681" author="samron" created="Thu, 9 Dec 2010 10:20:03 +0000"  >&lt;p&gt;Hi Mark,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://tomcat.apache.org/tomcat-5.5-doc/jndi-datasource-examples-howto.h&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tomcat.apache.org/tomcat-5.5-doc/jndi-datasource-examples-howto.h&lt;/a&gt;&lt;br/&gt;
tml#Oracle_8i,&lt;em&gt;9i&lt;/em&gt;&amp;amp;_10g&lt;/p&gt;

&lt;p&gt;This states it the other way round - that&apos;s why I changed it from&lt;br/&gt;
oracle.jdbc.driver.OracleDriver to oracle.jdbc.OracleDriver - but&lt;br/&gt;
nevertheless I got the same error picture before that change.&lt;/p&gt;

&lt;p&gt;No - this seems to be a DB-access-right related problem The big question&lt;br/&gt;
is now why the problem did not exist prior to dbcp 1.3.&lt;/p&gt;


&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Nils &lt;/p&gt;


</comment>
                            <comment id="12969695" author="markt" created="Thu, 9 Dec 2010 11:11:26 +0000"  >&lt;p&gt;Sorry for the mix up, you&apos;re right about the deprecation. HibernateSpatial is still looking for the older class. I assume that that class is the actual implementation which is why it works although trying to find the Javadocs to confirm this is like pulling teeth (which is partly what caused my previous mix-up).&lt;/p&gt;

&lt;p&gt;Regarding the access rights issue, I&apos;ve looked through &lt;a href=&quot;http://commons.apache.org/dbcp/changes-report.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/dbcp/changes-report.html&lt;/a&gt; and nothing jumps out at me as a possible trigger. Is there anything in the oracle logs that shed any light?&lt;/p&gt;</comment>
                            <comment id="12969702" author="samron" created="Thu, 9 Dec 2010 11:43:03 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;yes - I think I got a hit in the oracle-logs. I am doing the same thing&lt;br/&gt;
via GUI with DBCP 1.4 and DBCP 1.2.2.&lt;br/&gt;
In the middle of the traces some SQL-statements are missing.&lt;/p&gt;

&lt;p&gt;Using DBCP 1.2.2 I get:&lt;/p&gt;

&lt;p&gt;&amp;#8211; snip &amp;#8211;&lt;br/&gt;
  declare &lt;br/&gt;
     cost sys.ODCICost := sys.ODCICost(NULL, NULL, NULL, NULL); &lt;br/&gt;
     obj0 &quot;MDSYS&quot;.&quot;SDO_GEOMETRY&quot; := &quot;MDSYS&quot;.&quot;SDO_GEOMETRY&quot;(NULL, NULL,&lt;br/&gt;
NULL, NULL, NULL);&lt;br/&gt;
  obj1 &quot;MDSYS&quot;.&quot;SDO_GEOMETRY&quot; := &quot;MDSYS&quot;.&quot;SDO_GEOMETRY&quot;(NULL, NULL,&lt;br/&gt;
NULL, NULL, NULL);&lt;/p&gt;

&lt;p&gt;    begin &lt;br/&gt;
      :1 := &quot;MDSYS&quot;.&quot;SDO_STATISTICS&quot;.ODCIStatsFunctionCost(&lt;br/&gt;
                     sys.ODCIFuncInfo(&apos;MDSYS&apos;, &lt;br/&gt;
                            &apos;SDO_3GL&apos;, &lt;br/&gt;
                            &apos;FILTER&apos;, &lt;br/&gt;
                            2), &lt;br/&gt;
                     cost, &lt;br/&gt;
                     sys.ODCIARGDESCLIST(sys.ODCIARGDESC(2,&lt;br/&gt;
&apos;LIKT_BKE_KURSE_O_GEOM&apos;, &apos;WEBGISDB&apos;, &apos;&quot;GEOLOC&quot;&apos;, NULL, NULL, NULL),&lt;br/&gt;
sys.ODCIARGDESC(1, NULL, NULL, NULL, NULL, NULL, NULL),&lt;br/&gt;
sys.ODCIARGDESC(3, NULL, NULL, NULL, NULL, NULL, NULL)) &lt;br/&gt;
                     , obj0, obj1, :5, &lt;br/&gt;
                     sys.ODCIENV(:6,:7,:8,:9)); &lt;br/&gt;
      if cost.CPUCost IS NULL then &lt;br/&gt;
        :2 := -1.0; &lt;br/&gt;
      else &lt;br/&gt;
        :2 := cost.CPUCost; &lt;br/&gt;
      end if; &lt;br/&gt;
      if cost.IOCost IS NULL then &lt;br/&gt;
        :3 := -1.0; &lt;br/&gt;
      else &lt;br/&gt;
        :3 := cost.IOCost; &lt;br/&gt;
      end if; &lt;br/&gt;
      if cost.NetworkCost IS NULL then &lt;br/&gt;
        :4 := -1.0; &lt;br/&gt;
      else &lt;br/&gt;
        :4 := cost.NetworkCost; &lt;br/&gt;
      end if; &lt;br/&gt;
      exception &lt;br/&gt;
        when others then &lt;br/&gt;
          raise; &lt;br/&gt;
    end;&lt;br/&gt;
&amp;#8211; snap &amp;#8211;&lt;/p&gt;

&lt;p&gt;That is the first statement that is missing completely from the DBCP&lt;br/&gt;
1.4-trace!&lt;br/&gt;
Next come two more &quot;declare&quot;-SQL-statements (also - both missing in&lt;br/&gt;
1.4), then the trace joins again at a select-statement.&lt;/p&gt;

&lt;p&gt;I will now make a cross-check using DBCP 1.4 and full DB-access-rights&lt;br/&gt;
outside Eclipse in my normal Linux-server environment.&lt;/p&gt;


&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Nils&lt;/p&gt;


</comment>
                            <comment id="12977700" author="samron" created="Wed, 5 Jan 2011 09:39:47 +0000"  >&lt;p&gt;Hi Phil,&lt;/p&gt;

&lt;p&gt;from my side no good news for this one - even with the&lt;br/&gt;
oracle-access-users changed to the sceme-owner the error remains.&lt;/p&gt;

&lt;p&gt;It does not occur in Eclipse/Windows Tomcat 5.5.31 though.&lt;br/&gt;
Is there a difference between win dbcp and linux dbcp which could&lt;br/&gt;
explain that?&lt;/p&gt;

&lt;p&gt;Is there any possibility to track sql-operations further down with some&lt;br/&gt;
dbcp-logging-options? &lt;/p&gt;


&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Nils&lt;/p&gt;


&lt;p&gt;ian.jira.plugin.system.issuetabpanels:all-tabpanel ]&lt;/p&gt;
</comment>
                            <comment id="12978286" author="psteitz" created="Thu, 6 Jan 2011 11:51:51 +0000"  >&lt;p&gt;DBCP is 100% Java - there should be no difference on Linux vs Windows; though of course the drivers that DBCP instantiates could be behaving differently.&lt;/p&gt;

&lt;p&gt;There is currently no logging in DBCP.  &lt;/p&gt;

&lt;p&gt;What exactly is your code doing during the traces above?&lt;/p&gt;</comment>
                            <comment id="12989612" author="samron" created="Wed, 2 Feb 2011 12:17:29 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;good question.&lt;/p&gt;

&lt;p&gt;Since I can&apos;t trace within Windows/Eclipse (no error there!) - how do I&lt;br/&gt;
trace in the &quot;live&quot; linux tomcat environment? &lt;/p&gt;

&lt;p&gt;Basically I posted the SQL-Statements that are being done before the&lt;br/&gt;
error occurs.&lt;br/&gt;
That trace was done on the db-server.&lt;/p&gt;

&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Nils&lt;/p&gt;

</comment>
                            <comment id="12990899" author="psteitz" created="Sat, 5 Feb 2011 03:24:24 +0000"  >&lt;p&gt;Can you relate the GUI actions that you are taking in the linux tomcat environment to statements executed by the code?&lt;/p&gt;</comment>
                            <comment id="13083005" author="samron" created="Thu, 11 Aug 2011 08:12:28 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;



&lt;p&gt;I asked the question on a GIS-Forum at Stack-Exchange.&lt;/p&gt;

&lt;p&gt;I&#8217;ve got an answer that sounds very like the root-cause of the problem &#8211; located within hibernatespatial.&lt;/p&gt;

&lt;p&gt;See below&#8230;&lt;/p&gt;



&lt;p&gt;Does it ring a bell with you?&lt;/p&gt;



&lt;p&gt;Kind regards&lt;/p&gt;



&lt;p&gt;Nils&lt;/p&gt;





&lt;p&gt;Von: Stack Exchange &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:do-not-reply@stackexchange.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;do-not-reply@stackexchange.com&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;br/&gt;
Gesendet: Donnerstag, 11. August 2011 06:00&lt;/p&gt;




&lt;p&gt;Any known problems after Tomcat-upgrade using oracle locator? &amp;lt;&lt;a href=&quot;http://gis.stackexchange.com/questions/13105/any-known-problems-after-tomcat-upgrade-using-oracle-locator&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://gis.stackexchange.com/questions/13105/any-known-problems-after-tomcat-upgrade-using-oracle-locator&lt;/a&gt;&amp;gt; &lt;/p&gt;
</comment>
                            <comment id="13083046" author="markt" created="Thu, 11 Aug 2011 09:58:34 +0000"  >&lt;p&gt;The analysis shows that this is caused by hibernate needing to access the raw Oracle connection but DBCP is returning wrapped objects. That makes this a hibernate issue unless DBCP does not provide a mechanism for hibernate to access the raw connection (which I believe it does).&lt;/p&gt;

&lt;p&gt;I don&apos;t see anything for DBCP to fix here.&lt;/p&gt;</comment>
                            <comment id="13083055" author="samron" created="Thu, 11 Aug 2011 10:27:27 +0000"  >&lt;p&gt;Hi Mark,&lt;/p&gt;

&lt;p&gt;so dbcp does not use hibernate?&lt;br/&gt;
I am confused.&lt;/p&gt;

&lt;p&gt;I am not a developer - I just want to see this bug fixed in Tomcat so I can use a standard-tomcat again.&lt;br/&gt;
I played the game to escalate this to dbcp.&lt;/p&gt;

&lt;p&gt;But I will not play the game to escalate this further to hibernate - there seems to be a ready to use bug-fix there (at hibernate).&lt;br/&gt;
So implement it into dbcp 1.3.n or 1.4.n and I am willing to test it again.&lt;/p&gt;

&lt;p&gt;If that fixes the problem I will report back to Tomcat so they can upgrade to dbcp 1.3.n or dbcp 1.4.n as well.&lt;/p&gt;

&lt;p&gt;Is this open source or is this &quot;I am the big bug closer, but am not interested in fixing problems&quot;?&lt;/p&gt;

&lt;p&gt;I&apos;ve got my working workaround in place (commons.dbcp 1.2.2) - but I don&apos;t think this is helpful neither for tomcat nor dbcp nor the community.&lt;/p&gt;



&lt;p&gt;Regards&lt;/p&gt;

&lt;p&gt;Nils&lt;/p&gt;


</comment>
                            <comment id="13083058" author="markt" created="Thu, 11 Aug 2011 10:46:18 +0000"  >&lt;p&gt;No, DBCP does not use hibernate. Your application is using hibernate and hibernate is using DBCP, a version of which is packaged inside Apache Tomcat.&lt;/p&gt;

&lt;p&gt;There is no bug in Tomcat or DBCP to fix. The bug - if there is one - in hibernate or possibly your application.&lt;/p&gt;

&lt;p&gt;The hibernate folks are taking the understandable view that this is not a bug in hibernate. In this case hibernate needs access to the raw connection and it isn&apos;t really practical for hibernate to handle all possible scenarios for what it might need to do to access the raw connection. Hibernate provides a default mechanism to obtain the raw connection and provides an extension point for users to provide their own mechanism where the default mechanism doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;The application that is using hibernate needs to provide an appropriate implementation of hibernate&apos;s ConnectionFinder.&lt;/p&gt;

&lt;p&gt;Yes this is open source but just because you are using DBCP as embedded in Tomcat that does not make all database problems you come across DBCP or Tomcat bugs. While the problem you are seeing was triggered by a change to DBCP that still does not make this a DBCP bug. Hibernate was relying on the raw connection being available which is not a valid assumption in an environment using connection pooling.&lt;/p&gt;

&lt;p&gt;The community has provided you with all the information you need to fix the problem you are experiencing with your application.&lt;/p&gt;</comment>
                            <comment id="13083071" author="samron" created="Thu, 11 Aug 2011 11:41:27 +0000"  >&lt;p&gt;Hi Mark,&lt;/p&gt;

&lt;p&gt;thanks for this explanation and my apologies for not knowing the technical implications.&lt;/p&gt;

&lt;p&gt;The question that still arises is: If it is an application and/or hibernate problem (which is quite sure now) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;why does the problem not hit the application when using the &quot;old&quot; dbcp 1.2.2?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Was DBCP more error tolerant with regards to hybernate in that version?&lt;/p&gt;


&lt;p&gt;Kind regards&lt;/p&gt;

&lt;p&gt;Nils&lt;/p&gt;


</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65474</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tjgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170463</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-349] Insert clob or blob with oracle connection crashes software </title>
                <link>https://issues.apache.org/jira/browse/DBCP-349</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt; 1&amp;gt; tomcat 6.0.26 has tomcat-dbcp.jar that works completely fine. &lt;/p&gt;

&lt;p&gt; 2&amp;gt; tomcat 6.0.28, tomcat 6.0.29, tomcat 5.0.30, tomcat 5.0.31 has tomcat-dbcp.jar file that doesn&apos;t work and throws following error :&lt;/p&gt;

&lt;p&gt;java.lang.ClassCastException: org.apache.tomcat.dbcp.dbcp.PoolableConnection cannot be cast to oracle.jdbc.OracleConnection&lt;br/&gt;
        at oracle.sql.CLOB.createTemporary(CLOB.java:754)&lt;br/&gt;
        at oracle.sql.CLOB.createTemporary(CLOB.java:716)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;/p&gt;

&lt;p&gt;Would like to know if there was any changes to the commons dbcp package for tomcat version 6.0.29?&lt;/p&gt;</description>
                <environment>&lt;p&gt;windows XP , JDK 1.6, oracle 10g, oracle driver 10.2.0.2&lt;/p&gt;</environment>
        <key id="12491993">DBCP-349</key>
            <summary>Insert clob or blob with oracle connection crashes software </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="alina">alina joshi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Dec 2010 15:41:16 +0000</created>
                <updated>Sat, 31 May 2014 04:03:25 +0000</updated>
                            <resolved>Mon, 2 Dec 2013 21:47:27 +0000</resolved>
                                    <version>1.3</version>
                                                        <due></due>
                            <votes>2</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13016856" author="bruyeron@fullsix.com" created="Thu, 7 Apr 2011 14:18:08 +0000"  >&lt;p&gt;&lt;br/&gt;
Is this really fixed? I looked into the SVN logs and cannot find the relevant commits.&lt;/p&gt;</comment>
                            <comment id="13017602" author="psteitz" created="Fri, 8 Apr 2011 19:05:43 +0000"  >&lt;p&gt;You are correct that there were no DBCP commits on this issue.  It was closed by the original reporter.  Status should have been INVALID or NOT_A_PROBLEM since there was no fix applied.  Feel free to reopen.&lt;/p&gt;</comment>
                            <comment id="13017611" author="alina" created="Fri, 8 Apr 2011 19:17:05 +0000"  >&lt;p&gt;I have closed this issue as I got an email message from you stating it was fixed in DBCP 1.3.1  version.&lt;/p&gt;
</comment>
                            <comment id="13017618" author="psteitz" created="Fri, 8 Apr 2011 19:37:28 +0000"  >&lt;p&gt;Sorry, Alina.  I see what happened now.  I changed the &quot;fix version&quot; to 1.3.1/1.4.1 and that generated an email to you telling you about the issue status change.  When we update the &quot;fix version&quot; we are just indicating that we plan to fix the bug in that version, not necessarily that we have already fixed it.  Thanks for the bug report and sorry I misinterpreted the close action.&lt;/p&gt;

&lt;p&gt;Thanks, Renaud for pointing out that it had been closed without a committed fix.&lt;/p&gt;

&lt;p&gt;Patches, of course welcome!&lt;/p&gt;</comment>
                            <comment id="13403990" author="wermester" created="Fri, 29 Jun 2012 16:06:34 +0000"  >&lt;p&gt;Hi, same problem appear on new release tomcat 6 =&amp;gt; version 6.0.35&lt;/p&gt;</comment>
                            <comment id="13404921" author="bruyeron@fullsix.com" created="Mon, 2 Jul 2012 07:39:37 +0000"  >&lt;p&gt;&lt;br/&gt;
FYI, the stacktrace is missing the top of the stack, but in our case (a spring/hibernate application) there is a workaround at the application level: one must use CommonsDbcpNativeJdbcExtractor instead of SimpleNativeJdbcExtractor.&lt;/p&gt;</comment>
                            <comment id="13575635" author="gronono" created="Mon, 11 Feb 2013 06:32:42 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;It&apos;s not a bug of Commons Dbcp.&lt;/p&gt;

&lt;p&gt;Oracle (in CLOB.createTemporary()) casts the Connection to OracleConnection instead to use connection.unwrap method.&lt;/p&gt;</comment>
                            <comment id="13575636" author="gronono" created="Mon, 11 Feb 2013 06:33:13 +0000"  >&lt;p&gt;Attached is a program to understand the error&lt;/p&gt;</comment>
                            <comment id="13836958" author="markt" created="Mon, 2 Dec 2013 21:47:27 +0000"  >&lt;p&gt;Resolving this as invalid based on previous comment.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12568793" name="DBCP349.zip" size="2329447" author="gronono" created="Mon, 11 Feb 2013 06:33:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114625</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 48 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90448</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-348] connectionInitSqls doesn&apos;t work correctly. </title>
                <link>https://issues.apache.org/jira/browse/DBCP-348</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The parameter name is different between the source code and the online document.&lt;br/&gt;
Souce code(BasicDataSourceFactory.java):&lt;br/&gt;
   private final static String PROP_INITCONNECTIONSQLS = &quot;initConnectionSqls&quot;;&lt;/p&gt;

&lt;p&gt;Online document(&lt;a href=&quot;http://commons.apache.org/dbcp/configuration.html):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/dbcp/configuration.html):&lt;/a&gt;&lt;br/&gt;
   Parameter name: connectionInitSqls&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.4&lt;br/&gt;
JDK 6u21&lt;/p&gt;</environment>
        <key id="12480892">DBCP-348</key>
            <summary>connectionInitSqls doesn&apos;t work correctly. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mashmk02">Eiji Takahashi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Nov 2010 07:35:56 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:02 +0000</updated>
                            <resolved>Fri, 31 Jan 2014 09:47:53 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12935667" author="mashmk02" created="Thu, 25 Nov 2010 07:40:52 +0000"  >&lt;p&gt;change parameter name from &apos;initConnectionSqls&apos; to &apos;connectionInitSqls&apos;&lt;/p&gt;</comment>
                            <comment id="12935857" author="psteitz" created="Thu, 25 Nov 2010 19:57:53 +0000"  >&lt;p&gt;Thanks for the patch!&lt;/p&gt;

&lt;p&gt;Fixed in r1039158 in the 1.4.x branch and trunk (2.0).  I added a note to the current config docs pointing out the problem.&lt;/p&gt;

&lt;p&gt;Leaving open until 1.3.1/1.4.1 are released, at which time the config note needs to be removed from configuration.xml.&lt;/p&gt;

&lt;p&gt;Technically, this is an incompatible change; but I see it as an API bug that makes the 1.3/1.4 API unusable without looking at the internals, so the formal compatibility break is warranted in 1.3.1/1.4.1&lt;/p&gt;</comment>
                            <comment id="13039874" author="shndr" created="Thu, 26 May 2011 19:24:17 +0000"  >&lt;p&gt;Just ran into this issue as well. Something else I&apos;ve noticed is that although BasicDataSource expects a List of Strings, BasicDataSourceFactory expects a String with semi-colon delimiters. That difference should be documented or fixed as well.&lt;/p&gt;</comment>
                            <comment id="13887596" author="markt" created="Fri, 31 Jan 2014 09:47:53 +0000"  >&lt;p&gt;I&apos;ve clarified the difference in the Javadoc for the factory&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460436" name="connectionInitSqls.patch" size="2813" author="mashmk02" created="Thu, 25 Nov 2010 07:40:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114624</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90449</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-347] DelegatingStatement class has incomplete isWrapperFor method</title>
                <link>https://issues.apache.org/jira/browse/DBCP-347</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Currently org.apache.commons.dbcp.DelegatingStatement#isWrapperFor checks only if:&lt;/p&gt;

&lt;p&gt;1. Requested class is assignable from the DelegatingStatement instance:        iface.isAssignableFrom(getClass())&lt;br/&gt;
2. Wrapped object is a wrapper for the requested class:            _stmt.isWrapperFor(iface)&lt;/p&gt;

&lt;p&gt;I think there should be another option checked i.e. requested class is assignable from the wrapped object&apos;s class. For example:   iface.isAssignableFrom(_stmt.getClass())&lt;br/&gt;
This is especially that in fact unwrap method properly assumes this possiblity i.e.:     return iface.cast(_stmt);&lt;/p&gt;

&lt;p&gt;The whole method should be:&lt;/p&gt;

&lt;p&gt;    public boolean isWrapperFor(Class&amp;lt;?&amp;gt; iface) throws SQLException &lt;/p&gt;
{
        return iface.isAssignableFrom(getClass()) || iface.isAssignableFrom(_stmt.getClass()) || _stmt.isWrapperFor(iface);
    }</description>
                <environment>&lt;p&gt;Windows 7. java version &quot;1.6.0_21&quot;. Dell Latitude E6410.&lt;/p&gt;</environment>
        <key id="12478441">DBCP-347</key>
            <summary>DelegatingStatement class has incomplete isWrapperFor method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rposcro">Robert Poskrobek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Oct 2010 11:33:28 +0000</created>
                <updated>Sat, 31 May 2014 04:15:14 +0000</updated>
                            <resolved>Mon, 9 Dec 2013 21:20:16 +0000</resolved>
                                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12925341" author="ggregory@seagullsw.com" created="Wed, 27 Oct 2010 11:58:09 +0000"  >&lt;p&gt;Would you be willing to provide a patch that includes a unit test to prove what is broken?&lt;/p&gt;</comment>
                            <comment id="12925376" author="rposcro" created="Wed, 27 Oct 2010 14:08:10 +0000"  >&lt;p&gt;Ok! Let&apos;s start with &lt;tt&gt;java.sql.Wrapper#isWrapperFor&lt;/tt&gt; specification. It says that class implementing &lt;tt&gt;Wrapper&lt;/tt&gt; should check if directly implements requested interface. Otherwise it should immediately delegate the call to its wrapped object. According to this &lt;tt&gt;org.apache.commons.dbcp.DelegatingStatement#isWrapperFor&lt;/tt&gt; is written correctly. On the other hand Sun&apos;s specificifaction for &lt;tt&gt;java.sql.Wrapper#unwrap&lt;/tt&gt; method assumes wrapper to try to cast wrapped object rather than immediately delegating to its &lt;tt&gt;unwrap&lt;/tt&gt; method. Having this inconsistency I&apos;d vote for adding another level of checking for wrapper. This is because some wrapped classes doesn&apos;t implement &lt;tt&gt;java.sql.Wrapper&lt;/tt&gt; correctly (or at all) but still are valid classes for casting.&lt;/p&gt;

&lt;p&gt;Probably better to show my suggestion as code.&lt;br/&gt;
Currently we&apos;ve got:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.DelegatingStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isWrapperFor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; iface.isAssignableFrom(getClass()) || _stmt.isWrapperFor(iface);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suggest adding additional alternative condition here so:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.DelegatingStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isWrapperFor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; iface.isAssignableFrom(getClass()) || iface.isAssignableFrom(_stmt.getClass()) || _stmt.isWrapperFor(iface);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is no unit test for this method so I suggest adding it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.TestDelegatingStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIsWrapperFor() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        TesterConnection tstConn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TesterConnection(&lt;span class=&quot;code-quote&quot;&gt;&quot;rposcro&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rposcro&quot;&lt;/span&gt;);
        TesterStatement tstStmt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TesterStatement(tstConn);
        DelegatingConnection conn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingConnection(tstConn);
        DelegatingStatement stmt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingStatement(conn, tstStmt);

        &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; stmtProxyClass = Proxy.getProxyClass(
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getClassLoader(), 
                Statement.class);
        
        assertTrue(stmt.isWrapperFor(DelegatingStatement.class));
        assertTrue(stmt.isWrapperFor(TesterStatement.class));
        assertFalse(stmt.isWrapperFor(stmtProxyClass));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In order to pass the test there is fix needed for tester helper class which is not following specification currently:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.TesterStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isWrapperFor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please let me know your thoughts. Regards, r&lt;/p&gt;</comment>
                            <comment id="13843566" author="markt" created="Mon, 9 Dec 2013 21:20:16 +0000"  >&lt;p&gt;Thanks for the report, patch and test case.&lt;/p&gt;

&lt;p&gt;Similar issues in DelegatingDatabaseMetaData.isWrapperFor() and DelegatingResultSet.isWrapperFor() were also fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fty7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-345] NumActive is off-by-one at instantiation and causes premature exhaustion</title>
                <link>https://issues.apache.org/jira/browse/DBCP-345</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Scenario: we have some code that we had thought was potentially leaking connections.  In our unitTest/integrationTest environment, we know we can &lt;b&gt;lock down connections to a total of 2&lt;/b&gt; and a full run should pass.  We had no such luck with a &lt;tt&gt;maxActive&lt;/tt&gt; of 2.    &lt;/p&gt;

&lt;p&gt;We created/attached a &lt;tt&gt;DebugBasicDataSource&lt;/tt&gt; which initializes a  &lt;tt&gt;DebugConnectionPool&lt;/tt&gt; for logging purposes and delegates into the DBCP hierarchy.  BTW - consistent use of accessors would have made this a cleaner affair &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// num active starts at one! Here is the original unmodified log message:
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//          BORROWING:  from AbandonedObjectPool@10f0f6ac (1 of 2) 0 idle: threadStats[ ]: all-time uniques{ (empty)  }
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// SEE! no borrows ever, and the first pre-borrow already has a count of 1!&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Before borrowing the first connection - &lt;tt&gt;numActive&lt;/tt&gt; is 1!  &lt;/p&gt;


&lt;p&gt;The gorier details below, I hope they help someone else!&lt;/p&gt;

&lt;p&gt;Constraining the pool was the best way to uncover the leakage.  &lt;/p&gt;

&lt;p&gt;Thinking it was our error, we went after our code to find the problem.  We had such a hard time understanding who was using connections, in which Spring context.  The confusion stemmed from the fact that our unitTests run against REST resources deployed as Jersey components in a Grizzly container.  Where they using the same connection pool or not?  Was the unitTest setup side exhausting more connections, or was it leaking on the REST service side.&lt;/p&gt;

&lt;p&gt;Answers: &lt;br/&gt;
1.  Our unitTests executing Jersey with in-VM Grizzly container do indeed utilize the same pool (and same Spring context).&lt;br/&gt;
2.  Our unitTest (side) was not using more than one connection for data setup, and it returned the connection for reuse.&lt;br/&gt;
3.  Our REST service side was only using one connection, but was a Grizzly threaded container and we have AcitveMQ running as well.  Practically, one server connection could handle everything, but the REST service and ActiveMQ listener could potentially claim 2.&lt;/p&gt;


&lt;p&gt;Note, the attached DebugBasicDataSource was quite useful to determine which threads were claiming which connections in a leak situation.  Certainly do not configure it on the production side, but it might be nice to see something like this offered up on the DBCP site somewhere to help developers find or confirm their misconfiguration or bad code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475852">DBCP-345</key>
            <summary>NumActive is off-by-one at instantiation and causes premature exhaustion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rosskevin">Kevin Ross</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Oct 2010 14:19:24 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:11 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 16:30:09 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12918372" author="psteitz" created="Wed, 6 Oct 2010 01:27:04 +0000"  >&lt;p&gt;I can&apos;t see where in the attached code you are observing numActive directly.  Please provide the following to help determine if this is a DBCP bug (unlikely at this point):&lt;/p&gt;

&lt;p&gt;1. Your full DBCP configuration&lt;br/&gt;
2. The client code that actually opens connections and observes numActive&lt;/p&gt;
</comment>
                            <comment id="12918386" author="rosskevin" created="Wed, 6 Oct 2010 02:06:23 +0000"  >&lt;p&gt;Code attached already, DebugConnectionPool.java&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; borrowObject() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        log.debug( &lt;span class=&quot;code-quote&quot;&gt;&quot;BORROWING:  from &quot;&lt;/span&gt; + toId( delegate ) + stats( delegate ) );
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj = delegate.borrowObject();
        borrowOnThread( obj );
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( log.isDebugEnabled() )
            log.debug( &lt;span class=&quot;code-quote&quot;&gt;&quot;BORROWED: &quot;&lt;/span&gt; + toId( obj ) + &lt;span class=&quot;code-quote&quot;&gt;&quot; &amp;lt;= &quot;&lt;/span&gt; + toId( delegate ) + stats( delegate ) );
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; obj;
    }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; stats( GenericObjectPool delegate2 ) {

        &lt;span class=&quot;code-comment&quot;&gt;// num active starts at one! Here is the original unmodified log message:
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//          BORROWING:  from AbandonedObjectPool@10f0f6ac (1 of 2) 0 idle: threadStats[ ]: all-time uniques{ (empty)  }
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// SEE! no borrows ever, and the first pre-borrow already has a count of 1!
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// modify it &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; easier understanding i.e. -1
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s = &lt;span class=&quot;code-quote&quot;&gt;&quot; (&quot;&lt;/span&gt; + ( getNumActive() - 1 ) + &lt;span class=&quot;code-quote&quot;&gt;&quot; of &quot;&lt;/span&gt; + getMaxActive() + &lt;span class=&quot;code-quote&quot;&gt;&quot;) &quot;&lt;/span&gt; + getNumIdle() + &lt;span class=&quot;code-quote&quot;&gt;&quot; idle: threadStats[ &quot;&lt;/span&gt;;

        &lt;span class=&quot;code-comment&quot;&gt;// print out which thread has what count.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; threadKey : threadStats.keySet()) {

            List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; connectionIds = threadStats.get( threadKey );
            s += threadKey + Formatter.toString( connectionIds ) + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;;
        }

        s += &lt;span class=&quot;code-quote&quot;&gt;&quot;]: all-time uniques&quot;&lt;/span&gt; + Formatter.toString( uniqueConnectionIds );
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;This debug class is easily hooked up to Spring via:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.metova.service.db.DebugBasicDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- &amp;lt;bean id=&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSource&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.BasicDataSource&quot;&lt;/span&gt; destroy-method=&lt;span class=&quot;code-quote&quot;&gt;&quot;close&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; --&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.mysql.jdbc.Driver&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:mysql://localhost:3306/unitTest?autoReconnect=true&amp;amp;amp;characterEncoding=utf8&amp;amp;amp;useUnicode=true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;unitTest&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;unitTest&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;defaultAutoCommit&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testWhileIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testOnBorrow&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testOnReturn&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;validationQuery&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 1&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;timeBetweenEvictionRunsMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;5000&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;

		&lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- Keep these locked down for unitTests to see if we can expose leaks during bulk unit test cycles. --&amp;gt;&lt;/span&gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- numActive counter is found to be one off the code, which actually makes the maxActive bogus.  Make the maxActive what you desire +1--&amp;gt;&lt;/span&gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxActive&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minIdle&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;maxWait&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;10000&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;initialSize&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;removeAbandonedTimeout&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;60&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;removeAbandoned&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;logAbandoned&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;minEvictableIdleTimeMillis&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;30000&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Considering you didn&apos;t even look at my submission, it&apos;s a bit premature of you to dismiss this as not a DBCP bug, isn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="12919500" author="psteitz" created="Sat, 9 Oct 2010 15:14:21 +0000"  >&lt;p&gt;Thanks for including your pool config, which provides some information that may be helpful - you have initialSize set to 1.  That means when the datasource is created, one connection will be created and placed in the pool. So before the first getConnection request, there will be one idle connection in the pool. This should not affect numActive, but it will make numIdle = 1.&lt;/p&gt;

&lt;p&gt;To determine if this is actually a DBCP (or pool) bug, we need a unit test that directly borrows from DBCP and observes numActive.  I don&apos;t think this is a DBCP bug, since I cannot reproduce the behavior and the following unit test succeeds, when added to TestBasicDataSource (the setup creates the datasource):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testInitialSize2() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        assertEquals(0, ds.getInitialSize());
        assertEquals(0, ds.getNumIdle());
        assertEquals(0, ds.getNumActive());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are other unit tests that further verify correct behavior of the pool counters.   Apologies if I misunderstood the code, but I can&apos;t see where the attached code instantiates a datasource and checks numActive directly before borrowing a connection.  That is what the test code above does and the result is as expected.  Your code appears to add numActive and numIdle, which &lt;b&gt;will&lt;/b&gt; equal 1 when the pool is initialized with initialSize = 1.  If you can produce a unit test or other code that demonstrates that numActive is not correctly reporting the number of connections checked out to clients, then we can investigate; otherwise we need to close this issue as invalid.&lt;/p&gt;
</comment>
                            <comment id="12919502" author="rosskevin" created="Sat, 9 Oct 2010 15:37:54 +0000"  >&lt;p&gt;Before borrowing the first connection, &lt;tt&gt;numActive&lt;/tt&gt; should report 0 correct?&lt;/p&gt;

&lt;p&gt;Do we agree, that if you have never borrowed a connection, numActive should not be greater than 0, regardless of pool settings?&lt;/p&gt;

&lt;p&gt;If we agree, then there is a bug.&lt;/p&gt;

&lt;p&gt;My code attached exposes this, I&apos;m not sure why you are not able to use it or see it.  The commons-pool package is commonly used for many things and generic knowledge of that project is very useful in diagnosing this problem.&lt;/p&gt;

&lt;p&gt;Put a breakpoint in the borrowObject() method of the pool object (use your implementation, or mine), and before the super call to borrowObject() in the pool packages, inspect the &lt;tt&gt;numActive&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If numActive == 1 before the call to the pool to make the first borrow, there is a bug.  AFTER we borrow the first connection, numActive should be 1.&lt;/p&gt;

&lt;p&gt;If you still don&apos;t see it, change the line of my code in DebugConnectionPool.java from:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;log.debug( &lt;span class=&quot;code-quote&quot;&gt;&quot;BORROWING:  from &quot;&lt;/span&gt; + toId( delegate ) + stats( delegate ) );&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;log.debug( &lt;span class=&quot;code-quote&quot;&gt;&quot;BORROWING:  holy cow &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is num active before borrowing a connection!!!!!!!!!!!!!!!!!!!!! &quot;&lt;/span&gt; + getNumActive() );&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then look for the first time you see that message.  It proves that numActive is 1 before ever allowing a connection to be borrowed from the pool.&lt;/p&gt;

&lt;p&gt;I think that should get you there.&lt;/p&gt;</comment>
                            <comment id="12919514" author="psteitz" created="Sat, 9 Oct 2010 16:53:53 +0000"  >&lt;p&gt;I agree that if numActive shows 1 before anything has been borrowed from the pool, this is a bug.   Your code does not show this, however.  Moreover, the following test, using a stripped down version of your DebugConnectionPool (removing the stats and thread accounting) succeeds when added to TestGenerricObjectPool  (in src/test/org/apache/commons/pool/impl in the pool sources):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;pool.setMaxActive(3);
 pool.setMinIdle(0);
 pool.addObject();  &lt;span class=&quot;code-comment&quot;&gt;// effect of initialSize = 1 in DBCP
&lt;/span&gt; assertEquals(0, pool.getNumActive());
 assertEquals(1, pool.getNumIdle());
 DebugConnectionPool debugPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DebugConnectionPool(pool);
 assertEquals(0, debugPool.getNumActive());
 assertEquals(1, debugPool.getNumIdle());
 debugPool.borrowObject();
 assertEquals(1, debugPool.getNumActive());
 assertEquals(0, debugPool.getNumIdle());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adding instrumentation as you suggest before the borrow displays the correct value - 0 - for numActive.  There must be something else going on in your code.  What you need to trace is the client code that is access the pool - either directly, or indirectly using your wrapper class.&lt;/p&gt;</comment>
                            <comment id="12925534" author="rosskevin" created="Wed, 27 Oct 2010 20:16:09 +0000"  >&lt;p&gt;I just attached: AssertNumActiveDataSource.java.&lt;/p&gt;

&lt;p&gt;It relies on no other libraries.  If NumActive is &amp;gt; 0 before the first borrow, it throws an exception.&lt;/p&gt;

&lt;p&gt;Does this work for you?  It does not for me.&lt;/p&gt;

&lt;p&gt;The AssertNumActiveDataSource.java does nothing else, so I think it should be a good indicator of the problem I&apos;m trying to communicate to you.&lt;/p&gt;</comment>
                            <comment id="12925629" author="psteitz" created="Thu, 28 Oct 2010 01:00:13 +0000"  >&lt;p&gt;None of the attached code demonstrates a problem with either Commons Pool or DBCP.  When the AssertNumActiveDS class is added to o.a.c.dbcp test package, the following unit test succeeds:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testNumActiveDS() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AssertNumActiveDataSource();
        ds.setDriverClassName(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.TesterDriver&quot;&lt;/span&gt;);
        ds.setUrl(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:apache:commons:testdriver&quot;&lt;/span&gt;);
        ds.setMaxActive(getMaxActive());
        ds.setMaxWait(getMaxWait());
        ds.setDefaultAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        ds.setDefaultReadOnly(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        ds.setDefaultTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED);
        ds.setDefaultCatalog(CATALOG);
        ds.setUsername(&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt;);
        ds.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt;);
        ds.setValidationQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT DUMMY FROM DUAL&quot;&lt;/span&gt;);
        ds.setConnectionInitSqls(Arrays.asList(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 2&quot;&lt;/span&gt;}));
        ds.getConnection();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There must be something else wrong in the concurrency management or elsewhere in your code.  Reopen if you can produce a unit test that demonstrates that pool counters are failing.&lt;/p&gt;</comment>
                            <comment id="12925796" author="rosskevin" created="Thu, 28 Oct 2010 13:16:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;There must be something else wrong in the concurrency management or elsewhere in your code.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Phil, I would encourage you to ponder the following quote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;When you see hoof prints, think horses - not zebras.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When I said it works for me, does it work for you?  I was trying to find the differences in our results.  Your immediate resolution as &lt;b&gt;invalid&lt;/b&gt; was unnecessary and a bit overzealous.   It took me hours to uncover this problem, and it is my duty as a good member of the community to make sure no one else has to experience this.  Your interaction and communication with me was more likely to run me off rather than for me to persist and make sure this gets resolved as a valid defect.&lt;/p&gt;

&lt;p&gt;Luckily, I am a persistent bastard.  Please understand that you don&apos;t know who is on the other end of an issue.  The community member on the other end of an issue could have knowledge that dwarfs you or me, so don&apos;t be so quick to dismiss the work and contribution.&lt;/p&gt;

&lt;p&gt;The problem is with &lt;tt&gt;ds.setRemoveAbandoned( true );&lt;/tt&gt;.  &lt;/p&gt;

&lt;p&gt;Here is code that proves the problem, commenting the one line (above) removes the issue, this is what I was trying to get to when I asked you the question in my last comment.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testRemoveAbandonedAndNumActive() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        AssertNumActiveDataSource ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AssertNumActiveDataSource();
        ds.setDriverClassName( &lt;span class=&quot;code-quote&quot;&gt;&quot;com.mysql.jdbc.Driver&quot;&lt;/span&gt; );
        ds.setUrl( &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:mysql:&lt;span class=&quot;code-comment&quot;&gt;//localhost:3306/unitTest?autoReconnect=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;amp;characterEncoding=utf8&amp;amp;amp;useUnicode=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; );
&lt;/span&gt;        ds.setUsername( &lt;span class=&quot;code-quote&quot;&gt;&quot;unitTest&quot;&lt;/span&gt; );
        ds.setPassword( &lt;span class=&quot;code-quote&quot;&gt;&quot;unitTest&quot;&lt;/span&gt; );

        ds.setDefaultAutoCommit( &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; );
        ds.setTestWhileIdle( &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; );
        ds.setTestOnBorrow( &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; );
        ds.setTestOnReturn( &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; );
        ds.setValidationQuery( &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT 1&quot;&lt;/span&gt; );
        ds.setTimeBetweenEvictionRunsMillis( 5000 );

        ds.setMaxActive( 3 );
        ds.setMinIdle( 0 );
        ds.setMaxWait( 10000 );
        ds.setInitialSize( 1 );
        ds.setMinEvictableIdleTimeMillis( 30000 );

        ds.setRemoveAbandonedTimeout( 60 );
        ds.setLogAbandoned( &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; );

        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; exposes the problematic issue with NumActive.
&lt;/span&gt;        ds.setRemoveAbandoned( &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; );

        ds.getConnection();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12926032" author="psteitz" created="Fri, 29 Oct 2010 01:28:04 +0000"  >&lt;p&gt;Replacing mysql config with DBCP tester driver (as above), the unit test in the last comment succeeds for me.  Maybe someone else can get this to fail. &lt;/p&gt;</comment>
                            <comment id="13886744" author="markt" created="Thu, 30 Jan 2014 16:27:22 +0000"  >&lt;p&gt;This is the patch I have been used to HEAD of the the DBCP 1.5 branch to test this issue.&lt;/p&gt;</comment>
                            <comment id="13886751" author="markt" created="Thu, 30 Jan 2014 16:30:09 +0000"  >&lt;p&gt;I have also tried to reproduce this without success. It looks like something else is going on in the OPs test environment that is not happening for Phil or I.&lt;/p&gt;

&lt;p&gt;Feel free to re-open this if you can provide a patch to either trunk or the 1.5.x branch that demonstrates this issue via a unit test. The unit test should use org.apache.commons.dbcp.TesterDriver so it does not require any external databases.&lt;/p&gt;</comment>
                            <comment id="13886867" author="markt" created="Thu, 30 Jan 2014 18:26:00 +0000"  >&lt;p&gt;One other thing I thought of to help diagnose this is a debugger. If you put a break point on every place where numActive is incremented and then run your test you&apos;ll find out what is triggering the increment. If attaching a debugger isn&apos;t an option, you can modify the code, create a new exception every time numActive is incremented and then print the stack trace for that exception to the console. It isn&apos;t the prettiest debugging technique but it will tell what is triggering the behaviour you see.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12458186" name="AssertNumActiveDataSource.java" size="5865" author="rosskevin" created="Wed, 27 Oct 2010 20:13:44 +0000"/>
                            <attachment id="12456383" name="DebugBasicDataSource.java" size="858" author="rosskevin" created="Tue, 5 Oct 2010 14:20:17 +0000"/>
                            <attachment id="12456384" name="DebugConnectionPool.java" size="8274" author="rosskevin" created="Tue, 5 Oct 2010 14:20:17 +0000"/>
                            <attachment id="12626121" name="dbcp-345.patch" size="19429" author="markt" created="Thu, 30 Jan 2014 16:27:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114621</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-344] Maven configuration updated with configuration for transitive dependency conflict.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-344</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Added configuration to fix transitive dependencies.&lt;/p&gt;

&lt;p&gt;there are two conflicts.&lt;/p&gt;

&lt;p&gt;junit&lt;br/&gt;
commons-logging&lt;/p&gt;

&lt;p&gt;Attached to this JIRA ticket is a svn diff of the Maven2 POM configuration.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any&lt;/p&gt;</environment>
        <key id="12475624">DBCP-344</key>
            <summary>Maven configuration updated with configuration for transitive dependency conflict.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="whitingjr">Jeremy Whiting</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Oct 2010 14:37:49 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:09 +0000</updated>
                            <resolved>Wed, 5 Jan 2011 04:53:52 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12926722" author="psteitz" created="Sun, 31 Oct 2010 15:10:46 +0000"  >&lt;p&gt;Needs review and application (both in trunk and in the 1.x branch) by a Maven expert.&lt;/p&gt;</comment>
                            <comment id="12977622" author="psteitz" created="Wed, 5 Jan 2011 04:53:52 +0000"  >&lt;p&gt;Thanks for the patch.  Fixed in r1055296 for both trunk and 1_4_X branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456120" name="dbcp-pom-svn-diff.txt" size="628" author="whitingjr" created="Fri, 1 Oct 2010 14:39:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tjcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170444</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-342] Not cleaned up commons pool&apos;s evictor task when SQLException occurs after the GenericObjectPool is initialized in createDataSource.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-342</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-93&quot; title=&quot;[dbcp] BasicDataSource.createDataSource() memory leak on SQLExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-93&quot;&gt;&lt;del&gt;DBCP-93&lt;/del&gt;&lt;/a&gt; bts is not fixed correctly&lt;br/&gt;
(JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-93&quot; title=&quot;[dbcp] BasicDataSource.createDataSource() memory leak on SQLExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-93&quot;&gt;&lt;del&gt;DBCP-93&lt;/del&gt;&lt;/a&gt; : If SQLException occurs after the GenericObjectPool is initialized in createDataSource, the evictor task is not cleaned up)&lt;/p&gt;

&lt;p&gt;Only one evictor timer thread leaves but evictor timer task queued as many as createDataSource() method called.&lt;br/&gt;
queued evictor will keep tries to make connection to meet min idle connection.&lt;br/&gt;
if suddenly dbms become stable and can accept connection again,&lt;br/&gt;
then every queued evictor will try to make connection simultaneously.&lt;/p&gt;

&lt;p&gt;In my case there were more then 100000 user requests while I set wrong password to database,&lt;br/&gt;
when I change my password to correct in database &lt;br/&gt;
more then 100000 evictor tries to make connection&lt;br/&gt;
and finally mssql makes connections as many as integer limit and dbms dies.&lt;/p&gt;

&lt;p&gt;here is my test.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TestBasicDataSource.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCreateDataSourceCleanupEvictor() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    	ds.close();
    	ds = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    	ds = createDataSource();
    	ds.setDriverClassName(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.TesterConnRequestCountDriver&quot;&lt;/span&gt;);
    	ds.setUrl(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:apache:commons:testerConnRequestCountDriver&quot;&lt;/span&gt;);
    	ds.setValidationQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT DUMMY FROM DUAL&quot;&lt;/span&gt;);
    	ds.setUsername(&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt;);
    	
    	&lt;span class=&quot;code-comment&quot;&gt;// Make password incorrect, so createDataSource will &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt;
&lt;/span&gt;    	ds.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;wrong&quot;&lt;/span&gt;);
    	&lt;span class=&quot;code-comment&quot;&gt;// Set timeBetweenEvictionRuns &amp;gt; 0, so evictor will be created
&lt;/span&gt;    	ds.setTimeBetweenEvictionRunsMillis(100);
    	&lt;span class=&quot;code-comment&quot;&gt;// Set min idle &amp;gt; 0, so evictor will &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to make connection as many as idle count
&lt;/span&gt;    	ds.setMinIdle(2);
    	
    	&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.TesterConnRequestCountDriver&quot;&lt;/span&gt;);
    	TesterConnRequestCountDriver testerDriver = (TesterConnRequestCountDriver) DriverManager.getDriver(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:apache:commons:testerConnRequestCountDriver&quot;&lt;/span&gt;);
    	testerDriver.initConnRequestCount();
    	
    	&lt;span class=&quot;code-comment&quot;&gt;// user request 10 times
&lt;/span&gt;    	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;10; i++) {
    		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    			@SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unused&quot;&lt;/span&gt;)
				DataSource ds2 = ds.createDataSource();
    		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
    			&lt;span class=&quot;code-comment&quot;&gt;// Ignore
&lt;/span&gt;    		}
    	}

    	&lt;span class=&quot;code-comment&quot;&gt;// sleep 1000ms. evictory will invoked 10 times.
&lt;/span&gt;    	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
    	
    	&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; orphan evictor is alive, connection request count will be 100 which is denoted from (ds.createDataSource() count * evictor invoke count)
&lt;/span&gt;    	&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; DBMS connection is back to stable in 10 minutes then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; test &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; will make 120000 connections simultaneously
&lt;/span&gt;    	&lt;span class=&quot;code-comment&quot;&gt;// 		120000 connections = ds.createDataSource() count (10) * evictor invoke count (6000) * min idle (2)
&lt;/span&gt;    	&lt;span class=&quot;code-comment&quot;&gt;// but &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; evictor is cleaned up, connection request count will be only 10 (ds.createDataSource() count )
&lt;/span&gt;    	assertEquals(10, testerDriver.getConnectionRequestCount());
    	
    	&lt;span class=&quot;code-comment&quot;&gt;// fail to create datasource then clean up orphan connection pool and evictor in connnection pool
&lt;/span&gt;    	assertNull(ds.connectionPool);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;ul&gt;
	&lt;li&gt;commons-pool : 1.4&lt;/li&gt;
	&lt;li&gt;commons-dbcp : 1.4, 1.3 both&lt;/li&gt;
	&lt;li&gt;dbms : MSSQL 2007&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="12473220">DBCP-342</key>
            <summary>Not cleaned up commons pool&apos;s evictor task when SQLException occurs after the GenericObjectPool is initialized in createDataSource.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="brightfe">byungchol.kim</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Sep 2010 08:48:40 +0000</created>
                <updated>Mon, 13 May 2019 12:27:17 +0000</updated>
                            <resolved>Wed, 25 Feb 2015 00:21:16 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12905833" author="brightfe" created="Fri, 3 Sep 2010 08:50:04 +0000"  >&lt;p&gt;fix patch&lt;/p&gt;</comment>
                            <comment id="13024905" author="psteitz" created="Mon, 25 Apr 2011 18:38:52 +0000"  >&lt;p&gt;Modified version of the patch applied in r1096550 (trunk) and r1096550 (1.4.x branch).  I made the following changes to the patch:&lt;br/&gt;
1. Instead of letting the Evictor start and shutting it down on exception, I moved the timeBetweenEvictionRuns setter into a new startPoolMaintenance method that is not invoked until initialization has succeeded.  This prevents connection requests getting fired while initialization is in progress.&lt;br/&gt;
2. Separated exception management for factory and instance creation.&lt;br/&gt;
3. Made closeConnectionPool swallow rather than propagate exceptions so that the main exception leading to its invocation is not lost.&lt;br/&gt;
4. Changed the test class to not depend on DriverManager driver loading, which no longer happens by default.&lt;/p&gt;

&lt;p&gt;Thanks for the patch!&lt;/p&gt;</comment>
                            <comment id="13256647" author="frederic.tardif" created="Wed, 18 Apr 2012 15:39:06 +0000"  >&lt;p&gt;We just hit that same error with version 1.4. &lt;br/&gt;
The consequence of leaking pools that spawn connections (min pooled connection per pool) can be pretty nasty.&lt;/p&gt;

&lt;p&gt;Great to know there is a fix. &lt;/p&gt;

&lt;p&gt;Any ETA about when dbcp will release a new version with this fix officially included?&lt;/p&gt;</comment>
                            <comment id="14335713" author="psteitz" created="Wed, 25 Feb 2015 00:21:07 +0000"  >&lt;p&gt;Should be resolved, but not closed&lt;/p&gt;</comment>
                            <comment id="16838449" author="blama" created="Mon, 13 May 2019 10:32:49 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=psteitz&quot; class=&quot;user-hover&quot; rel=&quot;psteitz&quot;&gt;psteitz&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;is there a release date for 1.4.1 already? We are using 1.4 and I believe we have run into the issue this fix solves.&lt;/p&gt;

&lt;p&gt;At some point (reason unknown), there are 10 (our maxActive) connections created within a 7 seconds, when there is only 1-2 DB requests happening from our code.&lt;/p&gt;

&lt;p&gt;Thank you &amp;amp; Best regards&lt;/p&gt;</comment>
                            <comment id="16838503" author="garydgregory" created="Mon, 13 May 2019 12:27:17 +0000"  >&lt;p&gt;You should really consider updating to the current version 2.6.0, which will means changing package names from &lt;tt&gt;org.apache.commons.dbcp&lt;/tt&gt; to &lt;tt&gt;org.apache.commons.dbcp2&lt;/tt&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12498194">DBCP-353</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12468832">DBCP-339</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12380526">DBCP-379</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12453766" name="dbcp_orphan_evictor_fix_patch.txt" size="7316" author="brightfe" created="Fri, 3 Sep 2010 08:50:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114618</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170416</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-341] LocalXAConnectionFactory does not properly check if Xid is equal to currentXid when resuming</title>
                <link>https://issues.apache.org/jira/browse/DBCP-341</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The current implementation checks if Xid is not equal to currentXid using the != . That doesn&apos;t work in all cases resulting in XAException.&lt;br/&gt;
I think that this check should be left to the Xid implementation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12473149">DBCP-341</key>
            <summary>LocalXAConnectionFactory does not properly check if Xid is equal to currentXid when resuming</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="iocanel">Ioannis Canellos</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Sep 2010 15:29:08 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:06 +0000</updated>
                            <resolved>Sun, 2 Feb 2014 20:46:10 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12905546" author="iocanel" created="Thu, 2 Sep 2010 15:31:35 +0000"  >&lt;p&gt;I am attaching a patch that replaces the != operation with a call the Xid equals method.&lt;/p&gt;</comment>
                            <comment id="12977432" author="ggregory@seagullsw.com" created="Tue, 4 Jan 2011 19:57:54 +0000"  >&lt;p&gt;typo&lt;/p&gt;</comment>
                            <comment id="13889049" author="markt" created="Sun, 2 Feb 2014 20:46:10 +0000"  >&lt;p&gt;Thanks for the report and the fix. Sorry it has taken so long to address this.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed trunk for the 2.x series the 1.5.x branch. It will be included in the next release of each.&lt;/p&gt;

&lt;p&gt;If there are further 1.3.x and 1.4.x releases (currently being discussed on the dev mailing list) my expectation is that they will be generated from the 1.5.x branch so will pick up this fix too.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12453688" name="DBPC-341-patch.txt" size="916" author="iocanel" created="Thu, 2 Sep 2010 15:31:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114617</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-339] orphaned connectionPools created on Exception within createDataSource method</title>
                <link>https://issues.apache.org/jira/browse/DBCP-339</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When an Exception is thrown in the BasicDataSource.createDataSource after the connectionPool instance variable has been set the connectionPool is not closed.&lt;/p&gt;

&lt;p&gt;If the timeBetweenEvictionRunsMillis is greater than zero a TaskTimer evictor is created in the GenericObjectPool. This TaskTimer keeps running even though the DataSource was not successfully created. The evictor when it runs will attempt to create connections for this orphaned connectionPool up to the min connections (minIdle).&lt;/p&gt;

&lt;p&gt;If the database is down when the createDataSource is called an Exception will be thrown and an orphaned connectionPool will be created. If serveral retries are attempted while the database is down several orphaned connectionPools are created. Once the database is back up, all these orphaned connectionPool&apos;s evitor threads will attempt to created minIdle connections to the database. This exhausts the max num connections on the database.&lt;/p&gt;

&lt;p&gt;One solution to to close the connectionPool when an Exception is thrown within the createDataSource method.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux&lt;br/&gt;
MySQL 5.1.47&lt;br/&gt;
JDK 1.6&lt;br/&gt;
commonsPool 1.5.4&lt;/p&gt;</environment>
        <key id="12468832">DBCP-339</key>
            <summary>orphaned connectionPools created on Exception within createDataSource method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mikeseawa">Mike Bartlett</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Jul 2010 16:42:24 +0000</created>
                <updated>Mon, 25 Apr 2011 16:27:26 +0000</updated>
                            <resolved>Sun, 24 Apr 2011 00:26:41 +0000</resolved>
                                    <version>1.2.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12887192" author="psteitz" created="Sun, 11 Jul 2010 13:12:05 +0000"  >&lt;p&gt;Thank you for reporting this.  Patches welcome!&lt;/p&gt;</comment>
                            <comment id="12893828" author="dimas" created="Thu, 29 Jul 2010 21:17:38 +0000"  >&lt;p&gt;Proposed solution to close connection pool, if  an Exception is thrown, should work. Pool instances will be closed and associated eviction timer tasks will be canceled, and eventually garbage collected. The patch file for trunk (v 1.4.1-SNAPSHOT) is attached. &lt;/p&gt;</comment>
                            <comment id="13023624" author="psteitz" created="Sun, 24 Apr 2011 00:26:41 +0000"  >&lt;p&gt;Closing as duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-342&quot; title=&quot;Not cleaned up commons pool&amp;#39;s evictor task when SQLException occurs after the GenericObjectPool is initialized in createDataSource.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-342&quot;&gt;&lt;del&gt;DBCP-342&lt;/del&gt;&lt;/a&gt;.  Technically, it is the other way around (this issue was raised earlier), but &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-342&quot; title=&quot;Not cleaned up commons pool&amp;#39;s evictor task when SQLException occurs after the GenericObjectPool is initialized in createDataSource.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-342&quot;&gt;&lt;del&gt;DBCP-342&lt;/del&gt;&lt;/a&gt; has fuller discussion and patch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12473220">DBCP-342</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12450865" name="DBCP-339.patch" size="304" author="dimas" created="Thu, 29 Jul 2010 21:17:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114615</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178973</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-338] ORA-01453 on connections with previous errors</title>
                <link>https://issues.apache.org/jira/browse/DBCP-338</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Adapted from a post to commons-user by Tim Dudgeon:&lt;/p&gt;

&lt;p&gt;When an Oracle connection with autocommit=true encounters an error executing a DDL statement,  the connection is left in a transactional state that can lead to ORA-01453 when the connection is subsequently retrieved from the pool.  The following code illustrates the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; foo;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Connection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.SQLException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Statement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp.ConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp.DriverManagerConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp.PoolableConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.dbcp.PoolingDataSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.pool.impl.GenericObjectPool;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Ora01453Example {

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; URL = &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:oracle:thin:@192.168.56.101:1521:orcl&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; USERNAME = &lt;span class=&quot;code-quote&quot;&gt;&quot;ijc&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; PASSWORD = &lt;span class=&quot;code-quote&quot;&gt;&quot;ijc&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; PoolingDataSource dataSource;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        Ora01453Example instance = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Ora01453Example();
        instance.run();
    }

    Ora01453Example() {
        GenericObjectPool connectionPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        connectionPool.setMaxActive(5);
        connectionPool.setMaxIdle(2);
        connectionPool.setMaxWait(10000);
        ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DriverManagerConnectionFactory(URL, USERNAME, PASSWORD);
        PoolableConnectionFactory poolableConnectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolableConnectionFactory(
                connectionFactory, connectionPool, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        dataSource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoolingDataSource(connectionPool);
        dataSource.setAccessToUnderlyingConnectionAllowed(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    }

    void run() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Running...&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// get the connection
&lt;/span&gt;        Connection con = getConnection();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; will fail, either first time or second
&lt;/span&gt;            executeSql(con, &lt;span class=&quot;code-quote&quot;&gt;&quot;create table qwerty (id varchar2(100))&quot;&lt;/span&gt;);
            executeSql(con, &lt;span class=&quot;code-quote&quot;&gt;&quot;create table qwerty (id varchar2(100))&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed as expected&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// close connection so it goes back to pool
&lt;/span&gt;            con.close();
        }

        &lt;span class=&quot;code-comment&quot;&gt;// get a connection from pool again.
&lt;/span&gt;        con = getConnection();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Setting transaction level&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to set isolation level - will fail (assuming same connection is retrieved)
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            con.setAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
            con.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE);
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            con.close();
        }
    }

    Connection getConnection() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        Connection con = dataSource.getConnection();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;Got Connection: &quot;&lt;/span&gt; + con.hashCode()
                + &lt;span class=&quot;code-quote&quot;&gt;&quot; autoCommit=&quot;&lt;/span&gt; + con.getAutoCommit()
                + &lt;span class=&quot;code-quote&quot;&gt;&quot; isolation=&quot;&lt;/span&gt; + con.getTransactionIsolation());
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; con;
    }

    void executeSql(Connection con, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sql) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        Statement stmt = con.createStatement();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            stmt.execute(sql);
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            stmt.close();
        }
    }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Assuming the problem is that the driver creates, but does not commit a transaction on the failed DDL statement (despite autocommit=true), the simplest DBCP workaround would be to remove the autocommit test that guards the rollback in PooloableConnectionFactory#passivate.  That would have performance impacts, so it may be better to take an approach similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-116&quot; title=&quot;[dbcp] transactionIsolation,  testOnBorrow and autoCommmit=false crashes for Oracle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-116&quot;&gt;&lt;del&gt;DBCP-116&lt;/del&gt;&lt;/a&gt;, where we add a configuration parameter to either force rollback on each passivate or extend the rollbackAfterValidation config parameter defined there to PoolableConnectionFactory.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Oracle driver 11.1.0.7.0. &lt;/p&gt;</environment>
        <key id="12466851">DBCP-338</key>
            <summary>ORA-01453 on connections with previous errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Jun 2010 18:06:47 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:18 +0000</updated>
                            <resolved>Fri, 14 Feb 2014 15:00:15 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.1</version>
                    <version>1.2</version>
                    <version>1.2.1</version>
                    <version>1.2.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13901519" author="markt" created="Fri, 14 Feb 2014 15:00:15 +0000"  >&lt;p&gt;Just tested this with the latest Oracle database and JDBC driver (12.1.0.1) and it looks like this Oracle bug has been fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114614</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90454</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-337] equals in DelegatingXXX is not reflexive and could be faster</title>
                <link>https://issues.apache.org/jira/browse/DBCP-337</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The equals() methods in the different DelegatingXXX classes do not start with a simple object equality check for this.&lt;br/&gt;
The equals methods do not implement the contract for equals because x.equals&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; where getInnermostDelegate() for x returns null will return false.&lt;br/&gt;
Performance-wise the check would help since you don&apos;t need to walk the delegate tree.&lt;/p&gt;

&lt;p&gt;I will attach a patch.&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466690">DBCP-337</key>
            <summary>equals in DelegatingXXX is not reflexive and could be faster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rgansevles">Rob Gansevles</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jun 2010 20:49:55 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:06 +0000</updated>
                            <resolved>Thu, 28 Apr 2011 21:58:26 +0000</resolved>
                                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12877573" author="rgansevles" created="Thu, 10 Jun 2010 20:51:59 +0000"  >&lt;p&gt;this patch adds an &apos;==&apos; check as first statement to the equals() methods.&lt;br/&gt;
Patch is against trunk.&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="13026722" author="psteitz" created="Thu, 28 Apr 2011 21:58:26 +0000"  >&lt;p&gt;Patch with slight mods to the tests committed in r1097625&lt;br/&gt;
(trunk) and r1097630 (1.4 branch).&lt;/p&gt;

&lt;p&gt;Thanks for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12446795" name="delegate_equals_patch" size="3196" author="rgansevles" created="Thu, 10 Jun 2010 20:51:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114613</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-336] Incorect data from data base if connection pool size is minimum (say 1 to 3 )</title>
                <link>https://issues.apache.org/jira/browse/DBCP-336</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>
&lt;p&gt;   Environment:&lt;br/&gt;
   I have a sp which return data from data base according to a criteria and i put a sleep of 700 millisecond on sp . &lt;br/&gt;
   The connection pool configuration is very minimum compared to data accessing thread, then from multiple java thread i tried to access data for a time period of 30- 60 minute, also i put a query execution time out of 1 second, &lt;/p&gt;

&lt;p&gt;    The result is that&lt;br/&gt;
       Some thread have not get any data from db as there is not much available connection to db in pool and can see it from the exception log , it is OK.&lt;br/&gt;
     But the problem  is that after some period time (take 30 - 60 min)  data retrieved by  threads are incorrect, means data retrieved is, query result of some other thread.&lt;/p&gt;

&lt;p&gt;My connection pool configuration is here&lt;br/&gt;
-----------------------------------------------------------&lt;br/&gt;
  &amp;lt;property name=&quot;maxIdle&quot; value=&quot;3&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;poolInitialSize&quot; value=&quot;1&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;testOnBorrow&quot; value=&quot;true&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;maxStmts&quot; value=&quot;10&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;validationQuery&quot; value=&quot;SELECT 1&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;password&quot; value=&quot;*****&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;url&quot; value=&quot;jdbc:microsoft:sqlserver://192.168.29.222:1433;           DatabaseName=marketsummary&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;testOnReturn&quot; value=&quot;true&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;maxActive&quot; value=&quot;3&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;userId&quot; value=&quot;***&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;minIdle&quot; value=&quot;3&quot; description=&quot;String&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;maxWait&quot; value=&quot;1000&quot; description=&quot;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;property name=&quot;driver&quot; value=&quot;com.microsoft.jdbc.sqlserver.SQLServerDriver&quot; description=&quot;&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Please look in to this&lt;/p&gt;
</description>
                <environment>&lt;p&gt; java on linux and sql server 2005  db on windows &lt;/p&gt;</environment>
        <key id="12466350">DBCP-336</key>
            <summary>Incorect data from data base if connection pool size is minimum (say 1 to 3 )</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ronymsunny">Rony M Sunny</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Jun 2010 13:53:05 +0000</created>
                <updated>Thu, 21 Oct 2010 00:33:36 +0000</updated>
                            <resolved>Tue, 8 Jun 2010 13:23:06 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12876667" author="ronymsunny" created="Tue, 8 Jun 2010 12:56:20 +0000"  >&lt;p&gt;I am attaching a sample code which reproduce above mentioned bug (Incorrect data from DBCP connection pool)&lt;/p&gt;
</comment>
                            <comment id="12876674" author="markt" created="Tue, 8 Jun 2010 13:23:06 +0000"  >&lt;p&gt;You appear to have a threading issue in your application. This is not the correct place to get help. Please use the users mailing list.&lt;/p&gt;</comment>
                            <comment id="12877005" author="ronymsunny" created="Wed, 9 Jun 2010 09:26:27 +0000"  >&lt;p&gt;Dear Mark&lt;/p&gt;

&lt;p&gt;   I am very sorry to come with this issue and waisting your time,&lt;/p&gt;

&lt;p&gt;   The issue is due to the jdbc driver which i am using &lt;br/&gt;
&quot;com.microsoft.jdbc.sqlserver.SQLServerDriver&quot; now i migrate to new  &lt;br/&gt;
driver    &quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;  and issue was &lt;br/&gt;
solved.&lt;/p&gt;

&lt;p&gt;    With old driver an exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.sql.SQLException: &lt;span class=&quot;error&quot;&gt;&amp;#91;Microsoft&amp;#93;&lt;/span&gt;[SQLServer 2000 Driver for&lt;br/&gt;
JDBC]The operation was cancelled at the user&apos;s request. -&lt;br/&gt;
     occurs and after that incorrect data is getting from DB. I am &lt;br/&gt;
attaching that log with this mail.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;      Thanks very much for your support and again sorry for the &lt;br/&gt;
inconvenience from my side.&lt;/p&gt;

&lt;p&gt; Regards&lt;br/&gt;
 Rony M Sunny&lt;/p&gt;








&lt;p&gt;2010-06-09 14:36:06,149 DEBUG DBTest:59 - Got correct result  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;26&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,149 DEBUG DBTest:59 - Got correct result  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;23&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,164 DEBUG DBTest:59 - Got correct result  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;27&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,164 DEBUG DBTest:59 - Got correct result  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;22&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,180 ERROR ConnectionPool:147 - &lt;span class=&quot;error&quot;&gt;&amp;#91;12&amp;#93;&lt;/span&gt; Error in request data &lt;br/&gt;
java.sql.SQLException: &lt;span class=&quot;error&quot;&gt;&amp;#91;Microsoft&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQLServer 2000 Driver for JDBC&amp;#93;&lt;/span&gt;The operation was cancelled at the user&apos;s request.&lt;br/&gt;
        at com.microsoft.jdbc.base.BaseExceptions.createException(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.base.BaseExceptions.getException(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.sqlserver.tds.TDSRequest.processReplyToken(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.sqlserver.tds.TDSRPCRequest.processReplyToken(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.sqlserver.tds.TDSRequest.processReply(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.sqlserver.SQLServerImplStatement.getNextResultType(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.base.BaseStatement.commonTransitionToState(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.base.BaseStatement.postImplExecute(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.base.BasePreparedStatement.postImplExecute(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.base.BaseStatement.commonExecute(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.base.BaseStatement.executeQueryInternal(Unknown Source)&lt;br/&gt;
        at com.microsoft.jdbc.base.BasePreparedStatement.executeQuery(Unknown Source)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)&lt;br/&gt;
        at com.git.dbcp.ConnectionPool.requestData(ConnectionPool.java:141)&lt;br/&gt;
        at com.git.dbcp.DBTest$1.run(DBTest.java:51)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
2010-06-09 14:36:06,211 WARN  DBTest:57 - &lt;span class=&quot;error&quot;&gt;&amp;#91;13&amp;#93;&lt;/span&gt; ******** Got in correct data from pool  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;24&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,211 DEBUG DBTest:59 - Got correct result  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;29&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,211 DEBUG DBTest:59 - Got correct result  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;25&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,211 WARN  DBTest:57 - &lt;span class=&quot;error&quot;&gt;&amp;#91;14&amp;#93;&lt;/span&gt; ******** Got in correct data from pool  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;30&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24&amp;#93;&lt;/span&gt;] &lt;br/&gt;
2010-06-09 14:36:06,274 WARN  DBTest:57 - &lt;span class=&quot;error&quot;&gt;&amp;#91;23&amp;#93;&lt;/span&gt; ******** Got in correct data from pool  requessted scrip &lt;span class=&quot;error&quot;&gt;&amp;#91;24&amp;#93;&lt;/span&gt; reply [&lt;span class=&quot;error&quot;&gt;&amp;#91;25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25&amp;#93;&lt;/span&gt;] &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12446672" name="ASF.LICENSE.NOT.GRANTED--SQLException.log" size="3244" author="ronymsunny" created="Wed, 9 Jun 2010 09:26:28 +0000"/>
                            <attachment id="12446591" name="dbcpconnectionpooltest.zip" size="1024771" author="ronymsunny" created="Tue, 8 Jun 2010 12:56:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0en:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179039</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-335] NPE with MySQL PreparedStatement</title>
                <link>https://issues.apache.org/jira/browse/DBCP-335</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;My Grails application using MySQL and DBCP often throws an exception as below. I can trigger it by making a simultaneous requests (three at a time) on differend threads in a ThreadPoolExecutor. The requests would all use the same query. This triggers the exception with a few percent probability.&lt;/p&gt;

&lt;p&gt;I have tried with DBCP 1.2.2 and 1.4.&lt;/p&gt;

&lt;p&gt;There is a similar-looking &lt;a href=&quot;http://bugs.mysql.com/bug.php?id=41628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MySQL bug&lt;/a&gt; but they blame the pool...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;pool-1-thread-12&quot;&lt;/span&gt; java.lang.NullPointerException
        at com.mysql.jdbc.PreparedStatement.fillSendPacket(PreparedStatement.java:2475)
        at com.mysql.jdbc.PreparedStatement.fillSendPacket(PreparedStatement.java:2451)
        at com.mysql.jdbc.PreparedStatement.executeQuery(PreparedStatement.java:2205)
        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)
        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)
        at org.hibernate.jdbc.AbstractBatcher.getResultSet(AbstractBatcher.java:208)
        at org.hibernate.loader.Loader.getResultSet(Loader.java:1808)
        at org.hibernate.loader.Loader.doQuery(Loader.java:697)
        at org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:259)
        at org.hibernate.loader.Loader.loadEntity(Loader.java:1881)
        at org.hibernate.loader.entity.AbstractEntityLoader.load(AbstractEntityLoader.java:71)
        at org.hibernate.loader.entity.AbstractEntityLoader.load(AbstractEntityLoader.java:65)
        at org.hibernate.persister.entity.AbstractEntityPersister.load(AbstractEntityPersister.java:3072)
        at org.hibernate.event.def.DefaultLoadEventListener.loadFromDatasource(DefaultLoadEventListener.java:434)
        at org.hibernate.event.def.DefaultLoadEventListener.doLoad(DefaultLoadEventListener.java:415)
        at org.hibernate.event.def.DefaultLoadEventListener.load(DefaultLoadEventListener.java:165)
        at org.hibernate.event.def.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:121)
        at org.hibernate.impl.SessionImpl.fireLoad(SessionImpl.java:905)
        at org.hibernate.impl.SessionImpl.immediateLoad(SessionImpl.java:863)
        at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:95)
        at org.codehaus.groovy.grails.orm.hibernate.proxy.HibernateProxyHandler.unwrapProxy(HibernateProxyHandler.java:80)
        at org.codehaus.groovy.grails.orm.hibernate.cfg.GrailsHibernateUtil.unwrapProxy(GrailsHibernateUtil.java:322)
        at org.codehaus.groovy.grails.orm.hibernate.cfg.GrailsHibernateUtil$unwrapProxy.call(Unknown Source)
        at org.codehaus.groovy.grails.plugins.orm.hibernate.HibernatePluginSupport$__clinit__closure88.doCall(HibernatePluginSupport.groovy:401)
        at sun.reflect.GeneratedMethodAccessor381.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.codehaus.groovy.runtime.callsite.PogoMetaMethodSite$PogoCachedMethodSiteNoUnwrapNoCoerce.invoke(PogoMetaMethodSite.java:266)
        at org.codehaus.groovy.runtime.callsite.PogoMetaMethodSite.callCurrent(PogoMetaMethodSite.java:51)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:151)
        at org.codehaus.groovy.grails.plugins.orm.hibernate.HibernatePluginSupport$__clinit__closure88.call(HibernatePluginSupport.groovy)
        at sun.reflect.GeneratedMethodAccessor380.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:86)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:234)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1049)
        at groovy.lang.ExpandoMetaClass.invokeMethod(ExpandoMetaClass.java:923)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:880)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:924)
        at groovy.lang.ExpandoMetaClass.invokeMethod(ExpandoMetaClass.java:923)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:880)
        at org.codehaus.groovy.runtime.InvokerHelper.invokePogoMethod(InvokerHelper.java:739)
        at org.codehaus.groovy.runtime.InvokerHelper.invokeMethod(InvokerHelper.java:722)
        at org.codehaus.groovy.runtime.metaclass.ClosureMetaMethod$1.invoke(ClosureMetaMethod.java:135)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:234)
        at groovy.lang.MetaClassImpl.getProperty(MetaClassImpl.java:1594)
        at groovy.lang.ExpandoMetaClass.getProperty(ExpandoMetaClass.java:951)
        at groovy.lang.MetaClassImpl.getProperty(MetaClassImpl.java:3287)
        at groovy.lang.ExpandoMetaClass.getProperty(ExpandoMetaClass.java:964)
        at org.codehaus.groovy.runtime.callsite.PogoMetaClassGetPropertySite.getProperty(PogoMetaClassGetPropertySite.java:48)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callGroovyObjectGetProperty(AbstractCallSite.java:241)
        at org.example.MyService.onApplicationEvent(MyService.groovy:52)
        at org.example.MyService.onApplicationEvent(MyService.groovy)
        at org.springframework.context.event.SimpleApplicationEventMulticaster$1.run(SimpleApplicationEventMulticaster.java:92)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;CloudFoundry, Linux, Sun Java 1.6.0_04, Grails 1.2.2, MySQL Connector 5.1.12&lt;/p&gt;</environment>
        <key id="12465331">DBCP-335</key>
            <summary>NPE with MySQL PreparedStatement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="marcusb">Marcus Better</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 May 2010 04:06:03 +0000</created>
                <updated>Sat, 30 Apr 2011 17:49:06 +0000</updated>
                            <resolved>Sat, 30 Apr 2011 17:49:06 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12873920" author="bsp" created="Tue, 1 Jun 2010 08:29:06 +0000"  >&lt;p&gt;Marcus,&lt;/p&gt;

&lt;p&gt;In your example code DBCP is not used. If you have exceptions with provided example - it is not DBCP related.&lt;/p&gt;

&lt;p&gt;Anyway, if you need to periodicaly check if connection alive, it much better to use DBCP to do so. In fact, DBCP already has properties to check if connection alive:&lt;/p&gt;

&lt;p&gt;validationQuery - query used to validate connection&lt;br/&gt;
testWhileIdle - set to true to check connection while they are in the pool&lt;br/&gt;
timeBetweenEvictionRunsMillis - time between checks (and evictions)&lt;/p&gt;

&lt;p&gt;And one more thing about example. Personally i believe (IMHO) it is not correct to call Statement.execute() without synchronization.&lt;/p&gt;</comment>
                            <comment id="12873921" author="marcusb" created="Tue, 1 Jun 2010 08:50:36 +0000"  >&lt;p&gt;I didn&apos;t post any example code so I&apos;m not sure what you are referring to. And I am not trying to check if the connection is alive. The app is executing queries, and this happens at any time, also when all connetions are alive and well.&lt;/p&gt;

&lt;p&gt;In any case DBCP is used in my application, as is evident from the stack trace.&lt;/p&gt;</comment>
                            <comment id="12977428" author="psteitz" created="Tue, 4 Jan 2011 19:43:49 +0000"  >&lt;p&gt;Assuming the stack trace above is using DBCP 1.2.2, DBCP is propagating an exception thrown by driver.  This does not look like a DBCP bug to me.  Check to make sure multiple threads are not holding on to references to the same connections or statements.&lt;/p&gt;</comment>
                            <comment id="13027353" author="psteitz" created="Sat, 30 Apr 2011 17:49:06 +0000"  >&lt;p&gt;Please reopen if you can provide a test case showing that this is in fact a pool or dbcp bug.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114611</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179093</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-334] BasicDataSource does not consider the method &quot;setSoftMinEvictableIdleTimeMillis&quot; of CommonsPool.GenericObjectPool</title>
                <link>https://issues.apache.org/jira/browse/DBCP-334</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The BasicDataSource should have the &quot;softMinEvictableIdleTimeMillis&quot; (get and set) as the GenericObjectPool, to avoid destroying idle connections below the &quot;minIdle&quot; value. In this case, connections are dropped and immediately recreated with no reason. The &quot;minEvictableIdleTimeMillis&quot; should not be considered because there are ways to validate idle connections before they are used.&lt;/p&gt;

&lt;p&gt;The class should have these lines of code, besides those existing:&lt;br/&gt;
// property&lt;br/&gt;
	private long softMinEvictableIdleTimeMillis = GenericObjectPool.DEFAULT_SOFT_MIN_EVICTABLE_IDLE_TIME_MILLIS;&lt;br/&gt;
// getter&lt;br/&gt;
	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Returns the 
{@link #softMinEvictableIdleTimeMillis} property.&lt;br/&gt;
	 * @return the value of the {@link #softMinEvictableIdleTimeMillis}
&lt;p&gt; property&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;@see #softMinEvictableIdleTimeMillis&lt;br/&gt;
	 */&lt;br/&gt;
	public synchronized long getSoftMinEvictableIdleTimeMillis() 
{
		return softMinEvictableIdleTimeMillis;
	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;// setter&lt;br/&gt;
	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Sets the 
{@link #softMinEvictableIdleTimeMillis}
&lt;p&gt; property.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;@param softMinEvictableIdleTimeMillis the minimum amount of time an object&lt;/li&gt;
	&lt;li&gt;may sit idle in the pool&lt;/li&gt;
	&lt;li&gt;@see #softMinEvictableIdleTimeMillis&lt;br/&gt;
	 */&lt;br/&gt;
	public synchronized void setSoftMinEvictableIdleTimeMillis(final long softMinEvictableIdleTimeMillis) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {		this.softMinEvictableIdleTimeMillis = softMinEvictableIdleTimeMillis;		if (connectionPool != null) {
			connectionPool.setSoftMinEvictableIdleTimeMillis(softMinEvictableIdleTimeMillis);
		}	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;// creator of the pool&lt;br/&gt;
	@Override protected void createConnectionPool() &lt;/p&gt;
{
		super.createConnectionPool();
		connectionPool.setSoftMinEvictableIdleTimeMillis(softMinEvictableIdleTimeMillis);
	}

&lt;p&gt;I implemented myself a &quot;NotSoBasicDataSource&quot; class, inheriting from &quot;BasicDataSource&quot; and used it in a single test. It worked: idle connections do not decrease under (and re-grow to) &quot;minIdle&quot;.&lt;br/&gt;
Please, consider this feature, because it can save resources.&lt;br/&gt;
I don&apos;t know what is the behavior of the Tomcat DBCP, but it seems to me it has the same problem.&lt;/p&gt;

&lt;p&gt;I&apos;m waiting your opinions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12464688">DBCP-334</key>
            <summary>BasicDataSource does not consider the method &quot;setSoftMinEvictableIdleTimeMillis&quot; of CommonsPool.GenericObjectPool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="alberto.mozzone">Alberto Mozzone</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 May 2010 16:03:51 +0000</created>
                <updated>Fri, 20 May 2016 10:49:43 +0000</updated>
                            <resolved>Mon, 2 May 2011 02:00:36 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>1.2.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13027525" author="psteitz" created="Mon, 2 May 2011 02:00:36 +0000"  >&lt;p&gt;Fixed in trunk (r1098458) and 1.4 branch (r1098459).&lt;/p&gt;

&lt;p&gt;Thanks for the patch!&lt;/p&gt;</comment>
                            <comment id="13027572" author="alberto.mozzone" created="Mon, 2 May 2011 07:37:35 +0000"  >&lt;p&gt;You&apos;re welcome! I&apos;m always glad to contribute!&lt;br/&gt;
I was waiting for this patch for a long time: could you please tell in which version of Tomcat will it be distributed?&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="15293164" author="marks" created="Fri, 20 May 2016 10:49:43 +0000"  >&lt;p&gt;This issue was closed over 5 years ago... but the versions in which the defect was fixed (1.3.1 &amp;amp; 1.4.1) have yet to be released.  Or is there a missing fix version on this JIRA issue.  2.0 perhaps?&lt;/p&gt;

&lt;p&gt;Note that the same problem afflicts a couple of other issues as well:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-371&quot; title=&quot;DelegatingDatabaseMetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-371&quot;&gt;&lt;del&gt;DBCP-371&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-421&quot; title=&quot;java.sql.SQLException: Closed Connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-421&quot;&gt;DBCP-421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The latter is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-330&quot; title=&quot;Calling getMetaData() without closing the connection lead to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-330&quot;&gt;&lt;del&gt;DBCP-330&lt;/del&gt;&lt;/a&gt; but the affected versions differ between the two issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114610</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-333] Unable to create a JDBC driver using custom class loader</title>
                <link>https://issues.apache.org/jira/browse/DBCP-333</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I&apos;m unable to instantiate my JDBC driver using a custom class loader:&lt;br/&gt;
        BasicDataSource ds = new BasicDataSource();&lt;br/&gt;
        String connectURL = &quot;jdbc:mysql://&quot;&lt;ins&gt;config.getHost()&lt;/ins&gt;&quot;/&quot;+config.getDatabaseName();&lt;br/&gt;
        ds.setDriverClassName(MySQLStore.MYSQL_DRIVER);&lt;br/&gt;
        ds.setDriverClassLoader(config.getClass().getClassLoader());&lt;br/&gt;
        .....&lt;/p&gt;

&lt;p&gt;Having a look at the org.apache.commons.dbcp.BasicDataSource.createConnectionFactory() method implementation, I found that the class loader is actually ignored. In the first part of the method there is an attempt to load the class that seems to pass successfully, but the loaded class is not assigned to the driverFromCCL variable:&lt;br/&gt;
            if (driverClassLoader == null) &lt;/p&gt;
{
                 Class.forName(driverClassName);
            }
&lt;p&gt; else &lt;/p&gt;
{
                 Class.forName(driverClassName, true, driverClassLoader);
            }

&lt;p&gt;Then in the second part of the method driverFromCCL is still null and instead of instantiating the driver directly, DriverManager.getDriver(url) is called, which fails:&lt;br/&gt;
            if (driverFromCCL == null) &lt;/p&gt;
{
                driver = DriverManager.getDriver(url);
            }
&lt;p&gt; else {&lt;br/&gt;
                // Usage of DriverManager is not possible, as it does not&lt;br/&gt;
                // respect the ContextClassLoader&lt;br/&gt;
                driver = (Driver) driverFromCCL.newInstance();&lt;br/&gt;
                if (!driver.acceptsURL(url)) &lt;/p&gt;
{
                    throw new SQLException(&quot;No suitable driver&quot;, &quot;08001&quot;); 
                }
&lt;p&gt;            }&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;br/&gt;
Krasimir&lt;/p&gt;</description>
                <environment></environment>
        <key id="12463657">DBCP-333</key>
            <summary>Unable to create a JDBC driver using custom class loader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markt">Mark Thomas</assignee>
                                    <reporter username="krasimir_nedkov">Krasimir Nedkov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 May 2010 12:08:15 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:19 +0000</updated>
                            <resolved>Tue, 22 Mar 2011 20:46:27 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12935314" author="dencel" created="Wed, 24 Nov 2010 13:04:46 +0000"  >&lt;p&gt;Hello, I have the same problem. Please update BasicDataSource.java. &lt;/p&gt;

&lt;p&gt;Change line 1417: &lt;br/&gt;
Class.forName(driverClassName, true, driverClassLoader);&lt;br/&gt;
To: &lt;br/&gt;
 driverFromCCL = driverClassLoader.loadClass(driverClassName);&lt;/p&gt;</comment>
                            <comment id="12935389" author="joehni" created="Wed, 24 Nov 2010 16:26:40 +0000"  >&lt;p&gt;@Dennie: Sun explicitly stated that Class.forName is recommended (&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6500212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6500212&lt;/a&gt;) and I cannot see what it changes regarding the reported bug.&lt;/p&gt;</comment>
                            <comment id="12935843" author="masterobjects" created="Thu, 25 Nov 2010 19:17:59 +0000"  >&lt;p&gt;We ran into the same issue. I can confirm that Dennie de Lange&apos;s suggested code modification in line 1417 works fine.&lt;/p&gt;</comment>
                            <comment id="12935850" author="psteitz" created="Thu, 25 Nov 2010 19:37:02 +0000"  >&lt;p&gt;Thanks for the report and comments.  Patch looks good to me. &lt;/p&gt;</comment>
                            <comment id="12965312" author="sebb@apache.org" created="Tue, 30 Nov 2010 18:02:49 +0000"  >&lt;p&gt;What about the line a bit earlier which is called if driverClassLoader == null:&lt;/p&gt;

&lt;p&gt;Class.forName(driverClassName);&lt;/p&gt;

&lt;p&gt;In that case, driverFromCCL won&apos;t be initialised either.&lt;/p&gt;

&lt;p&gt;It&apos;s not clear to me what the code is trying to achieve, but at least at present it is self-consistent.&lt;br/&gt;
Replacing only one of the Class.forName() calls does not seem correct to me.&lt;/p&gt;

&lt;p&gt;==&lt;/p&gt;

&lt;p&gt;Also, why not replace:&lt;/p&gt;

&lt;p&gt;Class.forName(driverClassName, true, driverClassLoader);&lt;/p&gt;

&lt;p&gt;with&lt;/p&gt;

&lt;p&gt;driverFromCCL = Class.forName(driverClassName, true, driverClassLoader);&lt;/p&gt;

&lt;p&gt;Would that not work just as well? Similarly for &lt;/p&gt;

&lt;p&gt;Class.forName(driverClassName);&lt;/p&gt;

&lt;p&gt;==&lt;/p&gt;

&lt;p&gt;The method could do with some Javadoc TLC to explain when the URL is used, and when the classname is used.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12357573">DBCP-203</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114609</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170413</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-332] Closing BasicDataSource doesn&apos;t deregister JDBC driver, causing memory leak</title>
                <link>https://issues.apache.org/jira/browse/DBCP-332</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;BasicDataSource&apos;s method close() doesn&apos;t deregister JDBC driver. This causes permgen memory leaks in web server environments, during context reloads. For example, using Tomcat 6.0.26 with Spring, and BasicDataSource declared in Spring context, there is a message printed at web application reload:&lt;/p&gt;

&lt;p&gt;SEVERE: A web application registered the JBDC driver &lt;span class=&quot;error&quot;&gt;&amp;#91;com.mysql.jdbc.Driver&amp;#93;&lt;/span&gt; but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.&lt;/p&gt;

&lt;p&gt;I was able to fix it by overriding close method this way:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;XBasicDataSource &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; BasicDataSource {
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void close() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        DriverManager.deregisterDriver(DriverManager.getDriver(url));
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.close();
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but I think it should be probably the default behavior of BasicDataSource. Or perhaps there should be some flag/setting on BasicDataSource, named &quot;deregisterDriverAtClose&quot; or so.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12462930">DBCP-332</key>
            <summary>Closing BasicDataSource doesn&apos;t deregister JDBC driver, causing memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="grzegorzborkowski">Grzegorz Borkowski</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 Apr 2010 17:41:35 +0000</created>
                <updated>Tue, 24 Feb 2015 08:31:21 +0000</updated>
                            <resolved>Fri, 7 Feb 2014 17:15:22 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                                        <due></due>
                            <votes>20</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="12861643" author="psteitz" created="Wed, 28 Apr 2010 01:57:38 +0000"  >&lt;p&gt;Could this be a regression introduced by the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-272&quot; title=&quot;Contention for DriverManager when initializing multiple datasources &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-272&quot;&gt;&lt;del&gt;DBCP-272&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="12861714" author="grzegorzborkowski" created="Wed, 28 Apr 2010 07:59:58 +0000"  >&lt;p&gt;I don&apos;t think so. &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-272&quot; title=&quot;Contention for DriverManager when initializing multiple datasources &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-272&quot;&gt;&lt;del&gt;DBCP-272&lt;/del&gt;&lt;/a&gt; talks about initialization process - when and how driver should be registered, from what I see. But the net result is the same: driver gets registered. &lt;br/&gt;
Here I mean the fact, the it is not unregistered during closing the SimpleDataSource - which causes memory leak, and Tomcat complains about it.&lt;/p&gt;</comment>
                            <comment id="12861770" author="sebb@apache.org" created="Wed, 28 Apr 2010 11:16:20 +0000"  >&lt;p&gt;Is it possible for multiple data sources to register the same driver?&lt;/p&gt;

&lt;p&gt;If so, won&apos;t deregistering it in one cause problems for the others?&lt;/p&gt;</comment>
                            <comment id="12861774" author="grzegorzborkowski" created="Wed, 28 Apr 2010 11:33:21 +0000"  >&lt;p&gt;If they all use the same classloader, than probably yes, this could cause the problem - it needs verification, but it sounds logical. If that&apos;s the case, than it would be better to make this behavior optional. So add the method &quot;deregisterDriver&quot; to BasicDataSource so that I can call it from some listener programatically. Also, add settings &quot;deregisterDriverOnClose&quot;, so that I can set up BasicDataSource, for example in Spring, with this option set to true, so that it dergisters the driver automatically, and I don&apos;t have to write any code, only by pure configuration.&lt;/p&gt;</comment>
                            <comment id="12865123" author="zucchetti" created="Fri, 7 May 2010 12:31:03 +0000"  >&lt;p&gt;In which Tomcat version it has been corrected ? 6.0.25 ?&lt;/p&gt;</comment>
                            <comment id="12865125" author="grzegorzborkowski" created="Fri, 7 May 2010 12:33:53 +0000"  >&lt;p&gt;6.0.24&lt;/p&gt;</comment>
                            <comment id="12865128" author="zucchetti" created="Fri, 7 May 2010 12:45:12 +0000"  >&lt;p&gt;I have Tomcat 6.0.24 and in my catalina.log i see this error:&lt;/p&gt;

&lt;p&gt;A web application registered the JBDC driver &lt;span class=&quot;error&quot;&gt;&amp;#91;com.microsoft.sqlserver.jdbc.SQLServerDriver&amp;#93;&lt;/span&gt; but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.&lt;br/&gt;
A web application appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-4&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak.&lt;/p&gt;</comment>
                            <comment id="12870563" author="grzegorzborkowski" created="Mon, 24 May 2010 10:42:21 +0000"  >&lt;p&gt;@Daniele:  what you see in Tomcat logs means that Tomcat sees that there is memory leak, and it tries to prevent it. In earlier Tomcat versions, you wouldn&apos;t see it.&lt;/p&gt;</comment>
                            <comment id="12870567" author="grzegorzborkowski" created="Mon, 24 May 2010 10:55:05 +0000"  >&lt;p&gt;I&apos;ve discovered one problem with unregistering SQL driver in BasicDataSource.close() method: if you create the BasicDataSource, retrieve connection, close connection, than close BDS, and than create new instance of BDS, and try to obtain connection, it will not work: it will complain that it can&apos;t find proper driver for given URL. I haven&apos;t had time to investigate it, but I guess that driver registration is done somehow statically, at class loading. So after you deregister driver and create new instance of BDS, driver is not registered again, because no classlodin is done at that moment. That&apos;s my guess at least. As a solution, the BDS could try to register manually the driver (using java.sql.DriverManager.registerDriver) whenever first attempt to obtain driver fails.&lt;/p&gt;</comment>
                            <comment id="13894739" author="markt" created="Fri, 7 Feb 2014 17:15:22 +0000"  >&lt;p&gt;I&apos;ve been thinking about this and there are enough use cases where you don&apos;t want this to happen - a number of them articulated in this bug report - that I think that it makes more sense to leave de-registration of the JDBC driver as a client responsibility. It is much easier for the client to de-register the driver when it knows it is safe to do so than it is to add a bunch of configuration options and other complexity to DBCP.&lt;/p&gt;</comment>
                            <comment id="14334593" author="sslavic" created="Tue, 24 Feb 2015 08:31:21 +0000"  >&lt;p&gt;It would be nice to document this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90455</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-330] Calling getMetaData() without closing the connection lead to a memory leak</title>
                <link>https://issues.apache.org/jira/browse/DBCP-330</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;In my program, I am using a BasicDataSource to get my database connections. I have to keep one of the connection alive and thus never close it. On this connection, I have to periodically get the metadata (call the getMetaData() method) for my processing.&lt;br/&gt;
However, I have noticed that each call to this method create a new DelegatingDatabaseMetaData instance which can&apos;t be garbage collected until the connection is closed. This creation of DelegatingDatabaseMetaData will finally consume all the memory and generate a OutOfMemory error.&lt;/p&gt;

&lt;p&gt;Actually, in it&apos;s constructor, the DelegatingDatabaseMetaData class calls its super constructor (from the AbandonedTrace class) which creates a reference (parent.addTrace(this)&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from the connection to the DelegatingDatabaseMetaData. This reference prevent the DelegatingDatabaseMetaData to be collected until the Connection is closed.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux Mint 8 Helena - Universal Edition&lt;/p&gt;

&lt;p&gt;Linux version 2.6.31-14-generic (buildd@rothera) (gcc version 4.4.1 (Ubuntu 4.4.1-4ubuntu8) ) #48-Ubuntu SMP Fri Oct 16 14:04:26 UTC 2009&lt;/p&gt;

&lt;p&gt;java version &quot;1.6.0_15&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_15-b03)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 14.1-b02, mixed mode, sharing)&lt;/p&gt;</environment>
        <key id="12462025">DBCP-330</key>
            <summary>Calling getMetaData() without closing the connection lead to a memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="marett">Timothee Maret</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Apr 2010 09:44:42 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:11 +0000</updated>
                            <resolved>Sat, 23 Apr 2011 23:56:47 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12856844" author="psteitz" created="Wed, 14 Apr 2010 11:27:32 +0000"  >&lt;p&gt;Thanks for reporting this.  It looks to me like there is no need for DelegatingDatabaseMetaData to extend AbandonedTrace.  The methods that open resultsets wire them to the underlying connection themselves - i.e., there is no need to insert the DelegatingDatabaseMetaData itself into the associated connection&apos;s trace.  So as a fix, I propose:&lt;/p&gt;

&lt;p&gt;1) Add a comment indicating that in 2.0, this class will no longer extend AbandonedTrace&lt;br/&gt;
2) In the constructor, replace super(c) with super()&lt;/p&gt;</comment>
                            <comment id="12993015" author="derekhulley" created="Thu, 10 Feb 2011 11:41:07 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-352&quot; title=&quot;Repeated calls to getMetadata in a transaction leads to performance degredation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-352&quot;&gt;&lt;del&gt;DBCP-352&lt;/del&gt;&lt;/a&gt; patch and test results.&lt;/p&gt;</comment>
                            <comment id="12994707" author="marett" created="Tue, 15 Feb 2011 09:05:48 +0000"  >&lt;p&gt;Hi, I have successfully tested the patch on my setup. I have monitored the memory consumption with jprofiler, the DelegatingDatabaseMetaData objects get properly garbage collected. thanks!&lt;/p&gt;</comment>
                            <comment id="13023618" author="psteitz" created="Sat, 23 Apr 2011 23:56:47 +0000"  >&lt;p&gt;Fixed in trunk (r1096260) and 1_4 branch (r1096259).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12497342">DBCP-352</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tjan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170435</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-329] SQLException: Already closed.</title>
                <link>https://issues.apache.org/jira/browse/DBCP-329</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;After upgrading to 1.4 I see such exceptions logged:&lt;br/&gt;
java.sql.SQLException: Already closed.&lt;br/&gt;
	at org.apache.commons.dbcp.PoolableConnection.close(PoolableConnection.java:114)&lt;br/&gt;
	at org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.close(PoolingDataSource.java:191)&lt;br/&gt;
	...&lt;/p&gt;

&lt;p&gt;This should never happen. According to the Connection.close() javadoc: &lt;br/&gt;
&quot;Calling the method close on a Connection object that is already closed is a no-op.&quot;&lt;/p&gt;

&lt;p&gt;Moreover, I am pretty sure that our code does not close the connection twice. But because the close() is called in a finally block, it is possible that this exception hides another exception. Unfortunately I cannot reproduce it, even though it occurs regularly.&lt;/p&gt;</description>
                <environment>&lt;p&gt;MySQL&lt;/p&gt;</environment>
        <key id="12460477">DBCP-329</key>
            <summary>SQLException: Already closed.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hontvari">Hontv&#225;ri J&#243;zsef Levente</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Mar 2010 20:17:17 +0000</created>
                <updated>Tue, 30 Mar 2010 13:06:18 +0000</updated>
                            <resolved>Tue, 30 Mar 2010 01:19:48 +0000</resolved>
                                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12850936" author="hontvari" created="Mon, 29 Mar 2010 14:53:04 +0000"  >&lt;p&gt;I inserted some additional logging to debug this case, and indeed it hides another exception:&lt;br/&gt;
com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure&lt;/p&gt;

&lt;p&gt;The last packet successfully received from the server was 8,064,672 milliseconds ago.  The last packet sent successfully to the server was 8,064,672 milliseconds ago.&lt;br/&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)&lt;br/&gt;
	at java.lang.reflect.Constructor.newInstance(Constructor.java:513)&lt;br/&gt;
	at com.mysql.jdbc.Util.handleNewInstance(Util.java:409)&lt;br/&gt;
	at com.mysql.jdbc.SQLError.createCommunicationsException(SQLError.java:1122)&lt;br/&gt;
	at com.mysql.jdbc.MysqlIO.send(MysqlIO.java:3317)&lt;br/&gt;
	at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1941)&lt;br/&gt;
	at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2114)&lt;br/&gt;
	at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2696)&lt;br/&gt;
	at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:2105)&lt;br/&gt;
	at com.mysql.jdbc.PreparedStatement.executeQuery(PreparedStatement.java:2264)&lt;br/&gt;
	at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)&lt;br/&gt;
	at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)&lt;br/&gt;
	at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96)&lt;br/&gt;
	...&lt;br/&gt;
Caused by: java.net.SocketException: Connection reset by peer: socket write error&lt;br/&gt;
	at java.net.SocketOutputStream.socketWrite0(Native Method)&lt;br/&gt;
	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)&lt;br/&gt;
	at java.net.SocketOutputStream.write(SocketOutputStream.java:136)&lt;br/&gt;
	at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)&lt;br/&gt;
	at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)&lt;br/&gt;
	at com.mysql.jdbc.MysqlIO.send(MysqlIO.java:3298)&lt;br/&gt;
	... 34 common frames omitted&lt;/p&gt;

&lt;p&gt;So the latter exception is not related to DBCP, only the &quot;already closed&quot; in my original report.&lt;/p&gt;</comment>
                            <comment id="12850940" author="pbenedict" created="Mon, 29 Mar 2010 15:05:19 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This should never happen. According to the Connection.close() javadoc:&lt;br/&gt;
&quot;Calling the method close on a Connection object that is already closed is a no-op.&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I grant you that, but you&apos;re reading the spec wrong. If you already called close() on the socket, then calling it again should do nothing. However, your situation is different: the other side of the socket closed the socket. Java has no way of knowing whether that occurred except by reading or writing the socket again and then failing. Google this subject and you will find the same answer.&lt;/p&gt;</comment>
                            <comment id="12850960" author="hontvari" created="Mon, 29 Mar 2010 16:15:53 +0000"  >&lt;p&gt;That is true. But I still feel the message is not right. The original exception which was hidden by the &quot;Already closed&quot; exception is relatively clear (assuming that you know the less then ideal MySQL behaviour regarding closing unused connections.) I guess what happens here is that when in a previous operation an exception was thrown, DBCP declares that the connection is closed. &lt;br/&gt;
There is two cases, depending on how  DBCP works:&lt;br/&gt;
1) If it does try to connect the database on the close() operation, then it should throw the real exception. Like the hidden exception: jdbc4.CommunicationsException with message &quot;Communications link failure&quot;. This is as informative as it could be (it is the responsibility of MySQL that it cannot be more informative).&lt;br/&gt;
2) If I am right, it does not connect the database on close(). It already knows that it was itself who declared that the connection was broken, and it already thrown an exception in a previous operation. We could very well say that DBCP was the one who &quot;closed&quot; the broken connection. In this case it should not throw another exception. I think that is in line with the intent of the Java specification, and DBCP has all necessary informations which allows this behavior.&lt;/p&gt;

&lt;p&gt;If we look at from another viewpoint I think this usage pattern should work (and it worked before):&lt;br/&gt;
void fn() throws SQLException&lt;br/&gt;
{&lt;br/&gt;
  Connection connection = ....&lt;br/&gt;
  try &lt;/p&gt;
{
    connection.doSomething();
  }
&lt;p&gt; finally &lt;/p&gt;
{
    connection.close();
  }
&lt;p&gt;}&lt;br/&gt;
Currently this throws the misleading &quot;Already closed.&quot; exception instead of the more informative jdbc4.CommunicationsException.&lt;/p&gt;</comment>
                            <comment id="12851196" author="psteitz" created="Tue, 30 Mar 2010 01:18:10 +0000"  >&lt;p&gt;When you invoke the close method on a connection managed by DBCP, you are asking DBCP to return it to the pool.  Before returning a connection to the pool, DBCP  issues the JDBC driver call, _conn.isClosed() on the underlying physical connection to make sure that it is still open.  If the driver returns false, something bad has happened, because DBCP thinks the connection is open and the driver is reporting that it is closed.  In this case, the exception that you are observing is thrown.  Your own exception handler is masking the exception that your code encountered trying to use the connection that had been closed on the server side.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;http://markmail.org/message/c2gx2xuzum4pv743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/c2gx2xuzum4pv743&lt;/a&gt; for discussion of a similar issue.  If anyone feels that DBCP should be modified to silently dispose of bad connections returned to the pool, please reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-193&quot; title=&quot;BasicDataSource returns negative values for NumActive when Oracle Driver Connection#isClosed return true (End of file communication on CHannel)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-193&quot;&gt;&lt;del&gt;DBCP-193&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</comment>
                            <comment id="12851198" author="psteitz" created="Tue, 30 Mar 2010 01:19:48 +0000"  >&lt;p&gt;Duplicates &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-193&quot; title=&quot;BasicDataSource returns negative values for NumActive when Oracle Driver Connection#isClosed return true (End of file communication on CHannel)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-193&quot;&gt;&lt;del&gt;DBCP-193&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12851240" author="pbenedict" created="Tue, 30 Mar 2010 04:22:06 +0000"  >&lt;p&gt;Phil, you piqued my interest. Let&apos;s say a production database crashes during the day (my company is familiar with it!), which naturally kills all connections. The crash happened in-between the last good operation but before the close(). Do you intend an exception to propagate to the caller who is now finished with the database? Just seems like an unnecessary hassle. Any further thoughts?&lt;/p&gt;</comment>
                            <comment id="12851355" author="jwcarman" created="Tue, 30 Mar 2010 11:06:45 +0000"  >&lt;p&gt;Wouldn&apos;t a lot of this be solved by using a validation query (and test-on-borrow)?&lt;/p&gt;</comment>
                            <comment id="12851356" author="psteitz" created="Tue, 30 Mar 2010 11:10:20 +0000"  >&lt;p&gt;Honestly, I am ambivalent on this.  I can see the argument on both sides.  The use case reported here is another good example of one in which the client would prefer silent disposal - close in a finally block after the badness has been encountered on use.  On the other hand, I can see situations where the client really would like to know about these events.&lt;/p&gt;

&lt;p&gt;What do you think, Paul?  Other opinions?&lt;/p&gt;</comment>
                            <comment id="12851360" author="psteitz" created="Tue, 30 Mar 2010 11:23:43 +0000"  >&lt;p&gt;James: good point, but the answer is &quot;not exactly.&quot;  The check on isClosed() that I mentioned above happens &lt;b&gt;before&lt;/b&gt; the connection is returned to the pool (in the pool lifecycle, before passivate happens).   What it comes down to is do we want to let the client know (via an exception) as soon as we detect the condition that one of the connections handled by the pool has been closed externally.  The reasonable alternative behavior be to &quot;silently&quot; dispose of the connection wrapper and exit close normally.  One reason to let the client know about this is that DBCP in this case is not fulfilling any of its normal &quot;close&quot; contract cleanup actions (rollbacks, etc.). &lt;/p&gt;</comment>
                            <comment id="12851384" author="hontvari" created="Tue, 30 Mar 2010 13:02:16 +0000"  >&lt;p&gt;&amp;gt;If the driver returns false, something bad has happened, because DBCP thinks the connection is open and the driver is reporting that it is closed.&lt;/p&gt;

&lt;p&gt;As I see two kind of bad thing could have happened:&lt;br/&gt;
1) There was an exception in a previous operation on the connection. DBCP know about this fact, as DBCP is part of the call chain. The client code also knows about that exception, moreover, that exception contains relevant information about the problem. There is no need to issue a secondary exception on close() which does not add information (or actually mislead).&lt;br/&gt;
2) The client code closed the underlying connection. &lt;br/&gt;
That may indicate a bug, but you have to work hard to make this bug, you need to access the underlying connection and then close it. It is also possible that is is not a bug: the client code itself closes the underlying connection after using it because for example some problem happened. In this case it is a feature if DBCP does check isClosed and acknowledges it by not throwing an exception.&lt;br/&gt;
3) (A third possibility could be that the client borrowed the connection and does not use it. But in this case the client is not interested in the state of the is connection at all) &lt;/p&gt;

&lt;p&gt;Here is the template code which should be used if the current behavior remains:&lt;br/&gt;
Connection connection = ...&lt;br/&gt;
try {&lt;br/&gt;
  connection.doSomething();&lt;br/&gt;
} finally {&lt;br/&gt;
  try &lt;/p&gt;
{
    connection.close();
  }
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
    logger.warn(&quot;Close was not successful. This is likely caused by another exception, look at later log entries.&quot;, e);
  }
&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="12851386" author="pbenedict" created="Tue, 30 Mar 2010 13:06:18 +0000"  >&lt;p&gt;My employer does high-transaction processing &amp;#8211; about 2 million real-time invocations a day &amp;#8211; and are also on a mainframe where they pay for processor usage. They prohibit a validation query since it would cost 2 million more SQL statements a day. In an emergency reboot, connections are left hanging and each one throws an exception until the pool is re-cleared. It would be nice to see an option where a stale connection (exception from isClose()?) refreshes the entire pool.&lt;/p&gt;

&lt;p&gt;I agree with Phi. There&apos;s no right answer except what is right for you. I think we should support some configuration option where either (1) silent disposal (2) throw exception and (3) refresh the pool.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v03z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178991</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-328] exponential wait when requesting connections while the database is down</title>
                <link>https://issues.apache.org/jira/browse/DBCP-328</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;2 problems in one but they are very related:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;When the database is down (the actual server/machine, not the MySQL instance) the JDBC driver will wait &lt;tt&gt;connectTimeout&lt;/tt&gt; before timing out. &lt;tt&gt;BasicDataSource.createDataSource()&lt;/tt&gt;, which calls &lt;tt&gt;validateConnectionFactory()&lt;/tt&gt; when it initializes, is synchronized. So each threads are waiting on the synchronize lock so they can all then wait &lt;tt&gt;connectTimeout&lt;/tt&gt; before finally timing out.&lt;br/&gt;
Imagine a 5sec &lt;tt&gt;connectTimeout&lt;/tt&gt; and 10 concurrent theads, the last thread will timeout after roughly 50 seconds.&lt;/li&gt;
	&lt;li&gt;Similarly when the database dies (again the actual server/machine, not the instance), after &lt;tt&gt;BasicDataSource&lt;/tt&gt; has initialized, the JDBC driver will again wait &lt;tt&gt;connectTimeout&lt;/tt&gt; before timing out when new connections are created to grown the pool. &lt;tt&gt;PoolableConnectionFactory#makeObject()&lt;/tt&gt;, which calls &lt;tt&gt;createConnection()&lt;/tt&gt;, is also synchronized causing the same exponential wait for any threads requesting a connection from the pool.&lt;br/&gt;
Maybe I should explain that Connector/J closes the actual connection when it detects a communication failure with the database, and the connection is then removed from the pool. So when the database server dies the pool gets depleted and new connections need to be created.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I am not sure how to address #1 easily but #2 can be addressed by calling &lt;tt&gt;createConnection()&lt;/tt&gt; outside of any locks.&lt;br/&gt;
For example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public Object makeObject() throws Exception {
        ConnectionFactory connFactory;
        KeyedObjectPoolFactory stmtPoolFactory;
        ObjectPool pool;
        synchronized (this) {
            connFactory = _connFactory;
            stmtPoolFactory = _stmtPoolFactory;
            pool = _pool;
        }
        Connection conn = connFactory.createConnection();
        if(null != stmtPoolFactory) {
            KeyedObjectPool stmtpool = stmtPoolFactory.createPool();
            conn = new PoolingConnection(conn,stmtpool);
            stmtpool.setFactory((PoolingConnection)conn);
        }
        return new PoolableConnection(conn,pool,_config);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Although there may be some problem if the pool is swapped while creating a connection...&lt;/p&gt;

&lt;p&gt;See also dbcp-300.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tomcat Apache 5.5.28&lt;br/&gt;
MySQL 5.1 / Connector/J 5.1.5&lt;br/&gt;
JDK 1.5.0_22&lt;/p&gt;</environment>
        <key id="12460362">DBCP-328</key>
            <summary>exponential wait when requesting connections while the database is down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nbrachet@gmail.com">Nick Brachet</reporter>
                        <labels>
                            <label>tomcat</label>
                    </labels>
                <created>Fri, 26 Mar 2010 14:54:09 +0000</created>
                <updated>Mon, 29 Mar 2010 20:53:45 +0000</updated>
                            <resolved>Mon, 29 Mar 2010 20:53:45 +0000</resolved>
                                    <version>1.2.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12851086" author="psteitz" created="Mon, 29 Mar 2010 20:53:45 +0000"  >&lt;p&gt;Duplicates &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-300&quot; title=&quot;remove synchronize access of createDataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-300&quot;&gt;&lt;del&gt;DBCP-300&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114605</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 32 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178971</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-327] XAConnection is not closed</title>
                <link>https://issues.apache.org/jira/browse/DBCP-327</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;After creation of connection in DataSourceXAConnectionFactory::createConnection() the instance of XAConnection is ready to be garbage collected. But in MySQL Connector/J this instance holds the real physiscal connection to MySQL server. Thus, simple test case (in attach) opens 2 connections to server and the first one can be considered as &quot;leak&quot;.&lt;/p&gt;

&lt;p&gt;The possible solution is to close &quot;parent&quot; XA connection as soon as &quot;child&quot; Connection is closed as well. Due to compatibility issues it may be an option for BasicManagerDataSource. However, Derby seems okay with both variants (according to my test cases with JOTM/Hibernate/Derby/DBCP(+-patch))&lt;/p&gt;

&lt;p&gt;In the attachment - &quot;manual&quot; test case, since i don&apos;t know how to count real MySQL connection number in runtime. When BasicManagedDataSource is used (change it at ~43) we can create breakpoint at line &quot;connection.close();&quot; (~115). According to MySQL Administrator there are 2 connections, but according to pool - only one. If BasicManagedDataSourceXAClose is used - first connection correclty closed.&lt;/p&gt;

&lt;p&gt;This issue created serious problems in out production system, but, due to existing workaround (replace BasicManagedDataSource and DataSourceXAConnectionFactory) priority is minor.&lt;/p&gt;</description>
                <environment>&lt;p&gt;MySQL Connector/J 5.1.12; JOTM 2.1.9; propesed solution is tested with Derby 10.5.3.0_1 as well&lt;/p&gt;</environment>
        <key id="12459640">DBCP-327</key>
            <summary>XAConnection is not closed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bsp">Sergey Vladimirov</reporter>
                        <labels>
                            <label>connection</label>
                            <label>leak</label>
                            <label>mysql</label>
                            <label>transactions</label>
                            <label>xa</label>
                    </labels>
                <created>Fri, 19 Mar 2010 12:33:07 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:22 +0000</updated>
                            <resolved>Sun, 2 Feb 2014 20:49:45 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.3.1</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="28800">8h</timeoriginalestimate>
                            <timeestimate seconds="28800">8h</timeestimate>
                                        <comments>
                            <comment id="13034426" author="panghy" created="Mon, 16 May 2011 23:38:38 +0000"  >&lt;p&gt;Not sure what&apos;s the workaround stated in the description is (other than to not use DBCP). Basically, one cannot use XA mySQL connections with DBCP if this bug is not fixed (since connections will never be closed properly).&lt;/p&gt;</comment>
                            <comment id="13634491" author="fguillaume" created="Wed, 17 Apr 2013 21:57:16 +0000"  >&lt;p&gt;I&apos;ve attached a patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-355&quot; title=&quot;DataSourceXAConnectionFactory does not store the XAConnection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-355&quot;&gt;&lt;del&gt;DBCP-355&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12502250">DBCP-355</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12439271" name="MySQL and DBCP.zip" size="11935" author="bsp" created="Fri, 19 Mar 2010 12:33:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114604</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ftzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90456</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-324] Not release greater than 1.2 is in the global maven respository</title>
                <link>https://issues.apache.org/jira/browse/DBCP-324</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The Maven central repository does not contain any version greater than 1.2.2, for group Id &apos;commons-dbcp&apos;, artifact id &apos;commons-dbcp&apos;.&lt;br/&gt;
Also since there is no other groupId/ArtifactId that has those missing versions, or any other Maven repository containing them, there is no way of downloading it them automatically via Maven.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12456928">DBCP-324</key>
            <summary>Not release greater than 1.2 is in the global maven respository</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="asafm">Asaf Mesika</reporter>
                        <labels>
                            <label>maven</label>
                            <label>missing</label>
                            <label>packaging</label>
                    </labels>
                <created>Sun, 21 Feb 2010 07:48:13 +0000</created>
                <updated>Sat, 27 Feb 2010 00:58:02 +0000</updated>
                            <resolved>Sat, 27 Feb 2010 00:58:02 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12836375" author="psteitz" created="Sun, 21 Feb 2010 14:14:00 +0000"  >&lt;p&gt;The 1.3 and 1.4 jars are available from the maven central repo at&lt;br/&gt;
 &lt;a href=&quot;http://repo1.maven.org/maven2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo1.maven.org/maven2/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Replication to secondary mirrors may not yet have been completed.&lt;/p&gt;</comment>
                            <comment id="12839101" author="psteitz" created="Sat, 27 Feb 2010 00:58:01 +0000"  >&lt;p&gt;Replication to major mirrors has completed.  Note that the 1.3 and 1.4 releases are maven 2 releases.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uvx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178312</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-322] CPDSConnectionFactory.validateObject(Object) ignores Throwable</title>
                <link>https://issues.apache.org/jira/browse/DBCP-322</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;CPDSConnectionFactory.validateObject(Object) catches and ignores Throwable, which is a bit excessive. For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rset != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        rset.close();
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
        &lt;span class=&quot;code-comment&quot;&gt;// ignore
&lt;/span&gt;    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;close() can only throw SQLException, and that is all that should be ignored. In particular, ThreadDeath should never be ignored.&lt;/p&gt;

&lt;p&gt;Same applies to KeyedCPDSConnectionFactory.&lt;/p&gt;

&lt;p&gt;Basic&lt;span class=&quot;error&quot;&gt;&amp;#91;Managed&amp;#93;&lt;/span&gt;Datasource also catch Throwable, but rethrow it as SQLNestedException.&lt;br/&gt;
This is a bit better, but there&apos;s still the problem with ThreadDeath.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12446307">DBCP-322</key>
            <summary>CPDSConnectionFactory.validateObject(Object) ignores Throwable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jan 2010 12:32:07 +0000</created>
                <updated>Sat, 31 May 2014 04:14:43 +0000</updated>
                            <resolved>Thu, 26 Apr 2012 16:33:58 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.2.1</version>
                    <version>1.2.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12803713" author="psteitz" created="Fri, 22 Jan 2010 14:42:11 +0000"  >&lt;p&gt;Agree this is excessive.  Need to look carefully at each instance.&lt;/p&gt;</comment>
                            <comment id="13174326" author="psteitz" created="Wed, 21 Dec 2011 19:10:32 +0000"  >&lt;p&gt;This is a behavior change that could conceivably break some applications, so pushing to 2.0&lt;/p&gt;</comment>
                            <comment id="13262720" author="sebb@apache.org" created="Thu, 26 Apr 2012 16:33:58 +0000"  >&lt;p&gt;Fixed all instances of Throwable that were being ignored.&lt;br/&gt;
Ignoring Exception instead.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114599</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170418</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-320] .PerUserPoolDataSource.poolKeys can grow without limit</title>
                <link>https://issues.apache.org/jira/browse/DBCP-320</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The private static variable .PerUserPoolDataSource.poolKeys (a HashMap) only ever has items added to it; the contents are never cleared.&lt;/p&gt;

&lt;p&gt;Every different datasource generates a new HashMap entry; every username+password generates a new entry in that map.&lt;/p&gt;

&lt;p&gt;This might perhaps become a problem for long-running applications with lots of different users.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12445466">DBCP-320</key>
            <summary>.PerUserPoolDataSource.poolKeys can grow without limit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jan 2010 01:04:43 +0000</created>
                <updated>Mon, 15 Feb 2010 01:42:15 +0000</updated>
                            <resolved>Sun, 17 Jan 2010 22:05:32 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12800287" author="sebb@apache.org" created="Thu, 14 Jan 2010 18:23:38 +0000"  >&lt;p&gt;As far as I can make out, the Map is being used as a cache for PoolKey objects.&lt;/p&gt;

&lt;p&gt;As these are immutable and relatively small, it seems to me that caching them serves little purpose - the class might as well create the PoolKey each time.&lt;/p&gt;

&lt;p&gt;If caching is necessary, then surely it would be better to use an instance variable to hold the cache, and make the cache an LRUMap, as is done for SharedPoolDataSource?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;although that class has even less need for a cache!&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12801492" author="psteitz" created="Sun, 17 Jan 2010 20:14:54 +0000"  >&lt;p&gt;I agree - looks to me as though poolKeys can safely be eliminated.  It appears to be a global cache for UserKey objects, reused across PerUserPoolDataSource instances and to have no purpose other than caching the PoolKeys.  It is private and used only in getPoolKey.&lt;/p&gt;</comment>
                            <comment id="12801526" author="psteitz" created="Sun, 17 Jan 2010 22:05:32 +0000"  >&lt;p&gt;Fixed in r900226&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114597</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178561</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-318] PerUserPoolDataSource.getPooledConnectionAndInfo multi-threading bug</title>
                <link>https://issues.apache.org/jira/browse/DBCP-318</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;PerUserPoolDataSource.getPooledConnectionAndInfo(user,pass) has the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; pool = pools.get(key); &lt;span class=&quot;code-comment&quot;&gt;// (1) pools = instance variable
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pool == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            registerPool(username, password);
            pool = pools.get(key);
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first get() call can return null to multiple threads, so multiple threads can register the pool.&lt;br/&gt;
This allows more than maxActive() connections to be returned.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444743">DBCP-318</key>
            <summary>PerUserPoolDataSource.getPooledConnectionAndInfo multi-threading bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2010 20:01:37 +0000</created>
                <updated>Mon, 15 Feb 2010 01:43:45 +0000</updated>
                            <resolved>Tue, 5 Jan 2010 20:07:16 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12796826" author="sebb@apache.org" created="Tue, 5 Jan 2010 20:07:16 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=896195&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=896195&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-318&quot; title=&quot;PerUserPoolDataSource.getPooledConnectionAndInfo multi-threading bug&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-318&quot;&gt;&lt;del&gt;DBCP-318&lt;/del&gt;&lt;/a&gt; PerUserPoolDataSource.getPooledConnectionAndInfo multi-threading bug&lt;/p&gt;

&lt;p&gt;N.B. Also added a check in private method registerPool(String, String) to throw IllegalStateException if the key already existed in the pool.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-317] Findbugs: Class doesn&apos;t override equals in superclass</title>
                <link>https://issues.apache.org/jira/browse/DBCP-317</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Findbugs: Class doesn&apos;t override equals in superclass - 8 instances&lt;/p&gt;

&lt;p&gt;&quot;This class extends a class that defines an equals method and adds fields, but doesn&apos;t define an equals method itself. Thus, equality on instances of this class will ignore the identity of the subclass and the added fields. Be sure this is what is intended, and that you don&apos;t need to override the equals method. Even if you don&apos;t need to override the equals method, consider overriding it anyway to document the fact that the equals method for the subclass just return the result of invoking super.equals(o). &quot;&lt;/p&gt;

&lt;p&gt;Classes (superclass) are:&lt;/p&gt;

&lt;p&gt;cpdsadapter.ConnectionImpl doesn&apos;t override DelegatingConnection.equals&lt;br/&gt;
datasources.LRUMap doesn&apos;t override SequencedHashMap.equals&lt;br/&gt;
managed.ManagedConnection doesn&apos;t override DelegatingConnection.equals&lt;br/&gt;
managed.PoolableManagedConnection  doesn&apos;t override DelegatingConnection.equals&lt;br/&gt;
PoolableCallableStatement doesn&apos;t override DelegatingCallableStatement.equals&lt;br/&gt;
PoolableConnection doesn&apos;t override DelegatingConnection.equals&lt;br/&gt;
PoolablePreparedStatement doesn&apos;t override DelegatingPreparedStatement.equals&lt;br/&gt;
PoolingConnection doesn&apos;t override DelegatingConnection.equals&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444651">DBCP-317</key>
            <summary>Findbugs: Class doesn&apos;t override equals in superclass</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2010 02:35:09 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:23 +0000</updated>
                            <resolved>Tue, 4 Feb 2014 13:46:53 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12796503" author="psteitz" created="Tue, 5 Jan 2010 02:49:58 +0000"  >&lt;p&gt;I don&apos;t want to make any changes to the collections class (LRUMap), which is OK.&lt;/p&gt;

&lt;p&gt;The others are OK - working as designed - as the equals equivalence relation is defined by equality of underlying jdbc objects.  I am OK with vacuos override to document if that would make findbugs happier and the code easier to understand, though I am not sure it would make the code easier to understand.&lt;/p&gt;</comment>
                            <comment id="12797078" author="sebb@apache.org" created="Wed, 6 Jan 2010 11:46:01 +0000"  >&lt;p&gt;I&apos;ve been looking into this further.&lt;/p&gt;

&lt;p&gt;DelegatingPreparedStatement extends DelegatingStatement  and overrides equals() - but defines no extra fields&lt;br/&gt;
DelegatingCallableStatement extends DelegatingPreparedStatement  and overrides equals() - but defines no extra fields&lt;br/&gt;
Yet&lt;br/&gt;
PoolableCallableStatement extends DelegatingCallableStatement and has extra fields, but does not override equals()&lt;/p&gt;

&lt;p&gt;This is quite confusing - why do the Delagating...Statement classes override equals when they don&apos;t have any extra state?&lt;br/&gt;
Indeed Findbugs warns that these equals methods may not be symmetric.&lt;/p&gt;</comment>
                            <comment id="13869097" author="markt" created="Sun, 12 Jan 2014 17:50:40 +0000"  >&lt;p&gt;I&apos;ve fixed (removed) the unnecessary equals() methods in DelegatingPreparedStatement  and DelegatingCallableStatement &lt;/p&gt;

&lt;p&gt;The issues in the original description are still to be resolved.&lt;/p&gt;</comment>
                            <comment id="13890677" author="markt" created="Tue, 4 Feb 2014 13:46:53 +0000"  >&lt;p&gt;This issue has the same root cause as &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-358&quot; title=&quot;Equals implementations in DelegatingXxx classes are not symmetric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-358&quot;&gt;&lt;del&gt;DBCP-358&lt;/del&gt;&lt;/a&gt;. Fixing that issue has also resolved these FindBugs warnings.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12505732">DBCP-358</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114594</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fu07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90459</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-316] datasources.SharedPoolDataSource.getPooledConnectionAndInfo() contains an impossible null check</title>
                <link>https://issues.apache.org/jira/browse/DBCP-316</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;datasources.SharedPoolDataSource.getPooledConnectionAndInfo() contains an impossible null check:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (userKeys) {
    key = getUserPassKey(username, password);
}
        
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    info = (PooledConnectionAndInfo) pool.borrowObject(key);
}
&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException ex) {  &lt;span class=&quot;code-comment&quot;&gt;// Remove bad UserPassKey
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (userKeys != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;== cannot be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; here, &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; synch. would have failed with NPE
&lt;/span&gt;...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The null check should be removed, as userKeys cannot be null (it is a final variable, and set non-null).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444645">DBCP-316</key>
            <summary>datasources.SharedPoolDataSource.getPooledConnectionAndInfo() contains an impossible null check</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2010 02:16:06 +0000</created>
                <updated>Mon, 15 Feb 2010 01:44:11 +0000</updated>
                            <resolved>Tue, 5 Jan 2010 03:08:52 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12796493" author="psteitz" created="Tue, 5 Jan 2010 02:31:42 +0000"  >&lt;p&gt;Agree this is a needless check&lt;/p&gt;</comment>
                            <comment id="12796507" author="sebb@apache.org" created="Tue, 5 Jan 2010 03:08:52 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=895870&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=895870&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-316&quot; title=&quot;datasources.SharedPoolDataSource.getPooledConnectionAndInfo() contains an impossible null check&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-316&quot;&gt;&lt;del&gt;DBCP-316&lt;/del&gt;&lt;/a&gt; Remove impossible null check.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxcv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178545</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-315] .PoolingDriver.getPoolNames() says it throws SQLException but does not throw any Exceptions</title>
                <link>https://issues.apache.org/jira/browse/DBCP-315</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;.PoolingDriver.getPoolNames() says it throws SQLException but does not throw any Exceptions.&lt;/p&gt;

&lt;p&gt;The throws clause could be removed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444643">DBCP-315</key>
            <summary>.PoolingDriver.getPoolNames() says it throws SQLException but does not throw any Exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2010 01:58:48 +0000</created>
                <updated>Mon, 15 Feb 2010 01:45:22 +0000</updated>
                            <resolved>Tue, 5 Jan 2010 03:14:54 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12796496" author="psteitz" created="Tue, 5 Jan 2010 02:33:52 +0000"  >&lt;p&gt;+1 to removing throws&lt;/p&gt;</comment>
                            <comment id="12796508" author="sebb@apache.org" created="Tue, 5 Jan 2010 03:14:54 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=895871&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=895871&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-315&quot; title=&quot;.PoolingDriver.getPoolNames() says it throws SQLException but does not throw any Exceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-315&quot;&gt;&lt;del&gt;DBCP-315&lt;/del&gt;&lt;/a&gt; Remove throws clause from method that does not throw an exception.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114592</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178861</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-314] Hidden fields can cause problems when code is updated</title>
                <link>https://issues.apache.org/jira/browse/DBCP-314</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;There are quite a few instances of fields that are hidden (masked) by local variables or parameters.&lt;/p&gt;

&lt;p&gt;This is a potential source of bugs, as the hidden field can be accidentally revealed and used when code is updated.&lt;/p&gt;

&lt;p&gt;The classes that currently contain such code are:&lt;/p&gt;

&lt;p&gt;LocalXAConnectionFactory - 6 instances&lt;br/&gt;
InstanceKeyDataSource&lt;br/&gt;
DriverAdapterCPDS&lt;br/&gt;
PoolingDataSource&lt;br/&gt;
BasicDataSource - 2 instances&lt;br/&gt;
AbandonedTrace - 2 instances&lt;br/&gt;
BasicDataSource&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444641">DBCP-314</key>
            <summary>Hidden fields can cause problems when code is updated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2010 01:21:15 +0000</created>
                <updated>Mon, 15 Feb 2010 01:45:45 +0000</updated>
                            <resolved>Tue, 5 Jan 2010 01:51:05 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12796481" author="sebb@apache.org" created="Tue, 5 Jan 2010 01:51:05 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=895844&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=895844&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-314&quot; title=&quot;Hidden fields can cause problems when code is updated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-314&quot;&gt;&lt;del&gt;DBCP-314&lt;/del&gt;&lt;/a&gt; Renamed variables with duplicate names in different scopes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uz6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178840</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-313] PooledConnection.removeConnectionEventListener(ConnectionEventListener) does not throw any Exceptions, yet DBCP protects calls to it</title>
                <link>https://issues.apache.org/jira/browse/DBCP-313</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;javax.sql.PooledConnection.removeConnectionEventListener(ConnectionEventListener) does not throw any Exceptions, yet DBCP protects calls to it, generally ignoring any Exception.&lt;/p&gt;

&lt;p&gt;For example, in datasources.CPDSConnectionFactory:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void destroyObject(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PooledConnectionAndInfo) {
        PooledConnection pc = ((PooledConnectionAndInfo)obj).getPooledConnection();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            pc.removeConnectionEventListener(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-comment&quot;&gt;//ignore
&lt;/span&gt;        }
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems wrong, as the code may accidentally swallow a genuine Exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444638">DBCP-313</key>
            <summary>PooledConnection.removeConnectionEventListener(ConnectionEventListener) does not throw any Exceptions, yet DBCP protects calls to it</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2010 00:54:25 +0000</created>
                <updated>Mon, 15 Feb 2010 01:46:26 +0000</updated>
                            <resolved>Tue, 5 Jan 2010 03:05:16 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12796494" author="psteitz" created="Tue, 5 Jan 2010 02:32:46 +0000"  >&lt;p&gt;Agree the protection should be removed&lt;/p&gt;</comment>
                            <comment id="12796506" author="sebb@apache.org" created="Tue, 5 Jan 2010 03:05:16 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=895869&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=895869&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-313&quot; title=&quot;PooledConnection.removeConnectionEventListener(ConnectionEventListener) does not throw any Exceptions, yet DBCP protects calls to it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-313&quot;&gt;&lt;del&gt;DBCP-313&lt;/del&gt;&lt;/a&gt; Remove code that catches and ignores Exceptions when calling&lt;br/&gt;
PooledConnection.removeConnectionEventListener(ConnectionEventListener)&lt;br/&gt;
as the method does not throw any Exceptions.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114590</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178592</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-312] BasicDataSource.close() method needs JavaDoc clarification</title>
                <link>https://issues.apache.org/jira/browse/DBCP-312</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hello, the JavaDoc could use clarification for the BasicDataSource.close() method.  &lt;/p&gt;

&lt;p&gt;Link:  &lt;a href=&quot;http://commons.apache.org/dbcp/apidocs/org/apache/commons/dbcp/BasicDataSource.html#close(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/dbcp/apidocs/org/apache/commons/dbcp/BasicDataSource.html#close(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Text: &quot;Close and release all connections that are currently stored in the connection pool associated with our data source. All open (active) connection remain open until closed. Once the data source has been closed, no more connections can be obtained.&quot;&lt;/p&gt;

&lt;p&gt;I&apos;m unsure if this method closes just idle, or both idle and active connections.  This is a important distinction, because you wouldn&apos;t want to call close() if you still have some needed active connections open on various threads.  The first sentence seems to indicate both active and idle threads will be closed, but the second sentence indicates that only the idle threads will be explicitly closed.&lt;/p&gt;

&lt;p&gt;Recommend changing text to:&lt;br/&gt;
&quot;Close and release all connections, whether active or idle, that are currently stored in the connection pool associated with our data source.  Once the data source has been closed, no more connections can be obtained.&quot;&lt;/p&gt;

&lt;p&gt;or (if this method closes just idle connections):&lt;/p&gt;

&lt;p&gt;&quot;Close and release all idle connections that are currently stored in the connection pool associated with our data source. All open (active) connections will still remain open until they are closed via the Connection close() method. Once the data source has been closed, no more connections can be obtained.&quot;&lt;/p&gt;

&lt;p&gt;Note that, for the latter case, if BasicDataSource.close() only closes and releases idle connections, and an active DBCP Connection object subsequently has its close() method called, it&apos;s not clear whether its underlying actual JDBC connection will be released.  I.e., how do you release JDBC connections on previously active DBCP Connections after BasicDataSource.close() is called?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12443609">DBCP-312</key>
            <summary>BasicDataSource.close() method needs JavaDoc clarification</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gmazza">Glen Mazza</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Dec 2009 02:33:12 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:17 +0000</updated>
                            <resolved>Mon, 25 Apr 2011 17:21:41 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12793834" author="psteitz" created="Tue, 22 Dec 2009 23:00:45 +0000"  >&lt;p&gt;Thanks for reporting this.  I agree that the javadoc should be clearer.  Your second option above is correct - close has no effect on checked out connections.  What close does is close the underlying object pool.  This destroys the objects contained in the pool - in this case database connections.  So the physical connections corresponding to objects in the idle connection pool get closed when the datasource is closed.  When checked out connections are returned to the pool (i.e., when pool clients execute close on them), they are destroyed, so the physical connections get closed at that time.&lt;/p&gt;</comment>
                            <comment id="12793845" author="gmazza" created="Wed, 23 Dec 2009 00:07:57 +0000"  >&lt;p&gt;What you&apos;ve written above is absolute music to my ears, and would be excellent to replace what you presently have in the JavaDoc.  I have a main program that launches many threads, each requesting/returning a connection.  The main thread then closes the connection pool and exits while several of the threads may still be running.  This means (1) those threads can still work with their live connection even though the main thread closed the pool, and (2) once each spawned thread is finished and closes its connection, it becomes a &quot;real&quot; close of the underlying JDBC connection.  Great to hear.  Thanks!&lt;/p&gt;</comment>
                            <comment id="12793849" author="psteitz" created="Wed, 23 Dec 2009 00:18:32 +0000"  >&lt;p&gt;Thanks again for pointing out the weakness in the docs.  The unit tests are better - see testClose  in TestBasicDataSource &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12793851" author="psteitz" created="Wed, 23 Dec 2009 00:19:27 +0000"  >&lt;p&gt;Fixed in trunk as of r893360&lt;/p&gt;</comment>
                            <comment id="13024862" author="psteitz" created="Mon, 25 Apr 2011 17:20:02 +0000"  >&lt;p&gt;Reopening just to change fix version.&lt;/p&gt;</comment>
                            <comment id="13024863" author="psteitz" created="Mon, 25 Apr 2011 17:21:29 +0000"  >&lt;p&gt;This bug was actually fixed in the 1.3/1/4 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tj93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170428</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-309] First example for FSContext is invalid</title>
                <link>https://issues.apache.org/jira/browse/DBCP-309</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;First example on page &lt;a href=&quot;http://commons.apache.org/dbcp/guide/jndi-howto.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/dbcp/guide/jndi-howto.html&lt;/a&gt; is invalid, with this code every call of  &lt;/p&gt;

&lt;p&gt;  InitialContext ic2 = new InitialContext();&lt;br/&gt;
  DataSource ds = (DataSource) ic2.lookup(&quot;jdbc/basic&quot;);&lt;br/&gt;
  Connection conn = ds.getConnection();&lt;br/&gt;
  conn.close();&lt;/p&gt;

&lt;p&gt;ends with new datasource with unclosed connection in it becase new Reference(&quot;javax.sql.DataSource&quot;,  &quot;org.apache.commons.dbcp.BasicDataSourceFactory&quot;, null); reference creates new DataSource instead using created one while calling  ic2.lookup(&quot;jdbc/basic&quot;).&lt;/p&gt;

&lt;p&gt;At the end it ends with many opened connections to DB until JVM is ended.&lt;/p&gt;

&lt;p&gt;Second example I didn&apos;t test, i use direct aproach with manualy creating SharedPoolDataSource and registring it in FSContext JNDI itself.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12441779">DBCP-309</key>
            <summary>First example for FSContext is invalid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="barkh">Ondrej Tisler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Nov 2009 14:12:05 +0000</created>
                <updated>Tue, 24 Feb 2015 03:23:18 +0000</updated>
                            <resolved>Wed, 12 Feb 2014 20:05:51 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12783483" author="psteitz" created="Sun, 29 Nov 2009 21:52:38 +0000"  >&lt;p&gt;Looks like a bug in the examples to me.  Looks like the BasicDataSource example is taken from an example (Tomcat?) where a more general type of resource is being created but not bound directly into the JNDI context.  Unless I am missing something, it would be simpler (and correct) to just create the datasource instance and bind it directly.&lt;/p&gt;</comment>
                            <comment id="12783729" author="psteitz" created="Mon, 30 Nov 2009 16:25:28 +0000"  >&lt;p&gt;Strike last comment.  DataSoources do not implement Referenceable, so direct references will not work.  When using the FileSystem provider, datasources are created new for each lookup (as reported in the issue).  Tomcat&apos;s in-memory provider, however, returns the same datasource for repeated lookups.  The following test, for example, succeeds with the Tomcat provider, but fails with the FS provider&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Hashtable environment = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Hashtable();
        environment.put(Context.INITIAL_CONTEXT_FACTORY,
                org.apache.naming.java.javaURLContextFactory.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName());
        InitialContext ic = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InitialContext(environment);
        ic.createSubcontext(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc&quot;&lt;/span&gt;); 
        &lt;span class=&quot;code-comment&quot;&gt;// Construct BasicDataSource reference
&lt;/span&gt;        Reference ref = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Reference(&lt;span class=&quot;code-quote&quot;&gt;&quot;javax.sql.DataSource&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.dbcp.BasicDataSourceFactory&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        ref.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringRefAddr(&lt;span class=&quot;code-quote&quot;&gt;&quot;driverClassName&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TesterDriver&quot;&lt;/span&gt;));
        ref.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringRefAddr(&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:apache:commons:testdriver&quot;&lt;/span&gt;));
        ref.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringRefAddr(&lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt;));
        ref.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringRefAddr(&lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt;));
        ic.rebind(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc/basic&quot;&lt;/span&gt;, ref);
         
        &lt;span class=&quot;code-comment&quot;&gt;// Use
&lt;/span&gt;        InitialContext ic2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InitialContext(environment);
        DataSource ds = (DataSource) ic2.lookup(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc/basic&quot;&lt;/span&gt;);
        ((BasicDataSource) ds).setAccessToUnderlyingConnectionAllowed(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        Assert.assertNotNull(ds);
        Connection conn = ds.getConnection();
        Connection uconn = ((DelegatingConnection) conn).getInnermostDelegate();
        Assert.assertNotNull(conn);
        conn.close();
        
        DataSource ds2 = (DataSource) ic2.lookup(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc/basic&quot;&lt;/span&gt;);
        ((BasicDataSource) ds2).setAccessToUnderlyingConnectionAllowed(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        Assert.assertNotNull(ds2);
        Connection conn2 = ds2.getConnection();
        Connection uconn2 = ((DelegatingConnection) conn2).getInnermostDelegate();
        Assert.assertNotNull(conn2);
        conn2.close();
        Assert.assertEquals(ds, ds2);
        Assert.assertEquals(uconn2, uconn);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To make the examples less misleading, it seems we have two choices - 1) change to use the Tomcat provider or 2) comment that the FS provider creates new datasources each time.  Would appreciate comments / patches from JNDI spi experts on this.&lt;/p&gt;</comment>
                            <comment id="12784807" author="barkh" created="Wed, 2 Dec 2009 13:05:45 +0000"  >&lt;p&gt;I use this code for registring JNDI inFSContext:&lt;br/&gt;
      // JNDI with datasource&lt;br/&gt;
      InitialContext ic = new InitialContext();&lt;br/&gt;
      // Construct BasicDataSource reference&lt;br/&gt;
      Configuration poolConfig = dbConfig.subset(&quot;datasource&quot;);&lt;br/&gt;
      DriverAdapterCPDS cpds = new DriverAdapterCPDS();&lt;br/&gt;
      cpds.setDriver(poolConfig.getString(&quot;driver.driverClassName&quot;));&lt;br/&gt;
      cpds.setUrl(poolConfig.getString(&quot;driver.url&quot;));&lt;br/&gt;
      cpds.setUser(poolConfig.getString(&quot;driver.username&quot;));&lt;br/&gt;
      cpds.setPassword(CryptPass.encryptPass(poolConfig.getString(&quot;driver.password&quot;)));&lt;br/&gt;
      SharedPoolDataSource ds = new SharedPoolDataSource();&lt;br/&gt;
      ds.setConnectionPoolDataSource(cpds);&lt;br/&gt;
      ds.setDefaultAutoCommit(poolConfig.getBoolean(&quot;connection.defaultAutoCommit&quot;, true));&lt;br/&gt;
      ds.setValidationQuery(poolConfig.getString(&quot;validation.validationQuery&quot;));&lt;br/&gt;
      ic.rebind(poolConfig.getString(&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;@jndi&amp;#93;&lt;/span&gt;&quot;), ds);&lt;br/&gt;
      log.info(&quot;JNDI datasource is inicialized&quot;);&lt;/p&gt;

&lt;p&gt;next you can normaly use JNDI lookup:&lt;br/&gt;
      InitialContext ic2 = new InitialContext();&lt;br/&gt;
      ds = (DataSource) ic2.lookup(poolConfig.getString(&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;@jndi&amp;#93;&lt;/span&gt;&quot;));&lt;br/&gt;
      conn = ds.getConnection();&lt;/p&gt;</comment>
                            <comment id="13027555" author="psteitz" created="Mon, 2 May 2011 05:50:54 +0000"  >&lt;p&gt;Unfortunately, I think the right fix here is to drop the BasicDataSource example and resolve this issue, but open another one to make BasicDataSource implement Referenceable in 2.0.&lt;/p&gt;</comment>
                            <comment id="13898311" author="markt" created="Tue, 11 Feb 2014 21:05:32 +0000"  >&lt;p&gt;Caveat: I am no JNDI expert. The little I do know is gleaned from reverse engineering Tomcat&apos;s JNDI implementation.&lt;/p&gt;

&lt;p&gt;I think the example is wrong because it binds a reference. A reference will always result in a new object being created when it is looked up. If the example binds a BasicDataSource instance, it appears to behave as desired/expected.&lt;/p&gt;

&lt;p&gt;As most users expect multiple JNDI look ups using the same name to return the same object, Tomcat deliberately breaks the rules. By default, when Tomcat finds a reference, Tomcat resolves that reference to an object and then replaces the reference in JNDI with the object. In later Tomcat versions, this is configurable with the singleton property.&lt;/p&gt;

&lt;p&gt;It isn&apos;t clear to me how implementing Referenceable will help. If anything, that will make it worse as it would then be impossible to bind an instance of a BasicDataSource to JNDI as the Reference would be bound.&lt;/p&gt;

&lt;p&gt;I intend to tweak the examples to bind instances rather than References. This appears to be consistent with Ondrej Tisler&apos;s approach above.&lt;/p&gt;</comment>
                            <comment id="13899523" author="markt" created="Wed, 12 Feb 2014 20:05:51 +0000"  >&lt;p&gt;I&apos;ve fixed trunk for the 2.x series the 1.5.x branch. It will be included in the next release of each.&lt;/p&gt;

&lt;p&gt;If there are further 1.3.x and 1.4.x releases (currently being discussed on the dev mailing list) my expectation is that they will be generated from the 1.5.x branch so will pick up this fix too.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fu0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90460</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-308] ORA-01453: SET TRANSACTION must be first command of transaction exception with SharedPoolDataSource</title>
                <link>https://issues.apache.org/jira/browse/DBCP-308</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;When using SharedPoolDataSource I get ORA-01453: SET TRANSACTION exception on con.setReadOnly(isDefaultReadOnly()); in setupDefaults method&lt;br/&gt;
I correct it with code - &lt;/p&gt;

&lt;p&gt;  protected void setupDefaults(Connection con, String username) throws SQLException {&lt;br/&gt;
    con.rollback();&lt;br/&gt;
    con.setReadOnly(isDefaultReadOnly());&lt;br/&gt;
    con.setAutoCommit(isDefaultAutoCommit());&lt;br/&gt;
    int defaultTransactionIsolation = getDefaultTransactionIsolation();&lt;br/&gt;
    if (defaultTransactionIsolation != UNKNOWN_TRANSACTIONISOLATION) &lt;/p&gt;
{
      con.setTransactionIsolation(defaultTransactionIsolation);
    }
&lt;p&gt;  }&lt;/p&gt;

&lt;p&gt;rollback is important, without it it ends on same exception ... &lt;br/&gt;
I&apos;m using 10.1.2.0.2 oracle driver&lt;/p&gt;
</description>
                <environment>&lt;p&gt;JDK 1.5&lt;/p&gt;</environment>
        <key id="12441778">DBCP-308</key>
            <summary>ORA-01453: SET TRANSACTION must be first command of transaction exception with SharedPoolDataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="barkh">Ondrej Tisler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Nov 2009 14:04:08 +0000</created>
                <updated>Mon, 15 Feb 2010 01:49:55 +0000</updated>
                            <resolved>Sun, 29 Nov 2009 20:37:30 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12783470" author="psteitz" created="Sun, 29 Nov 2009 20:37:30 +0000"  >&lt;p&gt;This should be resolved in trunk, so will be fixed in 1.3/1.4 releases.  SharedPoolDataSource.setupDefaults now tests property values before setting them. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114585</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 49 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uz87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178848</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-307] PoolingConnection.PStmtKey.equals() and cpdsadapter.PooledConnectionImpl.PStmtKey.equals() don&apos;t check for null or the correct class</title>
                <link>https://issues.apache.org/jira/browse/DBCP-307</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;PoolingConnection.PStmtKey.equals() and cpdsadapter.PooledConnectionImpl.PStmtKey.equals() don&apos;t check for null or the correct class.&lt;/p&gt;

&lt;p&gt;Instead, they rely on catching NPE and ClassCastException.&lt;/p&gt;

&lt;p&gt;Although this should work, it&apos;s very bad practice, and will be slower than the corrected code if the NPE or CCE is ever thrown.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Patch to follow&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12441413">DBCP-307</key>
            <summary>PoolingConnection.PStmtKey.equals() and cpdsadapter.PooledConnectionImpl.PStmtKey.equals() don&apos;t check for null or the correct class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Nov 2009 00:23:44 +0000</created>
                <updated>Sun, 29 Nov 2009 20:11:45 +0000</updated>
                            <resolved>Sun, 29 Nov 2009 20:11:45 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12781308" author="psteitz" created="Mon, 23 Nov 2009 05:07:34 +0000"  >&lt;p&gt;Understand the point on bad practice, but this looks like it was done for performance.  The exception cases should not happen in practice.  Might be better to comment the code and leave as is.&lt;/p&gt;</comment>
                            <comment id="12783462" author="psteitz" created="Sun, 29 Nov 2009 20:11:45 +0000"  >&lt;p&gt;Per comments above,  exceptions should not be generated by DBCP internal use&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12425789" name="dbcp_307.txt" size="4721" author="sebb" created="Mon, 23 Nov 2009 00:53:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114584</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 49 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzlr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178909</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-306] the connection pool is lost after 1 hour .we need to start he app servr but after some time its again destroyed..</title>
                <link>https://issues.apache.org/jira/browse/DBCP-306</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt; pool is destroyed  after sometime i.e the connection with the database is lost  .we need to start he app servr  to create the pool but after some time its again destroyed..&lt;/p&gt;</description>
                <environment>&lt;p&gt;Solaris&lt;/p&gt;</environment>
        <key id="12441066">DBCP-306</key>
            <summary>the connection pool is lost after 1 hour .we need to start he app servr but after some time its again destroyed..</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rajiv.shaw@wipro.com">Rajiv Shaw</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Nov 2009 17:01:19 +0000</created>
                <updated>Mon, 15 Feb 2010 02:01:55 +0000</updated>
                            <resolved>Wed, 18 Nov 2009 17:27:31 +0000</resolved>
                                    <version>1.2.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12779537" author="markt" created="Wed, 18 Nov 2009 17:27:31 +0000"  >&lt;p&gt;Please use the users list for help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114583</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0cn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-303] getGeneratedKeys does not work</title>
                <link>https://issues.apache.org/jira/browse/DBCP-303</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;ResultSet rs = ps.getGeneratedKeys();&lt;br/&gt;
if (rs.next())&lt;/p&gt;

&lt;p&gt;The ResultSet is always empty.&lt;/p&gt;

&lt;p&gt;I&apos;ve tracked down the issue to PooledConnectionImpl.makeObject which doesn&apos;t call Connection.prepareStatement(String, int) when key._autoGeneratedKeys is not null. Patch to follow shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12440245">DBCP-303</key>
            <summary>getGeneratedKeys does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dave@daveoxley.co.uk">Dave Oxley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Nov 2009 03:09:39 +0000</created>
                <updated>Mon, 15 Feb 2010 02:04:42 +0000</updated>
                            <resolved>Tue, 10 Nov 2009 23:02:11 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12776140" author="markt" created="Tue, 10 Nov 2009 23:02:11 +0000"  >&lt;p&gt;Patch applied. Many thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12424433" name="DBCP-303.diff" size="1363" author="dave@daveoxley.co.uk" created="Tue, 10 Nov 2009 03:14:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114580</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-302] org.apache.commons.jocl.JOCLContentHandler.ConstructorDetails.createObject()  does not throw ClassNotFoundException</title>
                <link>https://issues.apache.org/jira/browse/DBCP-302</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;org.apache.commons.jocl.JOCLContentHandler.ConstructorDetails.createObject()  does not actually throw ClassNotFoundException&lt;/p&gt;

&lt;p&gt;Either the Exception should be removed from the throws clause, or it should be documented in Javadoc (stops Eclipse complaining).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12439161">DBCP-302</key>
            <summary>org.apache.commons.jocl.JOCLContentHandler.ConstructorDetails.createObject()  does not throw ClassNotFoundException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Oct 2009 11:43:15 +0000</created>
                <updated>Mon, 15 Feb 2010 02:05:04 +0000</updated>
                            <resolved>Tue, 10 Nov 2009 22:10:23 +0000</resolved>
                                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12776104" author="markt" created="Tue, 10 Nov 2009 22:10:23 +0000"  >&lt;p&gt;Phil fixed this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114579</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uw1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178333</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-299] Number of idle connections exceed MaxIdle parameter Value / Number of active connexions on Oracle exceed maxActive parameter value</title>
                <link>https://issues.apache.org/jira/browse/DBCP-299</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We have to disctinct problems.&lt;/p&gt;

&lt;p&gt;We use Tomcat 5.5 and connect to an Oracle 10g database through DBCP.&lt;/p&gt;

&lt;p&gt;1-We observe that on the DB side, there are many idle connexions (more than on DBCP side when we read the numActive and numIdle indicators).&lt;br/&gt;
2-With maxIdle set to 2, we can have numIdle=3 &lt;/p&gt;

&lt;p&gt;For the 1st point, we tried to play with the removeAbandoned and removeAbandonedTimeoutParameters but this remained unsuccessfull. Are there any other parameters to use ? &lt;br/&gt;
For the 2d point, we have no idea.&lt;/p&gt;

&lt;p&gt;Are these known bugs ? &lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Guillaume T&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tomcat 5.5&lt;br/&gt;
Java 1.5&lt;br/&gt;
Red Hat Enterprise Linux 5.2&lt;br/&gt;
Oracle : 10.2.0.4.0&lt;/p&gt;</environment>
        <key id="12432983">DBCP-299</key>
            <summary>Number of idle connections exceed MaxIdle parameter Value / Number of active connexions on Oracle exceed maxActive parameter value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="guillaume44fr">Thomassian</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Aug 2009 12:25:26 +0000</created>
                <updated>Mon, 15 Feb 2010 02:07:04 +0000</updated>
                            <resolved>Thu, 13 Aug 2009 12:48:37 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12742815" author="markt" created="Thu, 13 Aug 2009 12:48:37 +0000"  >&lt;p&gt;For 1, you&apos;ll need to log the abandoned connections and fix the root causes. The Oracle JDBC driver is known for keeping them open.&lt;/p&gt;

&lt;p&gt;2. Sounds like &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-379&quot; title=&quot;number of connections created has crossed more than maxActive &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-379&quot;&gt;&lt;del&gt;POOL-107&lt;/del&gt;&lt;/a&gt;. You could try using dbcp-1.2.2 and pool-1.5.2 rather than Tomcat&apos;s built in copy of DBCP.&lt;/p&gt;

&lt;p&gt;If you still see problems, you&apos;ll need to provide a test case that we can use to reproduce the error.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114576</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v04f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178993</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-298] CLONE -Connection socket hangs sporadically in DBCP 1.2.2 but not 1.2.1</title>
                <link>https://issues.apache.org/jira/browse/DBCP-298</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;I think I&apos;ve traced an exception to DBCP&apos;s code.&lt;/p&gt;

&lt;p&gt;Communication with the database is hanging sporadically in a production environment. If I don&apos;t set the socketTimeout property on the underlying connection, it will hang forever. With the socketTimeout property, I get the following exception:&lt;/p&gt;

&lt;p&gt;-------&lt;br/&gt;
com.mysql.jdbc.CommunicationsException: Communications link failure due to underlying exception:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;BEGIN NESTED EXCEPTION **&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;java.net.SocketTimeoutException&lt;br/&gt;
MESSAGE: Read timed out&lt;/p&gt;

&lt;p&gt;STACKTRACE:&lt;/p&gt;

&lt;p&gt;java.net.SocketTimeoutException: Read timed out&lt;br/&gt;
       at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
       at java.net.SocketInputStream.read(SocketInputStream.java:129)&lt;br/&gt;
       at com.mysql.jdbc.util.ReadAheadInputStream.fill(ReadAheadInputStream.java:113)&lt;br/&gt;
       at com.mysql.jdbc.util.ReadAheadInputStream.readFromUnderlyingStreamIfNecessary(ReadAheadInputStream.java:160)&lt;br/&gt;
       at com.mysql.jdbc.util.ReadAheadInputStream.read(ReadAheadInputStream.java:188)&lt;br/&gt;
       at com.mysql.jdbc.MysqlIO.readFully(MysqlIO.java:1994)&lt;br/&gt;
       at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:2411)&lt;br/&gt;
       at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2916)&lt;br/&gt;
       at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1631)&lt;br/&gt;
       at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1723)&lt;br/&gt;
       at com.mysql.jdbc.Connection.execSQL(Connection.java:3250)&lt;br/&gt;
       at com.mysql.jdbc.Statement.executeUpdate(Statement.java:1355)&lt;br/&gt;
       at com.mysql.jdbc.Statement.executeUpdate(Statement.java:1270)&lt;br/&gt;
       at org.apache.commons.dbcp.DelegatingStatement.executeUpdate(DelegatingStatement.java:228)&lt;br/&gt;
...&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;It always happens in an infrequently used JVM (not an app server handling frequent connections). So it&apos;s likely the offending connection was asleep for a long time before the exception occurs. &lt;/p&gt;

&lt;p&gt;I&apos;ve confirmed that this issue only occurs using 1.2.2 and not 1.2.1. I&apos;ve been looking through the changelogs but can&apos;t find anything that would cause this behavior.&lt;/p&gt;

&lt;p&gt;Does somebody familiar with the codebase have any idea what change (1.2.1-&amp;gt;1.2.2) could be causing this behavior? &lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment>&lt;p&gt;Fedora Core 3, MySQL 4.1.22. with the latest driver (5.07). Exceptions only occur in the &quot;job processing&quot; JVM, which sits idle for long periods of time and occasionally wakes up to interact with the database.&lt;/p&gt;</environment>
        <key id="12431529">DBCP-298</key>
            <summary>CLONE -Connection socket hangs sporadically in DBCP 1.2.2 but not 1.2.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dkim01">Denson Kim</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Jul 2009 18:49:14 +0000</created>
                <updated>Mon, 3 Aug 2009 18:32:59 +0000</updated>
                            <resolved>Mon, 3 Aug 2009 18:32:59 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12735715" author="dkim01" created="Mon, 27 Jul 2009 19:03:35 +0000"  >&lt;p&gt;I am having the same problem of all tomcat process hung at getting a dabase connection: &lt;br/&gt;
org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:96). &lt;/p&gt;

&lt;p&gt;I am using ms sql server 2005 and Microsoft jdbc driver.&lt;/p&gt;

&lt;p&gt;DBCP pool setting&lt;br/&gt;
url=jdbc:sqlserver://mssqlsrv:1433;databaseName=cloud&lt;br/&gt;
maxActive=20&lt;br/&gt;
maxIdle=20&lt;br/&gt;
testOnBorrow=true&lt;br/&gt;
testOnReturn=false&lt;br/&gt;
testWhileIdle=true&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;15 min&lt;br/&gt;
timeBetweenEvictionRunsMillis=900000&lt;/li&gt;
	&lt;li&gt;default value from DBCP 30min&lt;br/&gt;
minEvictableIdleTimeMillis=1800000&lt;br/&gt;
numTestsPerEvictionRun=1&lt;br/&gt;
validationQuery=select 1&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;dbcp version: 1.2.2&lt;br/&gt;
common pool version:1.3&lt;/p&gt;</comment>
                            <comment id="12738484" author="dkim01" created="Mon, 3 Aug 2009 18:32:59 +0000"  >&lt;p&gt;This is the same bug as evictor thread causing double deadlock. The solution is disable testWhileIdle.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12380004">DBCP-244</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 14 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uy7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-296] Db connection issue due to firewall timeout</title>
                <link>https://issues.apache.org/jira/browse/DBCP-296</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hello,&lt;br/&gt;
We use a db datasource for one of our applications.&lt;br/&gt;
The issue is that there is a firewall between tomcat server &amp;amp; db server (ORACLE 10g), that cuts pool connections after 1 hour of inactivity (it does not send anything, no FIN, no RST, it just drop packets), and the server goes wrong because of it reaches the maxActive value.&lt;/p&gt;

&lt;p&gt;We&apos;ve tried several configuration using :&lt;br/&gt;
validationQuery&lt;br/&gt;
testOnBorrow&lt;br/&gt;
testOnReturn&lt;br/&gt;
testWhileIdle&lt;br/&gt;
timeBetweenEvictionRunsMillis&lt;br/&gt;
numTestsPerEvictionRun&lt;br/&gt;
minEvictableIdleTimeMillis&lt;/p&gt;

&lt;p&gt;But that does not solve the problem (Moreover, I am not sure of the values I use for these params !)&lt;/p&gt;

&lt;p&gt;Could you please give me some advices about the way I have to configure this to get it working ?&lt;/p&gt;

&lt;p&gt;Best Regards.&lt;/p&gt;</description>
                <environment>&lt;p&gt;RHEL,&lt;br/&gt;
Tomcat 6.0.18&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;/p&gt;</environment>
        <key id="12429696">DBCP-296</key>
            <summary>Db connection issue due to firewall timeout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mw.alstom">Max W</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jul 2009 08:33:21 +0000</created>
                <updated>Tue, 7 Jul 2009 09:02:43 +0000</updated>
                            <resolved>Tue, 7 Jul 2009 09:02:43 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12727996" author="markt" created="Tue, 7 Jul 2009 09:02:43 +0000"  >&lt;p&gt;Jira is not a support forum. Please use the users list.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114573</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 18 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0br:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179026</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-295] In project pom please replace maven artifact relative license URL with the official URL for the license</title>
                <link>https://issues.apache.org/jira/browse/DBCP-295</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;POM of the commons-dbcp 1.2.2 currently points to /LICENSE.txt while it should (by the documentation for the license url element in &lt;a href=&quot;http://maven.apache.org/maven-v4_0_0.xsd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://maven.apache.org/maven-v4_0_0.xsd&lt;/a&gt;) point to &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/a&gt; which is the official url for the license text. This prevents maven plugins like maven jboss license plugin to download license, which instead currently prints a warning:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;WARNING&amp;#93;&lt;/span&gt; POM for dependency commons-dbcp:commons-dbcp:jar:1.2.2 has an invalid license URL: /LICENSE.txt&lt;/p&gt;</description>
                <environment></environment>
        <key id="12428506">DBCP-295</key>
            <summary>In project pom please replace maven artifact relative license URL with the official URL for the license</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sslavic">Stevo Slavi&#263;</reporter>
                        <labels>
                    </labels>
                <created>Sun, 21 Jun 2009 09:53:18 +0000</created>
                <updated>Mon, 15 Feb 2010 02:09:02 +0000</updated>
                            <resolved>Sun, 21 Jun 2009 15:51:40 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12722336" author="sslavic" created="Sun, 21 Jun 2009 10:34:46 +0000"  >&lt;p&gt;.. or even better, have the project specify org.apache:apache as parent, and remove licenses section from the project pom, so license section from parent pom gets inherited.&lt;/p&gt;</comment>
                            <comment id="12722375" author="psteitz" created="Sun, 21 Jun 2009 15:51:40 +0000"  >&lt;p&gt;The 1.3 release pom will be maven 2-generated and inherits from the apache parent.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114572</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178889</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-294] Memory leak in XA Implementation</title>
                <link>https://issues.apache.org/jira/browse/DBCP-294</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hello,&lt;br/&gt;
We are been using Ofbiz with DBCP based implementation.&lt;br/&gt;
Ofbiz uses a Head revision of DBCP (package org.apache.commons.dbcp.managed is the same as current TRUNK) and geronimo-transaction-1.0.&lt;/p&gt;

&lt;p&gt;We are having recurrent OutOfMemory which occur on a 2 days basis.&lt;br/&gt;
I analyzed the Heap Dump and I think have found the source of the problem:&lt;br/&gt;
The Heap Dump shows a Retained Heap of 400Mo by org.apache.commons.dbcp.managed.TransactionRegistry#xaResources field.&lt;/p&gt;

&lt;p&gt;After analyzing more deeply, the leak seems to come from what is stored in xaResources through&lt;br/&gt;
xaResources.put(connection, xaResource);&lt;/p&gt;

&lt;p&gt;Values inside weak Hash map  will never be removed since XAResource holds a STRONG reference on key (connection) through:&lt;br/&gt;
org.apache.commons.dbcp.managed.LocalXAConnectionFactory$LocalXAResource through:&lt;br/&gt;
public LocalXAResource(Connection localTransaction) &lt;/p&gt;
{
            this.connection = localTransaction;
        }


&lt;p&gt;Found in WeakHashMap javadoc:&lt;br/&gt;
Implementation note: The value objects in a WeakHashMap are held by ordinary strong references. &amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;Thus care should be taken to ensure that value objects do not strongly refer to their own keys &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;, either directly or indirectly, since that will prevent the keys from being discarded. Note that a value object may refer indirectly to its key via the WeakHashMap itself; that is, a value object may strongly refer to some other key object whose associated value object, in turn, strongly refers to the key of the first value object. One way to deal with this is to wrap values themselves within WeakReferences before inserting, as in: m.put(key, new WeakReference(value)), and then unwrapping upon each get. &lt;/p&gt;

&lt;p&gt;Philippe Mouawad&lt;br/&gt;
&lt;a href=&quot;http://www.ubik-ingenierie.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ubik-ingenierie.com&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK5, Oracle 10G,Postgres 8.x&lt;/p&gt;</environment>
        <key id="12427743">DBCP-294</key>
            <summary>Memory leak in XA Implementation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="psteitz">Phil Steitz</assignee>
                                    <reporter username="pmouawad">Philippe Mouawad</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Jun 2009 13:47:54 +0000</created>
                <updated>Mon, 15 Feb 2010 02:22:02 +0000</updated>
                            <resolved>Sun, 25 Oct 2009 16:28:21 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4</version>
                    <version>2.0</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>5</votes>
                                    <watches>5</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="187200">52h</timeoriginalestimate>
                            <timeestimate seconds="187200">52h</timeestimate>
                                        <comments>
                            <comment id="12718978" author="pmouawad" created="Fri, 12 Jun 2009 21:06:08 +0000"  >&lt;p&gt;Please find attached a patch to TransactionRegistry.&lt;br/&gt;
The idea is to unregister connection instead of relying on WeakHashMap release.&lt;br/&gt;
Release will be done by PoolableManagedConnection#reallyClose()&lt;/p&gt;

&lt;p&gt;Philippe Mouawad&lt;br/&gt;
&lt;a href=&quot;http://www.ubik-ingenierie.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ubik-ingenierie.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12719267" author="pmouawad" created="Sun, 14 Jun 2009 14:08:15 +0000"  >&lt;p&gt;After investigating more deeply I understood what was happening.&lt;/p&gt;

&lt;p&gt;1) In Ofbiz configuration the DBCP evictor Thread is configured.&lt;br/&gt;
2) When that thread runs, it kills down idle connection =&amp;gt; THIS IS THE PROBLEM&lt;br/&gt;
3) TransactionRegistry holds a through LocalXAResource a reference on a connection created by DriverConnectionFactory&lt;br/&gt;
4) When evictor kill down a PoolableConnection calling reallyClose(), the underlying JDBC connection does not unregister from TransactionRegistry#xaResources provoking the leak.&lt;/p&gt;

&lt;p&gt;I send a TestCase that reproduces the bug, here necessary elements:&lt;br/&gt;
Script for Postgres:&lt;/p&gt;

&lt;p&gt;CREATE TABLE cb_memory_monitoring_info&quot;(&lt;br/&gt;
mmi_id int8 PRIMARY KEY not null,&lt;br/&gt;
mmi_console_id varchar not null,&lt;br/&gt;
mmi_name varchar not null,&lt;br/&gt;
mmi_date timestamp not null,&lt;br/&gt;
mmi_value int4)&lt;/p&gt;


&lt;p&gt;Run TestBug with:&lt;br/&gt;
-Dcom.sun.management.jmxremote -Xmx4m -Xms4m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=C:/temp&lt;/p&gt;

&lt;p&gt;It will generate a heapDump after some seconds, look a TransactionRegistry#xaResources size, it will be around 110 elements&lt;/p&gt;


&lt;p&gt;Then run TestBugPatch with:&lt;br/&gt;
-Dcom.sun.management.jmxremote -Xmx4m -Xms4m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=C:/temp&lt;/p&gt;

&lt;p&gt;It will never run out of memory, TransactionRegistry#xaResources never grows over &lt;/p&gt;

&lt;p&gt;Philippe Mouawad&lt;br/&gt;
&lt;a href=&quot;http://www.ubik-ingenierie.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ubik-ingenierie.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12719268" author="pmouawad" created="Sun, 14 Jun 2009 14:09:29 +0000"  >&lt;p&gt;Implementations of PoolableConnectionFactory and PoolableConnection that work well with managed connections SOLVING the OOM&lt;/p&gt;</comment>
                            <comment id="12719269" author="pmouawad" created="Sun, 14 Jun 2009 14:16:05 +0000"  >&lt;p&gt;Test case&lt;/p&gt;</comment>
                            <comment id="12719275" author="pmouawad" created="Sun, 14 Jun 2009 15:07:03 +0000"  >&lt;p&gt;Moved implementations to org.apache.commons.dbcp.managed&lt;/p&gt;</comment>
                            <comment id="12719277" author="pmouawad" created="Sun, 14 Jun 2009 15:10:11 +0000"  >&lt;p&gt;Patch to TransactionRegistry&lt;/p&gt;</comment>
                            <comment id="12719278" author="pmouawad" created="Sun, 14 Jun 2009 15:12:56 +0000"  >&lt;p&gt;Cleanup some code&lt;/p&gt;</comment>
                            <comment id="12719279" author="psteitz" created="Sun, 14 Jun 2009 15:27:41 +0000"  >&lt;p&gt;Thanks for reporting this.  Reviewing the patch, setting fix version to 1.3&lt;/p&gt;</comment>
                            <comment id="12719306" author="pmouawad" created="Sun, 14 Jun 2009 17:22:43 +0000"  >&lt;p&gt;One more precision, in a previous comment I said that problem was due mainly to Evictor Thread.&lt;br/&gt;
The problem will occur even if Evictor Thread does not run aggressively, in fact each time Commons-pool destroy a PoolableConnection (call to reallyClose()) (which may occur outside of Evictor Thread depending on idle management configuration), this destroyed connection will generate a leak.&lt;/p&gt;

&lt;p&gt;Philippe Mouawad&lt;br/&gt;
&lt;a href=&quot;http://www.ubik-ingenierie.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ubik-ingenierie.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12724822" author="pmouawad" created="Sat, 27 Jun 2009 08:34:09 +0000"  >&lt;p&gt;Memory image of Production server.&lt;br/&gt;
4 days of run. &lt;br/&gt;
Around the point 3800 patch was put in production.&lt;br/&gt;
You can see that memory leak is solved.&lt;/p&gt;

&lt;p&gt;Philippe Mouawad&lt;br/&gt;
&lt;a href=&quot;http://www.ubik-ingenierie.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ubik-ingenierie.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12769832" author="psteitz" created="Sun, 25 Oct 2009 16:28:21 +0000"  >&lt;p&gt;Applied the patch with the following changes/additions:&lt;/p&gt;

&lt;p&gt;1) Modified BasicDataSource to allow BasicManagedDataSource to use PoolableManagedConnectionFactory&lt;br/&gt;
2) Added a &quot;full&quot; constructor for PMCF so BasicManagedDataSource properties can be set&lt;br/&gt;
3) Made initializeConnection protected in PCF and added call to this in PMCF#makeObject()&lt;br/&gt;
4) Modified PoolableManagedConnection constructor to not ignore abandonedConfig parameter&lt;br/&gt;
4) Added a test case demonstrating the bug&lt;/p&gt;

&lt;p&gt;Thanks for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12410576" name="PoolableManagedConnection.java" size="1128" author="pmouawad" created="Sun, 14 Jun 2009 15:07:03 +0000"/>
                            <attachment id="12410577" name="PoolableManagedConnectionFactory.java" size="1991" author="pmouawad" created="Sun, 14 Jun 2009 15:07:03 +0000"/>
                            <attachment id="12410580" name="Test.zip" size="661292" author="pmouawad" created="Sun, 14 Jun 2009 15:12:56 +0000"/>
                            <attachment id="12410579" name="TransactionRegistry-patch.txt" size="1220" author="pmouawad" created="Sun, 14 Jun 2009 15:10:11 +0000"/>
                            <attachment id="12411981" name="memory.png" size="6214" author="pmouawad" created="Sat, 27 Jun 2009 08:34:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114571</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uv9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178207</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-293] Closed statement exception using Oracle 11g and JDK Jrockit 1.6</title>
                <link>https://issues.apache.org/jira/browse/DBCP-293</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;After upgrade to latest version of weblogic which now includes jdk 1.6 I am running into an exception where statements appear to be closed but still reside in the statement cache. It appears related to transaction rollback and closing of connection for which statement was originally prepared. Exception stack is as follows:&lt;br/&gt;
 java.sql.SQLException: Closed Statement&lt;br/&gt;
        at oracle.jdbc.driver.SQLStateMapping.newSQLException(SQLStateMapping.java:70)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.newSQLException(DatabaseError.java:112)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:173)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:229)&lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:403)&lt;br/&gt;
        at oracle.jdbc.driver.OracleClosedStatement.setQueryTimeout(OracleClosedStatement.java:2438)&lt;br/&gt;
        at oracle.jdbc.driver.OracleStatementWrapper.setQueryTimeout(OracleStatementWrapper.java:250)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingStatement.setQueryTimeout(DelegatingStatement.java:246)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingStatement.setQueryTimeout(DelegatingStatement.java:246)&lt;br/&gt;
        at com.healthedge.j2ee.DBConnectionImpl.prepareStatement(DBConnectionImpl.java:208)&lt;/p&gt;

&lt;p&gt;Jocl file looks like this:&lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;object class=&quot;org.apache.commons.dbcp.PoolableConnectionFactory&quot; xmlns=&quot;http://apache.org/xml/xmlns/jakarta/commons/jocl&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;!--&lt;br/&gt;
      The first argument to PoolableConnectionFactory is a ConnectionFactory.&lt;br/&gt;
      We&apos;ll use a DriverManagerConnectionFactory, passing in the appropriate&lt;br/&gt;
      connect string for the underlying driver.&lt;br/&gt;
    --&amp;gt;&lt;br/&gt;
   &amp;lt;object class=&quot;org.apache.commons.dbcp.DriverManagerConnectionFactory&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;string value=&quot;jdbc:oracle:thin:@localhost:1521:orcl&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;string value=&quot;schema&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;string value=&quot;password&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;/object&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;!--&lt;br/&gt;
      The next argument is the pool to use.  We&apos;ll use a StackObjectPool,&lt;br/&gt;
      although any implementation of ObjectPool should suffice.&lt;/p&gt;

&lt;p&gt;      Since we are running on single connection from the client anyway,&lt;br/&gt;
      there is not a need to tune this to perfection.&lt;br/&gt;
    --&amp;gt;&lt;br/&gt;
   &amp;lt;object class=&quot;org.apache.commons.pool.impl.StackObjectPool&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;!--&lt;br/&gt;
      The next argument is the KeyedObjectPoolFactory to use to create pools&lt;br/&gt;
      for storing PreparedStatements.  This functionality is optional, it can&lt;br/&gt;
      be disabled by using the line below.&lt;/p&gt;

&lt;p&gt;   &amp;lt;object class=&quot;org.apache.commons.pool.KeyedObjectPoolFactory&quot; null=&quot;true&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;    --&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;object class=&quot;org.apache.commons.pool.impl.GenericKeyedObjectPoolFactory&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;object class=&quot;org.apache.commons.pool.KeyedPoolableObjectFactory&quot; null=&quot;true&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;      &amp;lt;int value=&quot;20&quot;/&amp;gt;    &lt;br/&gt;
      &amp;lt;byte value=&quot;2&quot;/&amp;gt;    &lt;br/&gt;
      &amp;lt;long value=&quot;2000&quot;/&amp;gt; &lt;br/&gt;
      &amp;lt;int value=&quot;200&quot;/&amp;gt;   &lt;br/&gt;
      &amp;lt;int value=&quot;300&quot;/&amp;gt;   &lt;br/&gt;
   &amp;lt;/object&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;!--&lt;br/&gt;
      The next argument is the query to use to validate that a Connection is&lt;br/&gt;
      still up and running.  It should return at least one row.&lt;br/&gt;
      This functionality is optional. We&apos;ll just set it to null.&lt;br/&gt;
   &amp;lt;string null=&quot;true&quot;/&amp;gt; &lt;br/&gt;
    --&amp;gt;&lt;br/&gt;
   &amp;lt;string value=&quot;select 1 from age_range&quot;/&amp;gt; &lt;br/&gt;
   &amp;lt;boolean value=&quot;false&quot;/&amp;gt; &amp;lt;!-- The default &quot;read only&quot; value for Connections. --&amp;gt; &lt;br/&gt;
   &amp;lt;boolean value=&quot;false&quot;/&amp;gt; &amp;lt;!-- The default &quot;auto commit&quot; value for Connections. --&amp;gt; &lt;/p&gt;

&lt;p&gt;&amp;lt;/object&amp;gt;&lt;/p&gt;

&lt;p&gt;Disabling statement cache eliminates the exception. &lt;/p&gt;

&lt;p&gt;This is my first time reporting an issue in this forum, so if I filed it in a wrong place please let me know. I searched bugs, but have not found anything that would be similar to this. &lt;/p&gt;</description>
                <environment>&lt;p&gt;dbcp 1.2.1&lt;br/&gt;
Oracle 11g, &lt;br/&gt;
oracle driver from weblogic 10.3 distribution  server/ext/jdbc/oracle/11g/ojdbc6.jar, &lt;br/&gt;
$ java -version&lt;br/&gt;
java version &quot;1.6.0_05&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_05-b13)&lt;br/&gt;
BEA JRockit(R) (build R27.6.0-50_o-100423-1.6.0_05-20080626-2104-linux-ia32, compiled mode)&lt;/p&gt;</environment>
        <key id="12427476">DBCP-293</key>
            <summary>Closed statement exception using Oracle 11g and JDK Jrockit 1.6</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ekrylov@pobox.com">Eugene Krylov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2009 17:27:38 +0000</created>
                <updated>Mon, 15 Feb 2010 02:22:34 +0000</updated>
                            <resolved>Fri, 12 Jun 2009 16:09:45 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12718891" author="ekrylov@pobox.com" created="Fri, 12 Jun 2009 16:09:45 +0000"  >&lt;p&gt;This appears to be working in the latest trunk version. Sorry about any inconvenience.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114570</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 21 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uvvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178307</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-291] setting maxWait does not work as expected</title>
                <link>https://issues.apache.org/jira/browse/DBCP-291</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;My expectation was that if maxWait is set to X seconds and there are N requests waiting to get a connection (in a case where the pool is bounded and &lt;br/&gt;
all the connection are used) if none of the used connection gets free than all N requests will time-out at the same time.&lt;br/&gt;
In reality it seems that 1 request will be timed-out after X seconds the second one after 2 * X and the last one after N * X.&lt;br/&gt;
The problem is that getPooledConnectionAndInfo is synchronized (and therefore will look all N requests) and only one request will be processed at the time.&lt;br/&gt;
This process includes waiting until freed connection or timed-out (done by commons.pool GenericKeyedObjectPool).&lt;br/&gt;
I am not sure why the getPooledConnectionAndInfo has to be synchronized and not only the pool creation part.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12382393">DBCP-291</key>
            <summary>setting maxWait does not work as expected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aozarov@hotmail.com">Arie</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Nov 2007 01:17:29 +0000</created>
                <updated>Mon, 15 Feb 2010 02:23:32 +0000</updated>
                            <resolved>Thu, 24 Dec 2009 20:13:51 +0000</resolved>
                                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12543460" author="psteitz" created="Mon, 19 Nov 2007 03:48:06 +0000"  >&lt;p&gt;Improving precision in per-thread timeouts will require more advanced scheduling than is currently available.  Best to wait for JDK source level 1.5.&lt;/p&gt;</comment>
                            <comment id="12543477" author="aozarov@hotmail.com" created="Mon, 19 Nov 2007 07:35:48 +0000"  >&lt;p&gt;Not sure what did you have in your mind but util.concurrent (if needed) is available as concurrent.util for JDK &amp;lt; 1.5&lt;/p&gt;</comment>
                            <comment id="12699932" author="jcbollinger" created="Thu, 16 Apr 2009 23:48:07 +0000"  >&lt;p&gt;I tested this against the dev code for 2.0 and 1.5, and both seem to behave as desired already.  If multiple threads invoke borrowObject() while the pool is exhausted, then each one waits approximately _maxWait milliseconds before failing with a NoSuchElementException.  If they all make their requests at approximately the same time, then the total time for all to finish waiting is also approximately _maxWait milliseconds (not N * _maxWait).&lt;/p&gt;

&lt;p&gt;It looks like this issue may have originally been filed against a different project that uses Pool.  If the problem persists there then it probably belongs to that project, not to Pool.&lt;/p&gt;</comment>
                            <comment id="12710234" author="markt" created="Sun, 17 May 2009 23:05:32 +0000"  >&lt;p&gt;A check of  DBCP confirms that getPooledConnectionAndInfo() is indeed a DBCP method so I have moved this issue to DBCP.&lt;/p&gt;</comment>
                            <comment id="12722379" author="markt" created="Sun, 21 Jun 2009 16:27:55 +0000"  >&lt;p&gt;Test case added and issue fixed. The fix will be in 1.3 onwards.&lt;/p&gt;</comment>
                            <comment id="12794277" author="psteitz" created="Wed, 23 Dec 2009 23:39:46 +0000"  >&lt;p&gt;We need to protect the userkeys map.  The uderlying LRUMap impl is not threadsafe.  I just got this:&lt;/p&gt;

&lt;p&gt; org.apache.commons.dbcp.SQLNestedException: Could not retrieve connection info from pool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SharedPoolDataSource.getPooledConnectionAndInfo(SharedPoolDataSource.java:183)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:680)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.TestSharedPoolDataSource.getConnection(TestSharedPoolDataSource.java:49)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.TestConnectionPool.newConnection(TestConnectionPool.java:84)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.TestConnectionPool$TestThread.run(TestConnectionPool.java:595)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Caused by: java.lang.NullPointerException&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SequencedHashMap.removeEntry(SequencedHashMap.java:217)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SequencedHashMap.removeImpl(SequencedHashMap.java:471)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SequencedHashMap.remove(SequencedHashMap.java:459)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.LRUMap.get(LRUMap.java:97)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SharedPoolDataSource.getUserPassKey(SharedPoolDataSource.java:203)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SharedPoolDataSource.getPooledConnectionAndInfo(SharedPoolDataSource.java:172)&lt;/p&gt;

&lt;p&gt;The problem is (I think) caused by concurrent modification to the LRUMap.  The get method modifies the map.&lt;/p&gt;
</comment>
                            <comment id="12794489" author="psteitz" created="Thu, 24 Dec 2009 20:13:51 +0000"  >&lt;p&gt;Fixed threadsafety issue in r893809&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114568</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uvs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178290</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-290] java.sql.SQLException: Closed Statement </title>
                <link>https://issues.apache.org/jira/browse/DBCP-290</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;We are getting below exception in production randomly..Using Spring(2.5) JDBC for all our DB related functionality.We don&apos;t handle any DB resources directly.everything thru Spring JDBC template. This app was running fine in Weblogic but after migrating to Tomcat6+DBCP(1.2.2) we are seeing the below exception. &lt;/p&gt;

&lt;p&gt;We also looked our code base for any threading or concurrency issues..we were not able spot any issues. &lt;/p&gt;


&lt;p&gt;I have observed one more thing..why checkOpen in DelegatingPreparedStatement didn&apos;t catch this but OracleStatement thinks the statement is closed.&lt;br/&gt;
Is it bcos the DBCP is returing the closed connection? (&lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-273&quot; title=&quot;validation on testonborrow does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-273&quot;&gt;&lt;del&gt;DBCP-273&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;





&lt;p&gt;Caused by: org.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException for SQL &lt;span class=&quot;error&quot;&gt;&amp;#91;INSERT INTO AUDIT_TRAIL ( DEAL_ID , AUDIT_TRAIL_ID ) VALUES ( ?,? ) &amp;#93;&lt;/span&gt;; SQL state &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;; error code &lt;span class=&quot;error&quot;&gt;&amp;#91;17009&amp;#93;&lt;/span&gt;; Closed Statement; nested exception is java.sql.SQLException: Closed Statement &lt;br/&gt;
        at org.springframework.jdbc.support.SQLStateSQLExceptionTranslator.translate(SQLStateSQLExceptionTranslator.java:124) &lt;br/&gt;
        at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.translate(SQLErrorCodeSQLExceptionTranslator.java:322) &lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:607) &lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:792) &lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:815) &lt;br/&gt;
        at org.springframework.jdbc.object.SqlUpdate.update(SqlUpdate.java:168) &lt;br/&gt;
        at com.dao.DealXAuditTrailDaoBase.insertDealXAuditTrailVoBase(Unknown Source) &lt;br/&gt;
        at com.deal.DealTO.insertAuditTrail(DealTO.java:183) &lt;br/&gt;
        at com.deal.DealTO.processAuditTrail(DealTO.java:168) &lt;br/&gt;
        at com.deal.DealTO.update(DealTO.java:110) &lt;br/&gt;
        at com.deal.DealTO$$FastClassByCGLIB$$fba55fe6.invoke(&amp;lt;generated&amp;gt;) &lt;br/&gt;
        at net.sf.cglib.proxy.MethodProxy.invoke(MethodProxy.java:149) &lt;br/&gt;
        at org.springframework.aop.framework.Cglib2AopProxy$CglibMethodInvocation.invokeJoinpoint(Cglib2AopProxy.java:700) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149) &lt;br/&gt;
        at com.businessrules.SpexBusinessRuleValidator.invoke(SpexBusinessRuleValidator.java:64) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171) &lt;br/&gt;
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:106) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171) &lt;br/&gt;
        at org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:635) &lt;br/&gt;
        at com.deal.DealTO$$EnhancerByCGLIB$$54d9c9a4.update(&amp;lt;generated&amp;gt;) &lt;br/&gt;
        at com.entity.EntityGeneralInfoController.copyFieldsToDeal(EntityGeneralInfoController.java:1158) &lt;br/&gt;
        at com.entity.EntityGeneralInfoController.doSave(EntityGeneralInfoController.java:429) &lt;br/&gt;
        ... 30 more &lt;br/&gt;
Caused by: java.sql.SQLException: Closed Statement &lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:125) &lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:162) &lt;br/&gt;
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:227) &lt;br/&gt;
        at oracle.jdbc.driver.OracleStatement.ensureOpen(OracleStatement.java:3249) &lt;br/&gt;
        at oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:2867) &lt;br/&gt;
        at oracle.jdbc.driver.OraclePreparedStatement.executeUpdate(OraclePreparedStatement.java:2957) &lt;br/&gt;
        at org.apache.tomcat.dbcp.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:102) &lt;br/&gt;
        at org.apache.tomcat.dbcp.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:102) &lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:798) &lt;br/&gt;
        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:591) &lt;/p&gt;




&lt;p&gt;        &amp;lt;Resource name=&quot;oracleDS&quot; auth=&quot;Container&quot; &lt;br/&gt;
                                type=&quot;javax.sql.DataSource&quot; &lt;br/&gt;
                                driverClassName=&quot;oracle.jdbc.OracleDriver&quot; &lt;br/&gt;
                                url=&quot;jdbc:oracle:thin:@xxxxx:1521:xxxxx&quot; &lt;br/&gt;
                                username=&quot;xxxx&quot; password=&quot;xxxx&quot; &lt;br/&gt;
                                initialSize=&quot;2&quot; maxActive=&quot;30&quot; maxIdle=&quot;30&quot; maxWait=&quot;3000&quot; minIdle=&quot;0&quot; &lt;br/&gt;
                                testOnBorrow=&quot;true&quot; testOnReturn=&quot;false&quot; testWhileIdle=&quot;false&quot; &lt;br/&gt;
                                poolPreparedStatements=&quot;true&quot; maxOpenPreparedStatements=&quot;10&quot; &lt;br/&gt;
                                removedAbandoned=&quot;true&quot; removeAbandonedTimeout=&quot;60&quot; &lt;br/&gt;
                                logAbandoned=&quot;true&quot; validationQuery=&quot;select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from dual&quot;/&amp;gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12424494">DBCP-290</key>
            <summary>java.sql.SQLException: Closed Statement </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ashoknan">kan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 May 2009 04:12:38 +0000</created>
                <updated>Wed, 30 Jun 2010 21:16:44 +0000</updated>
                            <resolved>Mon, 18 May 2009 20:48:40 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12710485" author="markt" created="Mon, 18 May 2009 20:48:39 +0000"  >&lt;p&gt;Marking this as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-273&quot; title=&quot;validation on testonborrow does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-273&quot;&gt;&lt;del&gt;DBCP-273&lt;/del&gt;&lt;/a&gt; as I can&apos;t see anything that suggests a different root cause. Once DBCP 1.3 is out then please re-open if you still see this issue.&lt;/p&gt;</comment>
                            <comment id="12884062" author="basavesh.b@spi.com" created="Wed, 30 Jun 2010 21:16:41 +0000"  >&lt;p&gt;Dear Jira,&lt;/p&gt;



&lt;p&gt;I am facing the same issue as what you are reported in the Forum. I would&lt;br/&gt;
appreciate if you can let me know how this was resolved. Thanks in Advance.&lt;/p&gt;

&lt;p&gt;We are using WAS 6.0 in the production environment and having this problem.&lt;/p&gt;



&lt;p&gt;Here is the log.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;6/30/10 10:08:00:833 EDT&amp;#93;&lt;/span&gt; 00000034 SystemOut     O If Last case&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;6/30/10 10:08:00:834 EDT&amp;#93;&lt;/span&gt; 00000034               E   StatementCallback;&lt;br/&gt;
uncategorized SQLException for SQL [SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM USER WHERE&lt;br/&gt;
UPPER(USER_ID) = UPPER(&apos;cj4&apos;) ]; SQL state &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;; error code &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;br/&gt;
DSRA9110E: Connection is closed.; nested exception is&lt;br/&gt;
com.ibm.websphere.ce.cm.ObjectClosedException: DSRA9110E: Connection is&lt;br/&gt;
closed.&lt;/p&gt;


&lt;p&gt;org.springframework.jdbc.UncategorizedSQLException: StatementCallback;&lt;br/&gt;
uncategorized SQLException for SQL [SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM VPT.VPT_USER WHERE&lt;br/&gt;
UPPER(USER_ID) = UPPER(&apos;zmmicj4&apos;) ]; SQL state &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;; error code &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;br/&gt;
DSRA9110E: Connection is closed.; nested exception is&lt;br/&gt;
com.ibm.websphere.ce.cm.ObjectClosedException: DSRA9110E: Connection is&lt;br/&gt;
closed.&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.support.SQLStateSQLExceptionTranslator.translate(SQ&lt;br/&gt;
LStateSQLExceptionTranslator.java:124)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.translat&lt;br/&gt;
e(SQLErrorCodeSQLExceptionTranslator.java:322)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:407)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:458)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:466)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:&lt;br/&gt;
474)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:&lt;br/&gt;
479)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
org.springframework.jdbc.core.JdbcTemplate.queryForInt(JdbcTemplate.java:488&lt;br/&gt;
)&lt;/p&gt;

&lt;p&gt;        at com.hbc.vp.daos.LoginDAOImpl.getUserCount(LoginDAOImpl.java:142)&lt;/p&gt;

&lt;p&gt;        at com.hbc.vp.daos.LoginDAOImpl.getUserCount(LoginDAOImpl.java:112)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
com.hbc.vp.services.LoginService.authenticateUser(LoginService.java:245)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
com.hbc.vp.controllers.LoginController.login(LoginController.java:131)&lt;/p&gt;

&lt;p&gt;        at sun.reflect.GeneratedMethodAccessor411.invoke(Unknown Source)&lt;/p&gt;

&lt;p&gt;        at&lt;br/&gt;
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl&lt;br/&gt;
.java:37)&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;


&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Basavesh&lt;/p&gt;


</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v03j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178989</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-288] DelegatingConnection implicitly casts AbandonedTrace to Statement</title>
                <link>https://issues.apache.org/jira/browse/DBCP-288</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;If a &lt;tt&gt;ManagedConnection&lt;/tt&gt; is put back to the connection pool it gets passivated (&lt;tt&gt;GenericObjectPool line 1101&lt;/tt&gt;) by calling &lt;tt&gt;passivateObject()&lt;/tt&gt; on the &lt;tt&gt;PoolableConnectionFactory&lt;/tt&gt; which calls passivate() on the &lt;tt&gt;DelegatingConnection&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;passivate()&lt;/tt&gt; in &lt;tt&gt;DelegatingConnection&lt;/tt&gt; then executes the following code: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
List statements = getTrace();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( statements != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  Statement[] set = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Statement[statements.size()];
  statements.toArray(set);
  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; set.length; i++) {
    set[i].close();
  }
  clearTrace();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is an implicit cast from &lt;tt&gt;AbandonedTrace&lt;/tt&gt; to &lt;tt&gt;Statement&lt;/tt&gt; since &lt;tt&gt;getTrace()&lt;/tt&gt; returns a list of &lt;tt&gt;AbandonedTrace&lt;/tt&gt; instances. &lt;br/&gt;
If the list contains other instances than those, that implement Statement an ArrayStoreException is thrown at &lt;tt&gt;statements.toArray(set)&lt;/tt&gt; (line 416). See &lt;a href=&quot;http://java.sun.com/j2se/1.4.2/docs/api/java/util/ArrayList.html#toArray(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/j2se/1.4.2/docs/api/java/util/ArrayList.html#toArray(&lt;/a&gt;) for details. &lt;/p&gt;

&lt;p&gt;I&apos;d say this is a bug since &lt;tt&gt;AbandonedTrace&lt;/tt&gt; does not implement &lt;tt&gt;Statement&lt;/tt&gt; and there are derived classes that do not implement it also. &lt;/p&gt;

&lt;p&gt;In my case the list returned by &lt;tt&gt;getTrace()&lt;/tt&gt; contains instances of &lt;tt&gt;DelegatingDatabaseMetaData&lt;/tt&gt; which causes the mentioned &lt;tt&gt;ArrayStoreException&lt;/tt&gt;. &lt;/p&gt;</description>
                <environment>&lt;p&gt;I am using DBCP from svn-trunk (rev 766626).&lt;/p&gt;

&lt;p&gt;I am using the BasicManagedDatasource with the MysqlXADataSource.&lt;/p&gt;

&lt;p&gt;Configuration of BasicDataSource: &lt;br/&gt;
maxActive=&quot;10&quot;&lt;br/&gt;
maxIdle=&quot;10&quot;&lt;br/&gt;
maxWait=&quot;5000&quot;&lt;br/&gt;
minIdle=&quot;0&quot;&lt;br/&gt;
initialSize=&quot;2&quot;&lt;br/&gt;
removeAbandoned=&quot;true&quot;&lt;br/&gt;
removeAbandonedTimeout=&quot;120&quot;&lt;br/&gt;
logAbandoned=&quot;true&quot;&lt;/p&gt;</environment>
        <key id="12423262">DBCP-288</key>
            <summary>DelegatingConnection implicitly casts AbandonedTrace to Statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kannegiesser">Marc Kannegie&#223;er</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Apr 2009 09:38:28 +0000</created>
                <updated>Mon, 15 Feb 2010 02:24:42 +0000</updated>
                            <resolved>Sun, 21 Jun 2009 16:43:00 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12700713" author="kannegiesser" created="Mon, 20 Apr 2009 09:40:15 +0000"  >&lt;p&gt;This patch fixes the problem for me:&lt;br/&gt;
it iterates over the list and checks if the element is a Statement and explicitly casts it to Statement if so. &lt;/p&gt;</comment>
                            <comment id="12722381" author="markt" created="Sun, 21 Jun 2009 16:43:00 +0000"  >&lt;p&gt;Many thanks for the patch. I have applied it (with some minor modifications) to trunk and it will be included in 1.3 onwards.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12405905" name="delegating_connection_close_statements.patch" size="1466" author="kannegiesser" created="Mon, 20 Apr 2009 09:40:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178600</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-286] DBCP does not rollback</title>
                <link>https://issues.apache.org/jira/browse/DBCP-286</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;DBCP 1.2.2 does not do connection rollbacks.  Or, at least the one in maven 2 repositories does not.  I switched back to 1.2.1, and it works great.&lt;/p&gt;

&lt;p&gt;I asked about this back in 2005, and it was stated that it did.  And, it does, up until 1.2.2&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/commons-user/200504.mbox/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/commons-user/200504.mbox/&lt;/a&gt;&amp;lt;425CB254.1020504@pandora.be&amp;gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;maven, gentoo linux, any java version&lt;/p&gt;</environment>
        <key id="12419684">DBCP-286</key>
            <summary>DBCP does not rollback</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="trent">Trent Nelson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Mar 2009 22:33:20 +0000</created>
                <updated>Mon, 15 Feb 2010 02:27:12 +0000</updated>
                            <resolved>Sun, 20 Sep 2009 16:24:22 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12693437" author="psteitz" created="Sat, 28 Mar 2009 13:43:47 +0000"  >&lt;p&gt;Can you provide some more information on your environment and what exactly you are observing?  &lt;/p&gt;

&lt;p&gt;Specifically - autocommit, readonly (when connection is returned and default values), testOnBorrow, testOnReturn, pool version, jdbc driver.  I assume that what you are seeing is when a connection is returned with readonly=false, automcommit=false, no rollback is happening in 1.2.2.  Correct?  &lt;/p&gt;</comment>
                            <comment id="12693838" author="trent" created="Mon, 30 Mar 2009 16:53:12 +0000"  >&lt;p&gt;We turn autocommit off usually.  In this case, it is turned off, which is why I noticed this.  I was trying to retrieve a record that had just been inserted, but it wasn&apos;t showing up.  So, a co-worker mentioned that I might be in a transaction, which would prevent me from seeing the latest records.  So, I knew that there was no way that &quot;I&quot; was in the middle of a transaction.  So, I decided to do a rollback just after getting the connection, and it then worked.  Then i tried 1.2.1, to see if it worked, without my own rollback, and it did.&lt;/p&gt;

&lt;p&gt;      connectionPool.setTestOnBorrow(true);&lt;br/&gt;
      connectionPool.setTestOnReturn(true);&lt;br/&gt;
      test is SELECT &apos;ping&apos; FROM dual&lt;br/&gt;
Oh, and autocommit is on by default, but turned off in each classes that gets a connection.&lt;/p&gt;

&lt;p&gt;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;- 1 trenta trenta  559366 Jul 17  2008 commons-collections-3.1.jar&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;- 1 trenta trenta  121757 Mar 27 15:43 commons-dbcp-1.2.2.jar&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;- 1 trenta trenta   42492 Jul 17  2008 commons-pool-1.2.jar&lt;/p&gt;

&lt;p&gt;Java 1.4.2-03, which I assume is JDBC2&lt;/p&gt;

&lt;p&gt;&amp;gt; I assume that what you are seeing is when a connection is returned with readonly=false, automcommit=false, no rollback is &lt;br/&gt;
&amp;gt; happening in 1.2.2. Correct?&lt;/p&gt;

&lt;p&gt;Yes, that is what I am seeing.&lt;/p&gt;</comment>
                            <comment id="12695867" author="psteitz" created="Sun, 5 Apr 2009 15:47:14 +0000"  >&lt;p&gt;What jdbc driver are you using (i.e., what database and driver version?)&lt;/p&gt;

&lt;p&gt;Where exactly are you setting automcommit on the connection?  I assume this is on the connection returned by the pool, not defaultAutoCommit, right?&lt;/p&gt;

&lt;p&gt;Both 1.2.1 and 1.2.2 do the following when returning connections to the pool (PoolableConnectionFactory#passivate):&lt;/p&gt;

&lt;p&gt;   if(!conn.getAutoCommit() &amp;amp;&amp;amp; !conn.isReadOnly()) &lt;/p&gt;
{
                conn.rollback();
     }

&lt;p&gt; Both set autoCommit to true (independent of defaultAutocommit setting) after this, but 1.2.2 tests the value first&lt;/p&gt;

&lt;p&gt;    if(!conn.getAutoCommit()) &lt;/p&gt;
{
        conn.setAutoCommit(true);
    }

&lt;p&gt;1.2.1 always executes conn.setAutoCommit(true) without testing the value.&lt;/p&gt;

&lt;p&gt;Before giving a connection to a client (PoolableConnectionFactory#activate), 1.2.1 sets all values to the default settings directly, but 1.2.2 tests the values first, invoking setters only if getters return values different from the defaults.  These changes were to address &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-102&quot; title=&quot;[dbcp] setReadOnly &amp;amp; setAutoCommit called too many times&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-102&quot;&gt;&lt;del&gt;DBCP-102&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12697573" author="trent" created="Thu, 9 Apr 2009 17:49:34 +0000"  >&lt;p&gt;Sorry for taking so long to get back to you.  I almost forgot, as I received the email notification on the weekend.&lt;/p&gt;

&lt;p&gt;&amp;gt; What jdbc driver are you using&lt;br/&gt;
oracle 10.2.0.4.0&lt;/p&gt;

&lt;p&gt;&amp;gt; Where exactly are you setting automcommit on the connection?&lt;br/&gt;
      new PoolableConnectionFactory(&lt;br/&gt;
          new DriverManagerConnectionFactory(url, user, password),&lt;br/&gt;
          connectionPool, null,&lt;br/&gt;
          &quot;SELECT &apos;ping&apos; FROM dual&quot;, false,&lt;br/&gt;
          true, // auto commit&lt;br/&gt;
          Connection.TRANSACTION_SERIALIZABLE, null, abandonedConfig);&lt;/p&gt;

&lt;p&gt;Then other code will do&lt;br/&gt;
      connection.setAutoCommit (false);&lt;/p&gt;

&lt;p&gt;That certainly is odd, because there is a distinct behaviour change when I specify 1.2.1 in my maven pom file, and then switch to 1.2.2.  I haven&apos;t done a whole lot of debugging, so maybe I&apos;m reporting something other than problems with connection rollbacks.&lt;/p&gt;

&lt;p&gt;Basically what I am seeing is I create a record in the oracle database, using a &quot;single&quot; connection outside of the pool.  Then, I try to read that record back in another section of code, which gets a new connection from the pool.  The connection from the pool is unable to see the record, which I presumed is because the connection was not rolled back.  When I do a rollback, the record is then visible.  Then, as the next test, I don&apos;t do a rollback, but switch to 1.2.1, and it also works.&lt;/p&gt;

&lt;p&gt;Any ideas on how to identify this?&lt;/p&gt;</comment>
                            <comment id="12722419" author="markt" created="Sun, 21 Jun 2009 20:22:37 +0000"  >&lt;p&gt;I can&apos;t repeat this with a 11.1.0.6.0 database and a 10.2.0.4.0 driver.&lt;/p&gt;

&lt;p&gt;Can you provide a test case to reproduce this please?&lt;/p&gt;

&lt;p&gt;So it is easy to repeat your results, I suggest you base your test case on the SCOTT schema and the tables that already exist there.&lt;/p&gt;</comment>
                            <comment id="12754620" author="psteitz" created="Sat, 12 Sep 2009 21:52:35 +0000"  >&lt;p&gt;A couple more requests for information:&lt;/p&gt;

&lt;p&gt;1. Please provide full dbcp config&lt;br/&gt;
2. In maven POM, is there a pool version specified?  If not, and maven is filling dependencies in from the dbcp poms, the 1.2.1 version depends on pool 1.2 and 1.2.2 depends on pool 1.3.  One difference between these is that pool 1.3 operates as a FIFO queue.  In pool 1.4+ this is configurable and the default has been changed back to LIFO (as in 1.2).  &lt;/p&gt;</comment>
                            <comment id="12757734" author="markt" created="Sun, 20 Sep 2009 16:24:22 +0000"  >&lt;p&gt;I can&apos;t reproduce this based on the description and without a test case that demonstrates the issue there isn&apos;t much more that can be done.&lt;/p&gt;

&lt;p&gt;I am resolving this as &quot;Cannot reproduce&quot; but if you still see this problem with the latest versions of DBCP and POOL please do re-open this issue. You;ll need to attach the simplest possible test case that demonstrates the issue. As I suggested earlier, basing your test case on the SCOTT schema should make it easy for anyone to repeat your results&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114563</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179091</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-285] BasicDataSource is thread-safe, but allows sub-classes to violate that</title>
                <link>https://issues.apache.org/jira/browse/DBCP-285</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;BasicDataSource is thread-safe, because all variables are read/written via synchronised methods.&lt;/p&gt;

&lt;p&gt;However, since almost all the variables are protected, sub-classes can ignore the synchronisation and compromise thread safety.&lt;/p&gt;

&lt;p&gt;Not sure I see the point of allowing a sub-class to do this; the variables ought to be private.&lt;/p&gt;

&lt;p&gt;If this cannot be done, then I suggest updating the Javadoc to warn classes not to use the instance variables directly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12416863">DBCP-285</key>
            <summary>BasicDataSource is thread-safe, but allows sub-classes to violate that</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Mar 2009 19:15:24 +0000</created>
                <updated>Mon, 15 Feb 2010 02:26:36 +0000</updated>
                            <resolved>Sun, 15 Mar 2009 21:26:30 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12682178" author="markt" created="Sun, 15 Mar 2009 21:26:30 +0000"  >&lt;p&gt;Making fields private, whilst the technically correct option, would break compatibility and backwards compatibility takes priority.&lt;/p&gt;

&lt;p&gt;The suggested warning has been added.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114562</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178603</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-284] Access to BasicDataSource.initialSize not always synchronized</title>
                <link>https://issues.apache.org/jira/browse/DBCP-284</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Access to BasicDataSource.initialSize not always synchronized - BasicDataSourceFactory.createDataSource() reads the field directly instead of using getInitialSize().&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Probably not a good idea that the field is protected rather than private&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12415521">DBCP-284</key>
            <summary>Access to BasicDataSource.initialSize not always synchronized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Feb 2009 00:21:03 +0000</created>
                <updated>Mon, 15 Feb 2010 02:27:37 +0000</updated>
                            <resolved>Fri, 13 Mar 2009 18:41:44 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12681859" author="markt" created="Fri, 13 Mar 2009 18:41:44 +0000"  >&lt;p&gt;Fixed. Thanks for the report.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114561</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uww7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178470</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-282] defaultReadOnly not honored in server.xml for PerUserPoolDataSource</title>
                <link>https://issues.apache.org/jira/browse/DBCP-282</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Running dbcp-1.2.2 on Apache-2.0.55/Tomcat-4.1.29/Jakarta on Linux, using JDBC to connect to Oracle 10g DB.&lt;/p&gt;

&lt;p&gt;We are seeing the constant SET TRANSACTION READ WRITE activity against the DB connection, and although I appreciate the discussion about a new configuration option, I am not able to figure out how to disable this activity.&lt;/p&gt;

&lt;p&gt;Background on this issue can be found at:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/DBCP-178&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DBCP-178&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For reference, assume that we do not have control over the codebase, although we have full control over the server configuration (server.xml, etc).&lt;/p&gt;

&lt;p&gt;I found the configuration options page for DBCP- but there appears to be no discussion on the logistics/mechanics of how to set or change these configuration options.&lt;/p&gt;

&lt;p&gt;Our connections are implemented as  type=&quot;org.apache.commons.dbcp.datasources.PerUserPoolDataSource&quot; in server.xml.  We have tried setting the parameter in the ResourceParams section for the JDBC stanza, like this:&lt;/p&gt;

&lt;p&gt;&amp;lt;ResourceParams name=&quot;jdbc/OURDBINSTANCENAME&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;parameter&amp;gt;&lt;br/&gt;
      &amp;lt;name&amp;gt;factory&amp;lt;/name&amp;gt;&lt;br/&gt;
      &amp;lt;value&amp;gt;org.apache.commons.dbcp.datasources.PerUserPoolDataSourceFactory&amp;lt;/value&amp;gt;&lt;br/&gt;
   &amp;lt;/parameter&amp;gt;&lt;br/&gt;
   &amp;lt;parameter&amp;gt;&lt;br/&gt;
      &amp;lt;name&amp;gt;defaultReadOnly&amp;lt;/name&amp;gt;&lt;br/&gt;
      &amp;lt;value&amp;gt;notset&amp;lt;/value&amp;gt;&lt;br/&gt;
   &amp;lt;/parameter&amp;gt;&lt;br/&gt;
...&lt;br/&gt;
&amp;lt;/ResourceParams&amp;gt;&lt;/p&gt;

&lt;p&gt;...with no success.&lt;/p&gt;

&lt;p&gt;It should be noted that previous to discovering this issue, we did not have this parameter set at all; so I&apos;m not even sure if this is the proper location for this configuration directive.  I could not find any guidance in the DBCP documentation on where to put this stuff.&lt;/p&gt;

&lt;p&gt;Please advise,&lt;br/&gt;
Josh&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tomcat 4.1.29/Apache-2.0.55/Oracle JDBC on RedHat ES3.0 on i386&lt;/p&gt;</environment>
        <key id="12413624">DBCP-282</key>
            <summary>defaultReadOnly not honored in server.xml for PerUserPoolDataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dragonwyatt">Josh Wyatt</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Jan 2009 14:43:02 +0000</created>
                <updated>Tue, 3 Feb 2009 15:10:32 +0000</updated>
                            <resolved>Sat, 31 Jan 2009 13:23:43 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                            <timeestimate seconds="7200">2h</timeestimate>
                                        <comments>
                            <comment id="12668888" author="dragonwyatt" created="Fri, 30 Jan 2009 14:55:36 +0000"  >&lt;p&gt;Experimentally, I set the value to &apos;true&apos; and now I note that the SQL generated issues &apos;SET TRANSACTION READ ONLY&apos; instead of &apos;SET TRANSACTION READ WRITE.&apos;  So, two things to note.  Firstly, the config item is in the right place (since changing the value between false and true changes the behavior), and secondly, &apos;unset&apos; is not honored in this configuration location.&lt;/p&gt;</comment>
                            <comment id="12669182" author="psteitz" created="Sat, 31 Jan 2009 13:23:43 +0000"  >&lt;p&gt;This has been (mostly) fixed in svn trunk,  r558850 as the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-207&quot; title=&quot;DBCP 1.2.1 incompatible with Informix (driver doesn&amp;#39;t support setReadOnly(...))&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-207&quot;&gt;&lt;del&gt;DBCP-207&lt;/del&gt;&lt;/a&gt;.   What remains to fully complete the fix is making defaultReadOnly a Boolean (as it is in BasicDataSource) so that leaving the value unset ensures that the driver default is used.  With the changes in r558850, if false is not the driver default, users will have to configure the property to match the driver default if this is the desired behavior.   The general issue of uniformly using objects instead of primitives to represent configuration properties is being tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-234&quot; title=&quot;Only set *configured* default values for Connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-234&quot;&gt;&lt;del&gt;DBCP-234&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12669979" author="dragonwyatt" created="Tue, 3 Feb 2009 15:02:51 +0000"  >&lt;p&gt;I was able to get the desired behavior using commons-dbcp-1.2.2 with the following patch against PerUserPoolDataSource.java.&lt;br/&gt;
This was a backport of a similar code change noted in 1.3, and congruent with the research/recommendation in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-178&quot; title=&quot;[dbcp] With Oracle jdbc driver, an unnecessary SQL &amp;quot;set transaction read write&amp;quot; is issued each time a connection is retrieved from the pool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-178&quot;&gt;&lt;del&gt;DBCP-178&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&amp;#8212; commons-dbcp-1.2.2-src/src/java/org/apache/commons/dbcp/datasources/PerUserPoolDataSource.java      2007-03-25 17:51:25.000000000 -0400&lt;br/&gt;
+++ commons-dbcp-1.2.2b-src/src/java/org/apache/commons/dbcp/datasources/PerUserPoolDataSource.java     2009-01-31 09:36:31.000000000 -0500&lt;br/&gt;
@@ -419,7 +419,9 @@&lt;br/&gt;
         if (defaultTransactionIsolation != UNKNOWN_TRANSACTIONISOLATION) &lt;/p&gt;
{
             con.setTransactionIsolation(defaultTransactionIsolation);
         }
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;con.setReadOnly(defaultReadOnly);&lt;br/&gt;
+        if (con.isReadOnly() != defaultReadOnly) 
{
+           con.setReadOnly(defaultReadOnly);
+       }
&lt;p&gt;     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;/p&gt;

&lt;p&gt;Our testing indicates that this completely disables the defaultReadOnly parameter for PerUserPoolDataSource, which may not be desirable for some users.&lt;/p&gt;</comment>
                            <comment id="12669983" author="dragonwyatt" created="Tue, 3 Feb 2009 15:10:32 +0000"  >&lt;p&gt;Note the pasted version of the patch got a little garbled due to changing some chars, poor formatting, etc; this is the actual diff for the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12399361" name="patch.commons-dbcp-1.2.2-transaction.diff" size="606" author="dragonwyatt" created="Tue, 3 Feb 2009 15:10:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114559</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v00v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178977</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-281] [dbcp] Deadlock when evicting dbcp objects (testWhileIdle=true) [ re-open of DBCP-65]</title>
                <link>https://issues.apache.org/jira/browse/DBCP-281</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;re-open of &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-65&quot; title=&quot;[dbcp] Deadlock when evicting dbcp objects (testWhileIdle=true)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-65&quot;&gt;&lt;del&gt;DBCP-65&lt;/del&gt;&lt;/a&gt;... it ain&apos;t fixed yet&lt;/p&gt;

&lt;p&gt;The GenericKeyedObjectPool$Evictor thread can still deadlock with dbcp&lt;br/&gt;
objects.&lt;/p&gt;



&lt;p&gt;&quot;Timer-1&quot;:&lt;br/&gt;
	at org.apache.commons.dbcp.AbandonedTrace.addTrace(AbandonedTrace.java:175)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x13cb66c0&amp;gt; (a org.apache.commons.dbcp.PoolableConnection)&lt;br/&gt;
	at org.apache.commons.dbcp.AbandonedTrace.init(AbandonedTrace.java:92)&lt;br/&gt;
	at org.apache.commons.dbcp.AbandonedTrace.&amp;lt;init&amp;gt;(AbandonedTrace.java:82)&lt;br/&gt;
	at org.apache.commons.dbcp.DelegatingStatement.&amp;lt;init&amp;gt;(DelegatingStatement.java:61)&lt;br/&gt;
	at org.apache.commons.dbcp.DelegatingConnection.createStatement(DelegatingConnection.java:224)&lt;br/&gt;
	at org.apache.commons.dbcp.PoolableConnectionFactory.validateConnection(PoolableConnectionFactory.java:331)&lt;br/&gt;
	at org.apache.commons.dbcp.PoolableConnectionFactory.validateObject(PoolableConnectionFactory.java:312)&lt;br/&gt;
	at org.apache.commons.pool.impl.GenericObjectPool.evict(GenericObjectPool.java:1217)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x0af4d498&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool)&lt;br/&gt;
	at org.apache.commons.pool.impl.GenericObjectPool$Evictor.run(GenericObjectPool.java:1341)&lt;br/&gt;
	at java.util.TimerThread.mainLoop(Timer.java:512)&lt;br/&gt;
	at java.util.TimerThread.run(Timer.java:462)&lt;br/&gt;
&quot;extract_themes_from_message_command_container-2&quot;:&lt;br/&gt;
	at org.apache.commons.pool.impl.GenericObjectPool.addObjectToPool(GenericObjectPool.java:1136)&lt;/li&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x0af4d498&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool)&lt;br/&gt;
	at org.apache.commons.pool.impl.GenericObjectPool.returnObject(GenericObjectPool.java:1076)&lt;br/&gt;
	at org.apache.commons.dbcp.PoolableConnection.close(PoolableConnection.java:87)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x13cb66c0&amp;gt; (a org.apache.commons.dbcp.PoolableConnection)&lt;br/&gt;
	at org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.close(PoolingDataSource.java:181)&lt;br/&gt;
	at org.springframework.orm.hibernate3.LocalDataSourceConnectionProvider.closeConnection(LocalDataSourceConnectionProvider.java:96)&lt;br/&gt;
	at org.hibernate.jdbc.ConnectionManager.closeConnection(ConnectionManager.java:451)&lt;br/&gt;
	at org.hibernate.jdbc.ConnectionManager.aggressiveRelease(ConnectionManager.java:406)&lt;br/&gt;
	at org.hibernate.jdbc.ConnectionManager.afterTransaction(ConnectionManager.java:293)&lt;br/&gt;
	at org.hibernate.jdbc.JDBCContext.afterTransactionCompletion(JDBCContext.java:221)&lt;br/&gt;
	at org.hibernate.transaction.JDBCTransaction.commit(JDBCTransaction.java:119)&lt;br/&gt;
	at org.springframework.orm.hibernate3.HibernateTransactionManager.doCommit(HibernateTransactionManager.java:606)&lt;br/&gt;
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:709)&lt;br/&gt;
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:678)&lt;br/&gt;
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)&lt;br/&gt;
	at net.tramposys.log.context.hibernate.HibernateLogContextManager.createOrAssociateLogContextWithJmsMessage(HibernateLogContextManager.java:68)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor50.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:310)&lt;br/&gt;
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:198)&lt;br/&gt;
	at $Proxy30.createOrAssociateLogContextWithJmsMessage(Unknown Source)&lt;br/&gt;
	at net.tramposys.commandq.jms.JmsCommandExecutor.onMessage(JmsCommandExecutor.java:59)&lt;br/&gt;
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:531)&lt;br/&gt;
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:466)&lt;br/&gt;
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:435)&lt;br/&gt;
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:316)&lt;br/&gt;
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:235)&lt;br/&gt;
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:927)&lt;br/&gt;
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:851)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:613)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Operating System: All&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12413259">DBCP-281</key>
            <summary>[dbcp] Deadlock when evicting dbcp objects (testWhileIdle=true) [ re-open of DBCP-65]</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mccraig">craig mcmillan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jan 2009 13:58:54 +0000</created>
                <updated>Mon, 15 Feb 2010 02:28:47 +0000</updated>
                            <resolved>Tue, 27 Jan 2009 01:45:07 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12667545" author="psteitz" created="Tue, 27 Jan 2009 01:45:07 +0000"  >&lt;p&gt;Duplicates &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-270&quot; title=&quot;Dead lock using the evictor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-270&quot;&gt;&lt;del&gt;DBCP-270&lt;/del&gt;&lt;/a&gt;, which was fixed in r672097, when synchronization in AbandonedTrace#addTrace was changed to lock only the trace. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12342202">DBCP-65</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114558</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v04v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178995</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-280] SequencedHashMap constructor calls overridable method; throws Error</title>
                <link>https://issues.apache.org/jira/browse/DBCP-280</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The constructor SequencedHashMap(Map) calls the public non-final method putAll().&lt;/p&gt;

&lt;p&gt;This is likely to cause problems if the class is ever extended. Possible solution: extract the code into a common private method.&lt;/p&gt;

&lt;p&gt;The next() method also throws an Error if the return type is unexpected.&lt;br/&gt;
It should probably return IllegalStateException or similar.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12413214">DBCP-280</key>
            <summary>SequencedHashMap constructor calls overridable method; throws Error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Jan 2009 23:52:10 +0000</created>
                <updated>Mon, 15 Feb 2010 02:29:20 +0000</updated>
                            <resolved>Sun, 15 Mar 2009 21:32:20 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12667153" author="psteitz" created="Mon, 26 Jan 2009 00:17:45 +0000"  >&lt;p&gt;This class was copied from Commons Collections 2.1 and has package scope.  &lt;/p&gt;</comment>
                            <comment id="12667475" author="sebb@apache.org" created="Mon, 26 Jan 2009 22:45:13 +0000"  >&lt;p&gt;I don&apos;t see how the scope or the origin of the code affects this.&lt;/p&gt;

&lt;p&gt;If the class will never be extended, then make the class final.&lt;br/&gt;
If the method will never be overridden, then make the method final.&lt;br/&gt;
Otherwise, extract the code into a private method as originally suggested.&lt;/p&gt;

&lt;p&gt;Since the fix to make the code safe is easy to do, it seems to me that it is worth doing to avoid potential problems later.&lt;br/&gt;
I.e. defensive programming.&lt;/p&gt;</comment>
                            <comment id="12673904" author="psteitz" created="Mon, 16 Feb 2009 15:32:09 +0000"  >&lt;p&gt;I would like to leave the collections classes included in dbcp in exactly the same state that they were when incorporated unless and until a dbcp-impacting bug with one of these classes is identified.  Both SequencedHashMap and LRUMap (the class actually used) have package scope and javadoc headers indicating their lineage and that they are not to be made public.  I do not want us to take on maintaining forked versions unless and until we need to.&lt;/p&gt;</comment>
                            <comment id="12673915" author="sebb@apache.org" created="Mon, 16 Feb 2009 16:13:02 +0000"  >&lt;p&gt;I&apos;ve had a look at Collections (trunk), and the class SequencedHashMap is deprecated - it recommends using LinkedMap or ListOrderedMap instead  - so the Collections code is unlikely to be fixed.&lt;/p&gt;

&lt;p&gt;Unfortunately, LinkedMap is a sub-class of AbstractHashedMap which has the same problem (I&apos;ll raise a separate Jira for this).&lt;/p&gt;

&lt;p&gt;Perhaps a minimally invasive solution would be to make the SequencedHashMap - or putall() method - final in DBCP?&lt;/p&gt;

&lt;p&gt;The former would probably be better, given that the original class is now deprecated.&lt;/p&gt;</comment>
                            <comment id="12682179" author="markt" created="Sun, 15 Mar 2009 21:32:20 +0000"  >&lt;p&gt;SequencedHashMap cannot be made final. It is extended by LRUMap.&lt;/p&gt;

&lt;p&gt;Yes, the code could be improved. However code correctness is not a sufficient justification to fork the code when:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;there is no real world bug reported as a result of these issues&lt;/li&gt;
	&lt;li&gt;the classes are clearly marked as to lineage and that they are not to be made public&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43162</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178928</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>


<item>
            <title>[DBCP-279] unset XADatasource&apos;s property in BasicManagedDataSource class</title>
                <link>https://issues.apache.org/jira/browse/DBCP-279</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;hi,everyone:&lt;br/&gt;
 when i use dbcp1.3&apos;s source,i find no where to set XADatasource&apos;s connect parameter;such as url hasn&apos;t setted for XADatasource&apos;s instance.anyone response to me is very kindy.&lt;/p&gt;

&lt;p&gt; Paul qing&lt;br/&gt;
stacktrace is:&lt;br/&gt;
org.apache.commons.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (&#25351;&#23450;&#20102;&#26080;&#25928;&#30340; Oracle URL: OracleDataSource.makeURL)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1228)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:884)&lt;br/&gt;
	at com.test.xa.TestJtaWithXaDs.addUser(TestJtaWithXaDs.java:85)&lt;br/&gt;
	at com.test.xa.TestJtaWithXaDs.main(TestJtaWithXaDs.java:41)&lt;br/&gt;
Caused by: java.sql.SQLException: &#25351;&#23450;&#20102;&#26080;&#25928;&#30340; Oracle URL: OracleDataSource.makeURL&lt;br/&gt;
	at oracle.jdbc.dbaccess.DBError.throwSqlException(DBError.java:134)&lt;br/&gt;
	at oracle.jdbc.dbaccess.DBError.throwSqlException(DBError.java:179)&lt;br/&gt;
	at oracle.jdbc.dbaccess.DBError.check_error(DBError.java:1130)&lt;br/&gt;
	at oracle.jdbc.pool.OracleDataSource.makeURL(OracleDataSource.java:966)&lt;br/&gt;
	at oracle.jdbc.pool.OracleDataSource.getURL(OracleDataSource.java:575)&lt;br/&gt;
	at oracle.jdbc.xa.client.OracleXADataSource.getXAConnection(OracleXADataSource.java:115)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.DataSourceXAConnectionFactory.createConnection(DataSourceXAConnectionFactory.java:103)&lt;br/&gt;
	at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:298)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.validateConnectionFactory(BasicDataSource.java:1340)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1224)&lt;/p&gt;</description>
                <environment>&lt;p&gt;jdk1.5(via BasicManagedDataSource class to create ds.)&lt;/p&gt;</environment>
        <key id="12411032">DBCP-279</key>
            <summary>unset XADatasource&apos;s property in BasicManagedDataSource class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="paulqing">paul qing</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Dec 2008 05:13:50 +0000</created>
                <updated>Mon, 16 May 2011 21:46:49 +0000</updated>
                            <resolved>Wed, 18 Feb 2009 17:02:59 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="12658019" author="paulqing" created="Fri, 19 Dec 2008 06:31:55 +0000"  >&lt;p&gt;org.apache.commons.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (&#25351;&#23450;&#20102;&#26080;&#25928;&#30340; Oracle URL: OracleDataSource.makeURL)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1228)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:884)&lt;br/&gt;
	at com.test.xa.TestJtaWithXaDs.addUser(TestJtaWithXaDs.java:85)&lt;br/&gt;
	at com.test.xa.TestJtaWithXaDs.main(TestJtaWithXaDs.java:41)&lt;br/&gt;
Caused by: java.sql.SQLException: &#25351;&#23450;&#20102;&#26080;&#25928;&#30340; Oracle URL: OracleDataSource.makeURL&lt;br/&gt;
	at oracle.jdbc.dbaccess.DBError.throwSqlException(DBError.java:134)&lt;br/&gt;
	at oracle.jdbc.dbaccess.DBError.throwSqlException(DBError.java:179)&lt;br/&gt;
	at oracle.jdbc.dbaccess.DBError.check_error(DBError.java:1130)&lt;br/&gt;
	at oracle.jdbc.pool.OracleDataSource.makeURL(OracleDataSource.java:966)&lt;br/&gt;
	at oracle.jdbc.pool.OracleDataSource.getURL(OracleDataSource.java:575)&lt;br/&gt;
	at oracle.jdbc.xa.client.OracleXADataSource.getXAConnection(OracleXADataSource.java:115)&lt;br/&gt;
	at org.apache.commons.dbcp.managed.DataSourceXAConnectionFactory.createConnection(DataSourceXAConnectionFactory.java:103)&lt;br/&gt;
	at org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:298)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.validateConnectionFactory(BasicDataSource.java:1340)&lt;br/&gt;
	at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1224)&lt;/p&gt;</comment>
                            <comment id="12674698" author="markt" created="Wed, 18 Feb 2009 17:02:59 +0000"  >&lt;p&gt;Not sure which version of the source you are using. There is no 1.3 yet.&lt;/p&gt;

&lt;p&gt;This looks like a configuration/usage issue to me. Please use the users list for assistance.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12507417">DBCP-360</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179019</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>