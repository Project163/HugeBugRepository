diff --git a/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileSystem.java b/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileSystem.java
index fc8bfc41..97b700bd 100644
--- a/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileSystem.java
+++ b/core/src/main/java/org/apache/commons/vfs2/provider/local/LocalFileSystem.java
@@ -28,6 +28,7 @@ import org.apache.commons.vfs2.FileSystemException;
 import org.apache.commons.vfs2.FileSystemOptions;
 import org.apache.commons.vfs2.provider.AbstractFileName;
 import org.apache.commons.vfs2.provider.AbstractFileSystem;
+import org.apache.commons.vfs2.util.FileObjectUtils;
 
 /**
  * A local file system.
@@ -72,7 +73,7 @@ public class LocalFileSystem
                                    final FileSelector selector)
         throws Exception
     {
-        final LocalFile localFile = (LocalFile) fileObject;
+        final LocalFile localFile = (LocalFile) FileObjectUtils.getAbstractFileObject(fileObject);
         final File file = localFile.getLocalFile();
         final SecurityManager sm = System.getSecurityManager();
         if (sm != null)
diff --git a/core/src/test/java/org/apache/commons/vfs2/test/VerifyingFileSelector.java b/core/src/test/java/org/apache/commons/vfs2/test/VerifyingFileSelector.java
index 6bfdb6d8..c34f9f2c 100644
--- a/core/src/test/java/org/apache/commons/vfs2/test/VerifyingFileSelector.java
+++ b/core/src/test/java/org/apache/commons/vfs2/test/VerifyingFileSelector.java
@@ -26,6 +26,8 @@ import org.apache.commons.vfs2.FileSelectInfo;
 import org.apache.commons.vfs2.FileSelector;
 import org.apache.commons.vfs2.FileSystemException;
 import org.apache.commons.vfs2.FileType;
+import org.apache.commons.vfs2.provider.AbstractFileObject;
+import org.apache.commons.vfs2.util.FileObjectUtils;
 import org.junit.Assert;
 
 /**
@@ -88,7 +90,7 @@ public class VerifyingFileSelector
         throws FileSystemException
     {
         // Check that the given file is a folder
-        final FileObject folder = fileInfo.getFile();
+        final FileObject folder = FileObjectUtils.getAbstractFileObject(fileInfo.getFile());
         assertSame(FileType.FOLDER, folder.getType());
         assertTrue(folder.isFolder());
 
@@ -101,7 +103,8 @@ public class VerifyingFileSelector
         }
         else
         {
-            assertSame(currentFolder, folder.getParent());
+            AbstractFileObject parent = FileObjectUtils.getAbstractFileObject(folder.getParent());
+            assertSame(currentFolder, parent);
 
             // Locate the info for the child, and make sure it is folder
             currentFolderInfo = getChild(baseName);
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 67efcea4..2620721f 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -26,8 +26,11 @@
 <!--       <action issue="VFS-443" dev="ggregory" type="update" due-to="nickallen"> -->
 <!--        [Local] Need an easy way to convert from a FileObject to a File. -->
 <!--       </action> -->
+      <action issue="VFS-279" dev="ecki" type="fix" due-to="Didier Earith, Simon Legner">
+        [local] Avoid ClassCastException when replicating local files while OnCall caching is active.
+      </action>
       <action issue="VFS-297" dev="joehni" type="fix" due-to="Kirill Safonov, Jimmy Praet">
-        [core/sftp] VSF fails to reuse FileSystem instances if FileSystemOptions contain
+        [sftp] VSF fails to reuse FileSystem instances if FileSystemOptions contain
         an array as value. Reported for SFTP using identities.
       </action>
       <action issue="VFS-198" dev="ecki" type="add" due-to="Andrew Franklin, Simon Legner">
