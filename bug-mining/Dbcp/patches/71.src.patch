diff --git a/src/java/org/apache/commons/dbcp/datasources/PerUserPoolDataSource.java b/src/java/org/apache/commons/dbcp/datasources/PerUserPoolDataSource.java
index 764c6fab..594e8338 100644
--- a/src/java/org/apache/commons/dbcp/datasources/PerUserPoolDataSource.java
+++ b/src/java/org/apache/commons/dbcp/datasources/PerUserPoolDataSource.java
@@ -364,8 +364,9 @@ public class PerUserPoolDataSource
         throws SQLException {
 
         PoolKey key = getPoolKey(username,password);
-        Object pool = pools.get(key);
+        Object pool;
         synchronized(this) {
+            pool = pools.get(key);
             if (pool == null) {
                 try {
                     registerPool(username, password);
@@ -498,7 +499,10 @@ public class PerUserPoolDataSource
                                   isRollbackAfterValidation(), 
                                   username, password);
            
-        pools.put(getPoolKey(username,password), pool);
+        Object old = pools.put(getPoolKey(username,password), pool);
+        if (old != null) {
+            throw new IllegalStateException("Pool already contains an entry for this user/password: "+username);
+        }
     }
 
     /**
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index fcc26683..0a3de2ff 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -49,6 +49,9 @@ The <action> type attribute can be add,update,fix,remove.
      changes below since 1.2.2 applies to both the 1.3 and 1.4 release.  Other than
      the one issue related to adding JDBC 4 support (DBCP-191), all bug fixes
      or new features are included in both DBCP 1.3 and 1.4 ">
+      <action dev="sebb" type="fix" issue="DBCP-318" due-to="Sebastian Bazley">
+        PerUserPoolDataSource.getPooledConnectionAndInfo multi-threading bug.
+      </action>
       <action dev="sebb" type="fix" issue="DBCP-315" due-to="Sebastian Bazley">
         Remove throws clause from method that does not throw an exception.
       </action>
