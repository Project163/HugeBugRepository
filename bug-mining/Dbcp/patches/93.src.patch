diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 53b65ca9..c10c7755 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -100,6 +100,11 @@ The <action> type attribute can be add,update,fix,remove.
         Correct implementation of DelegatingConnection.isWrapperFor() so it
         works correctly with older JDBC drivers.
       </action>
+      <action dev="markt" issue="DBCP-347" type="fix" due-to="Robert Poskrobek">
+        Correct implementation of DelegatingStatement.isWrapperFor(). Also fix
+        DelegatingDatabaseMetaData.isWrapperFor() and
+        DelegatingResultSet.isWrapperFor() that had the same problem.
+      </action>
     </release>
     <release version="1.4.1" date="TBD" description="TBD">
       <action dev="psteitz" issue="DBCP-334" type="update" due-to="Alberto Mozzone">
diff --git a/src/java/org/apache/commons/dbcp2/DelegatingDatabaseMetaData.java b/src/java/org/apache/commons/dbcp2/DelegatingDatabaseMetaData.java
index 966e481e..29048a02 100644
--- a/src/java/org/apache/commons/dbcp2/DelegatingDatabaseMetaData.java
+++ b/src/java/org/apache/commons/dbcp2/DelegatingDatabaseMetaData.java
@@ -1287,7 +1287,13 @@ public class DelegatingDatabaseMetaData implements DatabaseMetaData {
 
     @Override
     public boolean isWrapperFor(Class<?> iface) throws SQLException {
-        return iface.isAssignableFrom(getClass()) || _meta.isWrapperFor(iface);
+        if (iface.isAssignableFrom(getClass())) {
+            return true;
+        } else if (iface.isAssignableFrom(_meta.getClass())) {
+            return true;
+        } else {
+            return _meta.isWrapperFor(iface);
+        }
     }
 
     @Override
diff --git a/src/java/org/apache/commons/dbcp2/DelegatingResultSet.java b/src/java/org/apache/commons/dbcp2/DelegatingResultSet.java
index 8fbc4836..7d44fa3c 100644
--- a/src/java/org/apache/commons/dbcp2/DelegatingResultSet.java
+++ b/src/java/org/apache/commons/dbcp2/DelegatingResultSet.java
@@ -775,7 +775,13 @@ public class DelegatingResultSet extends AbandonedTrace implements ResultSet {
 
     @Override
     public boolean isWrapperFor(Class<?> iface) throws SQLException {
-        return iface.isAssignableFrom(getClass()) || _res.isWrapperFor(iface);
+        if (iface.isAssignableFrom(getClass())) {
+            return true;
+        } else if (iface.isAssignableFrom(_res.getClass())) {
+            return true;
+        } else {
+            return _res.isWrapperFor(iface);
+        }
     }
 
     @Override
diff --git a/src/java/org/apache/commons/dbcp2/DelegatingStatement.java b/src/java/org/apache/commons/dbcp2/DelegatingStatement.java
index c8aaee7a..e9a91f4d 100644
--- a/src/java/org/apache/commons/dbcp2/DelegatingStatement.java
+++ b/src/java/org/apache/commons/dbcp2/DelegatingStatement.java
@@ -495,7 +495,13 @@ public class DelegatingStatement extends AbandonedTrace implements Statement {
 
     @Override
     public boolean isWrapperFor(Class<?> iface) throws SQLException {
-        return iface.isAssignableFrom(getClass()) || _stmt.isWrapperFor(iface);
+        if (iface.isAssignableFrom(getClass())) {
+            return true;
+        } else if (iface.isAssignableFrom(_stmt.getClass())) {
+            return true;
+        } else {
+            return _stmt.isWrapperFor(iface);
+        }
     }
 
     @Override
diff --git a/src/test/org/apache/commons/dbcp2/TestDelegatingStatement.java b/src/test/org/apache/commons/dbcp2/TestDelegatingStatement.java
index 2548d1a5..95614d0e 100644
--- a/src/test/org/apache/commons/dbcp2/TestDelegatingStatement.java
+++ b/src/test/org/apache/commons/dbcp2/TestDelegatingStatement.java
@@ -17,6 +17,7 @@
 
 package org.apache.commons.dbcp2;
 
+import java.lang.reflect.Proxy;
 import java.sql.Connection;
 import java.sql.SQLException;
 import java.sql.Statement;
@@ -108,4 +109,33 @@ public class TestDelegatingStatement extends TestCase {
             // expected
         }
     }
+    
+    public void testIsWrapperFor() throws Exception {
+        TesterConnection tstConn = new TesterConnection("test", "test");
+        TesterStatement tstStmt = new TesterStatementNonWrapping(tstConn);
+        DelegatingConnection<TesterConnection> conn = new DelegatingConnection<>(tstConn);
+        DelegatingStatement stmt = new DelegatingStatement(conn, tstStmt);
+
+        Class<?> stmtProxyClass = Proxy.getProxyClass(
+                this.getClass().getClassLoader(), 
+                Statement.class);
+        
+        assertTrue(stmt.isWrapperFor(DelegatingStatement.class));
+        assertTrue(stmt.isWrapperFor(TesterStatement.class));
+        assertFalse(stmt.isWrapperFor(stmtProxyClass));
+        
+        stmt.close();
+    }
+    
+    private static class TesterStatementNonWrapping extends TesterStatement {
+
+        public TesterStatementNonWrapping(Connection conn) {
+            super(conn);
+        }
+     
+        @Override
+        public boolean isWrapperFor(Class<?> iface) throws SQLException {
+            return false;
+        }
+    }
 }
